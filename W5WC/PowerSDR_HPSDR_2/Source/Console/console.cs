//=================================================================
// console.cs
//=================================================================
// PowerSDR is a C# implementation of a Software Defined Radio.
// Copyright (C) 2004-2009  FlexRadio Systems
//
// This program is free software; you can redistribute it and/or
// modify it under the terms of the GNU General Public License
// as published by the Free Software Foundation; either version 2
// of the License, or (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
//
// You may contact us via email at: sales@flex-radio.com.
// Paper mail may be sent to: 
//    FlexRadio Systems
//    8900 Marybank Dr.
//    Austin, TX 78750
//    USA
//=================================================================

//
// SoftRock and HPSDR Modifications Copyright (C) 2005, 2006, 2007, 2008, 2009, 2010, 2011 Bill Tracey (kd5tfd)
//
//#define INTERLEAVED
//#define SPLIT_INTERLEAVED
//#define SDRX

namespace PowerSDR
{
    using System;
    using System.Collections;
    using System.Collections.Generic;
    using System.Diagnostics;
    using System.Drawing;
    using System.Drawing.Drawing2D;
    using System.Drawing.Text;
    using System.Globalization;
    using System.IO;
    using System.IO.Ports;
    using System.Net;
    using System.Reflection;
    using System.Threading;
    using System.Text;
    using System.Windows.Forms;

    using FlexCW;

    #region Enums

    public enum FWCATUMode
    {
        FIRST = -1,
        Bypass,
        SemiAutomatic,
        Automatic,
        LAST,
    }

    public enum AntMode
    {
        Simple = 0,
        Expert,
    }

    public enum Window
    {
        FIRST = -1,
        RECTANGULAR,
        HANNING,
        WELCH,
        PARZEN,
        BARTLETT,
        HAMMING,
        BLACKMAN2,
        BLACKMAN3,
        BLACKMAN4,
        EXPONENTIAL,
        RIEMANN,
        BLKHARRIS,
        LAST,
    }

    public enum FWCAnt
    {
        NC = 0,
        ANT1,
        ANT2,
        ANT3,
        RX1IN,
        RX2IN,
        RX1TAP,
        SIG_GEN,
    }

    public enum RenderType
    {
        HARDWARE = 0,
        SOFTWARE,
        NONE,
    }

    public enum ColorSheme
    {
        original = 0,
        enhanced,
        SPECTRAN,
        BLACKWHITE,
        LinLog,
        LinRad,
        LinAuto,
        off,
    }

    public enum MultiMeterDisplayMode
    {
        Original = 0,
        Edge,
        Analog,
    }

    public enum FilterWidthMode
    {
        Linear = 0,
        Log,
        Log10,
    }

    public enum DisplayEngine
    {
        GDI_PLUS = 0,
        DIRECT_X,
    }

    public enum Model
    {
        SDR1000 = 0,
        SOFTROCK40,
        DEMO,
        FLEX5000,
        SDRX,
        FLEX3000,
        FLEX1500,
        HPSDR,
        HERMES,
    }

    public enum BPFBand
    {
        NONE = -1,
        B160,
        B60,
        B20,
        B40,
        B10,
        B6,
    }

    public enum RFELPFBand
    {
        NONE = -1,
        AUX,
        B6,
        B60,
        B20,
        B30,
        B40,
        B1210,
        B80,
        B1715,
        B160,
    }

    public enum PAFBand
    {
        NONE = 0,
        B1210,
        B1715,
        B3020,
        B6040,
        B80,
        B160,
    }

    public enum XVTRTRMode
    {
        NEGATIVE = 0,	// DEMI144-28FRS
        POSITIVE,		// 25W DEMI
        NONE,			// For Elecraft or similar XVTR
    }

    public enum SoundCard
    {
        FIRST = -1,
        UNSUPPORTED_CARD,
        DELTA_44,
        FIREBOX,
        EDIROL_FA_66,
        AUDIGY,
        AUDIGY_2,
        AUDIGY_2_ZS,
        EXTIGY,
        MP3_PLUS,
        SANTA_CRUZ,
        HPSDR,
        LAST,
    }

    public enum DisplayMode
    {
        FIRST = -1,
        SPECTRUM,
        PANADAPTER,
        SCOPE,
        SCOPE2,
        PHASE,
        PHASE2,
        WATERFALL,
        HISTOGRAM,
        PANAFALL,
        PANASCOPE,
        SPECTRASCOPE,
        OFF,
        LAST,
    }

    public enum AGCMode
    {
        FIRST = -1,
        FIXD,
        LONG,
        SLOW,
        MED,
        FAST,
        CUSTOM,
        LAST,
    }

    public enum MeterRXMode
    {
        FIRST = -1,
        SIGNAL_STRENGTH,
        SIGNAL_AVERAGE,
        ADC_L,
        ADC_R,
        ADC2_L,
        ADC2_R,
        OFF,
        LAST,
    }

    public enum MeterTXMode
    {
        FIRST = -1,
        FORWARD_POWER,
        REVERSE_POWER,
        MIC,
        EQ,
        LEVELER,
        LVL_G,
        COMP,
        CPDR,
        ALC,
        ALC_G,
        SWR,
        OFF,
        LAST,
    }

    public enum KeyerLine
    {
        None = 0,
        DTR,
        RTS,
    }

    public enum DateTimeMode
    {
        OFF = 0,
        LOCAL,
        UTC,
        LAST,
    }

    public enum FRSRegion
    {
        FIRST = -1,
        US = 0,
        Spain = 1,
        Europe = 2,
        UK = 3,
        Italy_Plus = 4,
        Japan = 5,
        Australia = 6,
        Norway = 7,
        Denmark = 8,
        Latvia = 9,
        Slovakia = 10,
        Bulgaria = 11,
        Greece = 12,
        Hungary = 13,
        Netherlands = 14,
        France = 15,
        Russia = 16,
        Israel = 17,
        Extended = 18,
        LAST,
    }

    public enum PreampMode
    {
        FIRST = -1,
        OFF,
        LOW,
        MED,
        HIGH,
        HPSDR_OFF,
        HPSDR_ON,
        HPSDR_MINUS10,
        HPSDR_MINUS20,
        HPSDR_MINUS30,
        HPSDR_MINUS40,
        HPSDR_MINUS50,
        LAST,
    }

    public enum StatusPin
    {
        PIN_12 = 0x08,		//S3
        Dash = 0x10,		//S4
        Dot = 0x20,		//S5
        PA_DATA = 0x40,		//S6
        PIN_11 = 0x80,		//S7\
    }

    public enum ATUTuneMode
    {
        FIRST = -1,
        BYPASS,
        MEMORY,
        FULL,
        LAST,
    }

    public enum DSPMode
    {
        FIRST = -1,
        LSB,
        USB,
        DSB,
        CWL,
        CWU,
        FM,
        AM,
        DIGU,
        SPEC,
        DIGL,
        SAM,
        DRM,
        LAST,
    }

    public enum Band
    {
        FIRST = -1,
        GEN,
        B160M,
        B80M,
        B60M,
        B40M,
        B30M,
        B20M,
        B17M,
        B15M,
        B12M,
        B10M,
        B6M,
        B2M,
        WWV,
        VHF0,
        VHF1,
        VHF2,
        VHF3,
        VHF4,
        VHF5,
        VHF6,
        VHF7,
        VHF8,
        VHF9,
        VHF10,
        VHF11,
        VHF12,
        VHF13,
        LAST,
    }

    public enum Filter
    {
        FIRST = -1,
        F1,
        F2,
        F3,
        F4,
        F5,
        F6,
        F7,
        F8,
        F9,
        F10,
        VAR1,
        VAR2,
        NONE,
        LAST,
    }

    public enum PTTMode
    {
        FIRST = -1,
        NONE,
        MANUAL,
        MIC,
        CW,
        X2,
        CAT,
        VOX,
        LAST,
    }

    public enum DisplayLabelAlignment
    {
        FIRST = -1,
        LEFT,
        CENTER,
        RIGHT,
        AUTO,
        OFF,
        LAST,
    }

    public enum ClickTuneMode
    {
        Off = 0,
        VFOA,
        VFOB,
        //VFOAC,
    }

    public enum FMTXMode
    {
        // Order is chosen carefully here for memory form -- take care before rearranging
        High = 0,   // +
        Simplex,    // S
        Low,        // -     
    }

    #endregion

    unsafe public class Console : System.Windows.Forms.Form
    {
        #region Variable Declarations
        // ======================================================
        // Variable Declarations
        // ======================================================

        public Radio radio;
        private SIOListenerII siolisten = null;

        private Thread[] audio_process_thread;				// threads to run DttSP functions
        private Thread draw_display_thread;					// draws the main display 
        private Thread multimeter_thread;					// updates the rx1/tx meter data
        private Thread rx2_meter_thread;					// updates the rx2 meter data
        private Thread poll_ptt_thread;						// polls the PTT line on the parallel port
        private Thread poll_pa_pwr_thread;					// polls the FWD and REV power if the PA is installed
        private Thread sql_update_thread;					// polls the RX signal strength
        private Thread rx2_sql_update_thread;				// polls the RX2 signal strength
        private Thread vox_update_thread;					// polls the mic input
        private Thread noise_gate_update_thread;			// polls the mic input during TX
        private Thread f3k_temp_thread;				// polls the temp on the FLEX-3000 to turn fan on/off
        private Thread f3k_mic_function_thread;				// handles the FLEX-3000 mic inputs (Up, Down, Fast)
        //private Thread wbir_thread;
        // private Thread wbir_rx2_thread;
      // private Thread update_rx1_dds_thread;
      //  private Thread update_rx2_dds_thread;
      //  private Thread update_tx_dds_thread;
        //private Thread audio_watchdog_thread;
        // private Thread digital_watchdog_thread;
        //private HiPerfTimer polltimer;

        private bool calibration_running = false;
        private bool displaydidit = false;
        //private bool calibrationdidit = false;
        public Mutex calibration_mutex = new Mutex();

        public Setup SetupForm;
        public CWX CWXForm;
        public UCBForm UCBForm;
        public XVTRForm XVTRForm;
        public EQForm EQForm;
        public FilterForm filterRX1Form;
        public FilterForm filterRX2Form;
        public DiversityForm diversityForm;
        //public FWCForm fwcForm;
        public FLEX5000LLHWForm flex5000LLHWForm;
        public FLEX5000DebugForm flex5000DebugForm;
        public FWCMixForm fwcMixForm;
        public FLEX3000MixerForm flex3000MixerForm;
        public FWCAntForm fwcAntForm;
        public FLEX5000RelayForm flex5000RelayForm;
        public FWCATUForm fwcAtuForm;
        public FLEX3000ATUForm flex3000ATUForm;
        public FWCTestForm fwcTestForm;
        public FLEX5000LPFForm flex5000LPFForm;
        public FWCCalForm fwcCalForm;
        public FLEX5000ProdTestForm flex5000ProdTestForm;
        public FLEX5000FinalTestForm flex5000FinalTestForm;
        public FLEX5000RX2CalForm flex5000RX2CalForm;
        public FLEX3000TestForm flex3000TestForm;
        public DSPTestForm dspTestForm;
        public PreSelForm preSelForm;
        public Predistest predistForm;
        public bool buffiszero = false;
        public bool fwc_init = false;
        public int fwc_index = -1;
        private long fwc_last_cal_date_time = 0;
        private uint fwc_serial_num = 0;
        private uint fwc_trx_serial_num = 0;
        private uint rx2_trx_match_serial = 0;

        private int rx1_squelch_threshold_scroll = -160;
        private int rx2_squelch_threshold_scroll = -160;
        private bool rx1_squelch_on = false;
        private bool rx2_squelch_on = false;
        private int rx1_fm_squelch_threshold_scroll = 0;
        private int rx2_fm_squelch_threshold_scroll = 0;

        private long rx2_last_cal_date_time = 0;
        private uint rx2_serial_num = 0;

        public MemoryForm memoryForm;
        public MemoryList MemoryList { get; private set; }

        //public Memory MemForm;
        private HW hw;     // will eventually be an array of rigs to support multiple radios

        private bool whatisVHF = false;  //w3sz true if VHF panel is being displayed
        private bool whatisHF = true;   //w3sz true if HF panel is being displayed
        private bool iscollapsed = false;  //w3sz true if collapsed panel is being displayed
        private bool isexpanded = true;   //w3sz true if expanded panel is being displayed

        public WaveControl WaveForm;
        public PAQualify PAQualForm;
        //public ProductionTest ProdTestForm;

        private bool run_setup_wizard;						// Used to run the wizard the first time the software comes up
        private bool show_alpha_warning = false;
        //   private bool show_mobile_warning = false;

        private int band_160m_index;						// These band indexes are used to keep track of which
        private int band_80m_index;							// location in the bandstack was last saved/recalled
        private int band_60m_index;
        private int band_40m_index;
        private int band_30m_index;
        private int band_20m_index;
        private int band_17m_index;
        private int band_15m_index;
        private int band_12m_index;
        private int band_10m_index;
        private int band_6m_index;
        private int band_2m_index;
        private int band_wwv_index;
        private int band_gen_index;
        private int band_vhf0_index;
        private int band_vhf1_index;
        private int band_vhf2_index;
        private int band_vhf3_index;
        private int band_vhf4_index;
        private int band_vhf5_index;
        private int band_vhf6_index;
        private int band_vhf7_index;
        private int band_vhf8_index;
        private int band_vhf9_index;
        private int band_vhf10_index;
        private int band_vhf11_index;
        private int band_vhf12_index;
        private int band_vhf13_index;

        private int band_160m_register;						// These integers are the number of band stack registers
        private int band_80m_register;						// found in the database for each band
        public int band_60m_register;
        private int band_40m_register;
        private int band_30m_register;
        private int band_20m_register;
        private int band_17m_register;
        private int band_15m_register;
        private int band_12m_register;
        private int band_10m_register;
        private int band_6m_register;
        private int band_2m_register;
        private int band_wwv_register;
        private int band_gen_register;
        private int band_vhf0_register;
        private int band_vhf1_register;
        private int band_vhf2_register;
        private int band_vhf3_register;
        private int band_vhf4_register;
        private int band_vhf5_register;
        private int band_vhf6_register;
        private int band_vhf7_register;
        private int band_vhf8_register;
        private int band_vhf9_register;
        private int band_vhf10_register;
        private int band_vhf11_register;
        private int band_vhf12_register;
        private int band_vhf13_register;

        //private double[] wheel_tune_list;					// A list of available tuning steps
        //private int wheel_tune_index;		
        // An index into the above array

        // private bool fcenter = true;

        private RadioButtonTS[] vhf_text;
        private bool was_panadapter = false;				// used to restore panadater when switching to spectrum DSP mode
        private bool was_waterfall = false;					// used to restore waterfall when switching to spectrum DSP mode

        public float[] rx1_preamp_offset;					// offset values for each preamp mode in dB
        public float[] rx2_preamp_offset;					// offset values for each preamp mode in dB
        public float rx1_meter_cal_offset;					// multimeter calibration offset per volume setting in dB
        public float rx2_meter_cal_offset;					// multimeter calibration offset per volume setting in dB
        public float rx1_filter_size_cal_offset = 0;		// filter offset based on DSP filter size
        public float rx2_filter_size_cal_offset = 3;		// filter offset based on DSP filter size

        private bool meter_data_ready;						// used to synchronize the new DSP data with the multimeter
        private float new_meter_data;						// new data for the multimeter from the DSP
        private float current_meter_data;					// current data for the multimeter
        private int meter_peak_count;						// Counter for peak hold on multimeter
        private int meter_peak_value;						// Value for peak hold on multimeter
        private float[] meter_text_history;					// Array used to output the peak power over a period of time
        private int meter_text_history_index;				// index used with above variable to do peak power

        private bool rx2_meter_data_ready;					// used to synchronize the new DSP data with the multimeter
        private float rx2_meter_new_data;					// new data for the multimeter from the DSP
        private float rx2_meter_current_data;				// current data for the multimeter
        private int rx2_meter_peak_count;					// Counter for peak hold on multimeter
        private int rx2_meter_peak_value;					// Value for peak hold on multimeter

        public float[][] power_table;						// table used to store power in new power cal routine
        public int pa_fwd_power;							// forward power as read by the ADC on the PA
        public int pa_rev_power;							// reverse power as read by the ADC on the PA
        public double alex_fwd_power;
        public double alex_rev_power;
        private bool tuning;								// true when the TUN button is active
        public bool atu_tuning;		    					// true while the atu is tuning
        private Band tuned_band;							// last band that the atu was tuned on

        public float[] rx1_image_gain_table;				// table used to store image cal info
        public float[] rx1_image_phase_table;				// table used to store image cal info
        public float[] rx2_image_gain_table;				// table used to store image cal info
        public float[] rx2_image_phase_table;				// table used to store image cal info
        public float[] tx_image_gain_table;					// table used to store image cal info
        public float[] tx_image_phase_table;				// table used to store image cal info
        public int[][] tx_carrier_table;					// table used to store tx carrier cal info
        public int[][] pa_bias_table;						// table used to store PA Bias settings
        public float[][] rx1_level_table;					// table used to store RX1 Level cal settings
        public float[][] rx2_level_table;					// table used to store RX2 Level cal settings
        public float[][] pa_bridge_table;					// table used to store PA Bridge cal settings
        public float[] swr_table;							// table used to calibrate SWR
        public float[] atu_swr_table;						// table used to cal SWR at ATU power
        public float rx2_res_offset;

        public byte rx1_level_checksum;
        public byte rx1_image_gain_checksum;
        public byte rx1_image_phase_checksum;
        public byte tx_image_gain_checksum;
        public byte tx_image_phase_checksum;
        public byte tx_carrier_checksum;
        public byte pa_bias_checksum;
        public byte pa_bridge_checksum;
        public byte pa_power_checksum;
        public byte pa_swr_checksum;
        public byte atu_swr_checksum;

        public byte rx2_level_checksum;
        public byte rx2_image_gain_checksum;
        public byte rx2_image_phase_checksum;

        public double[] CTCSS_array =  {
            67.0 , 69.3 , 71.9 , 74.4 , 77.0 , 79.7 , 82.5 , 85.4 , 88.5 , 91.5 ,
            94.8 , 97.4 , 100.0, 103.5, 107.2, 110.9, 114.8, 118.8, 123.0, 127.3,
            131.8, 136.5, 141.3, 146.2, 151.4, 156.7, 159.8, 162.2, 165.5, 167.9,
            171.3, 173.8, 177.3, 179.9, 183.5, 186.2, 189.9, 192.8, 199.5, 203.5,
            206.5, 210.7, 218.1, 225.7, 229.1, 233.6, 241.8, 250.3, 254.1};

        public double[] FM_deviation_array = { 5000, 2500 };

        private bool shift_down;							// used to modify tuning rate
        private bool calibrating;							// true if running a calibration routine
        private bool manual_mox;							// True if the MOX button was clicked on (not PTT)		

        private DSPMode vfob_dsp_mode;						// Saves control pointer for last mode used on VFO B 
        private Filter vfob_filter;							// Saves control pointer for last filter used on VFO B
        private int vfo_char_width;							// Used to calibrate mousewheel tuning
        private int vfo_char_space;							// Used to calibrate mousewheel tuning
        private int vfo_small_char_width;					// Used to calibrate mousewheel tuning
        private int vfo_small_char_space;					// Used to calibrate mousewheel tuning
        private int vfo_decimal_width;						// Used to calibrate mousewheel tuning
        private int vfo_decimal_space;						// Used to calibrate mousewheel tuning		
        private int vfo_sub_char_width;						// Used to calibrate mousewheel tuning
        private int vfo_sub_char_space;						// Used to calibrate mousewheel tuning
        //private int vfo_sub_small_char_width;				// Used to calibrate mousewheel tuning
        //private int vfo_sub_small_char_space;				// Used to calibrate mousewheel tuning
        private int vfo_sub_decimal_width;					// Used to calibrate mousewheel tuning
        private int vfo_sub_decimal_space;					// Used to calibrate mousewheel tuning	
        private int vfo_pixel_offset;						// Used to calibrate mousewheel tuning
        private int vfoa_hover_digit;						// Digit for hover display
        private int vfo_sub_pixel_offset;
        private int vfoa_sub_hover_digit;					// Digit for VFOA sub hover display
        private int vfob_hover_digit;						// Digit for hover display
        private string last_band;							// Used in bandstacking algorithm

        private DSPMode quick_save_mode;					// Quick Save Mode
        private Filter quick_save_filter;					// Quick Save Filter

        private string separator;							// contains the locations specific decimal separator

        private int last_filter_shift;						// VK6APH
        private int last_var1_shift;						// VK6APH 
        private int last_var2_shift;						// VK6APH

        public string[] CmdLineArgs;

        private double rx1_avg_last_ddsfreq = 0;				// Used to move the display average when tuning
        private double rx1_avg_last_dttsp_osc = 0;
        private double rx1_last_bin_shift_leftover = 0;

        private double rx2_avg_last_ddsfreq = 0;				// Used to move the display average when tuning
       // private double rx2_avg_last_dttsp_osc = 0;
        private double rx2_last_bin_shift_leftover = 0;

        //    public CWKeyer2 Keyer;
        private HiPerfTimer break_in_timer;
        public double avg_vox_pwr = 0.0;
        public string pwr_mode;
        private bool gridmaxadjust = false;
        private bool gridminadjust = false;
        private bool wfmaxadjust = false;
        private bool wfminadjust = false;

        // BT 11/05/2007
        public PowerSDR.RemoteProfiles ProfileForm;
        private string machineName = System.Environment.MachineName;

        //EHR 25Mar08
        // private TDxInput.Device TDxDevice;
        // private TDxInput.Sensor TDxSensor;

        public bool initializing = true;

        private int h_delta = 0;		//k6jca 1/15/08
        private int v_delta = 0;		//k6jca 1/15/08

        private int previous_delta = 0;  //k6jca

        private Size console_basis_size = new Size(100, 100);		//k6jca
        private Point gr_filter_basis_location = new Point(100, 100);		//k6jca
        private Point gr_Multimeter_basis_location = new Point(100, 100);		//k6jca
        private Point gr_BandHF_basis_location = new Point(100, 100);		//k6jca
        private Point gr_BandVHF_basis_location = new Point(100, 100);		//k6jca
        private Point gr_Mode_basis_location = new Point(100, 100);		//k6jca
        private Point gr_VFOB_basis_location = new Point(100, 100);		//k6jca
        private Point gr_VFOA_basis_location = new Point(100, 100);		//k6jca
        private Point gr_ModePhone_basis_location = new Point(100, 100);		//k6jca
        private Point gr_ModeCW_basis_location = new Point(100, 100);		//k6jca
        private Point gr_ModeDig_basis_location = new Point(100, 100);		//k6jca
        private Point gr_ModeFM_basis_location = new Point(100, 100);  // anonymous
        private Point gr_VFO_basis_location = new Point(100, 100);		//k6jca
        private Point gr_vfobetween_basis_location = new Point(100, 100);		//k6jca
        private Point btn_display_pan_center_basis = new Point(100, 100);		//k6jca
        private Point tb_display_pan_basis = new Point(100, 100);		//k6jca
        private Size tb_display_pan_size_basis = new Size(100, 100);		//k6jca
        private Point btn_display_zoom_4x_basis = new Point(100, 100);		//k6jca
        private Point btn_display_zoom_2x_basis = new Point(100, 100);		//k6jca
        private Point btn_display_zoom_1x_basis = new Point(100, 100);		//k6jca
        private Point btn_display_zoom_05_basis = new Point(100, 100);		//k6jca
        private Point tb_display_zoom_basis = new Point(100, 100);		//k6jca
        private Point txt_display_peak_freq_basis = new Point(100, 100);		//k6jca
        private Point txt_display_peak_power_basis = new Point(100, 100);		//k6jca
        private Point txt_display_peak_offset_basis = new Point(100, 100);		//k6jca
        private Point lbl_display_zoom_basis = new Point(100, 100);		//k6jca
        private Size gr_display_size_basis = new Size(100, 100);		//k6jca
        private Size pic_display_size_basis = new Size(100, 100);		//k6jca
        private Size txtOverload_size_basis = new Size(100, 100);		//k6jca
        private Point txtOverload_basis = new Point(100, 100);		//k6jca
        private Point gr_display2_basis = new Point(100, 100);		//k6jca
        private Point gr_dsp_basis = new Point(100, 100);		//k6jca
        private Point tb_displaypan_basis = new Point(100, 100);		//k6jca
        private Point lbl_displaypan_basis = new Point(100, 100);		//k6jca
        private Point txt_display_cursor_freq_basis = new Point(100, 100);		//k6jca
        private Point txt_display_cursor_power_basis = new Point(100, 100);		//k6jca
        private Point txt_display_cursor_offset_basis = new Point(100, 100);		//k6jca
        private Point gr_multirx_basis = new Point(100, 100);		//k6jca

        private Point pan_rx2_divider_basis = new Point(100, 100);
        private Size pan_rx2_divider_size_basis = new Size(100, 100);

        private Point gr_display_split_basis = new Point(100, 100); // KE5DTO
        private Point gr_options_basis = new Point(100, 100);		//k6jca
        private Point gr_sound_controls_basis = new Point(100, 100);		//k6jca
        private Point chk_squelch_basis = new Point(100, 100);		//k6jca
        private Point ud_squelch_basis = new Point(100, 100);		//k6jca
        private Point pic_sql_basis = new Point(100, 100);		//k6jca
        private Point tb_sql_basis = new Point(100, 100);		//k6jca
        private Point gr_antenna_basis = new Point(100, 100);		//k6jca
        private Point chk_bci_basis = new Point(100, 100);		//k6jca
        private Point button1_basis = new Point(100, 100);		//k6jca
        private Point gr_date_time_basis = new Point(100, 100);		//k6jca
        //private Point lbl_cpu_meter_basis = new Point (100,100);		//k6jca

        private Point gr_rx2_meter_basis = new Point(100, 100);
        private Point gr_rx2_filter_basis = new Point(100, 100);
        private Point gr_rx2_mode_basis = new Point(100, 100);
        private Point gr_rx2_display_basis = new Point(100, 100);
        private Point gr_rx2_dsp_basis = new Point(100, 100);

        private Point lbl_rx2_rf_basis = new Point(100, 100);
        private Point ud_rx2_rf_basis = new Point(100, 100);
        private Point tb_rx2_rf_basis = new Point(100, 100);
        private Point chk_rx2_squelch_basis = new Point(100, 100);
        private Point ud_rx2_squelch_basis = new Point(100, 100);
        private Point tb_rx2_squelch_basis = new Point(100, 100);
        private Point pic_rx2_squelch_basis = new Point(100, 100);

        private Point gr_rx2_mixer_basis = new Point(100, 100);
        private Point chk_rx2_enable_basis = new Point(100, 100);
        private Point chk_rx2_preamp_basis = new Point(100, 100);
        private Point lbl_rx2_band_basis = new Point(100, 100);
        private Point combo_rx2_band_basis = new Point(100, 100);
        public bool si570_used = false; // modif F8CHK

        // :W1CEG:
        private Size gr_multi_meter_size_basis = new Size(100, 100);
        private Point pic_multi_meter_digital_basis = new Point(100, 100);
        private Size pic_multi_meter_size_basis = new Size(100, 100);
        private Point lbl_multi_smeter_basis = new Point(100, 100);
        private Point txt_multi_text_basis = new Point(100, 100);
        private Point chk_power_basis = new Point(100, 100);		//k6jca
        private Point gr_power_basis = new Point(100, 100);		//k6jca
        private Size gr_options_size_basis = new Size(100, 100);
        private Point chk_mon_basis = new Point(100, 100);
        private Point chk_mut_basis = new Point(100, 100);
        private Point chk_mox_basis = new Point(100, 100);
        private Point chk_tun_basis = new Point(100, 100);
        private Point chk_vox_basis = new Point(100, 100);
        // private Point lbl_af_basis = new Point(100, 100);
        private Point tb_af_basis = new Point(100, 100);
        private Point tb_rf_basis = new Point(100, 100);
        private Point gr_display_basis = new Point(100, 100);
        private Point pic_display_basis = new Point(100, 100);
        private Point combo_display_mode_basis = new Point(100, 100);
        private Point combo_agc_basis = new Point(100, 100);
        private Point combo_preamp_basis = new Point(100, 100);
        private Point combo_meter_rxmode_basis = new Point(100, 100);
        private Point combo_meter_txmode_basis = new Point(100, 100);
        private Size tb_display_zoom_size_basis = new Size(100, 100);
        private Size gr_BandHF_basis_size = new Size(100, 100);
        private Size gr_BandVHF_basis_size = new Size(100, 100);
        private Size gr_Mode_basis_size = new Size(100, 100);
        private Point rad_band160_basis = new Point(100, 100);
        private Point rad_band80_basis = new Point(100, 100);
        private Point rad_band60_basis = new Point(100, 100);
        private Point rad_band40_basis = new Point(100, 100);
        private Point rad_band30_basis = new Point(100, 100);
        private Point rad_band20_basis = new Point(100, 100);
        private Point rad_band17_basis = new Point(100, 100);
        private Point rad_band15_basis = new Point(100, 100);
        private Point rad_band12_basis = new Point(100, 100);
        private Point rad_band10_basis = new Point(100, 100);
        private Point rad_band6_basis = new Point(100, 100);
        private Point rad_band2_basis = new Point(100, 100);
        private Point rad_bandwwv_basis = new Point(100, 100);
        private Point rad_bandgen_basis = new Point(100, 100);
        private Point rad_mode_lsb_basis = new Point(100, 100);
        private Point rad_mode_usb_basis = new Point(100, 100);
        private Point rad_mode_dsb_basis = new Point(100, 100);
        private Point rad_mode_cwl_basis = new Point(100, 100);
        private Point rad_mode_cwu_basis = new Point(100, 100);
        private Point rad_mode_fmn_basis = new Point(100, 100);
        private Point rad_mode_am_basis = new Point(100, 100);
        private Point rad_mode_sam_basis = new Point(100, 100);
        private Point rad_mode_spec_basis = new Point(100, 100);
        private Point rad_mode_digl_basis = new Point(100, 100);
        private Point rad_mode_digu_basis = new Point(100, 100);
        private Point rad_mode_drm_basis = new Point(100, 100);

        #endregion

        #region Windows Form Generated Code

        private System.Windows.Forms.ButtonTS btnHidden;
        private System.Windows.Forms.TextBoxTS txtVFOAFreq;
        private System.Windows.Forms.TextBoxTS txtVFOABand;
        private System.Windows.Forms.TextBoxTS txtVFOBFreq;
        private System.Windows.Forms.PictureBox picDisplay;
        private System.Windows.Forms.GroupBoxTS grpVFOA;
        private System.Windows.Forms.GroupBoxTS grpVFOB;
        private System.Windows.Forms.TextBoxTS txtVFOBBand;
        private System.Windows.Forms.CheckBoxTS chkPower;
        private System.Windows.Forms.LabelTS lblCPUMeter;
        private System.Windows.Forms.ComboBoxTS comboDisplayMode;
        private System.Windows.Forms.NumericUpDownTS udFilterLow;
        private System.Windows.Forms.NumericUpDownTS udFilterHigh;
        private System.Windows.Forms.RadioButtonTS radFilterVar1;
        private System.Windows.Forms.RadioButtonTS radFilterVar2;
        private System.Windows.Forms.RadioButtonTS radModeSPEC;
        private System.Windows.Forms.RadioButtonTS radModeLSB;
        private System.Windows.Forms.RadioButtonTS radModeDIGL;
        private System.Windows.Forms.RadioButtonTS radModeCWU;
        private System.Windows.Forms.RadioButtonTS radModeDSB;
        private System.Windows.Forms.RadioButtonTS radModeSAM;
        private System.Windows.Forms.RadioButtonTS radModeAM;
        private System.Windows.Forms.RadioButtonTS radModeCWL;
        private System.Windows.Forms.RadioButtonTS radModeUSB;
        private System.Windows.Forms.RadioButtonTS radModeFMN;
        private System.Windows.Forms.RadioButtonTS radModeDRM;
        private System.Windows.Forms.LabelTS lblAGC;
        private System.Windows.Forms.ComboBoxTS comboAGC;
        private System.Windows.Forms.CheckBoxTS chkNB;
        private System.Windows.Forms.CheckBoxTS chkANF;
        private System.Windows.Forms.CheckBoxTS chkNR;
        private System.Windows.Forms.CheckBoxTS chkMON;
        private System.Windows.Forms.CheckBoxTS chkTUN;
        private System.Windows.Forms.CheckBoxTS chkMOX;
        private System.Windows.Forms.NumericUpDownTS udXIT;
        private System.Windows.Forms.NumericUpDownTS udRIT;
        private System.Windows.Forms.CheckBoxTS chkXIT;
        private System.Windows.Forms.CheckBoxTS chkRIT;
        private System.Windows.Forms.LabelTS lblPWR;
        private System.Windows.Forms.LabelTS lblAF;
        private System.Windows.Forms.LabelTS lblMIC;
        private System.Windows.Forms.TextBoxTS txtWheelTune;
        private System.Windows.Forms.CheckBoxTS chkBIN;
        private System.Windows.Forms.GroupBoxTS grpMultimeter;
        private System.Windows.Forms.ButtonTS btnVFOSwap;
        private System.Windows.Forms.ButtonTS btnVFOBtoA;
        private System.Windows.Forms.ButtonTS btnVFOAtoB;
        private System.Windows.Forms.CheckBoxTS chkVFOSplit;
        private System.Windows.Forms.CheckBoxTS chkDisplayAVG;
        private System.Windows.Forms.TextBoxTS txtMultiText;
        private System.Windows.Forms.Timer timer_cpu_meter;
        private System.Windows.Forms.LabelTS lblFilterHigh;
        private System.Windows.Forms.LabelTS lblFilterLow;
        private System.Windows.Forms.LabelTS lblMultiSMeter;
        private System.Windows.Forms.PictureBox picMultiMeterDigital;
        private System.Windows.Forms.CheckBoxTS chkSquelch;
        private System.Windows.Forms.Timer timer_peak_text;
        private System.Windows.Forms.TextBoxTS txtMemoryQuick;
        private System.Windows.Forms.ButtonTS btnMemoryQuickSave;
        private System.Windows.Forms.ButtonTS btnMemoryQuickRestore;
        private System.Windows.Forms.ToolTip toolTip1;
        private System.Windows.Forms.LabelTS lblFilterShift;
        private System.Windows.Forms.ButtonTS btnFilterShiftReset;
        private System.Windows.Forms.Timer timer_clock;
        private System.Windows.Forms.TextBoxTS txtDate;
        private System.Windows.Forms.Panel panelVFOAHover;
        private System.Windows.Forms.Panel panelVFOBHover;
        private System.Windows.Forms.ComboBoxTS comboMeterRXMode;
        private System.Windows.Forms.ComboBoxTS comboMeterTXMode;
        private System.Windows.Forms.ButtonTS btnXITReset;
        private System.Windows.Forms.ButtonTS btnRITReset;
        private System.Windows.Forms.ComboBoxTS comboTuneMode;
        private System.Windows.Forms.ComboBoxTS comboPreamp;
        private System.Windows.Forms.LabelTS lblPreamp;
        private System.Windows.Forms.CheckBoxTS chkDSPNB2;
        private System.Windows.Forms.CheckBoxTS chkVFOLock;
        private System.Windows.Forms.LabelTS lblFilterWidth;
        private System.Windows.Forms.ButtonTS btnBandHF;
        private System.Windows.Forms.ButtonTS btnBandVHF;
        private System.Windows.Forms.LabelTS lblCWSpeed;
        private System.Windows.Forms.ButtonTS btnIFtoVFO;
        private System.Windows.Forms.ButtonTS btnZeroBeat;
        private System.Windows.Forms.TextBoxTS txtTime;
        private System.Windows.Forms.RadioButtonTS radModeDIGU;
        private System.Windows.Forms.RadioButtonTS radFilter1;
        private System.Windows.Forms.RadioButtonTS radFilter2;
        private System.Windows.Forms.RadioButtonTS radFilter3;
        private System.Windows.Forms.RadioButtonTS radFilter4;
        private System.Windows.Forms.RadioButtonTS radFilter5;
        private System.Windows.Forms.RadioButtonTS radFilter6;
        private System.Windows.Forms.RadioButtonTS radFilter7;
        private System.Windows.Forms.RadioButtonTS radFilter8;
        private System.Windows.Forms.RadioButtonTS radFilter9;
        private System.Windows.Forms.RadioButtonTS radFilter10;
        private System.Windows.Forms.LabelTS lblRF;
        private System.Windows.Forms.LabelTS lblTuneStep;
        private System.Windows.Forms.GroupBoxTS grpVFOBetween;
        private System.Windows.Forms.CheckBoxTS chkVOX;
        private System.Windows.Forms.CheckBoxTS chkVACEnabled;
        private System.Windows.Forms.LabelTS lblTXGain;
        private System.Windows.Forms.LabelTS lblRXGain;
        private System.Windows.Forms.PictureBox picVOX;
        private System.Windows.Forms.CheckBoxTS chkNoiseGate;
        private System.Windows.Forms.PictureBox picNoiseGate;
        public TextBox txtOverload;
        private System.Windows.Forms.TextBoxTS txtDisplayCursorOffset;
        private System.Windows.Forms.TextBoxTS txtDisplayCursorPower;
        private System.Windows.Forms.TextBoxTS txtDisplayCursorFreq;
        private System.Windows.Forms.TextBoxTS txtDisplayPeakOffset;
        private System.Windows.Forms.TextBoxTS txtDisplayPeakFreq;
        private System.Windows.Forms.TextBoxTS txtDisplayPeakPower;
        private System.Windows.Forms.LabelTS lblVFOBLSD;
        private System.Windows.Forms.TextBoxTS txtVFOAMSD;
        private System.Windows.Forms.TextBoxTS txtVFOBMSD;
        private System.Windows.Forms.TextBoxTS txtVFOALSD;
        private System.Windows.Forms.TextBoxTS txtVFOBLSD;
        public CheckBoxTS chkSR;
        private System.Windows.Forms.ButtonTS btnTuneStepChangeSmaller;
        private System.Windows.Forms.ComboBoxTS comboTXProfile;
        private System.Windows.Forms.CheckBoxTS chkShowTXFilter;
        private System.Windows.Forms.ComboBoxTS comboVACSampleRate;
        private System.Windows.Forms.GroupBoxTS grpDIGSampleRate;
        private System.Windows.Forms.GroupBoxTS grpVACStereo;
        private System.Windows.Forms.CheckBoxTS chkVACStereo;
        private System.Windows.Forms.CheckBoxTS chkCWIambic;
        private System.Windows.Forms.LabelTS lblCWPitchFreq;
        private System.Windows.Forms.NumericUpDownTS udCWPitch;
        private System.Windows.Forms.CheckBoxTS chkCWVAC;
        private System.Windows.Forms.LabelTS lblDisplayPan;
        private System.Windows.Forms.ButtonTS btnDisplayPanCenter;
        private System.Windows.Forms.LabelTS lblDisplayZoom;
        private System.Windows.Forms.LabelTS lblTransmitProfile;
        private System.Windows.Forms.CheckBoxTS chkX2TR;
        private System.Windows.Forms.CheckBoxTS chkShowTXCWFreq;
        private System.Windows.Forms.CheckBoxTS chkPanSwap;
        private System.Windows.Forms.GroupBoxTS grpSemiBreakIn;
        private System.Windows.Forms.LabelTS lblCWBreakInDelay;
        private System.Windows.Forms.CheckBoxTS chkCWBreakInEnabled;
        private System.Windows.Forms.NumericUpDownTS udCWBreakInDelay;
        private System.Windows.Forms.CheckBoxTS chkPhoneVAC;
        private System.Windows.Forms.ComboBoxTS comboDigTXProfile;
        private System.Windows.Forms.LabelTS lblDigTXProfile;
        private System.Windows.Forms.CheckBoxTS chkRXEQ;
        private System.Windows.Forms.CheckBoxTS chkTXEQ;
        private System.ComponentModel.IContainer components;
        private System.Windows.Forms.CheckBoxTS chkEnableMultiRX;
        private System.Windows.Forms.ButtonTS btnTuneStepChangeLarger;
        private System.Windows.Forms.LabelTS lblAntRX1;
        private System.Windows.Forms.LabelTS lblAntTX;
        private System.Windows.Forms.CheckBoxTS chkSplitDisplay;
        private System.Windows.Forms.ComboBoxTS comboDisplayModeTop;
        private System.Windows.Forms.ComboBoxTS comboDisplayModeBottom;
        private System.Windows.Forms.LabelTS lblDisplayModeTop;
        private System.Windows.Forms.LabelTS lblDisplayModeBottom;
        private System.Windows.Forms.CheckBoxTS chkCPDR;
        private System.Windows.Forms.CheckBoxTS chkDX;
        private System.Windows.Forms.CheckBoxTS ckQuickPlay;
        private System.Windows.Forms.CheckBoxTS ckQuickRec;
        private System.Windows.Forms.GroupBoxTS grpDisplaySplit;
        private System.Windows.Forms.CheckBoxTS chkDisplayPeak;
        private System.Windows.Forms.CheckBoxTS chkRX2;
        private System.Windows.Forms.CheckBoxTS chkRX2SR;
        private System.Windows.Forms.Panel panelVFOASubHover;
        private System.Windows.Forms.LabelTS lblAntRX2;
        private System.Windows.Forms.RadioButtonTS radRX2ModeAM;
        private System.Windows.Forms.RadioButtonTS radRX2ModeSAM;
        private System.Windows.Forms.RadioButtonTS radRX2ModeDSB;
        private System.Windows.Forms.RadioButtonTS radRX2ModeCWU;
        private System.Windows.Forms.RadioButtonTS radRX2ModeDIGU;
        private System.Windows.Forms.RadioButtonTS radRX2ModeDIGL;
        private System.Windows.Forms.RadioButtonTS radRX2ModeLSB;
        private System.Windows.Forms.RadioButtonTS radRX2ModeSPEC;
        private System.Windows.Forms.RadioButtonTS radRX2ModeDRM;
        private System.Windows.Forms.RadioButtonTS radRX2ModeFMN;
        private System.Windows.Forms.RadioButtonTS radRX2ModeUSB;
        private System.Windows.Forms.RadioButtonTS radRX2ModeCWL;
        private System.Windows.Forms.CheckBoxTS chkRX2BIN;
        private System.Windows.Forms.RadioButtonTS radRX2Filter1;
        private System.Windows.Forms.RadioButtonTS radRX2Filter2;
        private System.Windows.Forms.RadioButtonTS radRX2Filter3;
        private System.Windows.Forms.RadioButtonTS radRX2Filter4;
        private System.Windows.Forms.RadioButtonTS radRX2Filter5;
        private System.Windows.Forms.RadioButtonTS radRX2Filter6;
        private System.Windows.Forms.RadioButtonTS radRX2Filter7;
        private System.Windows.Forms.RadioButtonTS radRX2FilterVar1;
        private System.Windows.Forms.RadioButtonTS radRX2FilterVar2;
        private System.Windows.Forms.GroupBoxTS grpRX2Meter;
        private System.Windows.Forms.ComboBoxTS comboRX2MeterMode;
        private System.Windows.Forms.NumericUpDownTS udRX2FilterLow;
        private System.Windows.Forms.NumericUpDownTS udRX2FilterHigh;
        private System.Windows.Forms.LabelTS lblRX2FilterLow;
        private System.Windows.Forms.LabelTS lblRX2FilterHigh;
        private System.Windows.Forms.CheckBoxTS chkRX2NB2;
        private System.Windows.Forms.CheckBoxTS chkRX2NB;
        private System.Windows.Forms.CheckBoxTS chkRX2ANF;
        private System.Windows.Forms.CheckBoxTS chkRX2NR;
        private System.Windows.Forms.PictureBox picRX2Meter;
        private System.Windows.Forms.TextBoxTS txtRX2Meter;
        private System.Windows.Forms.LabelTS lblRX2Meter;
        private System.Windows.Forms.CheckBoxTS chkRX2Preamp;
        private System.Windows.Forms.LabelTS lblRX2RF;
        private System.Windows.Forms.PictureBox picSquelch;
        private System.Windows.Forms.CheckBoxTS chkRX2Squelch;
        private System.Windows.Forms.PictureBox picRX2Squelch;
        private System.Windows.Forms.CheckBoxTS chkRX1Preamp;
        private System.Windows.Forms.CheckBoxTS chkRX2Mute;
        private System.Windows.Forms.CheckBoxTS chkRX2DisplayPeak;
        private System.Windows.Forms.ComboBoxTS comboRX2DisplayMode;
        private System.Windows.Forms.CheckBoxTS chkRX2DisplayAVG;
        private System.Windows.Forms.Label lblRX2Mute;
        private System.Windows.Forms.Label lblRX2Pan;
        private System.Windows.Forms.Label lblRX2Vol;
        private System.Windows.Forms.ComboBoxTS comboRX2Band;
        private System.Windows.Forms.LabelTS lblRX2Band;
        private System.Windows.Forms.ComboBoxTS comboRX2AGC;
        private System.Windows.Forms.LabelTS lblRX2AGC;
        private System.Windows.Forms.CheckBoxTS chkVFOSync;
        private System.Windows.Forms.CheckBoxTS chkVFOATX;
        private System.Windows.Forms.CheckBoxTS chkVFOBTX;
        private PanelTS panelBandHF;
        private PanelTS panelBandVHF;
        private PanelTS panelMode;
        private PanelTS panelFilter;
        private PanelTS panelDisplay;
        private PanelTS panelOptions;
        private PanelTS panelSoundControls;
        private PanelTS panelAntenna;
        private PanelTS panelDateTime;
        private PanelTS panelVFO;
        private PanelTS panelDSP;
        private PanelTS panelDisplay2;
        private PanelTS panelMultiRX;
        private PanelTS panelModeSpecificCW;
        private PanelTS panelModeSpecificPhone;
        private PanelTS panelModeSpecificDigital;
        private RadioButtonTS radBand160;
        private RadioButtonTS radBand80;
        private RadioButtonTS radBand60;
        private RadioButtonTS radBand40;
        private RadioButtonTS radBand30;
        private RadioButtonTS radBand20;
        private RadioButtonTS radBand17;
        private RadioButtonTS radBand15;
        private RadioButtonTS radBand12;
        private RadioButtonTS radBand10;
        private RadioButtonTS radBand6;
        private RadioButtonTS radBand2;
        private RadioButtonTS radBandWWV;
        private RadioButtonTS radBandGEN;
        private RadioButtonTS radBandVHF0;
        private RadioButtonTS radBandVHF11;
        private RadioButtonTS radBandVHF10;
        private RadioButtonTS radBandVHF9;
        private RadioButtonTS radBandVHF8;
        private RadioButtonTS radBandVHF7;
        private RadioButtonTS radBandVHF6;
        private RadioButtonTS radBandVHF5;
        private RadioButtonTS radBandVHF4;
        private RadioButtonTS radBandVHF3;
        private RadioButtonTS radBandVHF2;
        private RadioButtonTS radBandVHF1;
        private RadioButtonTS radBandVHF13;
        private RadioButtonTS radBandVHF12;
        private PanelTS panelRX2Mixer;
        private PanelTS panelRX2DSP;
        private PanelTS panelRX2Display;
        private PanelTS panelRX2Mode;
        private PanelTS panelRX2Filter;
        private PrettyTrackBar ptbDisplayPan;
        private PrettyTrackBar ptbDisplayZoom;
        private PrettyTrackBar ptbAF;
        private PrettyTrackBar ptbRF;
        private PrettyTrackBar ptbPWR;
        private PrettyTrackBar ptbSquelch;
        private PrettyTrackBar ptbMic;
        private LabelTS lblMicVal;
        private PrettyTrackBar ptbDX;
        private LabelTS lblDXVal;
        private PrettyTrackBar ptbCPDR;
        private LabelTS lblCPDRVal;
        private PrettyTrackBar ptbVOX;
        private LabelTS lblVOXVal;
        private PrettyTrackBar ptbNoiseGate;
        private LabelTS lblNoiseGateVal;
        private PrettyTrackBar ptbFilterWidth;
        private PrettyTrackBar ptbFilterShift;
        private PrettyTrackBar ptbCWSpeed;
        private PrettyTrackBar ptbPanMainRX;
        private PrettyTrackBar ptbPanSubRX;
        private PrettyTrackBar ptbRX2RF;
        private PrettyTrackBar ptbRX2Squelch;
        private PrettyTrackBar ptbRX2Gain;
        private PrettyTrackBar ptbRX2Pan;
        private PrettyTrackBar ptbRX1Gain;
        private PrettyTrackBar ptbRX0Gain;
        private PrettyTrackBar ptbVACRXGain;
        private PrettyTrackBar ptbVACTXGain;
        private ContextMenuStrip contextMenuStripFilterRX1;
        private ToolStripMenuItem toolStripMenuItemRX1FilterConfigure;
        private ToolStripMenuItem toolStripMenuItemRX1FilterReset;
        private ContextMenuStrip contextMenuStripFilterRX2;
        private ToolStripMenuItem toolStripMenuItemRX2FilterConfigure;
        private ToolStripMenuItem toolStripMenuItemRX2FilterReset;
        private System.Windows.Forms.Timer timer_navigate;
        private RadioButtonTS radDisplayZoom05;
        private RadioButtonTS radDisplayZoom4x;
        private RadioButtonTS radDisplayZoom2x;
        private RadioButtonTS radDisplayZoom1x;
        private CheckBoxTS chkFWCATUBypass;
        private CheckBoxTS chkFWCATU;
        private CheckBoxTS chkMicMute;
        private TextBoxTS txtCPUMeter;
        private CheckBoxTS chkBCI;
        private CheckBoxTS chkMUT;
        private PanelTS panelPower;
        private LabelTS lblAF2;
        private LabelTS lblRF2;
        private LabelTS lblModeLabel;
        private LabelTS lblFilterLabel;
        private CheckBoxTS chkCWDisableTXDisplay;
        private CheckBoxTS chkShowCWZero;
        private PanelTS panelModeSpecificFM;
        private LabelTS lblMicValFM;
        private RadioButtonTS radFMDeviation2kHz;
        private LabelTS labelTS7;
        private LabelTS lblFMOffset;
        private ButtonTS btnFMMemoryDown;
        private ButtonTS btnFMMemoryUp;
        private ButtonTS btnFMMemory;
        private LabelTS lblFMDeviation;
        private CheckBoxTS chkFMCTCSS;
        private CheckBoxTS chkFMVAC;
        private ComboBoxTS comboFMCTCSS;
        private ComboBoxTS comboFMMemory;
        private CheckBoxTS chkFMTXSimplex;
        private NumericUpDownTS udFMOffset;
        private ComboBoxTS comboFMTXProfile;
        private RadioButtonTS radFMDeviation5kHz;
        private LabelTS lblFMMic;
        private CheckBoxTS chkFMTXLow;
        private CheckBoxTS chkFMTXHigh;
        private CheckBoxTS chkFMTXRev;
        private ButtonTS btnTNFAdd;
        private CheckBoxTS chkTNF;
        private ContextMenuStrip contextMenuStripNotch;
        private ToolStripMenuItem toolStripNotchDelete;
        private ToolStripMenuItem toolStripNotchRemember;
        private ToolStripSeparator toolStripSeparator1;
        private ToolStripMenuItem toolStripNotchNormal;
        private ToolStripMenuItem toolStripNotchDeep;
        private ToolStripMenuItem toolStripNotchVeryDeep;
        private MenuStrip menuStrip1;
        private ToolStripMenuItem setupToolStripMenuItem;
        private ToolStripMenuItem memoryToolStripMenuItem;
        private ToolStripMenuItem waveToolStripMenuItem;
        private ToolStripMenuItem equalizerToolStripMenuItem;
        private ToolStripMenuItem xVTRsToolStripMenuItem;
        private ToolStripMenuItem cWXToolStripMenuItem;
        private ToolStripMenuItem uCBToolStripMenuItem;
        private ToolStripMenuItem mixerToolStripMenuItem;
        private ToolStripMenuItem antennaToolStripMenuItem;
        private ToolStripMenuItem relaysToolStripMenuItem;
        private ToolStripMenuItem aTUToolStripMenuItem;
        private ToolStripMenuItem eSCToolStripMenuItem;
        private ToolStripMenuItem collapseToolStripMenuItem;
        private ToolStripMenuItem filterToolStripMenuItem;
        private ToolStripMenuItem dSPToolStripMenuItem;
        private ToolStripMenuItem displayControlsToolStripMenuItem;
        public ToolStripMenuItem topControlsToolStripMenuItem;
        public ToolStripMenuItem bandControlsToolStripMenuItem;
        public ToolStripMenuItem modeControlsToolStripMenuItem;
        private ToolStripMenuItem FilterToolStripMenuItem1;
        private ToolStripMenuItem FilterToolStripMenuItem2;
        private ToolStripMenuItem FilterToolStripMenuItem3;
        private ToolStripMenuItem FilterToolStripMenuItem4;
        private ToolStripMenuItem FilterToolStripMenuItem5;
        private ToolStripMenuItem FilterToolStripMenuItem6;
        private ToolStripMenuItem FilterToolStripMenuItem7;
        private ToolStripMenuItem FilterToolStripMenuItem8;
        private ToolStripMenuItem FilterToolStripMenuItem9;
        private ToolStripMenuItem FilterToolStripMenuItem10;
        private ToolStripMenuItem NRToolStripMenuItem;
        private ToolStripMenuItem ANFToolStripMenuItem;
        private ToolStripMenuItem NBToolStripMenuItem;
        private ToolStripMenuItem NB2ToolStripMenuItem;
        private ToolStripMenuItem BINToolStripMenuItem;
        private ToolStripMenuItem MultiRXToolStripMenuItem;
        public ToolStripMenuItem bandToolStripMenuItem;
        private ToolStripMenuItem bandtoolStripMenuItem1;
        private ToolStripMenuItem bandtoolStripMenuItem2;
        private ToolStripMenuItem bandtoolStripMenuItem3;
        private ToolStripMenuItem bandtoolStripMenuItem4;
        private ToolStripMenuItem bandtoolStripMenuItem5;
        private ToolStripMenuItem bandtoolStripMenuItem7;
        private ToolStripMenuItem bandtoolStripMenuItem8;
        private ToolStripMenuItem bandtoolStripMenuItem9;
        private ToolStripMenuItem bandtoolStripMenuItem10;
        private ToolStripMenuItem bandtoolStripMenuItem11;
        private ToolStripMenuItem bandtoolStripMenuItem12;
        private ToolStripMenuItem bandtoolStripMenuItem13;
        public ToolStripMenuItem modeToolStripMenuItem;
        private ToolStripMenuItem lSBToolStripMenuItem;
        private ToolStripMenuItem uSBToolStripMenuItem;
        private ToolStripMenuItem dSBToolStripMenuItem;
        private ToolStripMenuItem cWLToolStripMenuItem;
        private ToolStripMenuItem cWUToolStripMenuItem;
        private ToolStripMenuItem fMToolStripMenuItem;
        private ToolStripMenuItem aMToolStripMenuItem;
        private ToolStripMenuItem sAMToolStripMenuItem;
        private ToolStripMenuItem sPECToolStripMenuItem;
        private ToolStripMenuItem dIGLToolStripMenuItem;
        private ToolStripMenuItem dIGUToolStripMenuItem;
        private ToolStripMenuItem dRMToolStripMenuItem;
        private ToolStripMenuItem bandtoolStripMenuItem14;
        private System.Windows.Forms.Timer timerNotchZoom;
        private PrettyTrackBar ptbFMMic;
        private CheckBoxTS chkVACIQEnabled;
        private CheckBoxTS chkCWVACIQ;
        private CheckBoxTS chkCWSidetone;
        private CheckBoxTS chkFullDuplex;

        #endregion

        #region Constructor and Destructor
        // ======================================================
        // Constructor and Destructor
        // ======================================================

        public Console(string[] args)
        {
            foreach (string s in args)
            {
                if (s.StartsWith("-datapath:"))
                {
                    string path = s.Trim().Substring(s.Trim().IndexOf(":") + 1);
                    if (path.EndsWith("\"")) path = path.Substring(0, path.Length - 1);
                    if (!path.EndsWith("\\")) path += "\\";
                    if (Directory.Exists(path))
                        AppDataPath = path;
                    else
                    {
                        DialogResult dr = MessageBox.Show("-datapath: command line option found, but the folder specified was not found.\n" +
                            "Would you like to create this folder?  If not, the default folder will be used.\n\n" +
                            "(" + s + ")",
                            "Command Line Option: Create Folder?",
                            MessageBoxButtons.YesNo,
                            MessageBoxIcon.Question);

                        if (dr == DialogResult.Yes)
                        {
                            Directory.CreateDirectory(path);
                            AppDataPath = path;
                        }
                    }
                }
            }

            if (app_data_path == "")
            {
                Assembly assembly = Assembly.GetExecutingAssembly();
                FileVersionInfo fvi = FileVersionInfo.GetVersionInfo(assembly.Location);
                string version = fvi.FileVersion; //.Substring(0, fvi.FileVersion.LastIndexOf("."));
                // AppDataPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData)
                //   + "\\FlexRadio Systems\\PowerSDR v" + version + "\\";
                AppDataPath = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData)
                     + "\\FlexRadio Systems\\PowerSDR (W5WC)" + "\\";
            }

#if(DEBUG)
            AppDataPath += "Debug\\";
#endif
            if (!Directory.Exists(app_data_path))
                Directory.CreateDirectory(app_data_path);

            /* if (Keyboard.IsKeyDown(Keys.R) && Keyboard.IsKeyDown(Keys.S))
              {
                  MessageBox.Show("The database reset function has been activated.  A copy of the current\n"+
                      "database will be placed on the desktop with a date and time stamp in the file name\n"+
                      "before creating a fresh new database for active use",
                      "Database Reset Activated",
                      MessageBoxButtons.OK, MessageBoxIcon.Information);
                  if (File.Exists(app_data_path + "database.xml"))
                  {
                      string desktop = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);
                      string datetime = DateTime.Now.ToShortDateString().Replace("/", "-") + "_" +
                          DateTime.Now.ToShortTimeString().Replace(":", ".");

                      File.Copy(app_data_path + "\\database.xml", desktop + "\\PowerSDR_database_" + datetime + ".xml");
                      File.Delete(app_data_path + "\\database.xml");
                      Thread.Sleep(100);
                  }
              } */

            if (db_file_name == "")
                DBFileName = AppDataPath + "database.xml";

            if (File.Exists(db_file_name))
            {
                if (Keyboard.IsKeyDown(Keys.LShiftKey) || Keyboard.IsKeyDown(Keys.RShiftKey))
                {
                    Thread.Sleep(500); // ensure this is intentional
                    if (Keyboard.IsKeyDown(Keys.LShiftKey) || Keyboard.IsKeyDown(Keys.RShiftKey))
                    {
                        DialogResult dr = MessageBox.Show(
                            "The database reset function has been tiggered.  Would you like to reset your database?\n\n" +
                            "If so, a copy of the current database will be placed on the desktop with\n" +
                            "a date and time stamp in the file name before creating a brand new\n" +
                            "database for active use.",
                            "Reset Database?",
                            MessageBoxButtons.YesNo, MessageBoxIcon.Warning);

                        if (dr == DialogResult.Yes)
                        {
                            string desktop = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);
                            string datetime = DateTime.Now.ToShortDateString().Replace("/", "-") + "_" +
                                DateTime.Now.ToShortTimeString().Replace(":", ".");

                            string file = db_file_name.Substring(db_file_name.LastIndexOf("\\") + 1);
                            file = file.Substring(0, file.Length - 4);

                            File.Copy(db_file_name, desktop + "\\PowerSDR_" + file + "_" + datetime + ".xml");

                            File.Delete(db_file_name);
                            Thread.Sleep(100);
                        }
                    }
                }
            }

            CmdLineArgs = args;

            Splash.ShowSplashScreen();							// Start splash screen

            Splash.SetStatus("Initializing Components");		// Set progress point
            InitializeComponent();								// Windows Forms Generated Code

            // for resizing
            GrabConsoleSizeBasis();
            // MinimumSize = this.Size;

            Splash.SetStatus("Initializing Database");			// Set progress point
            bool db_exists = DB.Init();											// Initialize the database

            InitCTCSS();
            Splash.SetStatus("Initializing Hardware");				// Set progress point

            if (File.Exists(db_file_name))
            {
                ArrayList a = DB.GetVars("State");
                a.Sort();
                foreach (string s in a)
                {
                    string[] vals = s.Split('/');
                    string name = vals[0];
                    string val = vals[1];

                    switch (name)
                    {
                        case "BandTextID":
                            FRSRegion r = (FRSRegion)Enum.Parse(typeof(FRSRegion), val);
                            CurrentRegion = r;
                            break;
                        //  case "chkRX2":
                        //   RX2Enabled = bool.Parse(val);
                        //  break;
                    }
                }
            }

            // check model in Options table
          //  ArrayList list = DB.GetVars("Options");						// Get the saved list of controls
         //   list.Sort();

         /*   foreach (string s in list)
            {
                if (s.StartsWith("radGenModelFLEX5000") && s.IndexOf("True") >= 0)
                {
                    fwc_init = true;
                    break;
                }

                
                if (s.StartsWith("radGenModelSDR1000") && s.IndexOf("True") >= 0)
                    current_model = Model.SDR1000;
            } */

            Application.DoEvents();
           /* if (fwc_init)
            {
                int count = 0;
                while(!(fwc_init = FWCMidi.Open()))
                {
                    if(count++ > 15)
                    {	
                        Splash.HideForm();
                        DialogResult dr = MessageBox.Show("Error communicating with the radio.  Would you like to switch\n"+
                            "to Demo (no hardware) mode?  If not, check that the unit has\n"+
                            "power and FireWire connections and try again.",
                            "Radio Not Found: Switch to Demo mode?",
                            MessageBoxButtons.YesNo,
                            MessageBoxIcon.Error);
                        if(dr == DialogResult.Yes)
                        {
                            ArrayList a = new ArrayList();
                            a.Add("radGenModelFLEX5000/False");
                            a.Add("radGenModelDemoNone/True");
                            DB.SaveVars("Options", ref a);
                            DB.Exit();
                            DB.Init();
                            fwc_init = false;
                        }
                        else
                        {
                            foreach(Control c in this.Controls)
                                c.Enabled = false;
                            Splash.CloseForm();
                            //Thread.CurrentThread.Abort();
                            Process.GetCurrentProcess().Kill();
                            return;
                        }
                        break;
                    }
                    Thread.Sleep(1000);
                }*/

             /*   int count = 0;
                while (!(fwc_init = Pal.Init()))
                {
                    if (count++ > 15)
                    {
                        Splash.HideForm();
                        DialogResult dr = MessageBox.Show("Error communicating with the radio.  Would you like to switch\n" +
                            "to Demo (no hardware) mode?  If not, check that the unit has\n" +
                            "power and FireWire connections and try again.",
                            "Radio Not Found: Switch to Demo mode?",
                            MessageBoxButtons.YesNo,
                            MessageBoxIcon.Error);
                        if (dr == DialogResult.Yes)
                        {
                            ArrayList a = new ArrayList();
                            a.Add("radGenModelFLEX5000/False");
                            a.Add("radGenModelDemoNone/True");
                            DB.SaveVars("Options", ref a);
                            DB.Exit();
                            DB.Init();
                            fwc_init = false;
                        }
                        else
                        {
                            foreach (Control c in this.Controls)
                                c.Enabled = false;
                            Splash.CloseForm();
                            //Thread.CurrentThread.Abort();
                            Process.GetCurrentProcess().Kill();
                            return;
                        }
                        break;
                    }
                    Thread.Sleep(1000);
                    Application.DoEvents();
                }
                FWC.SetPalCallback();
            }
            else if (list.Count == 0)
            {
                //fwc_init = FWCMidi.Open();
                //fwc_init = Pal.Init();
                //FWC.SetPalCallback();
            }

            if (fwc_init)
            {
                FWCEEPROM.Init();
                current_region = FWCEEPROM.Region;

                if (FWCEEPROM.NeedDump())
                {
                    Splash.HideForm();
                    FWCEEPROM.StartDump();
                    Splash.UnHideForm();
                }

                switch (FWCEEPROM.Model)
                {
                    case 0:
                    case 1:
                    case 2:
                        current_model = Model.FLEX5000;
                        break;
                    case 3:
                        current_model = Model.FLEX3000;
                        break;
                }

                InitRadio();
            } */

            if (fwc_init && current_model == Model.FLEX5000 && FWCEEPROM.RX2OK)
            {
                chkRX2.Visible = true;
                lblAntRX2.Visible = true;
                //panelRX2Divider.Visible = true;
            }
            else
            {
                this.Height -= (panelRX2Filter.Height + 8);
                if (chkRX2.Checked) chkRX2.Checked = false;
            }

           /*   if (!db_exists) // modify bandtext and bandstack for non-US regions
               {
                   if (current_region != FRSRegion.US)
                   {
                       Splash.SetStatus("Harmonizing BandText");
                       DB.UpdateRegion(current_region);
                   }
               } */

            Splash.SetStatus("Initializing Radio");				// Set progress point
            radio = new Radio();								// Initialize the Radio processor

            Splash.SetStatus("Initializing PortAudio");			// Set progress point
            PA19.PA_Initialize();								// Initialize the audio interface
            if (fwc_init) Thread.Sleep(500);

            Splash.SetStatus("Loading Main Form");				// Set progress point
            Splash.SplashForm.Owner = this;						// So that main form will show/focus when splash disappears
            break_in_timer = new HiPerfTimer();

            Init60mChannels();
            InitConsole();										// Initialize all forms and main variables

            Splash.SetStatus("Finished");						// Set progress point
            // Activates double buffering

            this.SetStyle(ControlStyles.UserPaint |
               ControlStyles.AllPaintingInWmPaint |
               ControlStyles.OptimizedDoubleBuffer, true);

            this.UpdateStyles();

            Splash.CloseForm();									// End splash screen

            if (fwc_init && (current_model == Model.FLEX3000 || current_model == Model.FLEX5000))
                extended = FWC.GetStatus();
            else if (File.Exists("extended.edf"))						// Check for extended capabilities file
            {
                ArrayList a = DB.GetVars("State");
                a.Sort();
                ArrayList names = new ArrayList();
                ArrayList vals = new ArrayList();

                foreach (string s in a)
                {
                    string[] str = s.Split('/');
                    if (str.Length > 2)
                    {
                        for (int j = 2; j < str.Length; j++)
                            str[1] += "/" + str[j];
                    }
                    names.Add(str[0]);
                    vals.Add(str[1]);
                }

                int i = names.BinarySearch("extended");
                if (i < 0) // If not found, prompt for logon info
                {
                    LogOn LogOnForm = new LogOn(this);
                    LogOnForm.ShowDialog();
                }
                else  // If found, check for existing logon info
                {
                    string text = (string)vals[i];

                    StreamReader sr = File.OpenText("extended.edf");
                    string data = sr.ReadLine();
                    sr.Close();

                    if (text == data)
                        extended = true;
                    else	// Logon information found, but doesn't match
                    {
                        MessageBox.Show("Error reading logon information.", "Logon Error",
                            MessageBoxButtons.OK, MessageBoxIcon.Error);
                        LogOn LogOnForm = new LogOn(this);
                        LogOnForm.ShowDialog();
                    }
                }
            }

            /*if(this.Text.IndexOf("SVN") >= 0) //w5wc
            {
                if(File.Exists(Application.StartupPath+"\\.svn\\entries"))
                {
                    try
                    {
                        string temp = this.Text;
                        StreamReader reader = new StreamReader(Application.StartupPath+"\\.svn\\entries");
                        for(int i=0; i<3; i++)
                            reader.ReadLine();

                        string current_rev = reader.ReadLine();
                        reader.Close();
					
                        int svn_rev = int.Parse(current_rev);
                        int title_rev = int.Parse(temp.Substring(temp.IndexOf(":")+2, 4));
                        if(title_rev < svn_rev)
                            this.Text = temp.Replace(title_rev.ToString(), svn_rev.ToString());
                    }
                    catch(Exception)
                    {
                        // do nothing
                    }
                }*/

            if (show_alpha_warning)
            {
                AlphaWarnForm form = new AlphaWarnForm(this);
                form.ShowDialog();
            }

            /* if (show_mobile_warning)
             {
                 MobileWarnForm form = new MobileWarnForm(this);
                 form.ShowDialog();
             }*/
            //w5wc

            //mnuReportBug.Visible = false; 
            //}

            if (run_setup_wizard)
            {
                var w = new SetupWizard(this, 0);
                w.ShowDialog();
                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                {
                    SetupForm.ResetFLEX5000();
                    CheckCalData();
                    for (int i = 0; i < 8; i++)
                        flex5000DebugForm.SetPAPot(i, (byte)pa_bias_table[0][i]);
                    if (!FWCEEPROM.TRXChecksumPresent)
                    {
                        WriteTRXChecksums();
                        VerifyTRXChecksums();
                    }
                    RX1Band = RX2Band = TXBand = rx1_band;
                    if (current_model == Model.FLEX5000)
                    {
                        fwcAntForm.SetBand(rx1_band);
                        fwcAntForm.CurrentAntMode = current_ant_mode;
                        fwcAntForm.RX1Ant = rx1_ant;
                        fwcAntForm.RX1Loop = rx1_loop;
                        fwcAntForm.RX2Ant = rx2_ant;
                        fwcAntForm.TXAnt = tx_ant;
                        CheckRX2CalData();
                    }
                }
            }


            /*      //  if (!db_exists) // modify bandtext and bandstack for non-US regions
                  {
                      {
                          Splash.SetStatus("Harmonizing BandText");

                         // UpdateBandStackRegisters();
                          if (current_region == FRSRegion.UK)
                          band_60m_register = 7;
                          Init60mChannels();

                          DB.UpdateRegion(current_region);
                      }
                  } */

            if (rx1_meter_cal_offset == 0.0f)
            {
                switch (current_soundcard)
                {
                    case SoundCard.SANTA_CRUZ:
                        rx1_meter_cal_offset = -26.39952f;
                        break;
                    case SoundCard.AUDIGY_2_ZS:
                        rx1_meter_cal_offset = 1.024933f;
                        break;
                    case SoundCard.MP3_PLUS:
                        rx1_meter_cal_offset = -33.40224f;
                        break;
                    case SoundCard.EXTIGY:
                        rx1_meter_cal_offset = -29.30501f;
                        break;
                    case SoundCard.DELTA_44:
                        rx1_meter_cal_offset = -25.13887f;
                        break;
                    case SoundCard.FIREBOX:
                        rx1_meter_cal_offset = -20.94611f;
                        break;
                    case SoundCard.EDIROL_FA_66:
                        rx1_meter_cal_offset = -46.82864f;
                        break;
                    case SoundCard.HPSDR:
                        rx1_meter_cal_offset = -25.32042f;
                        break;
                    case SoundCard.UNSUPPORTED_CARD:
                        rx1_meter_cal_offset = -40.32042f;
                        break;
                }
            }

            if (rx1_display_cal_offset == 0.0f)
            {
                switch (current_soundcard)
                {
                    case SoundCard.SANTA_CRUZ:
                        RX1DisplayCalOffset = -56.56675f;
                        break;
                    case SoundCard.AUDIGY_2_ZS:
                        RX1DisplayCalOffset = -29.20928f;
                        break;
                    case SoundCard.MP3_PLUS:
                        RX1DisplayCalOffset = -62.84578f;
                        break;
                    case SoundCard.EXTIGY:
                        RX1DisplayCalOffset = -62.099f;
                        break;
                    case SoundCard.DELTA_44:
                        RX1DisplayCalOffset = -57.467f;
                        break;
                    case SoundCard.FIREBOX:
                        RX1DisplayCalOffset = -54.019f;
                        break;
                    case SoundCard.EDIROL_FA_66:
                        RX1DisplayCalOffset = -80.429f;
                        break;
                    case SoundCard.HPSDR:
                        RX1DisplayCalOffset = -50.822f;
                        break;
                    case SoundCard.UNSUPPORTED_CARD:
                        RX1DisplayCalOffset = -66.822f;
                        break;
                }
            }

            /*if(notify_on_beta || notify_on_release)
            {
                Thread t = new Thread(new ThreadStart(CheckForUpdates));
                t.IsBackground = true;
                t.Priority = ThreadPriority.Lowest;
                t.Name = "Update Check Thread";
                t.Start();
            }*/

            foreach (string s in CmdLineArgs)
            {
                if (s == "-autostart")
                    chkPower.Checked = true;
                else if (s.StartsWith("-datapath:"))
                {
                    string path = s.Substring(s.IndexOf(":") + 1);
                    if (Directory.Exists(path))
                        AppDataPath = path;
                }
            }

            if ((current_model == Model.FLEX5000 || current_model == Model.FLEX3000) && !fwc_init)
                MessageBox.Show("Error opening radio driver.", "Driver Error", MessageBoxButtons.OK, MessageBoxIcon.Error);

            if (!fwc_init || !FWCEEPROM.RX2OK)
            {
                chkRX2.Checked = false;
                chkSplitDisplay.Checked = false;
            }

            SyncDSP();

            initializing = false;

            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            txtVFOBFreq_LostFocus(this, EventArgs.Empty);
        }

        //private int dispose_count = 0;
        public bool reset_db = false;
        protected override void Dispose(bool disposing)
        {
            //dispose_count++;
            USB.Exit();
            if (disposing)
            {
                if (components != null)
                {
                    components.Dispose();
                }
            }
            base.Dispose(disposing);
            ExitConsole();
            if (reset_db)
            {
                string desktop = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);
                string datetime = DateTime.Now.ToShortDateString().Replace("/", "-") + "_" +
                    DateTime.Now.ToShortTimeString().Replace(":", ".");

                string file = db_file_name.Substring(db_file_name.LastIndexOf("\\") + 1);
                file = file.Substring(0, file.Length - 4);

                File.Copy(app_data_path + "\\database.xml", desktop + "\\PowerSDR_database_" + datetime + ".xml");
                File.Delete(app_data_path + "\\database.xml");
            }
        }

        #endregion

        #region Windows Form Designer generated code
        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.components = new System.ComponentModel.Container();
            System.ComponentModel.ComponentResourceManager resources = new System.ComponentModel.ComponentResourceManager(typeof(Console));
            this.timer_cpu_meter = new System.Windows.Forms.Timer(this.components);
            this.timer_peak_text = new System.Windows.Forms.Timer(this.components);
            this.toolTip1 = new System.Windows.Forms.ToolTip(this.components);
            this.ptbRX2RF = new PowerSDR.PrettyTrackBar();
            this.chkSR = new System.Windows.Forms.CheckBoxTS();
            this.chkFWCATU = new System.Windows.Forms.CheckBoxTS();
            this.ckQuickPlay = new System.Windows.Forms.CheckBoxTS();
            this.chkMON = new System.Windows.Forms.CheckBoxTS();
            this.ckQuickRec = new System.Windows.Forms.CheckBoxTS();
            this.chkMOX = new System.Windows.Forms.CheckBoxTS();
            this.chkTUN = new System.Windows.Forms.CheckBoxTS();
            this.chkX2TR = new System.Windows.Forms.CheckBoxTS();
            this.comboTuneMode = new System.Windows.Forms.ComboBoxTS();
            this.chkPower = new System.Windows.Forms.CheckBoxTS();
            this.ptbFilterShift = new PowerSDR.PrettyTrackBar();
            this.ptbFilterWidth = new PowerSDR.PrettyTrackBar();
            this.btnFilterShiftReset = new System.Windows.Forms.ButtonTS();
            this.udFilterHigh = new System.Windows.Forms.NumericUpDownTS();
            this.udFilterLow = new System.Windows.Forms.NumericUpDownTS();
            this.chkFWCATUBypass = new System.Windows.Forms.CheckBoxTS();
            this.ptbCWSpeed = new PowerSDR.PrettyTrackBar();
            this.udCWPitch = new System.Windows.Forms.NumericUpDownTS();
            this.udCWBreakInDelay = new System.Windows.Forms.NumericUpDownTS();
            this.chkCWBreakInEnabled = new System.Windows.Forms.CheckBoxTS();
            this.chkShowTXCWFreq = new System.Windows.Forms.CheckBoxTS();
            this.chkCWVAC = new System.Windows.Forms.CheckBoxTS();
            this.chkCWIambic = new System.Windows.Forms.CheckBoxTS();
            this.udRX2FilterHigh = new System.Windows.Forms.NumericUpDownTS();
            this.udRX2FilterLow = new System.Windows.Forms.NumericUpDownTS();
            this.radRX2ModeAM = new System.Windows.Forms.RadioButtonTS();
            this.radRX2ModeLSB = new System.Windows.Forms.RadioButtonTS();
            this.radRX2ModeSAM = new System.Windows.Forms.RadioButtonTS();
            this.radRX2ModeCWL = new System.Windows.Forms.RadioButtonTS();
            this.radRX2ModeDSB = new System.Windows.Forms.RadioButtonTS();
            this.radRX2ModeUSB = new System.Windows.Forms.RadioButtonTS();
            this.radRX2ModeCWU = new System.Windows.Forms.RadioButtonTS();
            this.radRX2ModeFMN = new System.Windows.Forms.RadioButtonTS();
            this.radRX2ModeDIGU = new System.Windows.Forms.RadioButtonTS();
            this.radRX2ModeDRM = new System.Windows.Forms.RadioButtonTS();
            this.radRX2ModeDIGL = new System.Windows.Forms.RadioButtonTS();
            this.radRX2ModeSPEC = new System.Windows.Forms.RadioButtonTS();
            this.chkRX2DisplayPeak = new System.Windows.Forms.CheckBoxTS();
            this.comboRX2DisplayMode = new System.Windows.Forms.ComboBoxTS();
            this.chkRX2Mute = new System.Windows.Forms.CheckBoxTS();
            this.chkPanSwap = new System.Windows.Forms.CheckBoxTS();
            this.chkEnableMultiRX = new System.Windows.Forms.CheckBoxTS();
            this.chkDisplayPeak = new System.Windows.Forms.CheckBoxTS();
            this.comboDisplayMode = new System.Windows.Forms.ComboBoxTS();
            this.chkDisplayAVG = new System.Windows.Forms.CheckBoxTS();
            this.chkNR = new System.Windows.Forms.CheckBoxTS();
            this.chkDSPNB2 = new System.Windows.Forms.CheckBoxTS();
            this.chkBIN = new System.Windows.Forms.CheckBoxTS();
            this.chkNB = new System.Windows.Forms.CheckBoxTS();
            this.chkANF = new System.Windows.Forms.CheckBoxTS();
            this.btnZeroBeat = new System.Windows.Forms.ButtonTS();
            this.chkVFOSplit = new System.Windows.Forms.CheckBoxTS();
            this.btnRITReset = new System.Windows.Forms.ButtonTS();
            this.btnXITReset = new System.Windows.Forms.ButtonTS();
            this.udRIT = new System.Windows.Forms.NumericUpDownTS();
            this.btnIFtoVFO = new System.Windows.Forms.ButtonTS();
            this.chkRIT = new System.Windows.Forms.CheckBoxTS();
            this.btnVFOSwap = new System.Windows.Forms.ButtonTS();
            this.chkXIT = new System.Windows.Forms.CheckBoxTS();
            this.btnVFOBtoA = new System.Windows.Forms.ButtonTS();
            this.udXIT = new System.Windows.Forms.NumericUpDownTS();
            this.btnVFOAtoB = new System.Windows.Forms.ButtonTS();
            this.chkRX1Preamp = new System.Windows.Forms.CheckBoxTS();
            this.comboAGC = new System.Windows.Forms.ComboBoxTS();
            this.lblAGC = new System.Windows.Forms.LabelTS();
            this.comboPreamp = new System.Windows.Forms.ComboBoxTS();
            this.lblRF = new System.Windows.Forms.LabelTS();
            this.chkShowTXFilter = new System.Windows.Forms.CheckBoxTS();
            this.chkDX = new System.Windows.Forms.CheckBoxTS();
            this.chkTXEQ = new System.Windows.Forms.CheckBoxTS();
            this.comboTXProfile = new System.Windows.Forms.ComboBoxTS();
            this.chkRXEQ = new System.Windows.Forms.CheckBoxTS();
            this.chkCPDR = new System.Windows.Forms.CheckBoxTS();
            this.chkPhoneVAC = new System.Windows.Forms.CheckBoxTS();
            this.chkVOX = new System.Windows.Forms.CheckBoxTS();
            this.chkNoiseGate = new System.Windows.Forms.CheckBoxTS();
            this.comboDigTXProfile = new System.Windows.Forms.ComboBoxTS();
            this.chkVACEnabled = new System.Windows.Forms.CheckBoxTS();
            this.chkVACStereo = new System.Windows.Forms.CheckBoxTS();
            this.comboVACSampleRate = new System.Windows.Forms.ComboBoxTS();
            this.btnDisplayPanCenter = new System.Windows.Forms.ButtonTS();
            this.radModeAM = new System.Windows.Forms.RadioButtonTS();
            this.radModeLSB = new System.Windows.Forms.RadioButtonTS();
            this.radModeSAM = new System.Windows.Forms.RadioButtonTS();
            this.radModeCWL = new System.Windows.Forms.RadioButtonTS();
            this.radModeDSB = new System.Windows.Forms.RadioButtonTS();
            this.radModeUSB = new System.Windows.Forms.RadioButtonTS();
            this.radModeCWU = new System.Windows.Forms.RadioButtonTS();
            this.radModeFMN = new System.Windows.Forms.RadioButtonTS();
            this.radModeDIGU = new System.Windows.Forms.RadioButtonTS();
            this.radModeDRM = new System.Windows.Forms.RadioButtonTS();
            this.radModeDIGL = new System.Windows.Forms.RadioButtonTS();
            this.radModeSPEC = new System.Windows.Forms.RadioButtonTS();
            this.btnBandVHF = new System.Windows.Forms.ButtonTS();
            this.comboRX2Band = new System.Windows.Forms.ComboBoxTS();
            this.chkVFOATX = new System.Windows.Forms.CheckBoxTS();
            this.txtWheelTune = new System.Windows.Forms.TextBoxTS();
            this.chkVFOBTX = new System.Windows.Forms.CheckBoxTS();
            this.comboMeterTXMode = new System.Windows.Forms.ComboBoxTS();
            this.comboMeterRXMode = new System.Windows.Forms.ComboBoxTS();
            this.chkSquelch = new System.Windows.Forms.CheckBoxTS();
            this.btnMemoryQuickRestore = new System.Windows.Forms.ButtonTS();
            this.btnMemoryQuickSave = new System.Windows.Forms.ButtonTS();
            this.txtMemoryQuick = new System.Windows.Forms.TextBoxTS();
            this.chkVFOLock = new System.Windows.Forms.CheckBoxTS();
            this.chkVFOSync = new System.Windows.Forms.CheckBoxTS();
            this.chkFullDuplex = new System.Windows.Forms.CheckBoxTS();
            this.btnTuneStepChangeLarger = new System.Windows.Forms.ButtonTS();
            this.btnTuneStepChangeSmaller = new System.Windows.Forms.ButtonTS();
            this.chkSplitDisplay = new System.Windows.Forms.CheckBoxTS();
            this.comboDisplayModeTop = new System.Windows.Forms.ComboBoxTS();
            this.comboDisplayModeBottom = new System.Windows.Forms.ComboBoxTS();
            this.chkRX2SR = new System.Windows.Forms.CheckBoxTS();
            this.chkRX2NB2 = new System.Windows.Forms.CheckBoxTS();
            this.chkRX2NB = new System.Windows.Forms.CheckBoxTS();
            this.chkRX2ANF = new System.Windows.Forms.CheckBoxTS();
            this.chkRX2NR = new System.Windows.Forms.CheckBoxTS();
            this.chkRX2BIN = new System.Windows.Forms.CheckBoxTS();
            this.comboRX2AGC = new System.Windows.Forms.ComboBoxTS();
            this.lblRX2AGC = new System.Windows.Forms.LabelTS();
            this.comboRX2MeterMode = new System.Windows.Forms.ComboBoxTS();
            this.lblRX2RF = new System.Windows.Forms.LabelTS();
            this.chkRX2Squelch = new System.Windows.Forms.CheckBoxTS();
            this.chkRX2Preamp = new System.Windows.Forms.CheckBoxTS();
            this.chkRX2DisplayAVG = new System.Windows.Forms.CheckBoxTS();
            this.radBand160 = new System.Windows.Forms.RadioButtonTS();
            this.radBandGEN = new System.Windows.Forms.RadioButtonTS();
            this.radBandWWV = new System.Windows.Forms.RadioButtonTS();
            this.radBand2 = new System.Windows.Forms.RadioButtonTS();
            this.radBand6 = new System.Windows.Forms.RadioButtonTS();
            this.radBand10 = new System.Windows.Forms.RadioButtonTS();
            this.radBand12 = new System.Windows.Forms.RadioButtonTS();
            this.radBand15 = new System.Windows.Forms.RadioButtonTS();
            this.radBand17 = new System.Windows.Forms.RadioButtonTS();
            this.radBand20 = new System.Windows.Forms.RadioButtonTS();
            this.radBand30 = new System.Windows.Forms.RadioButtonTS();
            this.radBand40 = new System.Windows.Forms.RadioButtonTS();
            this.radBand60 = new System.Windows.Forms.RadioButtonTS();
            this.radBand80 = new System.Windows.Forms.RadioButtonTS();
            this.ptbDisplayZoom = new PowerSDR.PrettyTrackBar();
            this.ptbDisplayPan = new PowerSDR.PrettyTrackBar();
            this.ptbPWR = new PowerSDR.PrettyTrackBar();
            this.ptbRF = new PowerSDR.PrettyTrackBar();
            this.ptbAF = new PowerSDR.PrettyTrackBar();
            this.ptbPanMainRX = new PowerSDR.PrettyTrackBar();
            this.ptbPanSubRX = new PowerSDR.PrettyTrackBar();
            this.ptbRX2Gain = new PowerSDR.PrettyTrackBar();
            this.ptbRX2Pan = new PowerSDR.PrettyTrackBar();
            this.ptbRX0Gain = new PowerSDR.PrettyTrackBar();
            this.ptbRX1Gain = new PowerSDR.PrettyTrackBar();
            this.ptbVACRXGain = new PowerSDR.PrettyTrackBar();
            this.ptbVACTXGain = new PowerSDR.PrettyTrackBar();
            this.radDisplayZoom05 = new System.Windows.Forms.RadioButtonTS();
            this.radDisplayZoom4x = new System.Windows.Forms.RadioButtonTS();
            this.radDisplayZoom2x = new System.Windows.Forms.RadioButtonTS();
            this.radDisplayZoom1x = new System.Windows.Forms.RadioButtonTS();
            this.chkMicMute = new System.Windows.Forms.CheckBoxTS();
            this.chkBCI = new System.Windows.Forms.CheckBoxTS();
            this.chkMUT = new System.Windows.Forms.CheckBoxTS();
            this.chkCWDisableTXDisplay = new System.Windows.Forms.CheckBoxTS();
            this.chkShowCWZero = new System.Windows.Forms.CheckBoxTS();
            this.radFMDeviation5kHz = new System.Windows.Forms.RadioButtonTS();
            this.comboFMTXProfile = new System.Windows.Forms.ComboBoxTS();
            this.udFMOffset = new System.Windows.Forms.NumericUpDownTS();
            this.chkFMTXSimplex = new System.Windows.Forms.CheckBoxTS();
            this.comboFMCTCSS = new System.Windows.Forms.ComboBoxTS();
            this.btnFMMemory = new System.Windows.Forms.ButtonTS();
            this.chkFMCTCSS = new System.Windows.Forms.CheckBoxTS();
            this.chkFMVAC = new System.Windows.Forms.CheckBoxTS();
            this.btnFMMemoryUp = new System.Windows.Forms.ButtonTS();
            this.btnFMMemoryDown = new System.Windows.Forms.ButtonTS();
            this.radFMDeviation2kHz = new System.Windows.Forms.RadioButtonTS();
            this.chkFMTXLow = new System.Windows.Forms.CheckBoxTS();
            this.chkFMTXHigh = new System.Windows.Forms.CheckBoxTS();
            this.chkFMTXRev = new System.Windows.Forms.CheckBoxTS();
            this.chkTNF = new System.Windows.Forms.CheckBoxTS();
            this.btnTNFAdd = new System.Windows.Forms.ButtonTS();
            this.chkCWVACIQ = new System.Windows.Forms.CheckBoxTS();
            this.chkVACIQEnabled = new System.Windows.Forms.CheckBoxTS();
            this.chkCWSidetone = new System.Windows.Forms.CheckBoxTS();
            this.picSquelch = new System.Windows.Forms.PictureBox();
            this.picRX2Squelch = new System.Windows.Forms.PictureBox();
            this.timer_clock = new System.Windows.Forms.Timer(this.components);
            this.contextMenuStripFilterRX1 = new System.Windows.Forms.ContextMenuStrip(this.components);
            this.toolStripMenuItemRX1FilterConfigure = new System.Windows.Forms.ToolStripMenuItem();
            this.toolStripMenuItemRX1FilterReset = new System.Windows.Forms.ToolStripMenuItem();
            this.contextMenuStripFilterRX2 = new System.Windows.Forms.ContextMenuStrip(this.components);
            this.toolStripMenuItemRX2FilterConfigure = new System.Windows.Forms.ToolStripMenuItem();
            this.toolStripMenuItemRX2FilterReset = new System.Windows.Forms.ToolStripMenuItem();
            this.timer_navigate = new System.Windows.Forms.Timer(this.components);
            this.contextMenuStripNotch = new System.Windows.Forms.ContextMenuStrip(this.components);
            this.toolStripNotchDelete = new System.Windows.Forms.ToolStripMenuItem();
            this.toolStripNotchRemember = new System.Windows.Forms.ToolStripMenuItem();
            this.toolStripSeparator1 = new System.Windows.Forms.ToolStripSeparator();
            this.toolStripNotchNormal = new System.Windows.Forms.ToolStripMenuItem();
            this.toolStripNotchDeep = new System.Windows.Forms.ToolStripMenuItem();
            this.toolStripNotchVeryDeep = new System.Windows.Forms.ToolStripMenuItem();
            this.menuStrip1 = new System.Windows.Forms.MenuStrip();
            this.setupToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.memoryToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.waveToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.equalizerToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.xVTRsToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.cWXToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.uCBToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.mixerToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.antennaToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.relaysToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.aTUToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.eSCToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.collapseToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.filterToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.FilterToolStripMenuItem1 = new System.Windows.Forms.ToolStripMenuItem();
            this.FilterToolStripMenuItem2 = new System.Windows.Forms.ToolStripMenuItem();
            this.FilterToolStripMenuItem3 = new System.Windows.Forms.ToolStripMenuItem();
            this.FilterToolStripMenuItem4 = new System.Windows.Forms.ToolStripMenuItem();
            this.FilterToolStripMenuItem5 = new System.Windows.Forms.ToolStripMenuItem();
            this.FilterToolStripMenuItem6 = new System.Windows.Forms.ToolStripMenuItem();
            this.FilterToolStripMenuItem7 = new System.Windows.Forms.ToolStripMenuItem();
            this.FilterToolStripMenuItem8 = new System.Windows.Forms.ToolStripMenuItem();
            this.FilterToolStripMenuItem9 = new System.Windows.Forms.ToolStripMenuItem();
            this.FilterToolStripMenuItem10 = new System.Windows.Forms.ToolStripMenuItem();
            this.dSPToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.NRToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.ANFToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.NBToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.NB2ToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.BINToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.MultiRXToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.displayControlsToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.topControlsToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.bandControlsToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.modeControlsToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.bandToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem1 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem2 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem3 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem4 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem5 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem14 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem7 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem8 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem9 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem10 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem11 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem12 = new System.Windows.Forms.ToolStripMenuItem();
            this.bandtoolStripMenuItem13 = new System.Windows.Forms.ToolStripMenuItem();
            this.modeToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.lSBToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.uSBToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.dSBToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.cWLToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.cWUToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.fMToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.aMToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.sAMToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.sPECToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.dIGLToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.dIGUToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.dRMToolStripMenuItem = new System.Windows.Forms.ToolStripMenuItem();
            this.timerNotchZoom = new System.Windows.Forms.Timer(this.components);
            this.lblRF2 = new System.Windows.Forms.LabelTS();
            this.ptbRX2Squelch = new PowerSDR.PrettyTrackBar();
            this.panelOptions = new System.Windows.Forms.PanelTS();
            this.panelPower = new System.Windows.Forms.PanelTS();
            this.panelFilter = new System.Windows.Forms.PanelTS();
            this.radFilter1 = new System.Windows.Forms.RadioButtonTS();
            this.lblFilterHigh = new System.Windows.Forms.LabelTS();
            this.lblFilterWidth = new System.Windows.Forms.LabelTS();
            this.radFilterVar2 = new System.Windows.Forms.RadioButtonTS();
            this.lblFilterLow = new System.Windows.Forms.LabelTS();
            this.radFilterVar1 = new System.Windows.Forms.RadioButtonTS();
            this.lblFilterShift = new System.Windows.Forms.LabelTS();
            this.radFilter9 = new System.Windows.Forms.RadioButtonTS();
            this.radFilter8 = new System.Windows.Forms.RadioButtonTS();
            this.radFilter2 = new System.Windows.Forms.RadioButtonTS();
            this.radFilter7 = new System.Windows.Forms.RadioButtonTS();
            this.radFilter3 = new System.Windows.Forms.RadioButtonTS();
            this.radFilter6 = new System.Windows.Forms.RadioButtonTS();
            this.radFilter4 = new System.Windows.Forms.RadioButtonTS();
            this.radFilter5 = new System.Windows.Forms.RadioButtonTS();
            this.radFilter10 = new System.Windows.Forms.RadioButtonTS();
            this.panelModeSpecificCW = new System.Windows.Forms.PanelTS();
            this.lblCWSpeed = new System.Windows.Forms.LabelTS();
            this.grpSemiBreakIn = new System.Windows.Forms.GroupBoxTS();
            this.lblCWBreakInDelay = new System.Windows.Forms.LabelTS();
            this.lblCWPitchFreq = new System.Windows.Forms.LabelTS();
            this.panelAntenna = new System.Windows.Forms.PanelTS();
            this.lblAntRX2 = new System.Windows.Forms.LabelTS();
            this.lblAntRX1 = new System.Windows.Forms.LabelTS();
            this.lblAntTX = new System.Windows.Forms.LabelTS();
            this.panelRX2Filter = new System.Windows.Forms.PanelTS();
            this.radRX2Filter1 = new System.Windows.Forms.RadioButtonTS();
            this.lblRX2FilterHigh = new System.Windows.Forms.LabelTS();
            this.lblRX2FilterLow = new System.Windows.Forms.LabelTS();
            this.radRX2Filter2 = new System.Windows.Forms.RadioButtonTS();
            this.radRX2FilterVar2 = new System.Windows.Forms.RadioButtonTS();
            this.radRX2Filter3 = new System.Windows.Forms.RadioButtonTS();
            this.radRX2FilterVar1 = new System.Windows.Forms.RadioButtonTS();
            this.radRX2Filter4 = new System.Windows.Forms.RadioButtonTS();
            this.radRX2Filter7 = new System.Windows.Forms.RadioButtonTS();
            this.radRX2Filter5 = new System.Windows.Forms.RadioButtonTS();
            this.radRX2Filter6 = new System.Windows.Forms.RadioButtonTS();
            this.panelRX2Mode = new System.Windows.Forms.PanelTS();
            this.panelRX2Display = new System.Windows.Forms.PanelTS();
            this.panelRX2Mixer = new System.Windows.Forms.PanelTS();
            this.lblRX2Pan = new System.Windows.Forms.Label();
            this.lblRX2Vol = new System.Windows.Forms.Label();
            this.lblRX2Mute = new System.Windows.Forms.Label();
            this.panelMultiRX = new System.Windows.Forms.PanelTS();
            this.panelDisplay2 = new System.Windows.Forms.PanelTS();
            this.panelDSP = new System.Windows.Forms.PanelTS();
            this.panelVFO = new System.Windows.Forms.PanelTS();
            this.lblCPUMeter = new System.Windows.Forms.LabelTS();
            this.txtCPUMeter = new System.Windows.Forms.TextBoxTS();
            this.panelDateTime = new System.Windows.Forms.PanelTS();
            this.txtTime = new System.Windows.Forms.TextBoxTS();
            this.txtDate = new System.Windows.Forms.TextBoxTS();
            this.panelSoundControls = new System.Windows.Forms.PanelTS();
            this.lblAF = new System.Windows.Forms.LabelTS();
            this.lblPreamp = new System.Windows.Forms.LabelTS();
            this.lblPWR = new System.Windows.Forms.LabelTS();
            this.lblAF2 = new System.Windows.Forms.LabelTS();
            this.panelModeSpecificPhone = new System.Windows.Forms.PanelTS();
            this.picNoiseGate = new System.Windows.Forms.PictureBox();
            this.lblNoiseGateVal = new System.Windows.Forms.LabelTS();
            this.ptbNoiseGate = new PowerSDR.PrettyTrackBar();
            this.picVOX = new System.Windows.Forms.PictureBox();
            this.ptbVOX = new PowerSDR.PrettyTrackBar();
            this.lblVOXVal = new System.Windows.Forms.LabelTS();
            this.ptbCPDR = new PowerSDR.PrettyTrackBar();
            this.lblCPDRVal = new System.Windows.Forms.LabelTS();
            this.ptbDX = new PowerSDR.PrettyTrackBar();
            this.lblDXVal = new System.Windows.Forms.LabelTS();
            this.lblMicVal = new System.Windows.Forms.LabelTS();
            this.ptbMic = new PowerSDR.PrettyTrackBar();
            this.lblMIC = new System.Windows.Forms.LabelTS();
            this.lblTransmitProfile = new System.Windows.Forms.LabelTS();
            this.panelModeSpecificDigital = new System.Windows.Forms.PanelTS();
            this.lblDigTXProfile = new System.Windows.Forms.LabelTS();
            this.lblRXGain = new System.Windows.Forms.LabelTS();
            this.grpVACStereo = new System.Windows.Forms.GroupBoxTS();
            this.lblTXGain = new System.Windows.Forms.LabelTS();
            this.grpDIGSampleRate = new System.Windows.Forms.GroupBoxTS();
            this.panelDisplay = new System.Windows.Forms.PanelTS();
            this.picDisplay = new System.Windows.Forms.PictureBox();
            this.txtDisplayPeakOffset = new System.Windows.Forms.TextBoxTS();
            this.txtDisplayCursorOffset = new System.Windows.Forms.TextBoxTS();
            this.txtOverload = new System.Windows.Forms.TextBox();
            this.txtDisplayCursorPower = new System.Windows.Forms.TextBoxTS();
            this.lblDisplayZoom = new System.Windows.Forms.LabelTS();
            this.txtDisplayCursorFreq = new System.Windows.Forms.TextBoxTS();
            this.txtDisplayPeakPower = new System.Windows.Forms.TextBoxTS();
            this.txtDisplayPeakFreq = new System.Windows.Forms.TextBoxTS();
            this.lblDisplayPan = new System.Windows.Forms.LabelTS();
            this.panelMode = new System.Windows.Forms.PanelTS();
            this.panelBandHF = new System.Windows.Forms.PanelTS();
            this.txtVFOAFreq = new System.Windows.Forms.TextBoxTS();
            this.grpVFOA = new System.Windows.Forms.GroupBoxTS();
            this.lblModeLabel = new System.Windows.Forms.LabelTS();
            this.lblFilterLabel = new System.Windows.Forms.LabelTS();
            this.panelVFOASubHover = new System.Windows.Forms.Panel();
            this.panelVFOAHover = new System.Windows.Forms.Panel();
            this.txtVFOALSD = new System.Windows.Forms.TextBoxTS();
            this.txtVFOABand = new System.Windows.Forms.TextBoxTS();
            this.txtVFOAMSD = new System.Windows.Forms.TextBoxTS();
            this.btnHidden = new System.Windows.Forms.ButtonTS();
            this.grpVFOB = new System.Windows.Forms.GroupBoxTS();
            this.txtVFOBLSD = new System.Windows.Forms.TextBoxTS();
            this.panelVFOBHover = new System.Windows.Forms.Panel();
            this.txtVFOBMSD = new System.Windows.Forms.TextBoxTS();
            this.lblVFOBLSD = new System.Windows.Forms.LabelTS();
            this.txtVFOBBand = new System.Windows.Forms.TextBoxTS();
            this.txtVFOBFreq = new System.Windows.Forms.TextBoxTS();
            this.btnBandHF = new System.Windows.Forms.ButtonTS();
            this.grpMultimeter = new System.Windows.Forms.GroupBoxTS();
            this.txtMultiText = new System.Windows.Forms.TextBoxTS();
            this.picMultiMeterDigital = new System.Windows.Forms.PictureBox();
            this.lblMultiSMeter = new System.Windows.Forms.LabelTS();
            this.lblTuneStep = new System.Windows.Forms.LabelTS();
            this.grpVFOBetween = new System.Windows.Forms.GroupBoxTS();
            this.lblDisplayModeTop = new System.Windows.Forms.LabelTS();
            this.lblDisplayModeBottom = new System.Windows.Forms.LabelTS();
            this.grpDisplaySplit = new System.Windows.Forms.GroupBoxTS();
            this.chkRX2 = new System.Windows.Forms.CheckBoxTS();
            this.grpRX2Meter = new System.Windows.Forms.GroupBoxTS();
            this.picRX2Meter = new System.Windows.Forms.PictureBox();
            this.lblRX2Meter = new System.Windows.Forms.LabelTS();
            this.txtRX2Meter = new System.Windows.Forms.TextBoxTS();
            this.lblRX2Band = new System.Windows.Forms.LabelTS();
            this.panelBandVHF = new System.Windows.Forms.PanelTS();
            this.radBandVHF13 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF12 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF11 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF10 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF9 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF8 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF7 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF6 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF5 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF4 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF3 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF2 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF1 = new System.Windows.Forms.RadioButtonTS();
            this.radBandVHF0 = new System.Windows.Forms.RadioButtonTS();
            this.panelRX2DSP = new System.Windows.Forms.PanelTS();
            this.ptbSquelch = new PowerSDR.PrettyTrackBar();
            this.panelModeSpecificFM = new System.Windows.Forms.PanelTS();
            this.ptbFMMic = new PowerSDR.PrettyTrackBar();
            this.lblMicValFM = new System.Windows.Forms.LabelTS();
            this.labelTS7 = new System.Windows.Forms.LabelTS();
            this.lblFMOffset = new System.Windows.Forms.LabelTS();
            this.lblFMDeviation = new System.Windows.Forms.LabelTS();
            this.comboFMMemory = new System.Windows.Forms.ComboBoxTS();
            this.lblFMMic = new System.Windows.Forms.LabelTS();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX2RF)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbFilterShift)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbFilterWidth)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.udFilterHigh)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.udFilterLow)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbCWSpeed)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.udCWPitch)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.udCWBreakInDelay)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.udRX2FilterHigh)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.udRX2FilterLow)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.udRIT)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.udXIT)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbDisplayZoom)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbDisplayPan)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbPWR)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRF)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbAF)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbPanMainRX)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbPanSubRX)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX2Gain)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX2Pan)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX0Gain)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX1Gain)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbVACRXGain)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbVACTXGain)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.udFMOffset)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.picSquelch)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.picRX2Squelch)).BeginInit();
            this.contextMenuStripFilterRX1.SuspendLayout();
            this.contextMenuStripFilterRX2.SuspendLayout();
            this.contextMenuStripNotch.SuspendLayout();
            this.menuStrip1.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX2Squelch)).BeginInit();
            this.panelOptions.SuspendLayout();
            this.panelPower.SuspendLayout();
            this.panelFilter.SuspendLayout();
            this.panelModeSpecificCW.SuspendLayout();
            this.grpSemiBreakIn.SuspendLayout();
            this.panelAntenna.SuspendLayout();
            this.panelRX2Filter.SuspendLayout();
            this.panelRX2Mode.SuspendLayout();
            this.panelRX2Display.SuspendLayout();
            this.panelRX2Mixer.SuspendLayout();
            this.panelMultiRX.SuspendLayout();
            this.panelDisplay2.SuspendLayout();
            this.panelDSP.SuspendLayout();
            this.panelVFO.SuspendLayout();
            this.panelDateTime.SuspendLayout();
            this.panelSoundControls.SuspendLayout();
            this.panelModeSpecificPhone.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.picNoiseGate)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbNoiseGate)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.picVOX)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbVOX)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbCPDR)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbDX)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbMic)).BeginInit();
            this.panelModeSpecificDigital.SuspendLayout();
            this.grpVACStereo.SuspendLayout();
            this.grpDIGSampleRate.SuspendLayout();
            this.panelDisplay.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.picDisplay)).BeginInit();
            this.panelMode.SuspendLayout();
            this.panelBandHF.SuspendLayout();
            this.grpVFOA.SuspendLayout();
            this.grpVFOB.SuspendLayout();
            this.grpMultimeter.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.picMultiMeterDigital)).BeginInit();
            this.grpVFOBetween.SuspendLayout();
            this.grpDisplaySplit.SuspendLayout();
            this.grpRX2Meter.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.picRX2Meter)).BeginInit();
            this.panelBandVHF.SuspendLayout();
            this.panelRX2DSP.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.ptbSquelch)).BeginInit();
            this.panelModeSpecificFM.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.ptbFMMic)).BeginInit();
            this.SuspendLayout();
            // 
            // timer_cpu_meter
            // 
            this.timer_cpu_meter.Enabled = true;
            this.timer_cpu_meter.Interval = 1000;
            this.timer_cpu_meter.Tick += new System.EventHandler(this.timer_cpu_meter_Tick);
            // 
            // timer_peak_text
            // 
            this.timer_peak_text.Interval = 500;
            this.timer_peak_text.Tick += new System.EventHandler(this.timer_peak_text_Tick);
            // 
            // ptbRX2RF
            // 
            resources.ApplyResources(this.ptbRX2RF, "ptbRX2RF");
            this.ptbRX2RF.HeadImage = null;
            this.ptbRX2RF.LargeChange = 1;
            this.ptbRX2RF.Maximum = 120;
            this.ptbRX2RF.Minimum = -20;
            this.ptbRX2RF.Name = "ptbRX2RF";
            this.ptbRX2RF.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbRX2RF.SmallChange = 1;
            this.ptbRX2RF.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbRX2RF, resources.GetString("ptbRX2RF.ToolTip"));
            this.ptbRX2RF.Value = 90;
            this.ptbRX2RF.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbRX2RF_Scroll);
            // 
            // chkSR
            // 
            resources.ApplyResources(this.chkSR, "chkSR");
            this.chkSR.BackColor = System.Drawing.Color.Transparent;
            this.chkSR.Checked = true;
            this.chkSR.CheckState = System.Windows.Forms.CheckState.Checked;
            this.chkSR.FlatAppearance.BorderSize = 0;
            this.chkSR.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkSR.Name = "chkSR";
            this.toolTip1.SetToolTip(this.chkSR, resources.GetString("chkSR.ToolTip"));
            this.chkSR.UseVisualStyleBackColor = false;
            this.chkSR.CheckedChanged += new System.EventHandler(this.chkSR_CheckedChanged);
            // 
            // chkFWCATU
            // 
            resources.ApplyResources(this.chkFWCATU, "chkFWCATU");
            this.chkFWCATU.FlatAppearance.BorderSize = 0;
            this.chkFWCATU.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkFWCATU.Name = "chkFWCATU";
            this.toolTip1.SetToolTip(this.chkFWCATU, resources.GetString("chkFWCATU.ToolTip"));
            this.chkFWCATU.Click += new System.EventHandler(this.chkFWCATU_Click);
            // 
            // ckQuickPlay
            // 
            resources.ApplyResources(this.ckQuickPlay, "ckQuickPlay");
            this.ckQuickPlay.FlatAppearance.BorderSize = 0;
            this.ckQuickPlay.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.ckQuickPlay.Name = "ckQuickPlay";
            this.toolTip1.SetToolTip(this.ckQuickPlay, resources.GetString("ckQuickPlay.ToolTip"));
            this.ckQuickPlay.CheckedChanged += new System.EventHandler(this.ckQuickPlay_CheckedChanged);
            // 
            // chkMON
            // 
            resources.ApplyResources(this.chkMON, "chkMON");
            this.chkMON.FlatAppearance.BorderSize = 0;
            this.chkMON.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkMON.Name = "chkMON";
            this.toolTip1.SetToolTip(this.chkMON, resources.GetString("chkMON.ToolTip"));
            this.chkMON.CheckedChanged += new System.EventHandler(this.chkMON_CheckedChanged);
            // 
            // ckQuickRec
            // 
            resources.ApplyResources(this.ckQuickRec, "ckQuickRec");
            this.ckQuickRec.FlatAppearance.BorderSize = 0;
            this.ckQuickRec.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.ckQuickRec.Name = "ckQuickRec";
            this.toolTip1.SetToolTip(this.ckQuickRec, resources.GetString("ckQuickRec.ToolTip"));
            this.ckQuickRec.CheckedChanged += new System.EventHandler(this.ckQuickRec_CheckedChanged);
            // 
            // chkMOX
            // 
            resources.ApplyResources(this.chkMOX, "chkMOX");
            this.chkMOX.FlatAppearance.BorderSize = 0;
            this.chkMOX.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkMOX.Name = "chkMOX";
            this.toolTip1.SetToolTip(this.chkMOX, resources.GetString("chkMOX.ToolTip"));
            this.chkMOX.CheckedChanged += new System.EventHandler(this.chkMOX_CheckedChanged2);
            this.chkMOX.Click += new System.EventHandler(this.chkMOX_Click);
            // 
            // chkTUN
            // 
            resources.ApplyResources(this.chkTUN, "chkTUN");
            this.chkTUN.FlatAppearance.BorderSize = 0;
            this.chkTUN.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkTUN.Name = "chkTUN";
            this.toolTip1.SetToolTip(this.chkTUN, resources.GetString("chkTUN.ToolTip"));
            this.chkTUN.CheckedChanged += new System.EventHandler(this.chkTUN_CheckedChanged);
            // 
            // chkX2TR
            // 
            resources.ApplyResources(this.chkX2TR, "chkX2TR");
            this.chkX2TR.FlatAppearance.BorderSize = 0;
            this.chkX2TR.Name = "chkX2TR";
            this.toolTip1.SetToolTip(this.chkX2TR, resources.GetString("chkX2TR.ToolTip"));
            this.chkX2TR.CheckedChanged += new System.EventHandler(this.chkX2TR_CheckedChanged);
            // 
            // comboTuneMode
            // 
            this.comboTuneMode.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboTuneMode.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboTuneMode.DropDownWidth = 42;
            resources.ApplyResources(this.comboTuneMode, "comboTuneMode");
            this.comboTuneMode.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.comboTuneMode.Items.AddRange(new object[] {
            resources.GetString("comboTuneMode.Items"),
            resources.GetString("comboTuneMode.Items1"),
            resources.GetString("comboTuneMode.Items2")});
            this.comboTuneMode.Name = "comboTuneMode";
            this.toolTip1.SetToolTip(this.comboTuneMode, resources.GetString("comboTuneMode.ToolTip"));
            this.comboTuneMode.SelectedIndexChanged += new System.EventHandler(this.comboTuneMode_SelectedIndexChanged);
            // 
            // chkPower
            // 
            resources.ApplyResources(this.chkPower, "chkPower");
            this.chkPower.BackColor = System.Drawing.SystemColors.Control;
            this.chkPower.FlatAppearance.BorderSize = 0;
            this.chkPower.Name = "chkPower";
            this.toolTip1.SetToolTip(this.chkPower, resources.GetString("chkPower.ToolTip"));
            this.chkPower.UseVisualStyleBackColor = false;
            this.chkPower.CheckedChanged += new System.EventHandler(this.chkPower_CheckedChanged);
            // 
            // ptbFilterShift
            // 
            resources.ApplyResources(this.ptbFilterShift, "ptbFilterShift");
            this.ptbFilterShift.HeadImage = null;
            this.ptbFilterShift.LargeChange = 1;
            this.ptbFilterShift.Maximum = 1000;
            this.ptbFilterShift.Minimum = -1000;
            this.ptbFilterShift.Name = "ptbFilterShift";
            this.ptbFilterShift.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbFilterShift.SmallChange = 1;
            this.ptbFilterShift.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbFilterShift, resources.GetString("ptbFilterShift.ToolTip"));
            this.ptbFilterShift.Value = 0;
            this.ptbFilterShift.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbFilterShift_Scroll);
            // 
            // ptbFilterWidth
            // 
            resources.ApplyResources(this.ptbFilterWidth, "ptbFilterWidth");
            this.ptbFilterWidth.HeadImage = null;
            this.ptbFilterWidth.LargeChange = 1;
            this.ptbFilterWidth.Maximum = 15000;
            this.ptbFilterWidth.Minimum = 0;
            this.ptbFilterWidth.Name = "ptbFilterWidth";
            this.ptbFilterWidth.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbFilterWidth.SmallChange = 1;
            this.ptbFilterWidth.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbFilterWidth, resources.GetString("ptbFilterWidth.ToolTip"));
            this.ptbFilterWidth.Value = 10;
            this.ptbFilterWidth.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbFilterWidth_Scroll);
            // 
            // btnFilterShiftReset
            // 
            this.btnFilterShiftReset.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnFilterShiftReset, "btnFilterShiftReset");
            this.btnFilterShiftReset.Name = "btnFilterShiftReset";
            this.btnFilterShiftReset.Tag = "Reset Filter Shift";
            this.toolTip1.SetToolTip(this.btnFilterShiftReset, resources.GetString("btnFilterShiftReset.ToolTip"));
            this.btnFilterShiftReset.Click += new System.EventHandler(this.btnFilterShiftReset_Click);
            // 
            // udFilterHigh
            // 
            this.udFilterHigh.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            resources.ApplyResources(this.udFilterHigh, "udFilterHigh");
            this.udFilterHigh.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.udFilterHigh.Increment = new decimal(new int[] {
            10,
            0,
            0,
            0});
            this.udFilterHigh.Maximum = new decimal(new int[] {
            15000,
            0,
            0,
            0});
            this.udFilterHigh.Minimum = new decimal(new int[] {
            15000,
            0,
            0,
            -2147483648});
            this.udFilterHigh.Name = "udFilterHigh";
            this.udFilterHigh.ReadOnly = true;
            this.toolTip1.SetToolTip(this.udFilterHigh, resources.GetString("udFilterHigh.ToolTip"));
            this.udFilterHigh.Value = new decimal(new int[] {
            6000,
            0,
            0,
            0});
            this.udFilterHigh.ValueChanged += new System.EventHandler(this.udFilterHigh_ValueChanged);
            this.udFilterHigh.KeyPress += new System.Windows.Forms.KeyPressEventHandler(this.Console_KeyPress);
            this.udFilterHigh.LostFocus += new System.EventHandler(this.udFilterHigh_LostFocus);
            // 
            // udFilterLow
            // 
            this.udFilterLow.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            resources.ApplyResources(this.udFilterLow, "udFilterLow");
            this.udFilterLow.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.udFilterLow.Increment = new decimal(new int[] {
            10,
            0,
            0,
            0});
            this.udFilterLow.Maximum = new decimal(new int[] {
            15000,
            0,
            0,
            0});
            this.udFilterLow.Minimum = new decimal(new int[] {
            15000,
            0,
            0,
            -2147483648});
            this.udFilterLow.Name = "udFilterLow";
            this.toolTip1.SetToolTip(this.udFilterLow, resources.GetString("udFilterLow.ToolTip"));
            this.udFilterLow.Value = new decimal(new int[] {
            0,
            0,
            0,
            0});
            this.udFilterLow.ValueChanged += new System.EventHandler(this.udFilterLow_ValueChanged);
            this.udFilterLow.KeyPress += new System.Windows.Forms.KeyPressEventHandler(this.Console_KeyPress);
            this.udFilterLow.LostFocus += new System.EventHandler(this.udFilterLow_LostFocus);
            // 
            // chkFWCATUBypass
            // 
            resources.ApplyResources(this.chkFWCATUBypass, "chkFWCATUBypass");
            this.chkFWCATUBypass.FlatAppearance.BorderSize = 0;
            this.chkFWCATUBypass.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkFWCATUBypass.Name = "chkFWCATUBypass";
            this.toolTip1.SetToolTip(this.chkFWCATUBypass, resources.GetString("chkFWCATUBypass.ToolTip"));
            this.chkFWCATUBypass.CheckedChanged += new System.EventHandler(this.chkFWCATUBypass_CheckedChanged);
            this.chkFWCATUBypass.Click += new System.EventHandler(this.chkFWCATUBypass_Click);
            // 
            // ptbCWSpeed
            // 
            resources.ApplyResources(this.ptbCWSpeed, "ptbCWSpeed");
            this.ptbCWSpeed.HeadImage = null;
            this.ptbCWSpeed.LargeChange = 1;
            this.ptbCWSpeed.Maximum = 60;
            this.ptbCWSpeed.Minimum = 1;
            this.ptbCWSpeed.Name = "ptbCWSpeed";
            this.ptbCWSpeed.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbCWSpeed.SmallChange = 1;
            this.ptbCWSpeed.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbCWSpeed, resources.GetString("ptbCWSpeed.ToolTip"));
            this.ptbCWSpeed.Value = 25;
            this.ptbCWSpeed.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbCWSpeed_Scroll);
            // 
            // udCWPitch
            // 
            this.udCWPitch.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.udCWPitch.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.udCWPitch.Increment = new decimal(new int[] {
            10,
            0,
            0,
            0});
            resources.ApplyResources(this.udCWPitch, "udCWPitch");
            this.udCWPitch.Maximum = new decimal(new int[] {
            2250,
            0,
            0,
            0});
            this.udCWPitch.Minimum = new decimal(new int[] {
            200,
            0,
            0,
            0});
            this.udCWPitch.Name = "udCWPitch";
            this.toolTip1.SetToolTip(this.udCWPitch, resources.GetString("udCWPitch.ToolTip"));
            this.udCWPitch.Value = new decimal(new int[] {
            600,
            0,
            0,
            0});
            this.udCWPitch.ValueChanged += new System.EventHandler(this.udCWPitch_ValueChanged);
            // 
            // udCWBreakInDelay
            // 
            this.udCWBreakInDelay.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.udCWBreakInDelay.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.udCWBreakInDelay.Increment = new decimal(new int[] {
            1,
            0,
            0,
            0});
            resources.ApplyResources(this.udCWBreakInDelay, "udCWBreakInDelay");
            this.udCWBreakInDelay.Maximum = new decimal(new int[] {
            5000,
            0,
            0,
            0});
            this.udCWBreakInDelay.Minimum = new decimal(new int[] {
            0,
            0,
            0,
            0});
            this.udCWBreakInDelay.Name = "udCWBreakInDelay";
            this.toolTip1.SetToolTip(this.udCWBreakInDelay, resources.GetString("udCWBreakInDelay.ToolTip"));
            this.udCWBreakInDelay.Value = new decimal(new int[] {
            300,
            0,
            0,
            0});
            this.udCWBreakInDelay.ValueChanged += new System.EventHandler(this.udCWBreakInDelay_ValueChanged);
            this.udCWBreakInDelay.LostFocus += new System.EventHandler(this.udCWBreakInDelay_LostFocus);
            // 
            // chkCWBreakInEnabled
            // 
            this.chkCWBreakInEnabled.Checked = true;
            this.chkCWBreakInEnabled.CheckState = System.Windows.Forms.CheckState.Checked;
            resources.ApplyResources(this.chkCWBreakInEnabled, "chkCWBreakInEnabled");
            this.chkCWBreakInEnabled.ForeColor = System.Drawing.Color.White;
            this.chkCWBreakInEnabled.Name = "chkCWBreakInEnabled";
            this.toolTip1.SetToolTip(this.chkCWBreakInEnabled, resources.GetString("chkCWBreakInEnabled.ToolTip"));
            this.chkCWBreakInEnabled.CheckedChanged += new System.EventHandler(this.chkCWBreakInEnabled_CheckedChanged);
            // 
            // chkShowTXCWFreq
            // 
            this.chkShowTXCWFreq.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.chkShowTXCWFreq, "chkShowTXCWFreq");
            this.chkShowTXCWFreq.Name = "chkShowTXCWFreq";
            this.toolTip1.SetToolTip(this.chkShowTXCWFreq, resources.GetString("chkShowTXCWFreq.ToolTip"));
            this.chkShowTXCWFreq.CheckedChanged += new System.EventHandler(this.chkShowTXCWFreq_CheckedChanged);
            // 
            // chkCWVAC
            // 
            resources.ApplyResources(this.chkCWVAC, "chkCWVAC");
            this.chkCWVAC.FlatAppearance.BorderSize = 0;
            this.chkCWVAC.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkCWVAC.Name = "chkCWVAC";
            this.toolTip1.SetToolTip(this.chkCWVAC, resources.GetString("chkCWVAC.ToolTip"));
            this.chkCWVAC.CheckedChanged += new System.EventHandler(this.chkCWVAC_CheckedChanged);
            // 
            // chkCWIambic
            // 
            this.chkCWIambic.Checked = true;
            this.chkCWIambic.CheckState = System.Windows.Forms.CheckState.Checked;
            resources.ApplyResources(this.chkCWIambic, "chkCWIambic");
            this.chkCWIambic.ForeColor = System.Drawing.Color.White;
            this.chkCWIambic.Name = "chkCWIambic";
            this.toolTip1.SetToolTip(this.chkCWIambic, resources.GetString("chkCWIambic.ToolTip"));
            this.chkCWIambic.CheckedChanged += new System.EventHandler(this.chkCWIambic_CheckedChanged);
            // 
            // udRX2FilterHigh
            // 
            this.udRX2FilterHigh.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            resources.ApplyResources(this.udRX2FilterHigh, "udRX2FilterHigh");
            this.udRX2FilterHigh.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.udRX2FilterHigh.Increment = new decimal(new int[] {
            10,
            0,
            0,
            0});
            this.udRX2FilterHigh.Maximum = new decimal(new int[] {
            9999,
            0,
            0,
            0});
            this.udRX2FilterHigh.Minimum = new decimal(new int[] {
            9999,
            0,
            0,
            -2147483648});
            this.udRX2FilterHigh.Name = "udRX2FilterHigh";
            this.toolTip1.SetToolTip(this.udRX2FilterHigh, resources.GetString("udRX2FilterHigh.ToolTip"));
            this.udRX2FilterHigh.Value = new decimal(new int[] {
            6000,
            0,
            0,
            0});
            this.udRX2FilterHigh.ValueChanged += new System.EventHandler(this.udRX2FilterHigh_ValueChanged);
            // 
            // udRX2FilterLow
            // 
            this.udRX2FilterLow.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            resources.ApplyResources(this.udRX2FilterLow, "udRX2FilterLow");
            this.udRX2FilterLow.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.udRX2FilterLow.Increment = new decimal(new int[] {
            10,
            0,
            0,
            0});
            this.udRX2FilterLow.Maximum = new decimal(new int[] {
            9999,
            0,
            0,
            0});
            this.udRX2FilterLow.Minimum = new decimal(new int[] {
            9999,
            0,
            0,
            -2147483648});
            this.udRX2FilterLow.Name = "udRX2FilterLow";
            this.toolTip1.SetToolTip(this.udRX2FilterLow, resources.GetString("udRX2FilterLow.ToolTip"));
            this.udRX2FilterLow.Value = new decimal(new int[] {
            0,
            0,
            0,
            0});
            this.udRX2FilterLow.ValueChanged += new System.EventHandler(this.udRX2FilterLow_ValueChanged);
            // 
            // radRX2ModeAM
            // 
            resources.ApplyResources(this.radRX2ModeAM, "radRX2ModeAM");
            this.radRX2ModeAM.FlatAppearance.BorderSize = 0;
            this.radRX2ModeAM.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeAM.Name = "radRX2ModeAM";
            this.toolTip1.SetToolTip(this.radRX2ModeAM, resources.GetString("radRX2ModeAM.ToolTip"));
            this.radRX2ModeAM.CheckedChanged += new System.EventHandler(this.radRX2ModeAM_CheckedChanged);
            // 
            // radRX2ModeLSB
            // 
            resources.ApplyResources(this.radRX2ModeLSB, "radRX2ModeLSB");
            this.radRX2ModeLSB.FlatAppearance.BorderSize = 0;
            this.radRX2ModeLSB.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeLSB.Name = "radRX2ModeLSB";
            this.toolTip1.SetToolTip(this.radRX2ModeLSB, resources.GetString("radRX2ModeLSB.ToolTip"));
            this.radRX2ModeLSB.CheckedChanged += new System.EventHandler(this.radRX2ModeLSB_CheckedChanged);
            // 
            // radRX2ModeSAM
            // 
            resources.ApplyResources(this.radRX2ModeSAM, "radRX2ModeSAM");
            this.radRX2ModeSAM.FlatAppearance.BorderSize = 0;
            this.radRX2ModeSAM.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeSAM.Name = "radRX2ModeSAM";
            this.toolTip1.SetToolTip(this.radRX2ModeSAM, resources.GetString("radRX2ModeSAM.ToolTip"));
            this.radRX2ModeSAM.CheckedChanged += new System.EventHandler(this.radRX2ModeSAM_CheckedChanged);
            // 
            // radRX2ModeCWL
            // 
            resources.ApplyResources(this.radRX2ModeCWL, "radRX2ModeCWL");
            this.radRX2ModeCWL.FlatAppearance.BorderSize = 0;
            this.radRX2ModeCWL.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeCWL.Name = "radRX2ModeCWL";
            this.toolTip1.SetToolTip(this.radRX2ModeCWL, resources.GetString("radRX2ModeCWL.ToolTip"));
            this.radRX2ModeCWL.CheckedChanged += new System.EventHandler(this.radRX2ModeCWL_CheckedChanged);
            // 
            // radRX2ModeDSB
            // 
            resources.ApplyResources(this.radRX2ModeDSB, "radRX2ModeDSB");
            this.radRX2ModeDSB.FlatAppearance.BorderSize = 0;
            this.radRX2ModeDSB.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeDSB.Name = "radRX2ModeDSB";
            this.toolTip1.SetToolTip(this.radRX2ModeDSB, resources.GetString("radRX2ModeDSB.ToolTip"));
            this.radRX2ModeDSB.CheckedChanged += new System.EventHandler(this.radRX2ModeDSB_CheckedChanged);
            // 
            // radRX2ModeUSB
            // 
            resources.ApplyResources(this.radRX2ModeUSB, "radRX2ModeUSB");
            this.radRX2ModeUSB.BackColor = System.Drawing.SystemColors.Control;
            this.radRX2ModeUSB.FlatAppearance.BorderSize = 0;
            this.radRX2ModeUSB.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeUSB.Name = "radRX2ModeUSB";
            this.toolTip1.SetToolTip(this.radRX2ModeUSB, resources.GetString("radRX2ModeUSB.ToolTip"));
            this.radRX2ModeUSB.UseVisualStyleBackColor = false;
            this.radRX2ModeUSB.CheckedChanged += new System.EventHandler(this.radRX2ModeUSB_CheckedChanged);
            // 
            // radRX2ModeCWU
            // 
            resources.ApplyResources(this.radRX2ModeCWU, "radRX2ModeCWU");
            this.radRX2ModeCWU.FlatAppearance.BorderSize = 0;
            this.radRX2ModeCWU.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeCWU.Name = "radRX2ModeCWU";
            this.toolTip1.SetToolTip(this.radRX2ModeCWU, resources.GetString("radRX2ModeCWU.ToolTip"));
            this.radRX2ModeCWU.CheckedChanged += new System.EventHandler(this.radRX2ModeCWU_CheckedChanged);
            // 
            // radRX2ModeFMN
            // 
            resources.ApplyResources(this.radRX2ModeFMN, "radRX2ModeFMN");
            this.radRX2ModeFMN.FlatAppearance.BorderSize = 0;
            this.radRX2ModeFMN.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeFMN.Name = "radRX2ModeFMN";
            this.toolTip1.SetToolTip(this.radRX2ModeFMN, resources.GetString("radRX2ModeFMN.ToolTip"));
            this.radRX2ModeFMN.CheckedChanged += new System.EventHandler(this.radRX2ModeFMN_CheckedChanged);
            // 
            // radRX2ModeDIGU
            // 
            resources.ApplyResources(this.radRX2ModeDIGU, "radRX2ModeDIGU");
            this.radRX2ModeDIGU.FlatAppearance.BorderSize = 0;
            this.radRX2ModeDIGU.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeDIGU.Name = "radRX2ModeDIGU";
            this.toolTip1.SetToolTip(this.radRX2ModeDIGU, resources.GetString("radRX2ModeDIGU.ToolTip"));
            this.radRX2ModeDIGU.CheckedChanged += new System.EventHandler(this.radRX2ModeDIGU_CheckedChanged);
            // 
            // radRX2ModeDRM
            // 
            resources.ApplyResources(this.radRX2ModeDRM, "radRX2ModeDRM");
            this.radRX2ModeDRM.FlatAppearance.BorderSize = 0;
            this.radRX2ModeDRM.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeDRM.Name = "radRX2ModeDRM";
            this.toolTip1.SetToolTip(this.radRX2ModeDRM, resources.GetString("radRX2ModeDRM.ToolTip"));
            this.radRX2ModeDRM.CheckedChanged += new System.EventHandler(this.radRX2ModeDRM_CheckedChanged);
            // 
            // radRX2ModeDIGL
            // 
            resources.ApplyResources(this.radRX2ModeDIGL, "radRX2ModeDIGL");
            this.radRX2ModeDIGL.FlatAppearance.BorderSize = 0;
            this.radRX2ModeDIGL.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeDIGL.Name = "radRX2ModeDIGL";
            this.toolTip1.SetToolTip(this.radRX2ModeDIGL, resources.GetString("radRX2ModeDIGL.ToolTip"));
            this.radRX2ModeDIGL.CheckedChanged += new System.EventHandler(this.radRX2ModeDIGL_CheckedChanged);
            // 
            // radRX2ModeSPEC
            // 
            resources.ApplyResources(this.radRX2ModeSPEC, "radRX2ModeSPEC");
            this.radRX2ModeSPEC.FlatAppearance.BorderSize = 0;
            this.radRX2ModeSPEC.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2ModeSPEC.Name = "radRX2ModeSPEC";
            this.toolTip1.SetToolTip(this.radRX2ModeSPEC, resources.GetString("radRX2ModeSPEC.ToolTip"));
            // 
            // chkRX2DisplayPeak
            // 
            resources.ApplyResources(this.chkRX2DisplayPeak, "chkRX2DisplayPeak");
            this.chkRX2DisplayPeak.FlatAppearance.BorderSize = 0;
            this.chkRX2DisplayPeak.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRX2DisplayPeak.Name = "chkRX2DisplayPeak";
            this.toolTip1.SetToolTip(this.chkRX2DisplayPeak, resources.GetString("chkRX2DisplayPeak.ToolTip"));
            this.chkRX2DisplayPeak.CheckedChanged += new System.EventHandler(this.chkRX2DisplayPeak_CheckedChanged);
            // 
            // comboRX2DisplayMode
            // 
            this.comboRX2DisplayMode.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboRX2DisplayMode.DisplayMember = "0";
            this.comboRX2DisplayMode.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboRX2DisplayMode.DropDownWidth = 88;
            this.comboRX2DisplayMode.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboRX2DisplayMode, "comboRX2DisplayMode");
            this.comboRX2DisplayMode.Items.AddRange(new object[] {
            resources.GetString("comboRX2DisplayMode.Items"),
            resources.GetString("comboRX2DisplayMode.Items1"),
            resources.GetString("comboRX2DisplayMode.Items2")});
            this.comboRX2DisplayMode.Name = "comboRX2DisplayMode";
            this.toolTip1.SetToolTip(this.comboRX2DisplayMode, resources.GetString("comboRX2DisplayMode.ToolTip"));
            this.comboRX2DisplayMode.SelectedIndexChanged += new System.EventHandler(this.comboRX2DisplayMode_SelectedIndexChanged);
            // 
            // chkRX2Mute
            // 
            resources.ApplyResources(this.chkRX2Mute, "chkRX2Mute");
            this.chkRX2Mute.Name = "chkRX2Mute";
            this.toolTip1.SetToolTip(this.chkRX2Mute, resources.GetString("chkRX2Mute.ToolTip"));
            this.chkRX2Mute.CheckedChanged += new System.EventHandler(this.chkRX2Mute_CheckedChanged);
            // 
            // chkPanSwap
            // 
            resources.ApplyResources(this.chkPanSwap, "chkPanSwap");
            this.chkPanSwap.FlatAppearance.BorderSize = 0;
            this.chkPanSwap.ForeColor = System.Drawing.Color.White;
            this.chkPanSwap.Name = "chkPanSwap";
            this.toolTip1.SetToolTip(this.chkPanSwap, resources.GetString("chkPanSwap.ToolTip"));
            this.chkPanSwap.CheckedChanged += new System.EventHandler(this.chkPanSwap_CheckedChanged);
            // 
            // chkEnableMultiRX
            // 
            resources.ApplyResources(this.chkEnableMultiRX, "chkEnableMultiRX");
            this.chkEnableMultiRX.FlatAppearance.BorderSize = 0;
            this.chkEnableMultiRX.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkEnableMultiRX.Name = "chkEnableMultiRX";
            this.toolTip1.SetToolTip(this.chkEnableMultiRX, resources.GetString("chkEnableMultiRX.ToolTip"));
            this.chkEnableMultiRX.CheckedChanged += new System.EventHandler(this.chkEnableMultiRX_CheckedChanged);
            // 
            // chkDisplayPeak
            // 
            resources.ApplyResources(this.chkDisplayPeak, "chkDisplayPeak");
            this.chkDisplayPeak.FlatAppearance.BorderSize = 0;
            this.chkDisplayPeak.Name = "chkDisplayPeak";
            this.toolTip1.SetToolTip(this.chkDisplayPeak, resources.GetString("chkDisplayPeak.ToolTip"));
            this.chkDisplayPeak.CheckedChanged += new System.EventHandler(this.chkDisplayPeak_CheckedChanged);
            // 
            // comboDisplayMode
            // 
            this.comboDisplayMode.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboDisplayMode.DisplayMember = "0";
            this.comboDisplayMode.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboDisplayMode.DropDownWidth = 88;
            resources.ApplyResources(this.comboDisplayMode, "comboDisplayMode");
            this.comboDisplayMode.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.comboDisplayMode.Name = "comboDisplayMode";
            this.toolTip1.SetToolTip(this.comboDisplayMode, resources.GetString("comboDisplayMode.ToolTip"));
            this.comboDisplayMode.SelectedIndexChanged += new System.EventHandler(this.comboDisplayMode_SelectedIndexChanged);
            // 
            // chkDisplayAVG
            // 
            resources.ApplyResources(this.chkDisplayAVG, "chkDisplayAVG");
            this.chkDisplayAVG.FlatAppearance.BorderSize = 0;
            this.chkDisplayAVG.Name = "chkDisplayAVG";
            this.toolTip1.SetToolTip(this.chkDisplayAVG, resources.GetString("chkDisplayAVG.ToolTip"));
            this.chkDisplayAVG.CheckedChanged += new System.EventHandler(this.chkDisplayAVG_CheckedChanged);
            // 
            // chkNR
            // 
            resources.ApplyResources(this.chkNR, "chkNR");
            this.chkNR.FlatAppearance.BorderSize = 0;
            this.chkNR.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkNR.Name = "chkNR";
            this.toolTip1.SetToolTip(this.chkNR, resources.GetString("chkNR.ToolTip"));
            this.chkNR.CheckedChanged += new System.EventHandler(this.chkNR_CheckedChanged);
            // 
            // chkDSPNB2
            // 
            resources.ApplyResources(this.chkDSPNB2, "chkDSPNB2");
            this.chkDSPNB2.FlatAppearance.BorderSize = 0;
            this.chkDSPNB2.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkDSPNB2.Name = "chkDSPNB2";
            this.toolTip1.SetToolTip(this.chkDSPNB2, resources.GetString("chkDSPNB2.ToolTip"));
            this.chkDSPNB2.CheckedChanged += new System.EventHandler(this.chkDSPNB2_CheckedChanged);
            // 
            // chkBIN
            // 
            resources.ApplyResources(this.chkBIN, "chkBIN");
            this.chkBIN.FlatAppearance.BorderSize = 0;
            this.chkBIN.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkBIN.Name = "chkBIN";
            this.toolTip1.SetToolTip(this.chkBIN, resources.GetString("chkBIN.ToolTip"));
            this.chkBIN.CheckedChanged += new System.EventHandler(this.chkBIN_CheckedChanged);
            // 
            // chkNB
            // 
            resources.ApplyResources(this.chkNB, "chkNB");
            this.chkNB.FlatAppearance.BorderSize = 0;
            this.chkNB.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkNB.Name = "chkNB";
            this.toolTip1.SetToolTip(this.chkNB, resources.GetString("chkNB.ToolTip"));
            this.chkNB.CheckedChanged += new System.EventHandler(this.chkNB_CheckedChanged);
            // 
            // chkANF
            // 
            resources.ApplyResources(this.chkANF, "chkANF");
            this.chkANF.FlatAppearance.BorderSize = 0;
            this.chkANF.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkANF.Name = "chkANF";
            this.toolTip1.SetToolTip(this.chkANF, resources.GetString("chkANF.ToolTip"));
            this.chkANF.CheckedChanged += new System.EventHandler(this.chkANF_CheckedChanged);
            // 
            // btnZeroBeat
            // 
            resources.ApplyResources(this.btnZeroBeat, "btnZeroBeat");
            this.btnZeroBeat.FlatAppearance.BorderSize = 0;
            this.btnZeroBeat.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnZeroBeat.Name = "btnZeroBeat";
            this.toolTip1.SetToolTip(this.btnZeroBeat, resources.GetString("btnZeroBeat.ToolTip"));
            this.btnZeroBeat.Click += new System.EventHandler(this.btnZeroBeat_Click);
            // 
            // chkVFOSplit
            // 
            resources.ApplyResources(this.chkVFOSplit, "chkVFOSplit");
            this.chkVFOSplit.FlatAppearance.BorderSize = 0;
            this.chkVFOSplit.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkVFOSplit.Name = "chkVFOSplit";
            this.toolTip1.SetToolTip(this.chkVFOSplit, resources.GetString("chkVFOSplit.ToolTip"));
            this.chkVFOSplit.CheckedChanged += new System.EventHandler(this.chkVFOSplit_CheckedChanged);
            // 
            // btnRITReset
            // 
            this.btnRITReset.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnRITReset, "btnRITReset");
            this.btnRITReset.Name = "btnRITReset";
            this.toolTip1.SetToolTip(this.btnRITReset, resources.GetString("btnRITReset.ToolTip"));
            this.btnRITReset.Click += new System.EventHandler(this.btnRITReset_Click);
            // 
            // btnXITReset
            // 
            this.btnXITReset.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnXITReset, "btnXITReset");
            this.btnXITReset.Name = "btnXITReset";
            this.toolTip1.SetToolTip(this.btnXITReset, resources.GetString("btnXITReset.ToolTip"));
            this.btnXITReset.Click += new System.EventHandler(this.btnXITReset_Click);
            // 
            // udRIT
            // 
            this.udRIT.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.udRIT.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.udRIT.Increment = new decimal(new int[] {
            1,
            0,
            0,
            0});
            resources.ApplyResources(this.udRIT, "udRIT");
            this.udRIT.Maximum = new decimal(new int[] {
            99999,
            0,
            0,
            0});
            this.udRIT.Minimum = new decimal(new int[] {
            99999,
            0,
            0,
            -2147483648});
            this.udRIT.Name = "udRIT";
            this.toolTip1.SetToolTip(this.udRIT, resources.GetString("udRIT.ToolTip"));
            this.udRIT.Value = new decimal(new int[] {
            0,
            0,
            0,
            0});
            this.udRIT.ValueChanged += new System.EventHandler(this.udRIT_ValueChanged);
            this.udRIT.KeyPress += new System.Windows.Forms.KeyPressEventHandler(this.Console_KeyPress);
            this.udRIT.LostFocus += new System.EventHandler(this.udRIT_LostFocus);
            // 
            // btnIFtoVFO
            // 
            this.btnIFtoVFO.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnIFtoVFO, "btnIFtoVFO");
            this.btnIFtoVFO.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnIFtoVFO.Name = "btnIFtoVFO";
            this.toolTip1.SetToolTip(this.btnIFtoVFO, resources.GetString("btnIFtoVFO.ToolTip"));
            this.btnIFtoVFO.Click += new System.EventHandler(this.btnIFtoVFO_Click);
            // 
            // chkRIT
            // 
            resources.ApplyResources(this.chkRIT, "chkRIT");
            this.chkRIT.FlatAppearance.BorderSize = 0;
            this.chkRIT.Name = "chkRIT";
            this.toolTip1.SetToolTip(this.chkRIT, resources.GetString("chkRIT.ToolTip"));
            this.chkRIT.CheckedChanged += new System.EventHandler(this.chkRIT_CheckedChanged);
            // 
            // btnVFOSwap
            // 
            this.btnVFOSwap.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnVFOSwap, "btnVFOSwap");
            this.btnVFOSwap.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnVFOSwap.Name = "btnVFOSwap";
            this.toolTip1.SetToolTip(this.btnVFOSwap, resources.GetString("btnVFOSwap.ToolTip"));
            this.btnVFOSwap.Click += new System.EventHandler(this.btnVFOSwap_Click);
            // 
            // chkXIT
            // 
            resources.ApplyResources(this.chkXIT, "chkXIT");
            this.chkXIT.FlatAppearance.BorderSize = 0;
            this.chkXIT.Name = "chkXIT";
            this.toolTip1.SetToolTip(this.chkXIT, resources.GetString("chkXIT.ToolTip"));
            this.chkXIT.CheckedChanged += new System.EventHandler(this.chkXIT_CheckedChanged);
            // 
            // btnVFOBtoA
            // 
            this.btnVFOBtoA.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnVFOBtoA, "btnVFOBtoA");
            this.btnVFOBtoA.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnVFOBtoA.Name = "btnVFOBtoA";
            this.toolTip1.SetToolTip(this.btnVFOBtoA, resources.GetString("btnVFOBtoA.ToolTip"));
            this.btnVFOBtoA.Click += new System.EventHandler(this.btnVFOBtoA_Click);
            // 
            // udXIT
            // 
            this.udXIT.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.udXIT.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.udXIT.Increment = new decimal(new int[] {
            1,
            0,
            0,
            0});
            resources.ApplyResources(this.udXIT, "udXIT");
            this.udXIT.Maximum = new decimal(new int[] {
            99999,
            0,
            0,
            0});
            this.udXIT.Minimum = new decimal(new int[] {
            99999,
            0,
            0,
            -2147483648});
            this.udXIT.Name = "udXIT";
            this.toolTip1.SetToolTip(this.udXIT, resources.GetString("udXIT.ToolTip"));
            this.udXIT.Value = new decimal(new int[] {
            0,
            0,
            0,
            0});
            this.udXIT.ValueChanged += new System.EventHandler(this.udXIT_ValueChanged);
            this.udXIT.KeyPress += new System.Windows.Forms.KeyPressEventHandler(this.Console_KeyPress);
            this.udXIT.LostFocus += new System.EventHandler(this.udXIT_LostFocus);
            // 
            // btnVFOAtoB
            // 
            this.btnVFOAtoB.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnVFOAtoB, "btnVFOAtoB");
            this.btnVFOAtoB.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnVFOAtoB.Name = "btnVFOAtoB";
            this.toolTip1.SetToolTip(this.btnVFOAtoB, resources.GetString("btnVFOAtoB.ToolTip"));
            this.btnVFOAtoB.Click += new System.EventHandler(this.btnVFOAtoB_Click);
            // 
            // chkRX1Preamp
            // 
            resources.ApplyResources(this.chkRX1Preamp, "chkRX1Preamp");
            this.chkRX1Preamp.FlatAppearance.BorderSize = 0;
            this.chkRX1Preamp.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRX1Preamp.Name = "chkRX1Preamp";
            this.toolTip1.SetToolTip(this.chkRX1Preamp, resources.GetString("chkRX1Preamp.ToolTip"));
            this.chkRX1Preamp.CheckedChanged += new System.EventHandler(this.chkRX1Preamp_CheckedChanged);
            // 
            // comboAGC
            // 
            this.comboAGC.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboAGC.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboAGC.DropDownWidth = 48;
            this.comboAGC.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboAGC, "comboAGC");
            this.comboAGC.Name = "comboAGC";
            this.toolTip1.SetToolTip(this.comboAGC, resources.GetString("comboAGC.ToolTip"));
            this.comboAGC.SelectedIndexChanged += new System.EventHandler(this.comboAGC_SelectedIndexChanged);
            // 
            // lblAGC
            // 
            this.lblAGC.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblAGC, "lblAGC");
            this.lblAGC.Name = "lblAGC";
            this.toolTip1.SetToolTip(this.lblAGC, resources.GetString("lblAGC.ToolTip"));
            // 
            // comboPreamp
            // 
            this.comboPreamp.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboPreamp.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboPreamp.DropDownWidth = 48;
            this.comboPreamp.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboPreamp, "comboPreamp");
            this.comboPreamp.Name = "comboPreamp";
            this.toolTip1.SetToolTip(this.comboPreamp, resources.GetString("comboPreamp.ToolTip"));
            this.comboPreamp.SelectedIndexChanged += new System.EventHandler(this.comboPreamp_SelectedIndexChanged);
            // 
            // lblRF
            // 
            this.lblRF.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblRF, "lblRF");
            this.lblRF.Name = "lblRF";
            this.toolTip1.SetToolTip(this.lblRF, resources.GetString("lblRF.ToolTip"));
            // 
            // chkShowTXFilter
            // 
            resources.ApplyResources(this.chkShowTXFilter, "chkShowTXFilter");
            this.chkShowTXFilter.FlatAppearance.BorderSize = 0;
            this.chkShowTXFilter.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkShowTXFilter.Name = "chkShowTXFilter";
            this.toolTip1.SetToolTip(this.chkShowTXFilter, resources.GetString("chkShowTXFilter.ToolTip"));
            this.chkShowTXFilter.CheckedChanged += new System.EventHandler(this.chkShowTXFilter_CheckedChanged);
            // 
            // chkDX
            // 
            resources.ApplyResources(this.chkDX, "chkDX");
            this.chkDX.FlatAppearance.BorderSize = 0;
            this.chkDX.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkDX.Name = "chkDX";
            this.toolTip1.SetToolTip(this.chkDX, resources.GetString("chkDX.ToolTip"));
            this.chkDX.CheckedChanged += new System.EventHandler(this.chkDX_CheckedChanged);
            // 
            // chkTXEQ
            // 
            resources.ApplyResources(this.chkTXEQ, "chkTXEQ");
            this.chkTXEQ.FlatAppearance.BorderSize = 0;
            this.chkTXEQ.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkTXEQ.Name = "chkTXEQ";
            this.toolTip1.SetToolTip(this.chkTXEQ, resources.GetString("chkTXEQ.ToolTip"));
            this.chkTXEQ.CheckedChanged += new System.EventHandler(this.chkTXEQ_CheckedChanged);
            // 
            // comboTXProfile
            // 
            this.comboTXProfile.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboTXProfile.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboTXProfile.DropDownWidth = 96;
            this.comboTXProfile.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboTXProfile, "comboTXProfile");
            this.comboTXProfile.Name = "comboTXProfile";
            this.toolTip1.SetToolTip(this.comboTXProfile, resources.GetString("comboTXProfile.ToolTip"));
            this.comboTXProfile.SelectedIndexChanged += new System.EventHandler(this.comboTXProfile_SelectedIndexChanged);
            // 
            // chkRXEQ
            // 
            resources.ApplyResources(this.chkRXEQ, "chkRXEQ");
            this.chkRXEQ.FlatAppearance.BorderSize = 0;
            this.chkRXEQ.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRXEQ.Name = "chkRXEQ";
            this.toolTip1.SetToolTip(this.chkRXEQ, resources.GetString("chkRXEQ.ToolTip"));
            this.chkRXEQ.CheckedChanged += new System.EventHandler(this.chkRXEQ_CheckedChanged);
            // 
            // chkCPDR
            // 
            resources.ApplyResources(this.chkCPDR, "chkCPDR");
            this.chkCPDR.FlatAppearance.BorderSize = 0;
            this.chkCPDR.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkCPDR.Name = "chkCPDR";
            this.toolTip1.SetToolTip(this.chkCPDR, resources.GetString("chkCPDR.ToolTip"));
            this.chkCPDR.CheckedChanged += new System.EventHandler(this.chkCPDR_CheckedChanged);
            // 
            // chkPhoneVAC
            // 
            resources.ApplyResources(this.chkPhoneVAC, "chkPhoneVAC");
            this.chkPhoneVAC.FlatAppearance.BorderSize = 0;
            this.chkPhoneVAC.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkPhoneVAC.Name = "chkPhoneVAC";
            this.toolTip1.SetToolTip(this.chkPhoneVAC, resources.GetString("chkPhoneVAC.ToolTip"));
            this.chkPhoneVAC.CheckedChanged += new System.EventHandler(this.chkPhoneVAC_CheckedChanged);
            // 
            // chkVOX
            // 
            resources.ApplyResources(this.chkVOX, "chkVOX");
            this.chkVOX.FlatAppearance.BorderSize = 0;
            this.chkVOX.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkVOX.Name = "chkVOX";
            this.toolTip1.SetToolTip(this.chkVOX, resources.GetString("chkVOX.ToolTip"));
            this.chkVOX.CheckedChanged += new System.EventHandler(this.chkVOX_CheckedChanged);
            // 
            // chkNoiseGate
            // 
            resources.ApplyResources(this.chkNoiseGate, "chkNoiseGate");
            this.chkNoiseGate.FlatAppearance.BorderSize = 0;
            this.chkNoiseGate.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkNoiseGate.Name = "chkNoiseGate";
            this.toolTip1.SetToolTip(this.chkNoiseGate, resources.GetString("chkNoiseGate.ToolTip"));
            this.chkNoiseGate.CheckedChanged += new System.EventHandler(this.chkNoiseGate_CheckedChanged);
            // 
            // comboDigTXProfile
            // 
            this.comboDigTXProfile.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboDigTXProfile.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboDigTXProfile.DropDownWidth = 96;
            this.comboDigTXProfile.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboDigTXProfile, "comboDigTXProfile");
            this.comboDigTXProfile.Name = "comboDigTXProfile";
            this.toolTip1.SetToolTip(this.comboDigTXProfile, resources.GetString("comboDigTXProfile.ToolTip"));
            this.comboDigTXProfile.SelectedIndexChanged += new System.EventHandler(this.comboDigTXProfile_SelectedIndexChanged);
            // 
            // chkVACEnabled
            // 
            resources.ApplyResources(this.chkVACEnabled, "chkVACEnabled");
            this.chkVACEnabled.FlatAppearance.BorderSize = 0;
            this.chkVACEnabled.Name = "chkVACEnabled";
            this.toolTip1.SetToolTip(this.chkVACEnabled, resources.GetString("chkVACEnabled.ToolTip"));
            this.chkVACEnabled.CheckedChanged += new System.EventHandler(this.chkVACEnabled_CheckedChanged);
            // 
            // chkVACStereo
            // 
            this.chkVACStereo.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.chkVACStereo, "chkVACStereo");
            this.chkVACStereo.Name = "chkVACStereo";
            this.toolTip1.SetToolTip(this.chkVACStereo, resources.GetString("chkVACStereo.ToolTip"));
            this.chkVACStereo.CheckedChanged += new System.EventHandler(this.chkVACStereo_CheckedChanged);
            // 
            // comboVACSampleRate
            // 
            this.comboVACSampleRate.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboVACSampleRate.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboVACSampleRate.DropDownWidth = 64;
            this.comboVACSampleRate.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboVACSampleRate, "comboVACSampleRate");
            this.comboVACSampleRate.Items.AddRange(new object[] {
            resources.GetString("comboVACSampleRate.Items"),
            resources.GetString("comboVACSampleRate.Items1"),
            resources.GetString("comboVACSampleRate.Items2"),
            resources.GetString("comboVACSampleRate.Items3"),
            resources.GetString("comboVACSampleRate.Items4"),
            resources.GetString("comboVACSampleRate.Items5"),
            resources.GetString("comboVACSampleRate.Items6"),
            resources.GetString("comboVACSampleRate.Items7"),
            resources.GetString("comboVACSampleRate.Items8"),
            resources.GetString("comboVACSampleRate.Items9")});
            this.comboVACSampleRate.Name = "comboVACSampleRate";
            this.toolTip1.SetToolTip(this.comboVACSampleRate, resources.GetString("comboVACSampleRate.ToolTip"));
            this.comboVACSampleRate.SelectedIndexChanged += new System.EventHandler(this.comboVACSampleRate_SelectedIndexChanged);
            // 
            // btnDisplayPanCenter
            // 
            this.btnDisplayPanCenter.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnDisplayPanCenter, "btnDisplayPanCenter");
            this.btnDisplayPanCenter.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnDisplayPanCenter.Name = "btnDisplayPanCenter";
            this.btnDisplayPanCenter.Tag = "";
            this.toolTip1.SetToolTip(this.btnDisplayPanCenter, resources.GetString("btnDisplayPanCenter.ToolTip"));
            this.btnDisplayPanCenter.UseVisualStyleBackColor = false;
            this.btnDisplayPanCenter.Click += new System.EventHandler(this.btnDisplayPanCenter_Click);
            // 
            // radModeAM
            // 
            resources.ApplyResources(this.radModeAM, "radModeAM");
            this.radModeAM.FlatAppearance.BorderSize = 0;
            this.radModeAM.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeAM.Name = "radModeAM";
            this.toolTip1.SetToolTip(this.radModeAM, resources.GetString("radModeAM.ToolTip"));
            this.radModeAM.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // radModeLSB
            // 
            resources.ApplyResources(this.radModeLSB, "radModeLSB");
            this.radModeLSB.FlatAppearance.BorderSize = 0;
            this.radModeLSB.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeLSB.Name = "radModeLSB";
            this.toolTip1.SetToolTip(this.radModeLSB, resources.GetString("radModeLSB.ToolTip"));
            this.radModeLSB.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // radModeSAM
            // 
            resources.ApplyResources(this.radModeSAM, "radModeSAM");
            this.radModeSAM.FlatAppearance.BorderSize = 0;
            this.radModeSAM.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeSAM.Name = "radModeSAM";
            this.toolTip1.SetToolTip(this.radModeSAM, resources.GetString("radModeSAM.ToolTip"));
            this.radModeSAM.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // radModeCWL
            // 
            resources.ApplyResources(this.radModeCWL, "radModeCWL");
            this.radModeCWL.FlatAppearance.BorderSize = 0;
            this.radModeCWL.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeCWL.Name = "radModeCWL";
            this.toolTip1.SetToolTip(this.radModeCWL, resources.GetString("radModeCWL.ToolTip"));
            this.radModeCWL.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // radModeDSB
            // 
            resources.ApplyResources(this.radModeDSB, "radModeDSB");
            this.radModeDSB.FlatAppearance.BorderSize = 0;
            this.radModeDSB.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeDSB.Name = "radModeDSB";
            this.toolTip1.SetToolTip(this.radModeDSB, resources.GetString("radModeDSB.ToolTip"));
            this.radModeDSB.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // radModeUSB
            // 
            resources.ApplyResources(this.radModeUSB, "radModeUSB");
            this.radModeUSB.BackColor = System.Drawing.SystemColors.Control;
            this.radModeUSB.FlatAppearance.BorderSize = 0;
            this.radModeUSB.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeUSB.Name = "radModeUSB";
            this.toolTip1.SetToolTip(this.radModeUSB, resources.GetString("radModeUSB.ToolTip"));
            this.radModeUSB.UseVisualStyleBackColor = false;
            this.radModeUSB.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // radModeCWU
            // 
            resources.ApplyResources(this.radModeCWU, "radModeCWU");
            this.radModeCWU.FlatAppearance.BorderSize = 0;
            this.radModeCWU.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeCWU.Name = "radModeCWU";
            this.toolTip1.SetToolTip(this.radModeCWU, resources.GetString("radModeCWU.ToolTip"));
            this.radModeCWU.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // radModeFMN
            // 
            resources.ApplyResources(this.radModeFMN, "radModeFMN");
            this.radModeFMN.FlatAppearance.BorderSize = 0;
            this.radModeFMN.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeFMN.Name = "radModeFMN";
            this.toolTip1.SetToolTip(this.radModeFMN, resources.GetString("radModeFMN.ToolTip"));
            this.radModeFMN.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // radModeDIGU
            // 
            resources.ApplyResources(this.radModeDIGU, "radModeDIGU");
            this.radModeDIGU.FlatAppearance.BorderSize = 0;
            this.radModeDIGU.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeDIGU.Name = "radModeDIGU";
            this.toolTip1.SetToolTip(this.radModeDIGU, resources.GetString("radModeDIGU.ToolTip"));
            this.radModeDIGU.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // radModeDRM
            // 
            resources.ApplyResources(this.radModeDRM, "radModeDRM");
            this.radModeDRM.FlatAppearance.BorderSize = 0;
            this.radModeDRM.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeDRM.Name = "radModeDRM";
            this.toolTip1.SetToolTip(this.radModeDRM, resources.GetString("radModeDRM.ToolTip"));
            this.radModeDRM.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // radModeDIGL
            // 
            resources.ApplyResources(this.radModeDIGL, "radModeDIGL");
            this.radModeDIGL.FlatAppearance.BorderSize = 0;
            this.radModeDIGL.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeDIGL.Name = "radModeDIGL";
            this.toolTip1.SetToolTip(this.radModeDIGL, resources.GetString("radModeDIGL.ToolTip"));
            this.radModeDIGL.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // radModeSPEC
            // 
            resources.ApplyResources(this.radModeSPEC, "radModeSPEC");
            this.radModeSPEC.FlatAppearance.BorderSize = 0;
            this.radModeSPEC.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radModeSPEC.Name = "radModeSPEC";
            this.toolTip1.SetToolTip(this.radModeSPEC, resources.GetString("radModeSPEC.ToolTip"));
            this.radModeSPEC.CheckedChanged += new System.EventHandler(this.radModeButton_CheckedChanged);
            // 
            // btnBandVHF
            // 
            this.btnBandVHF.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnBandVHF, "btnBandVHF");
            this.btnBandVHF.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnBandVHF.Name = "btnBandVHF";
            this.toolTip1.SetToolTip(this.btnBandVHF, resources.GetString("btnBandVHF.ToolTip"));
            this.btnBandVHF.Click += new System.EventHandler(this.btnBandVHF_Click);
            // 
            // comboRX2Band
            // 
            this.comboRX2Band.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboRX2Band.DisplayMember = "0";
            this.comboRX2Band.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboRX2Band.DropDownWidth = 56;
            this.comboRX2Band.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboRX2Band, "comboRX2Band");
            this.comboRX2Band.Items.AddRange(new object[] {
            resources.GetString("comboRX2Band.Items"),
            resources.GetString("comboRX2Band.Items1"),
            resources.GetString("comboRX2Band.Items2"),
            resources.GetString("comboRX2Band.Items3"),
            resources.GetString("comboRX2Band.Items4"),
            resources.GetString("comboRX2Band.Items5"),
            resources.GetString("comboRX2Band.Items6"),
            resources.GetString("comboRX2Band.Items7"),
            resources.GetString("comboRX2Band.Items8"),
            resources.GetString("comboRX2Band.Items9"),
            resources.GetString("comboRX2Band.Items10"),
            resources.GetString("comboRX2Band.Items11"),
            resources.GetString("comboRX2Band.Items12")});
            this.comboRX2Band.Name = "comboRX2Band";
            this.toolTip1.SetToolTip(this.comboRX2Band, resources.GetString("comboRX2Band.ToolTip"));
            this.comboRX2Band.SelectedIndexChanged += new System.EventHandler(this.comboRX2Band_SelectedIndexChanged);
            // 
            // chkVFOATX
            // 
            resources.ApplyResources(this.chkVFOATX, "chkVFOATX");
            this.chkVFOATX.BackColor = System.Drawing.Color.Transparent;
            this.chkVFOATX.Checked = true;
            this.chkVFOATX.CheckState = System.Windows.Forms.CheckState.Checked;
            this.chkVFOATX.FlatAppearance.BorderSize = 0;
            this.chkVFOATX.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkVFOATX.Name = "chkVFOATX";
            this.toolTip1.SetToolTip(this.chkVFOATX, resources.GetString("chkVFOATX.ToolTip"));
            this.chkVFOATX.UseVisualStyleBackColor = false;
            this.chkVFOATX.CheckedChanged += new System.EventHandler(this.chkVFOATX_CheckedChanged);
            // 
            // txtWheelTune
            // 
            this.txtWheelTune.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.txtWheelTune.BorderStyle = System.Windows.Forms.BorderStyle.FixedSingle;
            this.txtWheelTune.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtWheelTune, "txtWheelTune");
            this.txtWheelTune.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.txtWheelTune.Name = "txtWheelTune";
            this.txtWheelTune.ReadOnly = true;
            this.toolTip1.SetToolTip(this.txtWheelTune, resources.GetString("txtWheelTune.ToolTip"));
            this.txtWheelTune.GotFocus += new System.EventHandler(this.HideFocus);
            this.txtWheelTune.MouseDown += new System.Windows.Forms.MouseEventHandler(this.WheelTune_MouseDown);
            // 
            // chkVFOBTX
            // 
            resources.ApplyResources(this.chkVFOBTX, "chkVFOBTX");
            this.chkVFOBTX.FlatAppearance.BorderSize = 0;
            this.chkVFOBTX.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkVFOBTX.Name = "chkVFOBTX";
            this.toolTip1.SetToolTip(this.chkVFOBTX, resources.GetString("chkVFOBTX.ToolTip"));
            this.chkVFOBTX.CheckedChanged += new System.EventHandler(this.chkVFOBTX_CheckedChanged);
            // 
            // comboMeterTXMode
            // 
            this.comboMeterTXMode.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboMeterTXMode.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboMeterTXMode.DropDownWidth = 72;
            this.comboMeterTXMode.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboMeterTXMode, "comboMeterTXMode");
            this.comboMeterTXMode.Name = "comboMeterTXMode";
            this.toolTip1.SetToolTip(this.comboMeterTXMode, resources.GetString("comboMeterTXMode.ToolTip"));
            this.comboMeterTXMode.SelectedIndexChanged += new System.EventHandler(this.comboMeterTXMode_SelectedIndexChanged);
            // 
            // comboMeterRXMode
            // 
            this.comboMeterRXMode.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboMeterRXMode.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboMeterRXMode.DropDownWidth = 72;
            this.comboMeterRXMode.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboMeterRXMode, "comboMeterRXMode");
            this.comboMeterRXMode.Name = "comboMeterRXMode";
            this.toolTip1.SetToolTip(this.comboMeterRXMode, resources.GetString("comboMeterRXMode.ToolTip"));
            this.comboMeterRXMode.SelectedIndexChanged += new System.EventHandler(this.comboMeterRXMode_SelectedIndexChanged);
            // 
            // chkSquelch
            // 
            resources.ApplyResources(this.chkSquelch, "chkSquelch");
            this.chkSquelch.FlatAppearance.BorderSize = 0;
            this.chkSquelch.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkSquelch.Name = "chkSquelch";
            this.toolTip1.SetToolTip(this.chkSquelch, resources.GetString("chkSquelch.ToolTip"));
            this.chkSquelch.CheckedChanged += new System.EventHandler(this.chkSquelch_CheckedChanged);
            // 
            // btnMemoryQuickRestore
            // 
            this.btnMemoryQuickRestore.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnMemoryQuickRestore, "btnMemoryQuickRestore");
            this.btnMemoryQuickRestore.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnMemoryQuickRestore.Name = "btnMemoryQuickRestore";
            this.toolTip1.SetToolTip(this.btnMemoryQuickRestore, resources.GetString("btnMemoryQuickRestore.ToolTip"));
            this.btnMemoryQuickRestore.Click += new System.EventHandler(this.btnMemoryQuickRestore_Click);
            // 
            // btnMemoryQuickSave
            // 
            this.btnMemoryQuickSave.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnMemoryQuickSave, "btnMemoryQuickSave");
            this.btnMemoryQuickSave.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnMemoryQuickSave.Name = "btnMemoryQuickSave";
            this.toolTip1.SetToolTip(this.btnMemoryQuickSave, resources.GetString("btnMemoryQuickSave.ToolTip"));
            this.btnMemoryQuickSave.Click += new System.EventHandler(this.btnMemoryQuickSave_Click);
            // 
            // txtMemoryQuick
            // 
            this.txtMemoryQuick.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.txtMemoryQuick.BorderStyle = System.Windows.Forms.BorderStyle.FixedSingle;
            this.txtMemoryQuick.Cursor = System.Windows.Forms.Cursors.Default;
            this.txtMemoryQuick.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.txtMemoryQuick, "txtMemoryQuick");
            this.txtMemoryQuick.Name = "txtMemoryQuick";
            this.txtMemoryQuick.ReadOnly = true;
            this.toolTip1.SetToolTip(this.txtMemoryQuick, resources.GetString("txtMemoryQuick.ToolTip"));
            // 
            // chkVFOLock
            // 
            resources.ApplyResources(this.chkVFOLock, "chkVFOLock");
            this.chkVFOLock.FlatAppearance.BorderSize = 0;
            this.chkVFOLock.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkVFOLock.Name = "chkVFOLock";
            this.toolTip1.SetToolTip(this.chkVFOLock, resources.GetString("chkVFOLock.ToolTip"));
            this.chkVFOLock.CheckedChanged += new System.EventHandler(this.chkVFOLock_CheckedChanged);
            // 
            // chkVFOSync
            // 
            resources.ApplyResources(this.chkVFOSync, "chkVFOSync");
            this.chkVFOSync.FlatAppearance.BorderSize = 0;
            this.chkVFOSync.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkVFOSync.Name = "chkVFOSync";
            this.toolTip1.SetToolTip(this.chkVFOSync, resources.GetString("chkVFOSync.ToolTip"));
            this.chkVFOSync.CheckedChanged += new System.EventHandler(this.chkVFOSync_CheckedChanged);
            // 
            // chkFullDuplex
            // 
            resources.ApplyResources(this.chkFullDuplex, "chkFullDuplex");
            this.chkFullDuplex.FlatAppearance.BorderSize = 0;
            this.chkFullDuplex.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkFullDuplex.Name = "chkFullDuplex";
            this.toolTip1.SetToolTip(this.chkFullDuplex, resources.GetString("chkFullDuplex.ToolTip"));
            this.chkFullDuplex.CheckedChanged += new System.EventHandler(this.chkFullDuplex_CheckedChanged);
            // 
            // btnTuneStepChangeLarger
            // 
            this.btnTuneStepChangeLarger.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnTuneStepChangeLarger, "btnTuneStepChangeLarger");
            this.btnTuneStepChangeLarger.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnTuneStepChangeLarger.Name = "btnTuneStepChangeLarger";
            this.toolTip1.SetToolTip(this.btnTuneStepChangeLarger, resources.GetString("btnTuneStepChangeLarger.ToolTip"));
            this.btnTuneStepChangeLarger.Click += new System.EventHandler(this.btnChangeTuneStepLarger_Click);
            // 
            // btnTuneStepChangeSmaller
            // 
            this.btnTuneStepChangeSmaller.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnTuneStepChangeSmaller, "btnTuneStepChangeSmaller");
            this.btnTuneStepChangeSmaller.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnTuneStepChangeSmaller.Name = "btnTuneStepChangeSmaller";
            this.toolTip1.SetToolTip(this.btnTuneStepChangeSmaller, resources.GetString("btnTuneStepChangeSmaller.ToolTip"));
            this.btnTuneStepChangeSmaller.Click += new System.EventHandler(this.btnChangeTuneStepSmaller_Click);
            // 
            // chkSplitDisplay
            // 
            resources.ApplyResources(this.chkSplitDisplay, "chkSplitDisplay");
            this.chkSplitDisplay.Name = "chkSplitDisplay";
            this.toolTip1.SetToolTip(this.chkSplitDisplay, resources.GetString("chkSplitDisplay.ToolTip"));
            this.chkSplitDisplay.CheckedChanged += new System.EventHandler(this.chkSplitDisplay_CheckedChanged);
            // 
            // comboDisplayModeTop
            // 
            this.comboDisplayModeTop.BackColor = System.Drawing.SystemColors.Window;
            this.comboDisplayModeTop.DisplayMember = "0";
            this.comboDisplayModeTop.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboDisplayModeTop.DropDownWidth = 88;
            this.comboDisplayModeTop.ForeColor = System.Drawing.SystemColors.WindowText;
            resources.ApplyResources(this.comboDisplayModeTop, "comboDisplayModeTop");
            this.comboDisplayModeTop.Items.AddRange(new object[] {
            resources.GetString("comboDisplayModeTop.Items"),
            resources.GetString("comboDisplayModeTop.Items1"),
            resources.GetString("comboDisplayModeTop.Items2")});
            this.comboDisplayModeTop.Name = "comboDisplayModeTop";
            this.toolTip1.SetToolTip(this.comboDisplayModeTop, resources.GetString("comboDisplayModeTop.ToolTip"));
            this.comboDisplayModeTop.SelectedIndexChanged += new System.EventHandler(this.comboDisplayModeTop_SelectedIndexChanged);
            // 
            // comboDisplayModeBottom
            // 
            this.comboDisplayModeBottom.BackColor = System.Drawing.SystemColors.Window;
            this.comboDisplayModeBottom.DisplayMember = "0";
            this.comboDisplayModeBottom.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboDisplayModeBottom.DropDownWidth = 88;
            this.comboDisplayModeBottom.ForeColor = System.Drawing.SystemColors.WindowText;
            resources.ApplyResources(this.comboDisplayModeBottom, "comboDisplayModeBottom");
            this.comboDisplayModeBottom.Items.AddRange(new object[] {
            resources.GetString("comboDisplayModeBottom.Items"),
            resources.GetString("comboDisplayModeBottom.Items1"),
            resources.GetString("comboDisplayModeBottom.Items2")});
            this.comboDisplayModeBottom.Name = "comboDisplayModeBottom";
            this.toolTip1.SetToolTip(this.comboDisplayModeBottom, resources.GetString("comboDisplayModeBottom.ToolTip"));
            this.comboDisplayModeBottom.SelectedIndexChanged += new System.EventHandler(this.comboDisplayModeBottom_SelectedIndexChanged);
            // 
            // chkRX2SR
            // 
            resources.ApplyResources(this.chkRX2SR, "chkRX2SR");
            this.chkRX2SR.BackColor = System.Drawing.Color.Yellow;
            this.chkRX2SR.Checked = true;
            this.chkRX2SR.CheckState = System.Windows.Forms.CheckState.Checked;
            this.chkRX2SR.FlatAppearance.BorderSize = 0;
            this.chkRX2SR.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRX2SR.Name = "chkRX2SR";
            this.toolTip1.SetToolTip(this.chkRX2SR, resources.GetString("chkRX2SR.ToolTip"));
            this.chkRX2SR.UseVisualStyleBackColor = false;
            this.chkRX2SR.CheckedChanged += new System.EventHandler(this.chkRX2SR_CheckedChanged);
            // 
            // chkRX2NB2
            // 
            resources.ApplyResources(this.chkRX2NB2, "chkRX2NB2");
            this.chkRX2NB2.FlatAppearance.BorderSize = 0;
            this.chkRX2NB2.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRX2NB2.Name = "chkRX2NB2";
            this.toolTip1.SetToolTip(this.chkRX2NB2, resources.GetString("chkRX2NB2.ToolTip"));
            this.chkRX2NB2.CheckedChanged += new System.EventHandler(this.chkRX2NB2_CheckedChanged);
            // 
            // chkRX2NB
            // 
            resources.ApplyResources(this.chkRX2NB, "chkRX2NB");
            this.chkRX2NB.FlatAppearance.BorderSize = 0;
            this.chkRX2NB.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRX2NB.Name = "chkRX2NB";
            this.toolTip1.SetToolTip(this.chkRX2NB, resources.GetString("chkRX2NB.ToolTip"));
            this.chkRX2NB.CheckedChanged += new System.EventHandler(this.chkRX2NB_CheckedChanged);
            // 
            // chkRX2ANF
            // 
            resources.ApplyResources(this.chkRX2ANF, "chkRX2ANF");
            this.chkRX2ANF.FlatAppearance.BorderSize = 0;
            this.chkRX2ANF.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRX2ANF.Name = "chkRX2ANF";
            this.toolTip1.SetToolTip(this.chkRX2ANF, resources.GetString("chkRX2ANF.ToolTip"));
            this.chkRX2ANF.CheckedChanged += new System.EventHandler(this.chkRX2ANF_CheckedChanged);
            // 
            // chkRX2NR
            // 
            resources.ApplyResources(this.chkRX2NR, "chkRX2NR");
            this.chkRX2NR.FlatAppearance.BorderSize = 0;
            this.chkRX2NR.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRX2NR.Name = "chkRX2NR";
            this.toolTip1.SetToolTip(this.chkRX2NR, resources.GetString("chkRX2NR.ToolTip"));
            this.chkRX2NR.CheckedChanged += new System.EventHandler(this.chkRX2NR_CheckedChanged);
            // 
            // chkRX2BIN
            // 
            resources.ApplyResources(this.chkRX2BIN, "chkRX2BIN");
            this.chkRX2BIN.FlatAppearance.BorderSize = 0;
            this.chkRX2BIN.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRX2BIN.Name = "chkRX2BIN";
            this.toolTip1.SetToolTip(this.chkRX2BIN, resources.GetString("chkRX2BIN.ToolTip"));
            this.chkRX2BIN.CheckedChanged += new System.EventHandler(this.chkRX2BIN_CheckedChanged);
            // 
            // comboRX2AGC
            // 
            this.comboRX2AGC.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboRX2AGC.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboRX2AGC.DropDownWidth = 48;
            this.comboRX2AGC.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboRX2AGC, "comboRX2AGC");
            this.comboRX2AGC.Name = "comboRX2AGC";
            this.toolTip1.SetToolTip(this.comboRX2AGC, resources.GetString("comboRX2AGC.ToolTip"));
            this.comboRX2AGC.SelectedIndexChanged += new System.EventHandler(this.comboRX2AGC_SelectedIndexChanged);
            // 
            // lblRX2AGC
            // 
            this.lblRX2AGC.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.lblRX2AGC, "lblRX2AGC");
            this.lblRX2AGC.Name = "lblRX2AGC";
            this.toolTip1.SetToolTip(this.lblRX2AGC, resources.GetString("lblRX2AGC.ToolTip"));
            // 
            // comboRX2MeterMode
            // 
            this.comboRX2MeterMode.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboRX2MeterMode.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboRX2MeterMode.DropDownWidth = 72;
            this.comboRX2MeterMode.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboRX2MeterMode, "comboRX2MeterMode");
            this.comboRX2MeterMode.Name = "comboRX2MeterMode";
            this.toolTip1.SetToolTip(this.comboRX2MeterMode, resources.GetString("comboRX2MeterMode.ToolTip"));
            this.comboRX2MeterMode.SelectedIndexChanged += new System.EventHandler(this.comboRX2MeterMode_SelectedIndexChanged);
            // 
            // lblRX2RF
            // 
            this.lblRX2RF.BackColor = System.Drawing.Color.Transparent;
            this.lblRX2RF.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.lblRX2RF, "lblRX2RF");
            this.lblRX2RF.Name = "lblRX2RF";
            this.toolTip1.SetToolTip(this.lblRX2RF, resources.GetString("lblRX2RF.ToolTip"));
            // 
            // chkRX2Squelch
            // 
            resources.ApplyResources(this.chkRX2Squelch, "chkRX2Squelch");
            this.chkRX2Squelch.FlatAppearance.BorderSize = 0;
            this.chkRX2Squelch.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRX2Squelch.Name = "chkRX2Squelch";
            this.toolTip1.SetToolTip(this.chkRX2Squelch, resources.GetString("chkRX2Squelch.ToolTip"));
            this.chkRX2Squelch.CheckedChanged += new System.EventHandler(this.chkRX2Squelch_CheckedChanged);
            // 
            // chkRX2Preamp
            // 
            resources.ApplyResources(this.chkRX2Preamp, "chkRX2Preamp");
            this.chkRX2Preamp.FlatAppearance.BorderSize = 0;
            this.chkRX2Preamp.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRX2Preamp.Name = "chkRX2Preamp";
            this.toolTip1.SetToolTip(this.chkRX2Preamp, resources.GetString("chkRX2Preamp.ToolTip"));
            this.chkRX2Preamp.CheckedChanged += new System.EventHandler(this.chkRX2Preamp_CheckedChanged);
            // 
            // chkRX2DisplayAVG
            // 
            resources.ApplyResources(this.chkRX2DisplayAVG, "chkRX2DisplayAVG");
            this.chkRX2DisplayAVG.FlatAppearance.BorderSize = 0;
            this.chkRX2DisplayAVG.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkRX2DisplayAVG.Name = "chkRX2DisplayAVG";
            this.toolTip1.SetToolTip(this.chkRX2DisplayAVG, resources.GetString("chkRX2DisplayAVG.ToolTip"));
            this.chkRX2DisplayAVG.CheckedChanged += new System.EventHandler(this.chkRX2DisplayAVG_CheckedChanged);
            // 
            // radBand160
            // 
            resources.ApplyResources(this.radBand160, "radBand160");
            this.radBand160.FlatAppearance.BorderSize = 0;
            this.radBand160.ForeColor = System.Drawing.Color.White;
            this.radBand160.Name = "radBand160";
            this.radBand160.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand160, resources.GetString("radBand160.ToolTip"));
            this.radBand160.UseVisualStyleBackColor = true;
            this.radBand160.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBand160.Click += new System.EventHandler(this.radBand160_Click);
            // 
            // radBandGEN
            // 
            resources.ApplyResources(this.radBandGEN, "radBandGEN");
            this.radBandGEN.FlatAppearance.BorderSize = 0;
            this.radBandGEN.ForeColor = System.Drawing.Color.White;
            this.radBandGEN.Name = "radBandGEN";
            this.radBandGEN.TabStop = true;
            this.toolTip1.SetToolTip(this.radBandGEN, resources.GetString("radBandGEN.ToolTip"));
            this.radBandGEN.UseVisualStyleBackColor = true;
            this.radBandGEN.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBandGEN.Click += new System.EventHandler(this.radBandGEN_Click);
            // 
            // radBandWWV
            // 
            resources.ApplyResources(this.radBandWWV, "radBandWWV");
            this.radBandWWV.FlatAppearance.BorderSize = 0;
            this.radBandWWV.ForeColor = System.Drawing.Color.White;
            this.radBandWWV.Name = "radBandWWV";
            this.radBandWWV.TabStop = true;
            this.toolTip1.SetToolTip(this.radBandWWV, resources.GetString("radBandWWV.ToolTip"));
            this.radBandWWV.UseVisualStyleBackColor = true;
            this.radBandWWV.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBandWWV.Click += new System.EventHandler(this.radBandWWV_Click);
            // 
            // radBand2
            // 
            resources.ApplyResources(this.radBand2, "radBand2");
            this.radBand2.FlatAppearance.BorderSize = 0;
            this.radBand2.ForeColor = System.Drawing.Color.White;
            this.radBand2.Name = "radBand2";
            this.radBand2.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand2, resources.GetString("radBand2.ToolTip"));
            this.radBand2.UseVisualStyleBackColor = true;
            // 
            // radBand6
            // 
            resources.ApplyResources(this.radBand6, "radBand6");
            this.radBand6.FlatAppearance.BorderSize = 0;
            this.radBand6.ForeColor = System.Drawing.Color.White;
            this.radBand6.Name = "radBand6";
            this.radBand6.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand6, resources.GetString("radBand6.ToolTip"));
            this.radBand6.UseVisualStyleBackColor = true;
            this.radBand6.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBand6.Click += new System.EventHandler(this.radBand6_Click);
            // 
            // radBand10
            // 
            resources.ApplyResources(this.radBand10, "radBand10");
            this.radBand10.FlatAppearance.BorderSize = 0;
            this.radBand10.ForeColor = System.Drawing.Color.White;
            this.radBand10.Name = "radBand10";
            this.radBand10.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand10, resources.GetString("radBand10.ToolTip"));
            this.radBand10.UseVisualStyleBackColor = true;
            this.radBand10.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBand10.Click += new System.EventHandler(this.radBand10_Click);
            // 
            // radBand12
            // 
            resources.ApplyResources(this.radBand12, "radBand12");
            this.radBand12.FlatAppearance.BorderSize = 0;
            this.radBand12.ForeColor = System.Drawing.Color.White;
            this.radBand12.Name = "radBand12";
            this.radBand12.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand12, resources.GetString("radBand12.ToolTip"));
            this.radBand12.UseVisualStyleBackColor = true;
            this.radBand12.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBand12.Click += new System.EventHandler(this.radBand12_Click);
            // 
            // radBand15
            // 
            resources.ApplyResources(this.radBand15, "radBand15");
            this.radBand15.FlatAppearance.BorderSize = 0;
            this.radBand15.ForeColor = System.Drawing.Color.White;
            this.radBand15.Name = "radBand15";
            this.radBand15.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand15, resources.GetString("radBand15.ToolTip"));
            this.radBand15.UseVisualStyleBackColor = true;
            this.radBand15.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBand15.Click += new System.EventHandler(this.radBand15_Click);
            // 
            // radBand17
            // 
            resources.ApplyResources(this.radBand17, "radBand17");
            this.radBand17.FlatAppearance.BorderSize = 0;
            this.radBand17.ForeColor = System.Drawing.Color.White;
            this.radBand17.Name = "radBand17";
            this.radBand17.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand17, resources.GetString("radBand17.ToolTip"));
            this.radBand17.UseVisualStyleBackColor = true;
            this.radBand17.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBand17.Click += new System.EventHandler(this.radBand17_Click);
            // 
            // radBand20
            // 
            resources.ApplyResources(this.radBand20, "radBand20");
            this.radBand20.FlatAppearance.BorderSize = 0;
            this.radBand20.ForeColor = System.Drawing.Color.White;
            this.radBand20.Name = "radBand20";
            this.radBand20.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand20, resources.GetString("radBand20.ToolTip"));
            this.radBand20.UseVisualStyleBackColor = true;
            this.radBand20.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBand20.Click += new System.EventHandler(this.radBand20_Click);
            // 
            // radBand30
            // 
            resources.ApplyResources(this.radBand30, "radBand30");
            this.radBand30.FlatAppearance.BorderSize = 0;
            this.radBand30.ForeColor = System.Drawing.Color.White;
            this.radBand30.Name = "radBand30";
            this.radBand30.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand30, resources.GetString("radBand30.ToolTip"));
            this.radBand30.UseVisualStyleBackColor = true;
            this.radBand30.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBand30.Click += new System.EventHandler(this.radBand30_Click);
            // 
            // radBand40
            // 
            resources.ApplyResources(this.radBand40, "radBand40");
            this.radBand40.FlatAppearance.BorderSize = 0;
            this.radBand40.ForeColor = System.Drawing.Color.White;
            this.radBand40.Name = "radBand40";
            this.radBand40.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand40, resources.GetString("radBand40.ToolTip"));
            this.radBand40.UseVisualStyleBackColor = true;
            this.radBand40.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBand40.Click += new System.EventHandler(this.radBand40_Click);
            // 
            // radBand60
            // 
            resources.ApplyResources(this.radBand60, "radBand60");
            this.radBand60.FlatAppearance.BorderSize = 0;
            this.radBand60.ForeColor = System.Drawing.Color.White;
            this.radBand60.Name = "radBand60";
            this.radBand60.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand60, resources.GetString("radBand60.ToolTip"));
            this.radBand60.UseVisualStyleBackColor = true;
            this.radBand60.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBand60.Click += new System.EventHandler(this.radBand60_Click);
            // 
            // radBand80
            // 
            resources.ApplyResources(this.radBand80, "radBand80");
            this.radBand80.FlatAppearance.BorderSize = 0;
            this.radBand80.ForeColor = System.Drawing.Color.White;
            this.radBand80.Name = "radBand80";
            this.radBand80.TabStop = true;
            this.toolTip1.SetToolTip(this.radBand80, resources.GetString("radBand80.ToolTip"));
            this.radBand80.UseVisualStyleBackColor = true;
            this.radBand80.CheckedChanged += new System.EventHandler(this.radBand_CheckedChanged);
            this.radBand80.Click += new System.EventHandler(this.radBand80_Click);
            // 
            // ptbDisplayZoom
            // 
            resources.ApplyResources(this.ptbDisplayZoom, "ptbDisplayZoom");
            this.ptbDisplayZoom.HeadImage = null;
            this.ptbDisplayZoom.LargeChange = 1;
            this.ptbDisplayZoom.Maximum = 240;
            this.ptbDisplayZoom.Minimum = 10;
            this.ptbDisplayZoom.Name = "ptbDisplayZoom";
            this.ptbDisplayZoom.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbDisplayZoom.SmallChange = 1;
            this.ptbDisplayZoom.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbDisplayZoom, resources.GetString("ptbDisplayZoom.ToolTip"));
            this.ptbDisplayZoom.Value = 150;
            this.ptbDisplayZoom.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbDisplayZoom_Scroll);
            // 
            // ptbDisplayPan
            // 
            resources.ApplyResources(this.ptbDisplayPan, "ptbDisplayPan");
            this.ptbDisplayPan.HeadImage = null;
            this.ptbDisplayPan.LargeChange = 1;
            this.ptbDisplayPan.Maximum = 1000;
            this.ptbDisplayPan.Minimum = 0;
            this.ptbDisplayPan.Name = "ptbDisplayPan";
            this.ptbDisplayPan.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbDisplayPan.SmallChange = 1;
            this.ptbDisplayPan.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbDisplayPan, resources.GetString("ptbDisplayPan.ToolTip"));
            this.ptbDisplayPan.Value = 500;
            this.ptbDisplayPan.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbDisplayPan_Scroll);
            // 
            // ptbPWR
            // 
            resources.ApplyResources(this.ptbPWR, "ptbPWR");
            this.ptbPWR.HeadImage = null;
            this.ptbPWR.LargeChange = 1;
            this.ptbPWR.Maximum = 100;
            this.ptbPWR.Minimum = 0;
            this.ptbPWR.Name = "ptbPWR";
            this.ptbPWR.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbPWR.SmallChange = 1;
            this.ptbPWR.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbPWR, resources.GetString("ptbPWR.ToolTip"));
            this.ptbPWR.Value = 50;
            this.ptbPWR.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbPWR_Scroll);
            // 
            // ptbRF
            // 
            resources.ApplyResources(this.ptbRF, "ptbRF");
            this.ptbRF.HeadImage = null;
            this.ptbRF.LargeChange = 1;
            this.ptbRF.Maximum = 120;
            this.ptbRF.Minimum = -20;
            this.ptbRF.Name = "ptbRF";
            this.ptbRF.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbRF.SmallChange = 1;
            this.ptbRF.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbRF, resources.GetString("ptbRF.ToolTip"));
            this.ptbRF.Value = 90;
            this.ptbRF.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbRF_Scroll);
            // 
            // ptbAF
            // 
            resources.ApplyResources(this.ptbAF, "ptbAF");
            this.ptbAF.HeadImage = null;
            this.ptbAF.LargeChange = 1;
            this.ptbAF.Maximum = 100;
            this.ptbAF.Minimum = 0;
            this.ptbAF.Name = "ptbAF";
            this.ptbAF.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbAF.SmallChange = 1;
            this.ptbAF.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbAF, resources.GetString("ptbAF.ToolTip"));
            this.ptbAF.Value = 50;
            this.ptbAF.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbAF_Scroll);
            // 
            // ptbPanMainRX
            // 
            resources.ApplyResources(this.ptbPanMainRX, "ptbPanMainRX");
            this.ptbPanMainRX.HeadImage = null;
            this.ptbPanMainRX.LargeChange = 1;
            this.ptbPanMainRX.Maximum = 100;
            this.ptbPanMainRX.Minimum = 0;
            this.ptbPanMainRX.Name = "ptbPanMainRX";
            this.ptbPanMainRX.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbPanMainRX.SmallChange = 1;
            this.ptbPanMainRX.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbPanMainRX, resources.GetString("ptbPanMainRX.ToolTip"));
            this.ptbPanMainRX.Value = 50;
            this.ptbPanMainRX.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbPanMainRX_Scroll);
            // 
            // ptbPanSubRX
            // 
            resources.ApplyResources(this.ptbPanSubRX, "ptbPanSubRX");
            this.ptbPanSubRX.HeadImage = null;
            this.ptbPanSubRX.LargeChange = 1;
            this.ptbPanSubRX.Maximum = 100;
            this.ptbPanSubRX.Minimum = 0;
            this.ptbPanSubRX.Name = "ptbPanSubRX";
            this.ptbPanSubRX.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbPanSubRX.SmallChange = 1;
            this.ptbPanSubRX.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbPanSubRX, resources.GetString("ptbPanSubRX.ToolTip"));
            this.ptbPanSubRX.Value = 50;
            this.ptbPanSubRX.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbPanSubRX_Scroll);
            // 
            // ptbRX2Gain
            // 
            resources.ApplyResources(this.ptbRX2Gain, "ptbRX2Gain");
            this.ptbRX2Gain.HeadImage = null;
            this.ptbRX2Gain.LargeChange = 1;
            this.ptbRX2Gain.Maximum = 100;
            this.ptbRX2Gain.Minimum = 0;
            this.ptbRX2Gain.Name = "ptbRX2Gain";
            this.ptbRX2Gain.Orientation = System.Windows.Forms.Orientation.Vertical;
            this.ptbRX2Gain.SmallChange = 1;
            this.ptbRX2Gain.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbRX2Gain, resources.GetString("ptbRX2Gain.ToolTip"));
            this.ptbRX2Gain.Value = 0;
            this.ptbRX2Gain.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbRX2Gain_Scroll);
            // 
            // ptbRX2Pan
            // 
            resources.ApplyResources(this.ptbRX2Pan, "ptbRX2Pan");
            this.ptbRX2Pan.HeadImage = null;
            this.ptbRX2Pan.LargeChange = 1;
            this.ptbRX2Pan.Maximum = 100;
            this.ptbRX2Pan.Minimum = 0;
            this.ptbRX2Pan.Name = "ptbRX2Pan";
            this.ptbRX2Pan.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbRX2Pan.SmallChange = 1;
            this.ptbRX2Pan.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbRX2Pan, resources.GetString("ptbRX2Pan.ToolTip"));
            this.ptbRX2Pan.Value = 0;
            this.ptbRX2Pan.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbRX2Pan_Scroll);
            // 
            // ptbRX0Gain
            // 
            resources.ApplyResources(this.ptbRX0Gain, "ptbRX0Gain");
            this.ptbRX0Gain.HeadImage = null;
            this.ptbRX0Gain.LargeChange = 1;
            this.ptbRX0Gain.Maximum = 100;
            this.ptbRX0Gain.Minimum = 0;
            this.ptbRX0Gain.Name = "ptbRX0Gain";
            this.ptbRX0Gain.Orientation = System.Windows.Forms.Orientation.Vertical;
            this.ptbRX0Gain.SmallChange = 1;
            this.ptbRX0Gain.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbRX0Gain, resources.GetString("ptbRX0Gain.ToolTip"));
            this.ptbRX0Gain.Value = 100;
            this.ptbRX0Gain.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbRX0Gain_Scroll);
            // 
            // ptbRX1Gain
            // 
            resources.ApplyResources(this.ptbRX1Gain, "ptbRX1Gain");
            this.ptbRX1Gain.HeadImage = null;
            this.ptbRX1Gain.LargeChange = 1;
            this.ptbRX1Gain.Maximum = 100;
            this.ptbRX1Gain.Minimum = 0;
            this.ptbRX1Gain.Name = "ptbRX1Gain";
            this.ptbRX1Gain.Orientation = System.Windows.Forms.Orientation.Vertical;
            this.ptbRX1Gain.SmallChange = 1;
            this.ptbRX1Gain.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbRX1Gain, resources.GetString("ptbRX1Gain.ToolTip"));
            this.ptbRX1Gain.Value = 100;
            this.ptbRX1Gain.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbRX1Gain_Scroll);
            // 
            // ptbVACRXGain
            // 
            resources.ApplyResources(this.ptbVACRXGain, "ptbVACRXGain");
            this.ptbVACRXGain.HeadImage = null;
            this.ptbVACRXGain.LargeChange = 1;
            this.ptbVACRXGain.Maximum = 40;
            this.ptbVACRXGain.Minimum = -40;
            this.ptbVACRXGain.Name = "ptbVACRXGain";
            this.ptbVACRXGain.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbVACRXGain.SmallChange = 1;
            this.ptbVACRXGain.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbVACRXGain, resources.GetString("ptbVACRXGain.ToolTip"));
            this.ptbVACRXGain.Value = 0;
            this.ptbVACRXGain.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbVACRXGain_Scroll);
            // 
            // ptbVACTXGain
            // 
            resources.ApplyResources(this.ptbVACTXGain, "ptbVACTXGain");
            this.ptbVACTXGain.HeadImage = null;
            this.ptbVACTXGain.LargeChange = 1;
            this.ptbVACTXGain.Maximum = 40;
            this.ptbVACTXGain.Minimum = -40;
            this.ptbVACTXGain.Name = "ptbVACTXGain";
            this.ptbVACTXGain.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbVACTXGain.SmallChange = 1;
            this.ptbVACTXGain.TabStop = false;
            this.toolTip1.SetToolTip(this.ptbVACTXGain, resources.GetString("ptbVACTXGain.ToolTip"));
            this.ptbVACTXGain.Value = 0;
            this.ptbVACTXGain.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbVACTXGain_Scroll);
            // 
            // radDisplayZoom05
            // 
            resources.ApplyResources(this.radDisplayZoom05, "radDisplayZoom05");
            this.radDisplayZoom05.FlatAppearance.BorderSize = 0;
            this.radDisplayZoom05.ForeColor = System.Drawing.Color.White;
            this.radDisplayZoom05.Name = "radDisplayZoom05";
            this.radDisplayZoom05.TabStop = true;
            this.toolTip1.SetToolTip(this.radDisplayZoom05, resources.GetString("radDisplayZoom05.ToolTip"));
            this.radDisplayZoom05.UseVisualStyleBackColor = true;
            this.radDisplayZoom05.CheckedChanged += new System.EventHandler(this.radDisplayZoom05_CheckedChanged);
            // 
            // radDisplayZoom4x
            // 
            resources.ApplyResources(this.radDisplayZoom4x, "radDisplayZoom4x");
            this.radDisplayZoom4x.FlatAppearance.BorderSize = 0;
            this.radDisplayZoom4x.ForeColor = System.Drawing.Color.White;
            this.radDisplayZoom4x.Name = "radDisplayZoom4x";
            this.radDisplayZoom4x.TabStop = true;
            this.toolTip1.SetToolTip(this.radDisplayZoom4x, resources.GetString("radDisplayZoom4x.ToolTip"));
            this.radDisplayZoom4x.UseVisualStyleBackColor = true;
            this.radDisplayZoom4x.CheckedChanged += new System.EventHandler(this.radDisplayZoom4x_CheckedChanged);
            // 
            // radDisplayZoom2x
            // 
            resources.ApplyResources(this.radDisplayZoom2x, "radDisplayZoom2x");
            this.radDisplayZoom2x.FlatAppearance.BorderSize = 0;
            this.radDisplayZoom2x.ForeColor = System.Drawing.Color.White;
            this.radDisplayZoom2x.Name = "radDisplayZoom2x";
            this.radDisplayZoom2x.TabStop = true;
            this.toolTip1.SetToolTip(this.radDisplayZoom2x, resources.GetString("radDisplayZoom2x.ToolTip"));
            this.radDisplayZoom2x.UseVisualStyleBackColor = true;
            this.radDisplayZoom2x.CheckedChanged += new System.EventHandler(this.radDisplayZoom2x_CheckedChanged);
            // 
            // radDisplayZoom1x
            // 
            resources.ApplyResources(this.radDisplayZoom1x, "radDisplayZoom1x");
            this.radDisplayZoom1x.FlatAppearance.BorderSize = 0;
            this.radDisplayZoom1x.ForeColor = System.Drawing.Color.White;
            this.radDisplayZoom1x.Name = "radDisplayZoom1x";
            this.radDisplayZoom1x.TabStop = true;
            this.toolTip1.SetToolTip(this.radDisplayZoom1x, resources.GetString("radDisplayZoom1x.ToolTip"));
            this.radDisplayZoom1x.UseVisualStyleBackColor = true;
            this.radDisplayZoom1x.CheckedChanged += new System.EventHandler(this.radDisplayZoom1x_CheckedChanged);
            // 
            // chkMicMute
            // 
            resources.ApplyResources(this.chkMicMute, "chkMicMute");
            this.chkMicMute.FlatAppearance.BorderSize = 0;
            this.chkMicMute.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkMicMute.Name = "chkMicMute";
            this.toolTip1.SetToolTip(this.chkMicMute, resources.GetString("chkMicMute.ToolTip"));
            this.chkMicMute.CheckedChanged += new System.EventHandler(this.chkMicMute_CheckedChanged);
            // 
            // chkBCI
            // 
            resources.ApplyResources(this.chkBCI, "chkBCI");
            this.chkBCI.BackColor = System.Drawing.Color.Transparent;
            this.chkBCI.FlatAppearance.BorderSize = 0;
            this.chkBCI.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkBCI.Name = "chkBCI";
            this.toolTip1.SetToolTip(this.chkBCI, resources.GetString("chkBCI.ToolTip"));
            this.chkBCI.UseVisualStyleBackColor = false;
            // 
            // chkMUT
            // 
            resources.ApplyResources(this.chkMUT, "chkMUT");
            this.chkMUT.FlatAppearance.BorderSize = 0;
            this.chkMUT.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkMUT.Name = "chkMUT";
            this.toolTip1.SetToolTip(this.chkMUT, resources.GetString("chkMUT.ToolTip"));
            this.chkMUT.CheckedChanged += new System.EventHandler(this.chkMUT_CheckedChanged);
            // 
            // chkCWDisableTXDisplay
            // 
            resources.ApplyResources(this.chkCWDisableTXDisplay, "chkCWDisableTXDisplay");
            this.chkCWDisableTXDisplay.ForeColor = System.Drawing.Color.White;
            this.chkCWDisableTXDisplay.Name = "chkCWDisableTXDisplay";
            this.toolTip1.SetToolTip(this.chkCWDisableTXDisplay, resources.GetString("chkCWDisableTXDisplay.ToolTip"));
            this.chkCWDisableTXDisplay.CheckedChanged += new System.EventHandler(this.chkCWDisableTXDisplay_CheckedChanged);
            // 
            // chkShowCWZero
            // 
            resources.ApplyResources(this.chkShowCWZero, "chkShowCWZero");
            this.chkShowCWZero.ForeColor = System.Drawing.Color.White;
            this.chkShowCWZero.Name = "chkShowCWZero";
            this.toolTip1.SetToolTip(this.chkShowCWZero, resources.GetString("chkShowCWZero.ToolTip"));
            this.chkShowCWZero.CheckedChanged += new System.EventHandler(this.chkShowCWZero_CheckedChanged);
            // 
            // radFMDeviation5kHz
            // 
            resources.ApplyResources(this.radFMDeviation5kHz, "radFMDeviation5kHz");
            this.radFMDeviation5kHz.Checked = true;
            this.radFMDeviation5kHz.FlatAppearance.BorderSize = 0;
            this.radFMDeviation5kHz.ForeColor = System.Drawing.Color.White;
            this.radFMDeviation5kHz.Name = "radFMDeviation5kHz";
            this.radFMDeviation5kHz.TabStop = true;
            this.toolTip1.SetToolTip(this.radFMDeviation5kHz, resources.GetString("radFMDeviation5kHz.ToolTip"));
            this.radFMDeviation5kHz.UseVisualStyleBackColor = true;
            this.radFMDeviation5kHz.CheckedChanged += new System.EventHandler(this.radFMDeviation5kHz_CheckedChanged);
            // 
            // comboFMTXProfile
            // 
            this.comboFMTXProfile.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboFMTXProfile.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboFMTXProfile.DropDownWidth = 96;
            this.comboFMTXProfile.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboFMTXProfile, "comboFMTXProfile");
            this.comboFMTXProfile.Name = "comboFMTXProfile";
            this.toolTip1.SetToolTip(this.comboFMTXProfile, resources.GetString("comboFMTXProfile.ToolTip"));
            this.comboFMTXProfile.SelectedIndexChanged += new System.EventHandler(this.comboFMTXProfile_SelectedIndexChanged);
            // 
            // udFMOffset
            // 
            this.udFMOffset.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.udFMOffset.DecimalPlaces = 3;
            this.udFMOffset.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.udFMOffset.Increment = new decimal(new int[] {
            1,
            0,
            0,
            65536});
            resources.ApplyResources(this.udFMOffset, "udFMOffset");
            this.udFMOffset.Maximum = new decimal(new int[] {
            50,
            0,
            0,
            0});
            this.udFMOffset.Minimum = new decimal(new int[] {
            0,
            0,
            0,
            0});
            this.udFMOffset.Name = "udFMOffset";
            this.toolTip1.SetToolTip(this.udFMOffset, resources.GetString("udFMOffset.ToolTip"));
            this.udFMOffset.Value = new decimal(new int[] {
            1,
            0,
            0,
            65536});
            this.udFMOffset.ValueChanged += new System.EventHandler(this.udFMOffset_ValueChanged);
            // 
            // chkFMTXSimplex
            // 
            resources.ApplyResources(this.chkFMTXSimplex, "chkFMTXSimplex");
            this.chkFMTXSimplex.Checked = true;
            this.chkFMTXSimplex.CheckState = System.Windows.Forms.CheckState.Checked;
            this.chkFMTXSimplex.FlatAppearance.BorderSize = 0;
            this.chkFMTXSimplex.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkFMTXSimplex.Name = "chkFMTXSimplex";
            this.toolTip1.SetToolTip(this.chkFMTXSimplex, resources.GetString("chkFMTXSimplex.ToolTip"));
            this.chkFMTXSimplex.CheckedChanged += new System.EventHandler(this.chkFMTXSimplex_CheckedChanged);
            this.chkFMTXSimplex.Click += new System.EventHandler(this.chkFMMode_Click);
            // 
            // comboFMCTCSS
            // 
            this.comboFMCTCSS.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboFMCTCSS.DropDownWidth = 60;
            resources.ApplyResources(this.comboFMCTCSS, "comboFMCTCSS");
            this.comboFMCTCSS.Name = "comboFMCTCSS";
            this.toolTip1.SetToolTip(this.comboFMCTCSS, resources.GetString("comboFMCTCSS.ToolTip"));
            this.comboFMCTCSS.SelectedIndexChanged += new System.EventHandler(this.comboFMCTCSS_SelectedIndexChanged);
            // 
            // btnFMMemory
            // 
            this.btnFMMemory.BackColor = System.Drawing.Color.Transparent;
            this.btnFMMemory.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnFMMemory, "btnFMMemory");
            this.btnFMMemory.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnFMMemory.Name = "btnFMMemory";
            this.toolTip1.SetToolTip(this.btnFMMemory, resources.GetString("btnFMMemory.ToolTip"));
            this.btnFMMemory.UseVisualStyleBackColor = false;
            this.btnFMMemory.Click += new System.EventHandler(this.btnFMMemory_Click);
            // 
            // chkFMCTCSS
            // 
            resources.ApplyResources(this.chkFMCTCSS, "chkFMCTCSS");
            this.chkFMCTCSS.BackColor = System.Drawing.Color.Transparent;
            this.chkFMCTCSS.FlatAppearance.BorderSize = 0;
            this.chkFMCTCSS.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkFMCTCSS.Name = "chkFMCTCSS";
            this.toolTip1.SetToolTip(this.chkFMCTCSS, resources.GetString("chkFMCTCSS.ToolTip"));
            this.chkFMCTCSS.UseVisualStyleBackColor = false;
            this.chkFMCTCSS.CheckedChanged += new System.EventHandler(this.chkFMCTCSS_CheckedChanged);
            // 
            // chkFMVAC
            // 
            resources.ApplyResources(this.chkFMVAC, "chkFMVAC");
            this.chkFMVAC.BackColor = System.Drawing.Color.Transparent;
            this.chkFMVAC.FlatAppearance.BorderSize = 0;
            this.chkFMVAC.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkFMVAC.Name = "chkFMVAC";
            this.toolTip1.SetToolTip(this.chkFMVAC, resources.GetString("chkFMVAC.ToolTip"));
            this.chkFMVAC.UseVisualStyleBackColor = false;
            this.chkFMVAC.CheckedChanged += new System.EventHandler(this.chkFMVAC_CheckedChanged);
            // 
            // btnFMMemoryUp
            // 
            this.btnFMMemoryUp.BackColor = System.Drawing.Color.Transparent;
            this.btnFMMemoryUp.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnFMMemoryUp, "btnFMMemoryUp");
            this.btnFMMemoryUp.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnFMMemoryUp.Name = "btnFMMemoryUp";
            this.toolTip1.SetToolTip(this.btnFMMemoryUp, resources.GetString("btnFMMemoryUp.ToolTip"));
            this.btnFMMemoryUp.UseVisualStyleBackColor = false;
            this.btnFMMemoryUp.Click += new System.EventHandler(this.btnFMMemoryUp_Click);
            // 
            // btnFMMemoryDown
            // 
            this.btnFMMemoryDown.BackColor = System.Drawing.Color.Transparent;
            this.btnFMMemoryDown.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnFMMemoryDown, "btnFMMemoryDown");
            this.btnFMMemoryDown.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnFMMemoryDown.Name = "btnFMMemoryDown";
            this.toolTip1.SetToolTip(this.btnFMMemoryDown, resources.GetString("btnFMMemoryDown.ToolTip"));
            this.btnFMMemoryDown.UseVisualStyleBackColor = false;
            this.btnFMMemoryDown.Click += new System.EventHandler(this.btnFMMemoryDown_Click);
            // 
            // radFMDeviation2kHz
            // 
            resources.ApplyResources(this.radFMDeviation2kHz, "radFMDeviation2kHz");
            this.radFMDeviation2kHz.FlatAppearance.BorderSize = 0;
            this.radFMDeviation2kHz.ForeColor = System.Drawing.Color.White;
            this.radFMDeviation2kHz.Name = "radFMDeviation2kHz";
            this.toolTip1.SetToolTip(this.radFMDeviation2kHz, resources.GetString("radFMDeviation2kHz.ToolTip"));
            this.radFMDeviation2kHz.UseVisualStyleBackColor = true;
            this.radFMDeviation2kHz.CheckedChanged += new System.EventHandler(this.radFMDeviation2kHz_CheckedChanged);
            // 
            // chkFMTXLow
            // 
            resources.ApplyResources(this.chkFMTXLow, "chkFMTXLow");
            this.chkFMTXLow.BackColor = System.Drawing.Color.Transparent;
            this.chkFMTXLow.FlatAppearance.BorderSize = 0;
            this.chkFMTXLow.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkFMTXLow.Name = "chkFMTXLow";
            this.toolTip1.SetToolTip(this.chkFMTXLow, resources.GetString("chkFMTXLow.ToolTip"));
            this.chkFMTXLow.UseVisualStyleBackColor = false;
            this.chkFMTXLow.CheckedChanged += new System.EventHandler(this.chkFMTXLow_CheckedChanged);
            this.chkFMTXLow.Click += new System.EventHandler(this.chkFMMode_Click);
            // 
            // chkFMTXHigh
            // 
            resources.ApplyResources(this.chkFMTXHigh, "chkFMTXHigh");
            this.chkFMTXHigh.BackColor = System.Drawing.Color.Transparent;
            this.chkFMTXHigh.FlatAppearance.BorderSize = 0;
            this.chkFMTXHigh.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkFMTXHigh.Name = "chkFMTXHigh";
            this.toolTip1.SetToolTip(this.chkFMTXHigh, resources.GetString("chkFMTXHigh.ToolTip"));
            this.chkFMTXHigh.UseVisualStyleBackColor = false;
            this.chkFMTXHigh.CheckedChanged += new System.EventHandler(this.chkFMTXHigh_CheckedChanged);
            this.chkFMTXHigh.Click += new System.EventHandler(this.chkFMMode_Click);
            // 
            // chkFMTXRev
            // 
            resources.ApplyResources(this.chkFMTXRev, "chkFMTXRev");
            this.chkFMTXRev.BackColor = System.Drawing.Color.Transparent;
            this.chkFMTXRev.FlatAppearance.BorderSize = 0;
            this.chkFMTXRev.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkFMTXRev.Name = "chkFMTXRev";
            this.toolTip1.SetToolTip(this.chkFMTXRev, resources.GetString("chkFMTXRev.ToolTip"));
            this.chkFMTXRev.UseVisualStyleBackColor = false;
            this.chkFMTXRev.CheckedChanged += new System.EventHandler(this.chkFMTXRev_CheckedChanged);
            // 
            // chkTNF
            // 
            resources.ApplyResources(this.chkTNF, "chkTNF");
            this.chkTNF.Checked = true;
            this.chkTNF.CheckState = System.Windows.Forms.CheckState.Checked;
            this.chkTNF.FlatAppearance.BorderSize = 0;
            this.chkTNF.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.chkTNF.Name = "chkTNF";
            this.toolTip1.SetToolTip(this.chkTNF, resources.GetString("chkTNF.ToolTip"));
            this.chkTNF.CheckedChanged += new System.EventHandler(this.chkTNF_CheckedChanged);
            // 
            // btnTNFAdd
            // 
            this.btnTNFAdd.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnTNFAdd, "btnTNFAdd");
            this.btnTNFAdd.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.btnTNFAdd.Name = "btnTNFAdd";
            this.toolTip1.SetToolTip(this.btnTNFAdd, resources.GetString("btnTNFAdd.ToolTip"));
            this.btnTNFAdd.Click += new System.EventHandler(this.btnTNFAdd_Click);
            // 
            // chkCWVACIQ
            // 
            resources.ApplyResources(this.chkCWVACIQ, "chkCWVACIQ");
            this.chkCWVACIQ.ForeColor = System.Drawing.Color.White;
            this.chkCWVACIQ.Name = "chkCWVACIQ";
            this.toolTip1.SetToolTip(this.chkCWVACIQ, resources.GetString("chkCWVACIQ.ToolTip"));
            this.chkCWVACIQ.CheckedChanged += new System.EventHandler(this.chkCWVACIQ_CheckedChanged);
            // 
            // chkVACIQEnabled
            // 
            this.chkVACIQEnabled.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.chkVACIQEnabled, "chkVACIQEnabled");
            this.chkVACIQEnabled.Name = "chkVACIQEnabled";
            this.toolTip1.SetToolTip(this.chkVACIQEnabled, resources.GetString("chkVACIQEnabled.ToolTip"));
            this.chkVACIQEnabled.CheckedChanged += new System.EventHandler(this.chkVACIQEnabled_CheckedChanged);
            // 
            // chkCWSidetone
            // 
            this.chkCWSidetone.Checked = true;
            this.chkCWSidetone.CheckState = System.Windows.Forms.CheckState.Checked;
            this.chkCWSidetone.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.chkCWSidetone, "chkCWSidetone");
            this.chkCWSidetone.Name = "chkCWSidetone";
            this.toolTip1.SetToolTip(this.chkCWSidetone, resources.GetString("chkCWSidetone.ToolTip"));
            this.chkCWSidetone.CheckedChanged += new System.EventHandler(this.chkCWSidetone_CheckedChanged);
            // 
            // picSquelch
            // 
            this.picSquelch.BackColor = System.Drawing.SystemColors.ControlText;
            resources.ApplyResources(this.picSquelch, "picSquelch");
            this.picSquelch.Name = "picSquelch";
            this.picSquelch.TabStop = false;
            this.picSquelch.Paint += new System.Windows.Forms.PaintEventHandler(this.picSquelch_Paint);
            // 
            // picRX2Squelch
            // 
            this.picRX2Squelch.BackColor = System.Drawing.SystemColors.ControlText;
            resources.ApplyResources(this.picRX2Squelch, "picRX2Squelch");
            this.picRX2Squelch.Name = "picRX2Squelch";
            this.picRX2Squelch.TabStop = false;
            this.picRX2Squelch.Paint += new System.Windows.Forms.PaintEventHandler(this.picRX2Squelch_Paint);
            // 
            // timer_clock
            // 
            this.timer_clock.Enabled = true;
            this.timer_clock.Tick += new System.EventHandler(this.timer_clock_Tick);
            // 
            // contextMenuStripFilterRX1
            // 
            this.contextMenuStripFilterRX1.Items.AddRange(new System.Windows.Forms.ToolStripItem[] {
            this.toolStripMenuItemRX1FilterConfigure,
            this.toolStripMenuItemRX1FilterReset});
            this.contextMenuStripFilterRX1.Name = "contextMenuStripFilterRX1";
            resources.ApplyResources(this.contextMenuStripFilterRX1, "contextMenuStripFilterRX1");
            // 
            // toolStripMenuItemRX1FilterConfigure
            // 
            this.toolStripMenuItemRX1FilterConfigure.Name = "toolStripMenuItemRX1FilterConfigure";
            resources.ApplyResources(this.toolStripMenuItemRX1FilterConfigure, "toolStripMenuItemRX1FilterConfigure");
            this.toolStripMenuItemRX1FilterConfigure.Click += new System.EventHandler(this.toolStripMenuItemRX1FilterConfigure_Click);
            // 
            // toolStripMenuItemRX1FilterReset
            // 
            this.toolStripMenuItemRX1FilterReset.Name = "toolStripMenuItemRX1FilterReset";
            resources.ApplyResources(this.toolStripMenuItemRX1FilterReset, "toolStripMenuItemRX1FilterReset");
            this.toolStripMenuItemRX1FilterReset.Click += new System.EventHandler(this.toolStripMenuItemRX1FilterReset_Click);
            // 
            // contextMenuStripFilterRX2
            // 
            this.contextMenuStripFilterRX2.Items.AddRange(new System.Windows.Forms.ToolStripItem[] {
            this.toolStripMenuItemRX2FilterConfigure,
            this.toolStripMenuItemRX2FilterReset});
            this.contextMenuStripFilterRX2.Name = "contextMenuStripFilterRX2";
            resources.ApplyResources(this.contextMenuStripFilterRX2, "contextMenuStripFilterRX2");
            // 
            // toolStripMenuItemRX2FilterConfigure
            // 
            this.toolStripMenuItemRX2FilterConfigure.Name = "toolStripMenuItemRX2FilterConfigure";
            resources.ApplyResources(this.toolStripMenuItemRX2FilterConfigure, "toolStripMenuItemRX2FilterConfigure");
            this.toolStripMenuItemRX2FilterConfigure.Click += new System.EventHandler(this.toolStripMenuItemRX2FilterConfigure_Click);
            // 
            // toolStripMenuItemRX2FilterReset
            // 
            this.toolStripMenuItemRX2FilterReset.Name = "toolStripMenuItemRX2FilterReset";
            resources.ApplyResources(this.toolStripMenuItemRX2FilterReset, "toolStripMenuItemRX2FilterReset");
            this.toolStripMenuItemRX2FilterReset.Click += new System.EventHandler(this.toolStripMenuItemRX2FilterReset_Click);
            // 
            // timer_navigate
            // 
            this.timer_navigate.Tick += new System.EventHandler(this.timer_navigate_Tick);
            // 
            // contextMenuStripNotch
            // 
            this.contextMenuStripNotch.Items.AddRange(new System.Windows.Forms.ToolStripItem[] {
            this.toolStripNotchDelete,
            this.toolStripNotchRemember,
            this.toolStripSeparator1,
            this.toolStripNotchNormal,
            this.toolStripNotchDeep,
            this.toolStripNotchVeryDeep});
            this.contextMenuStripNotch.Name = "contextMenuStripNotch";
            resources.ApplyResources(this.contextMenuStripNotch, "contextMenuStripNotch");
            // 
            // toolStripNotchDelete
            // 
            this.toolStripNotchDelete.Name = "toolStripNotchDelete";
            resources.ApplyResources(this.toolStripNotchDelete, "toolStripNotchDelete");
            this.toolStripNotchDelete.Click += new System.EventHandler(this.toolStripNotchDelete_Click);
            // 
            // toolStripNotchRemember
            // 
            this.toolStripNotchRemember.Name = "toolStripNotchRemember";
            resources.ApplyResources(this.toolStripNotchRemember, "toolStripNotchRemember");
            this.toolStripNotchRemember.Click += new System.EventHandler(this.toolStripNotchRemember_Click);
            // 
            // toolStripSeparator1
            // 
            this.toolStripSeparator1.Name = "toolStripSeparator1";
            resources.ApplyResources(this.toolStripSeparator1, "toolStripSeparator1");
            // 
            // toolStripNotchNormal
            // 
            this.toolStripNotchNormal.Name = "toolStripNotchNormal";
            resources.ApplyResources(this.toolStripNotchNormal, "toolStripNotchNormal");
            this.toolStripNotchNormal.Click += new System.EventHandler(this.toolStripNotchNormal_Click);
            // 
            // toolStripNotchDeep
            // 
            this.toolStripNotchDeep.Name = "toolStripNotchDeep";
            resources.ApplyResources(this.toolStripNotchDeep, "toolStripNotchDeep");
            this.toolStripNotchDeep.Click += new System.EventHandler(this.toolStripNotchDeep_Click);
            // 
            // toolStripNotchVeryDeep
            // 
            this.toolStripNotchVeryDeep.Name = "toolStripNotchVeryDeep";
            resources.ApplyResources(this.toolStripNotchVeryDeep, "toolStripNotchVeryDeep");
            this.toolStripNotchVeryDeep.Click += new System.EventHandler(this.toolStripNotchVeryDeep_Click);
            // 
            // menuStrip1
            // 
            this.menuStrip1.BackColor = System.Drawing.Color.Transparent;
            this.menuStrip1.Items.AddRange(new System.Windows.Forms.ToolStripItem[] {
            this.setupToolStripMenuItem,
            this.memoryToolStripMenuItem,
            this.waveToolStripMenuItem,
            this.equalizerToolStripMenuItem,
            this.xVTRsToolStripMenuItem,
            this.cWXToolStripMenuItem,
            this.uCBToolStripMenuItem,
            this.mixerToolStripMenuItem,
            this.antennaToolStripMenuItem,
            this.relaysToolStripMenuItem,
            this.aTUToolStripMenuItem,
            this.eSCToolStripMenuItem,
            this.collapseToolStripMenuItem,
            this.filterToolStripMenuItem,
            this.dSPToolStripMenuItem,
            this.displayControlsToolStripMenuItem,
            this.bandToolStripMenuItem,
            this.modeToolStripMenuItem});
            resources.ApplyResources(this.menuStrip1, "menuStrip1");
            this.menuStrip1.Name = "menuStrip1";
            // 
            // setupToolStripMenuItem
            // 
            this.setupToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.setupToolStripMenuItem.Name = "setupToolStripMenuItem";
            resources.ApplyResources(this.setupToolStripMenuItem, "setupToolStripMenuItem");
            this.setupToolStripMenuItem.Click += new System.EventHandler(this.setupToolStripMenuItem_Click);
            // 
            // memoryToolStripMenuItem
            // 
            this.memoryToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.memoryToolStripMenuItem.Name = "memoryToolStripMenuItem";
            resources.ApplyResources(this.memoryToolStripMenuItem, "memoryToolStripMenuItem");
            this.memoryToolStripMenuItem.Click += new System.EventHandler(this.memoryToolStripMenuItem_Click);
            // 
            // waveToolStripMenuItem
            // 
            this.waveToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.waveToolStripMenuItem.Name = "waveToolStripMenuItem";
            resources.ApplyResources(this.waveToolStripMenuItem, "waveToolStripMenuItem");
            this.waveToolStripMenuItem.Click += new System.EventHandler(this.waveToolStripMenuItem_Click);
            // 
            // equalizerToolStripMenuItem
            // 
            this.equalizerToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.equalizerToolStripMenuItem.Name = "equalizerToolStripMenuItem";
            resources.ApplyResources(this.equalizerToolStripMenuItem, "equalizerToolStripMenuItem");
            this.equalizerToolStripMenuItem.Click += new System.EventHandler(this.equalizerToolStripMenuItem_Click);
            // 
            // xVTRsToolStripMenuItem
            // 
            this.xVTRsToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.xVTRsToolStripMenuItem.Name = "xVTRsToolStripMenuItem";
            resources.ApplyResources(this.xVTRsToolStripMenuItem, "xVTRsToolStripMenuItem");
            this.xVTRsToolStripMenuItem.Click += new System.EventHandler(this.xVTRsToolStripMenuItem_Click);
            // 
            // cWXToolStripMenuItem
            // 
            this.cWXToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.cWXToolStripMenuItem.Name = "cWXToolStripMenuItem";
            resources.ApplyResources(this.cWXToolStripMenuItem, "cWXToolStripMenuItem");
            this.cWXToolStripMenuItem.Click += new System.EventHandler(this.cWXToolStripMenuItem_Click);
            // 
            // uCBToolStripMenuItem
            // 
            this.uCBToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.uCBToolStripMenuItem.Name = "uCBToolStripMenuItem";
            resources.ApplyResources(this.uCBToolStripMenuItem, "uCBToolStripMenuItem");
            // 
            // mixerToolStripMenuItem
            // 
            this.mixerToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.mixerToolStripMenuItem.Name = "mixerToolStripMenuItem";
            resources.ApplyResources(this.mixerToolStripMenuItem, "mixerToolStripMenuItem");
            // 
            // antennaToolStripMenuItem
            // 
            this.antennaToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.antennaToolStripMenuItem.Name = "antennaToolStripMenuItem";
            resources.ApplyResources(this.antennaToolStripMenuItem, "antennaToolStripMenuItem");
            // 
            // relaysToolStripMenuItem
            // 
            this.relaysToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.relaysToolStripMenuItem.Name = "relaysToolStripMenuItem";
            resources.ApplyResources(this.relaysToolStripMenuItem, "relaysToolStripMenuItem");
            // 
            // aTUToolStripMenuItem
            // 
            this.aTUToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.aTUToolStripMenuItem.Name = "aTUToolStripMenuItem";
            resources.ApplyResources(this.aTUToolStripMenuItem, "aTUToolStripMenuItem");
            // 
            // eSCToolStripMenuItem
            // 
            resources.ApplyResources(this.eSCToolStripMenuItem, "eSCToolStripMenuItem");
            this.eSCToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.eSCToolStripMenuItem.Name = "eSCToolStripMenuItem";
            // 
            // collapseToolStripMenuItem
            // 
            this.collapseToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.collapseToolStripMenuItem.Name = "collapseToolStripMenuItem";
            resources.ApplyResources(this.collapseToolStripMenuItem, "collapseToolStripMenuItem");
            this.collapseToolStripMenuItem.Click += new System.EventHandler(this.CollapseToolStripMenuItem_Click);
            // 
            // filterToolStripMenuItem
            // 
            this.filterToolStripMenuItem.DropDownItems.AddRange(new System.Windows.Forms.ToolStripItem[] {
            this.FilterToolStripMenuItem1,
            this.FilterToolStripMenuItem2,
            this.FilterToolStripMenuItem3,
            this.FilterToolStripMenuItem4,
            this.FilterToolStripMenuItem5,
            this.FilterToolStripMenuItem6,
            this.FilterToolStripMenuItem7,
            this.FilterToolStripMenuItem8,
            this.FilterToolStripMenuItem9,
            this.FilterToolStripMenuItem10});
            this.filterToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.filterToolStripMenuItem.Name = "filterToolStripMenuItem";
            resources.ApplyResources(this.filterToolStripMenuItem, "filterToolStripMenuItem");
            // 
            // FilterToolStripMenuItem1
            // 
            this.FilterToolStripMenuItem1.Name = "FilterToolStripMenuItem1";
            resources.ApplyResources(this.FilterToolStripMenuItem1, "FilterToolStripMenuItem1");
            this.FilterToolStripMenuItem1.Click += new System.EventHandler(this.mnuFilter_Click);
            // 
            // FilterToolStripMenuItem2
            // 
            this.FilterToolStripMenuItem2.Name = "FilterToolStripMenuItem2";
            resources.ApplyResources(this.FilterToolStripMenuItem2, "FilterToolStripMenuItem2");
            this.FilterToolStripMenuItem2.Click += new System.EventHandler(this.mnuFilter_Click);
            // 
            // FilterToolStripMenuItem3
            // 
            this.FilterToolStripMenuItem3.Name = "FilterToolStripMenuItem3";
            resources.ApplyResources(this.FilterToolStripMenuItem3, "FilterToolStripMenuItem3");
            this.FilterToolStripMenuItem3.Click += new System.EventHandler(this.mnuFilter_Click);
            // 
            // FilterToolStripMenuItem4
            // 
            this.FilterToolStripMenuItem4.Name = "FilterToolStripMenuItem4";
            resources.ApplyResources(this.FilterToolStripMenuItem4, "FilterToolStripMenuItem4");
            this.FilterToolStripMenuItem4.Click += new System.EventHandler(this.mnuFilter_Click);
            // 
            // FilterToolStripMenuItem5
            // 
            this.FilterToolStripMenuItem5.Name = "FilterToolStripMenuItem5";
            resources.ApplyResources(this.FilterToolStripMenuItem5, "FilterToolStripMenuItem5");
            this.FilterToolStripMenuItem5.Click += new System.EventHandler(this.mnuFilter_Click);
            // 
            // FilterToolStripMenuItem6
            // 
            this.FilterToolStripMenuItem6.Name = "FilterToolStripMenuItem6";
            resources.ApplyResources(this.FilterToolStripMenuItem6, "FilterToolStripMenuItem6");
            this.FilterToolStripMenuItem6.Click += new System.EventHandler(this.mnuFilter_Click);
            // 
            // FilterToolStripMenuItem7
            // 
            this.FilterToolStripMenuItem7.Name = "FilterToolStripMenuItem7";
            resources.ApplyResources(this.FilterToolStripMenuItem7, "FilterToolStripMenuItem7");
            this.FilterToolStripMenuItem7.Click += new System.EventHandler(this.mnuFilter_Click);
            // 
            // FilterToolStripMenuItem8
            // 
            this.FilterToolStripMenuItem8.Name = "FilterToolStripMenuItem8";
            resources.ApplyResources(this.FilterToolStripMenuItem8, "FilterToolStripMenuItem8");
            this.FilterToolStripMenuItem8.Click += new System.EventHandler(this.mnuFilter_Click);
            // 
            // FilterToolStripMenuItem9
            // 
            this.FilterToolStripMenuItem9.Name = "FilterToolStripMenuItem9";
            resources.ApplyResources(this.FilterToolStripMenuItem9, "FilterToolStripMenuItem9");
            this.FilterToolStripMenuItem9.Click += new System.EventHandler(this.mnuFilter_Click);
            // 
            // FilterToolStripMenuItem10
            // 
            this.FilterToolStripMenuItem10.Name = "FilterToolStripMenuItem10";
            resources.ApplyResources(this.FilterToolStripMenuItem10, "FilterToolStripMenuItem10");
            this.FilterToolStripMenuItem10.Click += new System.EventHandler(this.mnuFilter_Click);
            // 
            // dSPToolStripMenuItem
            // 
            this.dSPToolStripMenuItem.DropDownItems.AddRange(new System.Windows.Forms.ToolStripItem[] {
            this.NRToolStripMenuItem,
            this.ANFToolStripMenuItem,
            this.NBToolStripMenuItem,
            this.NB2ToolStripMenuItem,
            this.BINToolStripMenuItem,
            this.MultiRXToolStripMenuItem});
            this.dSPToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.dSPToolStripMenuItem.Name = "dSPToolStripMenuItem";
            resources.ApplyResources(this.dSPToolStripMenuItem, "dSPToolStripMenuItem");
            // 
            // NRToolStripMenuItem
            // 
            this.NRToolStripMenuItem.Name = "NRToolStripMenuItem";
            resources.ApplyResources(this.NRToolStripMenuItem, "NRToolStripMenuItem");
            this.NRToolStripMenuItem.Click += new System.EventHandler(this.mnuDSP_Click);
            // 
            // ANFToolStripMenuItem
            // 
            this.ANFToolStripMenuItem.Name = "ANFToolStripMenuItem";
            resources.ApplyResources(this.ANFToolStripMenuItem, "ANFToolStripMenuItem");
            this.ANFToolStripMenuItem.Click += new System.EventHandler(this.mnuDSP_Click);
            // 
            // NBToolStripMenuItem
            // 
            this.NBToolStripMenuItem.Name = "NBToolStripMenuItem";
            resources.ApplyResources(this.NBToolStripMenuItem, "NBToolStripMenuItem");
            this.NBToolStripMenuItem.Click += new System.EventHandler(this.mnuDSP_Click);
            // 
            // NB2ToolStripMenuItem
            // 
            this.NB2ToolStripMenuItem.Name = "NB2ToolStripMenuItem";
            resources.ApplyResources(this.NB2ToolStripMenuItem, "NB2ToolStripMenuItem");
            this.NB2ToolStripMenuItem.Click += new System.EventHandler(this.mnuDSP_Click);
            // 
            // BINToolStripMenuItem
            // 
            this.BINToolStripMenuItem.Name = "BINToolStripMenuItem";
            resources.ApplyResources(this.BINToolStripMenuItem, "BINToolStripMenuItem");
            this.BINToolStripMenuItem.Click += new System.EventHandler(this.mnuDSP_Click);
            // 
            // MultiRXToolStripMenuItem
            // 
            this.MultiRXToolStripMenuItem.Name = "MultiRXToolStripMenuItem";
            resources.ApplyResources(this.MultiRXToolStripMenuItem, "MultiRXToolStripMenuItem");
            this.MultiRXToolStripMenuItem.Click += new System.EventHandler(this.mnuDSP_Click);
            // 
            // displayControlsToolStripMenuItem
            // 
            this.displayControlsToolStripMenuItem.DropDownItems.AddRange(new System.Windows.Forms.ToolStripItem[] {
            this.topControlsToolStripMenuItem,
            this.bandControlsToolStripMenuItem,
            this.modeControlsToolStripMenuItem});
            this.displayControlsToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.displayControlsToolStripMenuItem.Name = "displayControlsToolStripMenuItem";
            resources.ApplyResources(this.displayControlsToolStripMenuItem, "displayControlsToolStripMenuItem");
            // 
            // topControlsToolStripMenuItem
            // 
            this.topControlsToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlText;
            this.topControlsToolStripMenuItem.Name = "topControlsToolStripMenuItem";
            resources.ApplyResources(this.topControlsToolStripMenuItem, "topControlsToolStripMenuItem");
            this.topControlsToolStripMenuItem.Click += new System.EventHandler(this.mnuShowTopControls_Click);
            // 
            // bandControlsToolStripMenuItem
            // 
            this.bandControlsToolStripMenuItem.Name = "bandControlsToolStripMenuItem";
            resources.ApplyResources(this.bandControlsToolStripMenuItem, "bandControlsToolStripMenuItem");
            this.bandControlsToolStripMenuItem.Click += new System.EventHandler(this.mnuShowBandControls_Click);
            // 
            // modeControlsToolStripMenuItem
            // 
            this.modeControlsToolStripMenuItem.Name = "modeControlsToolStripMenuItem";
            resources.ApplyResources(this.modeControlsToolStripMenuItem, "modeControlsToolStripMenuItem");
            this.modeControlsToolStripMenuItem.Click += new System.EventHandler(this.mnuShowModeControls_Click);
            // 
            // bandToolStripMenuItem
            // 
            this.bandToolStripMenuItem.DropDownItems.AddRange(new System.Windows.Forms.ToolStripItem[] {
            this.bandtoolStripMenuItem1,
            this.bandtoolStripMenuItem2,
            this.bandtoolStripMenuItem3,
            this.bandtoolStripMenuItem4,
            this.bandtoolStripMenuItem5,
            this.bandtoolStripMenuItem14,
            this.bandtoolStripMenuItem7,
            this.bandtoolStripMenuItem8,
            this.bandtoolStripMenuItem9,
            this.bandtoolStripMenuItem10,
            this.bandtoolStripMenuItem11,
            this.bandtoolStripMenuItem12,
            this.bandtoolStripMenuItem13});
            this.bandToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.bandToolStripMenuItem.Name = "bandToolStripMenuItem";
            resources.ApplyResources(this.bandToolStripMenuItem, "bandToolStripMenuItem");
            // 
            // bandtoolStripMenuItem1
            // 
            this.bandtoolStripMenuItem1.Name = "bandtoolStripMenuItem1";
            resources.ApplyResources(this.bandtoolStripMenuItem1, "bandtoolStripMenuItem1");
            this.bandtoolStripMenuItem1.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem2
            // 
            this.bandtoolStripMenuItem2.Name = "bandtoolStripMenuItem2";
            resources.ApplyResources(this.bandtoolStripMenuItem2, "bandtoolStripMenuItem2");
            this.bandtoolStripMenuItem2.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem3
            // 
            this.bandtoolStripMenuItem3.Name = "bandtoolStripMenuItem3";
            resources.ApplyResources(this.bandtoolStripMenuItem3, "bandtoolStripMenuItem3");
            this.bandtoolStripMenuItem3.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem4
            // 
            this.bandtoolStripMenuItem4.Name = "bandtoolStripMenuItem4";
            resources.ApplyResources(this.bandtoolStripMenuItem4, "bandtoolStripMenuItem4");
            this.bandtoolStripMenuItem4.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem5
            // 
            this.bandtoolStripMenuItem5.Name = "bandtoolStripMenuItem5";
            resources.ApplyResources(this.bandtoolStripMenuItem5, "bandtoolStripMenuItem5");
            this.bandtoolStripMenuItem5.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem14
            // 
            this.bandtoolStripMenuItem14.Name = "bandtoolStripMenuItem14";
            resources.ApplyResources(this.bandtoolStripMenuItem14, "bandtoolStripMenuItem14");
            this.bandtoolStripMenuItem14.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem7
            // 
            this.bandtoolStripMenuItem7.Name = "bandtoolStripMenuItem7";
            resources.ApplyResources(this.bandtoolStripMenuItem7, "bandtoolStripMenuItem7");
            this.bandtoolStripMenuItem7.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem8
            // 
            this.bandtoolStripMenuItem8.Name = "bandtoolStripMenuItem8";
            resources.ApplyResources(this.bandtoolStripMenuItem8, "bandtoolStripMenuItem8");
            this.bandtoolStripMenuItem8.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem9
            // 
            this.bandtoolStripMenuItem9.Name = "bandtoolStripMenuItem9";
            resources.ApplyResources(this.bandtoolStripMenuItem9, "bandtoolStripMenuItem9");
            this.bandtoolStripMenuItem9.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem10
            // 
            this.bandtoolStripMenuItem10.Name = "bandtoolStripMenuItem10";
            resources.ApplyResources(this.bandtoolStripMenuItem10, "bandtoolStripMenuItem10");
            this.bandtoolStripMenuItem10.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem11
            // 
            this.bandtoolStripMenuItem11.Name = "bandtoolStripMenuItem11";
            resources.ApplyResources(this.bandtoolStripMenuItem11, "bandtoolStripMenuItem11");
            this.bandtoolStripMenuItem11.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem12
            // 
            this.bandtoolStripMenuItem12.Name = "bandtoolStripMenuItem12";
            resources.ApplyResources(this.bandtoolStripMenuItem12, "bandtoolStripMenuItem12");
            this.bandtoolStripMenuItem12.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // bandtoolStripMenuItem13
            // 
            this.bandtoolStripMenuItem13.Name = "bandtoolStripMenuItem13";
            resources.ApplyResources(this.bandtoolStripMenuItem13, "bandtoolStripMenuItem13");
            this.bandtoolStripMenuItem13.Click += new System.EventHandler(this.mnuBand_Click);
            // 
            // modeToolStripMenuItem
            // 
            this.modeToolStripMenuItem.DropDownItems.AddRange(new System.Windows.Forms.ToolStripItem[] {
            this.lSBToolStripMenuItem,
            this.uSBToolStripMenuItem,
            this.dSBToolStripMenuItem,
            this.cWLToolStripMenuItem,
            this.cWUToolStripMenuItem,
            this.fMToolStripMenuItem,
            this.aMToolStripMenuItem,
            this.sAMToolStripMenuItem,
            this.sPECToolStripMenuItem,
            this.dIGLToolStripMenuItem,
            this.dIGUToolStripMenuItem,
            this.dRMToolStripMenuItem});
            this.modeToolStripMenuItem.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.modeToolStripMenuItem.Name = "modeToolStripMenuItem";
            resources.ApplyResources(this.modeToolStripMenuItem, "modeToolStripMenuItem");
            // 
            // lSBToolStripMenuItem
            // 
            this.lSBToolStripMenuItem.Name = "lSBToolStripMenuItem";
            resources.ApplyResources(this.lSBToolStripMenuItem, "lSBToolStripMenuItem");
            this.lSBToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // uSBToolStripMenuItem
            // 
            this.uSBToolStripMenuItem.Name = "uSBToolStripMenuItem";
            resources.ApplyResources(this.uSBToolStripMenuItem, "uSBToolStripMenuItem");
            this.uSBToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // dSBToolStripMenuItem
            // 
            this.dSBToolStripMenuItem.Name = "dSBToolStripMenuItem";
            resources.ApplyResources(this.dSBToolStripMenuItem, "dSBToolStripMenuItem");
            this.dSBToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // cWLToolStripMenuItem
            // 
            this.cWLToolStripMenuItem.Name = "cWLToolStripMenuItem";
            resources.ApplyResources(this.cWLToolStripMenuItem, "cWLToolStripMenuItem");
            this.cWLToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // cWUToolStripMenuItem
            // 
            this.cWUToolStripMenuItem.Name = "cWUToolStripMenuItem";
            resources.ApplyResources(this.cWUToolStripMenuItem, "cWUToolStripMenuItem");
            this.cWUToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // fMToolStripMenuItem
            // 
            this.fMToolStripMenuItem.Name = "fMToolStripMenuItem";
            resources.ApplyResources(this.fMToolStripMenuItem, "fMToolStripMenuItem");
            this.fMToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // aMToolStripMenuItem
            // 
            this.aMToolStripMenuItem.Name = "aMToolStripMenuItem";
            resources.ApplyResources(this.aMToolStripMenuItem, "aMToolStripMenuItem");
            this.aMToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // sAMToolStripMenuItem
            // 
            this.sAMToolStripMenuItem.Name = "sAMToolStripMenuItem";
            resources.ApplyResources(this.sAMToolStripMenuItem, "sAMToolStripMenuItem");
            this.sAMToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // sPECToolStripMenuItem
            // 
            this.sPECToolStripMenuItem.Name = "sPECToolStripMenuItem";
            resources.ApplyResources(this.sPECToolStripMenuItem, "sPECToolStripMenuItem");
            this.sPECToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // dIGLToolStripMenuItem
            // 
            this.dIGLToolStripMenuItem.Name = "dIGLToolStripMenuItem";
            resources.ApplyResources(this.dIGLToolStripMenuItem, "dIGLToolStripMenuItem");
            this.dIGLToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // dIGUToolStripMenuItem
            // 
            this.dIGUToolStripMenuItem.Name = "dIGUToolStripMenuItem";
            resources.ApplyResources(this.dIGUToolStripMenuItem, "dIGUToolStripMenuItem");
            this.dIGUToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // dRMToolStripMenuItem
            // 
            this.dRMToolStripMenuItem.Name = "dRMToolStripMenuItem";
            resources.ApplyResources(this.dRMToolStripMenuItem, "dRMToolStripMenuItem");
            this.dRMToolStripMenuItem.Click += new System.EventHandler(this.mnuMode_Click);
            // 
            // timerNotchZoom
            // 
            this.timerNotchZoom.Interval = 1000;
            this.timerNotchZoom.Tick += new System.EventHandler(this.timerNotchZoom_Tick);
            // 
            // lblRF2
            // 
            this.lblRF2.BackColor = System.Drawing.Color.Transparent;
            this.lblRF2.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblRF2, "lblRF2");
            this.lblRF2.Name = "lblRF2";
            // 
            // ptbRX2Squelch
            // 
            resources.ApplyResources(this.ptbRX2Squelch, "ptbRX2Squelch");
            this.ptbRX2Squelch.HeadImage = null;
            this.ptbRX2Squelch.LargeChange = 1;
            this.ptbRX2Squelch.Maximum = 0;
            this.ptbRX2Squelch.Minimum = -160;
            this.ptbRX2Squelch.Name = "ptbRX2Squelch";
            this.ptbRX2Squelch.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbRX2Squelch.SmallChange = 1;
            this.ptbRX2Squelch.TabStop = false;
            this.ptbRX2Squelch.Value = -150;
            this.ptbRX2Squelch.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbRX2Squelch_Scroll);
            // 
            // panelOptions
            // 
            resources.ApplyResources(this.panelOptions, "panelOptions");
            this.panelOptions.BackColor = System.Drawing.Color.Transparent;
            this.panelOptions.Controls.Add(this.chkSR);
            this.panelOptions.Controls.Add(this.chkFWCATU);
            this.panelOptions.Controls.Add(this.ckQuickPlay);
            this.panelOptions.Controls.Add(this.chkMON);
            this.panelOptions.Controls.Add(this.ckQuickRec);
            this.panelOptions.Controls.Add(this.chkMOX);
            this.panelOptions.Controls.Add(this.chkTUN);
            this.panelOptions.Controls.Add(this.comboTuneMode);
            this.panelOptions.Controls.Add(this.chkFWCATUBypass);
            this.panelOptions.Controls.Add(this.chkX2TR);
            this.panelOptions.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.panelOptions.Name = "panelOptions";
            // 
            // panelPower
            // 
            resources.ApplyResources(this.panelPower, "panelPower");
            this.panelPower.BackColor = System.Drawing.Color.Transparent;
            this.panelPower.Controls.Add(this.chkPower);
            this.panelPower.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.panelPower.Name = "panelPower";
            // 
            // panelFilter
            // 
            resources.ApplyResources(this.panelFilter, "panelFilter");
            this.panelFilter.BackColor = System.Drawing.Color.Transparent;
            this.panelFilter.ContextMenuStrip = this.contextMenuStripFilterRX1;
            this.panelFilter.Controls.Add(this.radFilter1);
            this.panelFilter.Controls.Add(this.ptbFilterShift);
            this.panelFilter.Controls.Add(this.ptbFilterWidth);
            this.panelFilter.Controls.Add(this.btnFilterShiftReset);
            this.panelFilter.Controls.Add(this.udFilterHigh);
            this.panelFilter.Controls.Add(this.udFilterLow);
            this.panelFilter.Controls.Add(this.lblFilterHigh);
            this.panelFilter.Controls.Add(this.lblFilterWidth);
            this.panelFilter.Controls.Add(this.radFilterVar2);
            this.panelFilter.Controls.Add(this.lblFilterLow);
            this.panelFilter.Controls.Add(this.radFilterVar1);
            this.panelFilter.Controls.Add(this.lblFilterShift);
            this.panelFilter.Controls.Add(this.radFilter9);
            this.panelFilter.Controls.Add(this.radFilter8);
            this.panelFilter.Controls.Add(this.radFilter2);
            this.panelFilter.Controls.Add(this.radFilter7);
            this.panelFilter.Controls.Add(this.radFilter3);
            this.panelFilter.Controls.Add(this.radFilter6);
            this.panelFilter.Controls.Add(this.radFilter4);
            this.panelFilter.Controls.Add(this.radFilter5);
            this.panelFilter.Controls.Add(this.radFilter10);
            this.panelFilter.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.panelFilter.Name = "panelFilter";
            // 
            // radFilter1
            // 
            resources.ApplyResources(this.radFilter1, "radFilter1");
            this.radFilter1.FlatAppearance.BorderSize = 0;
            this.radFilter1.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilter1.Name = "radFilter1";
            this.radFilter1.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // lblFilterHigh
            // 
            this.lblFilterHigh.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblFilterHigh, "lblFilterHigh");
            this.lblFilterHigh.Name = "lblFilterHigh";
            // 
            // lblFilterWidth
            // 
            this.lblFilterWidth.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblFilterWidth, "lblFilterWidth");
            this.lblFilterWidth.Name = "lblFilterWidth";
            // 
            // radFilterVar2
            // 
            resources.ApplyResources(this.radFilterVar2, "radFilterVar2");
            this.radFilterVar2.FlatAppearance.BorderSize = 0;
            this.radFilterVar2.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilterVar2.Name = "radFilterVar2";
            this.radFilterVar2.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // lblFilterLow
            // 
            this.lblFilterLow.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblFilterLow, "lblFilterLow");
            this.lblFilterLow.Name = "lblFilterLow";
            // 
            // radFilterVar1
            // 
            resources.ApplyResources(this.radFilterVar1, "radFilterVar1");
            this.radFilterVar1.FlatAppearance.BorderSize = 0;
            this.radFilterVar1.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilterVar1.Name = "radFilterVar1";
            this.radFilterVar1.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // lblFilterShift
            // 
            this.lblFilterShift.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblFilterShift, "lblFilterShift");
            this.lblFilterShift.Name = "lblFilterShift";
            // 
            // radFilter9
            // 
            resources.ApplyResources(this.radFilter9, "radFilter9");
            this.radFilter9.FlatAppearance.BorderSize = 0;
            this.radFilter9.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilter9.Name = "radFilter9";
            this.radFilter9.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // radFilter8
            // 
            resources.ApplyResources(this.radFilter8, "radFilter8");
            this.radFilter8.FlatAppearance.BorderSize = 0;
            this.radFilter8.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilter8.Name = "radFilter8";
            this.radFilter8.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // radFilter2
            // 
            resources.ApplyResources(this.radFilter2, "radFilter2");
            this.radFilter2.FlatAppearance.BorderSize = 0;
            this.radFilter2.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilter2.Name = "radFilter2";
            this.radFilter2.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // radFilter7
            // 
            resources.ApplyResources(this.radFilter7, "radFilter7");
            this.radFilter7.FlatAppearance.BorderSize = 0;
            this.radFilter7.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilter7.Name = "radFilter7";
            this.radFilter7.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // radFilter3
            // 
            resources.ApplyResources(this.radFilter3, "radFilter3");
            this.radFilter3.FlatAppearance.BorderSize = 0;
            this.radFilter3.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilter3.Name = "radFilter3";
            this.radFilter3.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // radFilter6
            // 
            resources.ApplyResources(this.radFilter6, "radFilter6");
            this.radFilter6.FlatAppearance.BorderSize = 0;
            this.radFilter6.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilter6.Name = "radFilter6";
            this.radFilter6.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // radFilter4
            // 
            resources.ApplyResources(this.radFilter4, "radFilter4");
            this.radFilter4.FlatAppearance.BorderSize = 0;
            this.radFilter4.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilter4.Name = "radFilter4";
            this.radFilter4.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // radFilter5
            // 
            resources.ApplyResources(this.radFilter5, "radFilter5");
            this.radFilter5.FlatAppearance.BorderSize = 0;
            this.radFilter5.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilter5.Name = "radFilter5";
            this.radFilter5.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // radFilter10
            // 
            resources.ApplyResources(this.radFilter10, "radFilter10");
            this.radFilter10.FlatAppearance.BorderSize = 0;
            this.radFilter10.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radFilter10.Name = "radFilter10";
            this.radFilter10.CheckedChanged += new System.EventHandler(this.radFilter_CheckedChanged);
            // 
            // panelModeSpecificCW
            // 
            resources.ApplyResources(this.panelModeSpecificCW, "panelModeSpecificCW");
            this.panelModeSpecificCW.BackColor = System.Drawing.Color.Transparent;
            this.panelModeSpecificCW.Controls.Add(this.chkCWSidetone);
            this.panelModeSpecificCW.Controls.Add(this.chkCWVACIQ);
            this.panelModeSpecificCW.Controls.Add(this.chkShowCWZero);
            this.panelModeSpecificCW.Controls.Add(this.chkCWDisableTXDisplay);
            this.panelModeSpecificCW.Controls.Add(this.ptbCWSpeed);
            this.panelModeSpecificCW.Controls.Add(this.udCWPitch);
            this.panelModeSpecificCW.Controls.Add(this.lblCWSpeed);
            this.panelModeSpecificCW.Controls.Add(this.grpSemiBreakIn);
            this.panelModeSpecificCW.Controls.Add(this.lblCWPitchFreq);
            this.panelModeSpecificCW.Controls.Add(this.chkShowTXCWFreq);
            this.panelModeSpecificCW.Controls.Add(this.chkCWVAC);
            this.panelModeSpecificCW.Controls.Add(this.chkCWIambic);
            this.panelModeSpecificCW.Controls.Add(this.panelAntenna);
            this.panelModeSpecificCW.Name = "panelModeSpecificCW";
            // 
            // lblCWSpeed
            // 
            this.lblCWSpeed.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblCWSpeed, "lblCWSpeed");
            this.lblCWSpeed.Name = "lblCWSpeed";
            // 
            // grpSemiBreakIn
            // 
            this.grpSemiBreakIn.Controls.Add(this.udCWBreakInDelay);
            this.grpSemiBreakIn.Controls.Add(this.lblCWBreakInDelay);
            this.grpSemiBreakIn.Controls.Add(this.chkCWBreakInEnabled);
            this.grpSemiBreakIn.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.grpSemiBreakIn, "grpSemiBreakIn");
            this.grpSemiBreakIn.Name = "grpSemiBreakIn";
            this.grpSemiBreakIn.TabStop = false;
            // 
            // lblCWBreakInDelay
            // 
            this.lblCWBreakInDelay.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblCWBreakInDelay, "lblCWBreakInDelay");
            this.lblCWBreakInDelay.Name = "lblCWBreakInDelay";
            // 
            // lblCWPitchFreq
            // 
            this.lblCWPitchFreq.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblCWPitchFreq, "lblCWPitchFreq");
            this.lblCWPitchFreq.Name = "lblCWPitchFreq";
            // 
            // panelAntenna
            // 
            resources.ApplyResources(this.panelAntenna, "panelAntenna");
            this.panelAntenna.BackColor = System.Drawing.Color.Transparent;
            this.panelAntenna.Controls.Add(this.chkBCI);
            this.panelAntenna.Controls.Add(this.lblAntRX2);
            this.panelAntenna.Controls.Add(this.lblAntRX1);
            this.panelAntenna.Controls.Add(this.lblAntTX);
            this.panelAntenna.Name = "panelAntenna";
            // 
            // lblAntRX2
            // 
            this.lblAntRX2.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblAntRX2, "lblAntRX2");
            this.lblAntRX2.Name = "lblAntRX2";
            // 
            // lblAntRX1
            // 
            this.lblAntRX1.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblAntRX1, "lblAntRX1");
            this.lblAntRX1.Name = "lblAntRX1";
            // 
            // lblAntTX
            // 
            this.lblAntTX.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblAntTX, "lblAntTX");
            this.lblAntTX.Name = "lblAntTX";
            // 
            // panelRX2Filter
            // 
            resources.ApplyResources(this.panelRX2Filter, "panelRX2Filter");
            this.panelRX2Filter.BackColor = System.Drawing.Color.Transparent;
            this.panelRX2Filter.ContextMenuStrip = this.contextMenuStripFilterRX2;
            this.panelRX2Filter.Controls.Add(this.udRX2FilterHigh);
            this.panelRX2Filter.Controls.Add(this.radRX2Filter1);
            this.panelRX2Filter.Controls.Add(this.udRX2FilterLow);
            this.panelRX2Filter.Controls.Add(this.lblRX2FilterHigh);
            this.panelRX2Filter.Controls.Add(this.lblRX2FilterLow);
            this.panelRX2Filter.Controls.Add(this.radRX2Filter2);
            this.panelRX2Filter.Controls.Add(this.radRX2FilterVar2);
            this.panelRX2Filter.Controls.Add(this.radRX2Filter3);
            this.panelRX2Filter.Controls.Add(this.radRX2FilterVar1);
            this.panelRX2Filter.Controls.Add(this.radRX2Filter4);
            this.panelRX2Filter.Controls.Add(this.radRX2Filter7);
            this.panelRX2Filter.Controls.Add(this.radRX2Filter5);
            this.panelRX2Filter.Controls.Add(this.radRX2Filter6);
            this.panelRX2Filter.Name = "panelRX2Filter";
            // 
            // radRX2Filter1
            // 
            resources.ApplyResources(this.radRX2Filter1, "radRX2Filter1");
            this.radRX2Filter1.FlatAppearance.BorderSize = 0;
            this.radRX2Filter1.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2Filter1.Name = "radRX2Filter1";
            this.radRX2Filter1.CheckedChanged += new System.EventHandler(this.radRX2Filter1_CheckedChanged);
            // 
            // lblRX2FilterHigh
            // 
            this.lblRX2FilterHigh.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.lblRX2FilterHigh, "lblRX2FilterHigh");
            this.lblRX2FilterHigh.Name = "lblRX2FilterHigh";
            // 
            // lblRX2FilterLow
            // 
            this.lblRX2FilterLow.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.lblRX2FilterLow, "lblRX2FilterLow");
            this.lblRX2FilterLow.Name = "lblRX2FilterLow";
            // 
            // radRX2Filter2
            // 
            resources.ApplyResources(this.radRX2Filter2, "radRX2Filter2");
            this.radRX2Filter2.FlatAppearance.BorderSize = 0;
            this.radRX2Filter2.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2Filter2.Name = "radRX2Filter2";
            this.radRX2Filter2.CheckedChanged += new System.EventHandler(this.radRX2Filter2_CheckedChanged);
            // 
            // radRX2FilterVar2
            // 
            resources.ApplyResources(this.radRX2FilterVar2, "radRX2FilterVar2");
            this.radRX2FilterVar2.FlatAppearance.BorderSize = 0;
            this.radRX2FilterVar2.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2FilterVar2.Name = "radRX2FilterVar2";
            this.radRX2FilterVar2.CheckedChanged += new System.EventHandler(this.radRX2FilterVar2_CheckedChanged);
            // 
            // radRX2Filter3
            // 
            resources.ApplyResources(this.radRX2Filter3, "radRX2Filter3");
            this.radRX2Filter3.FlatAppearance.BorderSize = 0;
            this.radRX2Filter3.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2Filter3.Name = "radRX2Filter3";
            this.radRX2Filter3.CheckedChanged += new System.EventHandler(this.radRX2Filter3_CheckedChanged);
            // 
            // radRX2FilterVar1
            // 
            resources.ApplyResources(this.radRX2FilterVar1, "radRX2FilterVar1");
            this.radRX2FilterVar1.FlatAppearance.BorderSize = 0;
            this.radRX2FilterVar1.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2FilterVar1.Name = "radRX2FilterVar1";
            this.radRX2FilterVar1.CheckedChanged += new System.EventHandler(this.radRX2FilterVar1_CheckedChanged);
            // 
            // radRX2Filter4
            // 
            resources.ApplyResources(this.radRX2Filter4, "radRX2Filter4");
            this.radRX2Filter4.FlatAppearance.BorderSize = 0;
            this.radRX2Filter4.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2Filter4.Name = "radRX2Filter4";
            this.radRX2Filter4.CheckedChanged += new System.EventHandler(this.radRX2Filter4_CheckedChanged);
            // 
            // radRX2Filter7
            // 
            resources.ApplyResources(this.radRX2Filter7, "radRX2Filter7");
            this.radRX2Filter7.FlatAppearance.BorderSize = 0;
            this.radRX2Filter7.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2Filter7.Name = "radRX2Filter7";
            this.radRX2Filter7.CheckedChanged += new System.EventHandler(this.radRX2Filter7_CheckedChanged);
            // 
            // radRX2Filter5
            // 
            resources.ApplyResources(this.radRX2Filter5, "radRX2Filter5");
            this.radRX2Filter5.FlatAppearance.BorderSize = 0;
            this.radRX2Filter5.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2Filter5.Name = "radRX2Filter5";
            this.radRX2Filter5.CheckedChanged += new System.EventHandler(this.radRX2Filter5_CheckedChanged);
            // 
            // radRX2Filter6
            // 
            resources.ApplyResources(this.radRX2Filter6, "radRX2Filter6");
            this.radRX2Filter6.FlatAppearance.BorderSize = 0;
            this.radRX2Filter6.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.radRX2Filter6.Name = "radRX2Filter6";
            this.radRX2Filter6.CheckedChanged += new System.EventHandler(this.radRX2Filter6_CheckedChanged);
            // 
            // panelRX2Mode
            // 
            resources.ApplyResources(this.panelRX2Mode, "panelRX2Mode");
            this.panelRX2Mode.BackColor = System.Drawing.Color.Transparent;
            this.panelRX2Mode.Controls.Add(this.radRX2ModeAM);
            this.panelRX2Mode.Controls.Add(this.radRX2ModeLSB);
            this.panelRX2Mode.Controls.Add(this.radRX2ModeSAM);
            this.panelRX2Mode.Controls.Add(this.radRX2ModeCWL);
            this.panelRX2Mode.Controls.Add(this.radRX2ModeDSB);
            this.panelRX2Mode.Controls.Add(this.radRX2ModeUSB);
            this.panelRX2Mode.Controls.Add(this.radRX2ModeCWU);
            this.panelRX2Mode.Controls.Add(this.radRX2ModeFMN);
            this.panelRX2Mode.Controls.Add(this.radRX2ModeDIGU);
            this.panelRX2Mode.Controls.Add(this.radRX2ModeDRM);
            this.panelRX2Mode.Controls.Add(this.radRX2ModeDIGL);
            this.panelRX2Mode.Controls.Add(this.radRX2ModeSPEC);
            this.panelRX2Mode.Name = "panelRX2Mode";
            // 
            // panelRX2Display
            // 
            resources.ApplyResources(this.panelRX2Display, "panelRX2Display");
            this.panelRX2Display.BackColor = System.Drawing.Color.Transparent;
            this.panelRX2Display.Controls.Add(this.chkRX2DisplayPeak);
            this.panelRX2Display.Controls.Add(this.comboRX2DisplayMode);
            this.panelRX2Display.Controls.Add(this.chkRX2DisplayAVG);
            this.panelRX2Display.Name = "panelRX2Display";
            // 
            // panelRX2Mixer
            // 
            resources.ApplyResources(this.panelRX2Mixer, "panelRX2Mixer");
            this.panelRX2Mixer.BackColor = System.Drawing.Color.Transparent;
            this.panelRX2Mixer.Controls.Add(this.ptbRX2Pan);
            this.panelRX2Mixer.Controls.Add(this.ptbRX2Gain);
            this.panelRX2Mixer.Controls.Add(this.lblRX2Pan);
            this.panelRX2Mixer.Controls.Add(this.lblRX2Vol);
            this.panelRX2Mixer.Controls.Add(this.lblRX2Mute);
            this.panelRX2Mixer.Controls.Add(this.chkRX2Mute);
            this.panelRX2Mixer.Name = "panelRX2Mixer";
            // 
            // lblRX2Pan
            // 
            resources.ApplyResources(this.lblRX2Pan, "lblRX2Pan");
            this.lblRX2Pan.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.lblRX2Pan.Name = "lblRX2Pan";
            // 
            // lblRX2Vol
            // 
            this.lblRX2Vol.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.lblRX2Vol, "lblRX2Vol");
            this.lblRX2Vol.Name = "lblRX2Vol";
            // 
            // lblRX2Mute
            // 
            resources.ApplyResources(this.lblRX2Mute, "lblRX2Mute");
            this.lblRX2Mute.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.lblRX2Mute.Name = "lblRX2Mute";
            // 
            // panelMultiRX
            // 
            resources.ApplyResources(this.panelMultiRX, "panelMultiRX");
            this.panelMultiRX.BackColor = System.Drawing.Color.Transparent;
            this.panelMultiRX.Controls.Add(this.ptbRX1Gain);
            this.panelMultiRX.Controls.Add(this.ptbPanSubRX);
            this.panelMultiRX.Controls.Add(this.ptbRX0Gain);
            this.panelMultiRX.Controls.Add(this.ptbPanMainRX);
            this.panelMultiRX.Controls.Add(this.chkPanSwap);
            this.panelMultiRX.Controls.Add(this.chkEnableMultiRX);
            this.panelMultiRX.Name = "panelMultiRX";
            // 
            // panelDisplay2
            // 
            resources.ApplyResources(this.panelDisplay2, "panelDisplay2");
            this.panelDisplay2.BackColor = System.Drawing.Color.Transparent;
            this.panelDisplay2.Controls.Add(this.btnTNFAdd);
            this.panelDisplay2.Controls.Add(this.chkTNF);
            this.panelDisplay2.Controls.Add(this.chkDisplayPeak);
            this.panelDisplay2.Controls.Add(this.comboDisplayMode);
            this.panelDisplay2.Controls.Add(this.chkDisplayAVG);
            this.panelDisplay2.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.panelDisplay2.Name = "panelDisplay2";
            // 
            // panelDSP
            // 
            resources.ApplyResources(this.panelDSP, "panelDSP");
            this.panelDSP.BackColor = System.Drawing.Color.Transparent;
            this.panelDSP.Controls.Add(this.chkMUT);
            this.panelDSP.Controls.Add(this.chkNR);
            this.panelDSP.Controls.Add(this.chkDSPNB2);
            this.panelDSP.Controls.Add(this.chkBIN);
            this.panelDSP.Controls.Add(this.chkNB);
            this.panelDSP.Controls.Add(this.chkANF);
            this.panelDSP.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.panelDSP.Name = "panelDSP";
            // 
            // panelVFO
            // 
            resources.ApplyResources(this.panelVFO, "panelVFO");
            this.panelVFO.BackColor = System.Drawing.Color.Transparent;
            this.panelVFO.Controls.Add(this.btnZeroBeat);
            this.panelVFO.Controls.Add(this.chkVFOSplit);
            this.panelVFO.Controls.Add(this.btnRITReset);
            this.panelVFO.Controls.Add(this.btnXITReset);
            this.panelVFO.Controls.Add(this.udRIT);
            this.panelVFO.Controls.Add(this.btnIFtoVFO);
            this.panelVFO.Controls.Add(this.chkRIT);
            this.panelVFO.Controls.Add(this.btnVFOSwap);
            this.panelVFO.Controls.Add(this.chkXIT);
            this.panelVFO.Controls.Add(this.btnVFOBtoA);
            this.panelVFO.Controls.Add(this.udXIT);
            this.panelVFO.Controls.Add(this.btnVFOAtoB);
            this.panelVFO.Controls.Add(this.lblCPUMeter);
            this.panelVFO.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.panelVFO.Name = "panelVFO";
            // 
            // lblCPUMeter
            // 
            resources.ApplyResources(this.lblCPUMeter, "lblCPUMeter");
            this.lblCPUMeter.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.lblCPUMeter.Name = "lblCPUMeter";
            // 
            // txtCPUMeter
            // 
            this.txtCPUMeter.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            resources.ApplyResources(this.txtCPUMeter, "txtCPUMeter");
            this.txtCPUMeter.ForeColor = System.Drawing.Color.White;
            this.txtCPUMeter.Name = "txtCPUMeter";
            this.txtCPUMeter.ReadOnly = true;
            // 
            // panelDateTime
            // 
            resources.ApplyResources(this.panelDateTime, "panelDateTime");
            this.panelDateTime.BackColor = System.Drawing.Color.Transparent;
            this.panelDateTime.Controls.Add(this.txtTime);
            this.panelDateTime.Controls.Add(this.txtDate);
            this.panelDateTime.Controls.Add(this.txtCPUMeter);
            this.panelDateTime.Name = "panelDateTime";
            // 
            // txtTime
            // 
            this.txtTime.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            resources.ApplyResources(this.txtTime, "txtTime");
            this.txtTime.ForeColor = System.Drawing.Color.White;
            this.txtTime.Name = "txtTime";
            this.txtTime.ReadOnly = true;
            this.txtTime.MouseDown += new System.Windows.Forms.MouseEventHandler(this.DateTime_MouseDown);
            // 
            // txtDate
            // 
            this.txtDate.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            resources.ApplyResources(this.txtDate, "txtDate");
            this.txtDate.ForeColor = System.Drawing.Color.White;
            this.txtDate.Name = "txtDate";
            this.txtDate.ReadOnly = true;
            this.txtDate.MouseDown += new System.Windows.Forms.MouseEventHandler(this.DateTime_MouseDown);
            // 
            // panelSoundControls
            // 
            resources.ApplyResources(this.panelSoundControls, "panelSoundControls");
            this.panelSoundControls.BackColor = System.Drawing.Color.Transparent;
            this.panelSoundControls.Controls.Add(this.comboAGC);
            this.panelSoundControls.Controls.Add(this.ptbPWR);
            this.panelSoundControls.Controls.Add(this.ptbRF);
            this.panelSoundControls.Controls.Add(this.ptbAF);
            this.panelSoundControls.Controls.Add(this.lblAF);
            this.panelSoundControls.Controls.Add(this.lblAGC);
            this.panelSoundControls.Controls.Add(this.lblPreamp);
            this.panelSoundControls.Controls.Add(this.comboPreamp);
            this.panelSoundControls.Controls.Add(this.lblRF);
            this.panelSoundControls.Controls.Add(this.lblPWR);
            this.panelSoundControls.Controls.Add(this.chkRX1Preamp);
            this.panelSoundControls.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.panelSoundControls.Name = "panelSoundControls";
            // 
            // lblAF
            // 
            this.lblAF.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblAF, "lblAF");
            this.lblAF.Name = "lblAF";
            // 
            // lblPreamp
            // 
            this.lblPreamp.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblPreamp, "lblPreamp");
            this.lblPreamp.Name = "lblPreamp";
            // 
            // lblPWR
            // 
            this.lblPWR.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblPWR, "lblPWR");
            this.lblPWR.Name = "lblPWR";
            // 
            // lblAF2
            // 
            this.lblAF2.BackColor = System.Drawing.Color.Transparent;
            this.lblAF2.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblAF2, "lblAF2");
            this.lblAF2.Name = "lblAF2";
            // 
            // panelModeSpecificPhone
            // 
            resources.ApplyResources(this.panelModeSpecificPhone, "panelModeSpecificPhone");
            this.panelModeSpecificPhone.BackColor = System.Drawing.Color.Transparent;
            this.panelModeSpecificPhone.Controls.Add(this.chkMicMute);
            this.panelModeSpecificPhone.Controls.Add(this.picNoiseGate);
            this.panelModeSpecificPhone.Controls.Add(this.lblNoiseGateVal);
            this.panelModeSpecificPhone.Controls.Add(this.ptbNoiseGate);
            this.panelModeSpecificPhone.Controls.Add(this.picVOX);
            this.panelModeSpecificPhone.Controls.Add(this.ptbVOX);
            this.panelModeSpecificPhone.Controls.Add(this.lblVOXVal);
            this.panelModeSpecificPhone.Controls.Add(this.ptbCPDR);
            this.panelModeSpecificPhone.Controls.Add(this.lblCPDRVal);
            this.panelModeSpecificPhone.Controls.Add(this.ptbDX);
            this.panelModeSpecificPhone.Controls.Add(this.lblDXVal);
            this.panelModeSpecificPhone.Controls.Add(this.lblMicVal);
            this.panelModeSpecificPhone.Controls.Add(this.ptbMic);
            this.panelModeSpecificPhone.Controls.Add(this.lblMIC);
            this.panelModeSpecificPhone.Controls.Add(this.chkShowTXFilter);
            this.panelModeSpecificPhone.Controls.Add(this.chkDX);
            this.panelModeSpecificPhone.Controls.Add(this.lblTransmitProfile);
            this.panelModeSpecificPhone.Controls.Add(this.chkTXEQ);
            this.panelModeSpecificPhone.Controls.Add(this.comboTXProfile);
            this.panelModeSpecificPhone.Controls.Add(this.chkRXEQ);
            this.panelModeSpecificPhone.Controls.Add(this.chkCPDR);
            this.panelModeSpecificPhone.Controls.Add(this.chkPhoneVAC);
            this.panelModeSpecificPhone.Controls.Add(this.chkVOX);
            this.panelModeSpecificPhone.Controls.Add(this.chkNoiseGate);
            this.panelModeSpecificPhone.Name = "panelModeSpecificPhone";
            // 
            // picNoiseGate
            // 
            this.picNoiseGate.BackColor = System.Drawing.SystemColors.ControlText;
            resources.ApplyResources(this.picNoiseGate, "picNoiseGate");
            this.picNoiseGate.Name = "picNoiseGate";
            this.picNoiseGate.TabStop = false;
            this.picNoiseGate.Paint += new System.Windows.Forms.PaintEventHandler(this.picNoiseGate_Paint);
            // 
            // lblNoiseGateVal
            // 
            resources.ApplyResources(this.lblNoiseGateVal, "lblNoiseGateVal");
            this.lblNoiseGateVal.ForeColor = System.Drawing.Color.White;
            this.lblNoiseGateVal.Name = "lblNoiseGateVal";
            // 
            // ptbNoiseGate
            // 
            resources.ApplyResources(this.ptbNoiseGate, "ptbNoiseGate");
            this.ptbNoiseGate.HeadImage = null;
            this.ptbNoiseGate.LargeChange = 1;
            this.ptbNoiseGate.Maximum = 0;
            this.ptbNoiseGate.Minimum = -160;
            this.ptbNoiseGate.Name = "ptbNoiseGate";
            this.ptbNoiseGate.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbNoiseGate.SmallChange = 1;
            this.ptbNoiseGate.TabStop = false;
            this.ptbNoiseGate.Value = -40;
            this.ptbNoiseGate.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbNoiseGate_Scroll);
            // 
            // picVOX
            // 
            this.picVOX.BackColor = System.Drawing.SystemColors.ControlText;
            resources.ApplyResources(this.picVOX, "picVOX");
            this.picVOX.Name = "picVOX";
            this.picVOX.TabStop = false;
            this.picVOX.Paint += new System.Windows.Forms.PaintEventHandler(this.picVOX_Paint);
            // 
            // ptbVOX
            // 
            resources.ApplyResources(this.ptbVOX, "ptbVOX");
            this.ptbVOX.HeadImage = null;
            this.ptbVOX.LargeChange = 1;
            this.ptbVOX.Maximum = 1000;
            this.ptbVOX.Minimum = 0;
            this.ptbVOX.Name = "ptbVOX";
            this.ptbVOX.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbVOX.SmallChange = 1;
            this.ptbVOX.TabStop = false;
            this.ptbVOX.Value = 200;
            this.ptbVOX.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbVOX_Scroll);
            // 
            // lblVOXVal
            // 
            resources.ApplyResources(this.lblVOXVal, "lblVOXVal");
            this.lblVOXVal.ForeColor = System.Drawing.Color.White;
            this.lblVOXVal.Name = "lblVOXVal";
            // 
            // ptbCPDR
            // 
            resources.ApplyResources(this.ptbCPDR, "ptbCPDR");
            this.ptbCPDR.HeadImage = null;
            this.ptbCPDR.LargeChange = 1;
            this.ptbCPDR.Maximum = 20;
            this.ptbCPDR.Minimum = 0;
            this.ptbCPDR.Name = "ptbCPDR";
            this.ptbCPDR.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbCPDR.SmallChange = 1;
            this.ptbCPDR.TabStop = false;
            this.ptbCPDR.Value = 1;
            this.ptbCPDR.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbCPDR_Scroll);
            // 
            // lblCPDRVal
            // 
            resources.ApplyResources(this.lblCPDRVal, "lblCPDRVal");
            this.lblCPDRVal.ForeColor = System.Drawing.Color.White;
            this.lblCPDRVal.Name = "lblCPDRVal";
            // 
            // ptbDX
            // 
            resources.ApplyResources(this.ptbDX, "ptbDX");
            this.ptbDX.HeadImage = null;
            this.ptbDX.LargeChange = 1;
            this.ptbDX.Maximum = 10;
            this.ptbDX.Minimum = 0;
            this.ptbDX.Name = "ptbDX";
            this.ptbDX.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbDX.SmallChange = 1;
            this.ptbDX.TabStop = false;
            this.ptbDX.Value = 10;
            this.ptbDX.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbDX_Scroll);
            // 
            // lblDXVal
            // 
            resources.ApplyResources(this.lblDXVal, "lblDXVal");
            this.lblDXVal.ForeColor = System.Drawing.Color.White;
            this.lblDXVal.Name = "lblDXVal";
            // 
            // lblMicVal
            // 
            resources.ApplyResources(this.lblMicVal, "lblMicVal");
            this.lblMicVal.ForeColor = System.Drawing.Color.White;
            this.lblMicVal.Name = "lblMicVal";
            // 
            // ptbMic
            // 
            resources.ApplyResources(this.ptbMic, "ptbMic");
            this.ptbMic.HeadImage = null;
            this.ptbMic.LargeChange = 1;
            this.ptbMic.Maximum = 70;
            this.ptbMic.Minimum = -96;
            this.ptbMic.Name = "ptbMic";
            this.ptbMic.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbMic.SmallChange = 1;
            this.ptbMic.TabStop = false;
            this.ptbMic.Value = 6;
            this.ptbMic.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbMic_Scroll);
            // 
            // lblMIC
            // 
            resources.ApplyResources(this.lblMIC, "lblMIC");
            this.lblMIC.ForeColor = System.Drawing.Color.White;
            this.lblMIC.Name = "lblMIC";
            // 
            // lblTransmitProfile
            // 
            this.lblTransmitProfile.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblTransmitProfile, "lblTransmitProfile");
            this.lblTransmitProfile.Name = "lblTransmitProfile";
            // 
            // panelModeSpecificDigital
            // 
            resources.ApplyResources(this.panelModeSpecificDigital, "panelModeSpecificDigital");
            this.panelModeSpecificDigital.BackColor = System.Drawing.Color.Transparent;
            this.panelModeSpecificDigital.Controls.Add(this.ptbVACTXGain);
            this.panelModeSpecificDigital.Controls.Add(this.comboDigTXProfile);
            this.panelModeSpecificDigital.Controls.Add(this.ptbVACRXGain);
            this.panelModeSpecificDigital.Controls.Add(this.chkVACEnabled);
            this.panelModeSpecificDigital.Controls.Add(this.lblDigTXProfile);
            this.panelModeSpecificDigital.Controls.Add(this.lblRXGain);
            this.panelModeSpecificDigital.Controls.Add(this.grpVACStereo);
            this.panelModeSpecificDigital.Controls.Add(this.lblTXGain);
            this.panelModeSpecificDigital.Controls.Add(this.grpDIGSampleRate);
            this.panelModeSpecificDigital.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.panelModeSpecificDigital.Name = "panelModeSpecificDigital";
            // 
            // lblDigTXProfile
            // 
            this.lblDigTXProfile.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblDigTXProfile, "lblDigTXProfile");
            this.lblDigTXProfile.Name = "lblDigTXProfile";
            // 
            // lblRXGain
            // 
            this.lblRXGain.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblRXGain, "lblRXGain");
            this.lblRXGain.Name = "lblRXGain";
            // 
            // grpVACStereo
            // 
            this.grpVACStereo.Controls.Add(this.chkVACIQEnabled);
            this.grpVACStereo.Controls.Add(this.chkVACStereo);
            this.grpVACStereo.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.grpVACStereo, "grpVACStereo");
            this.grpVACStereo.Name = "grpVACStereo";
            this.grpVACStereo.TabStop = false;
            // 
            // lblTXGain
            // 
            this.lblTXGain.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblTXGain, "lblTXGain");
            this.lblTXGain.Name = "lblTXGain";
            // 
            // grpDIGSampleRate
            // 
            this.grpDIGSampleRate.Controls.Add(this.comboVACSampleRate);
            this.grpDIGSampleRate.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.grpDIGSampleRate, "grpDIGSampleRate");
            this.grpDIGSampleRate.Name = "grpDIGSampleRate";
            this.grpDIGSampleRate.TabStop = false;
            // 
            // panelDisplay
            // 
            resources.ApplyResources(this.panelDisplay, "panelDisplay");
            this.panelDisplay.BackColor = System.Drawing.Color.Transparent;
            this.panelDisplay.Controls.Add(this.radDisplayZoom4x);
            this.panelDisplay.Controls.Add(this.radDisplayZoom2x);
            this.panelDisplay.Controls.Add(this.radDisplayZoom1x);
            this.panelDisplay.Controls.Add(this.radDisplayZoom05);
            this.panelDisplay.Controls.Add(this.ptbDisplayZoom);
            this.panelDisplay.Controls.Add(this.ptbDisplayPan);
            this.panelDisplay.Controls.Add(this.picDisplay);
            this.panelDisplay.Controls.Add(this.txtDisplayPeakOffset);
            this.panelDisplay.Controls.Add(this.txtDisplayCursorOffset);
            this.panelDisplay.Controls.Add(this.txtOverload);
            this.panelDisplay.Controls.Add(this.txtDisplayCursorPower);
            this.panelDisplay.Controls.Add(this.lblDisplayZoom);
            this.panelDisplay.Controls.Add(this.txtDisplayCursorFreq);
            this.panelDisplay.Controls.Add(this.txtDisplayPeakPower);
            this.panelDisplay.Controls.Add(this.btnDisplayPanCenter);
            this.panelDisplay.Controls.Add(this.txtDisplayPeakFreq);
            this.panelDisplay.Controls.Add(this.lblDisplayPan);
            this.panelDisplay.Name = "panelDisplay";
            // 
            // picDisplay
            // 
            this.picDisplay.BackColor = System.Drawing.Color.Black;
            resources.ApplyResources(this.picDisplay, "picDisplay");
            this.picDisplay.Cursor = System.Windows.Forms.Cursors.Cross;
            this.picDisplay.Name = "picDisplay";
            this.picDisplay.TabStop = false;
            this.picDisplay.Paint += new System.Windows.Forms.PaintEventHandler(this.picDisplay_Paint);
            this.picDisplay.DoubleClick += new System.EventHandler(this.picDisplay_DoubleClick);
            this.picDisplay.MouseDown += new System.Windows.Forms.MouseEventHandler(this.picDisplay_MouseDown);
            this.picDisplay.MouseLeave += new System.EventHandler(this.picDisplay_MouseLeave);
            this.picDisplay.MouseMove += new System.Windows.Forms.MouseEventHandler(this.picDisplay_MouseMove);
            this.picDisplay.MouseUp += new System.Windows.Forms.MouseEventHandler(this.picDisplay_MouseUp);
            this.picDisplay.Resize += new System.EventHandler(this.picDisplay_Resize);
            // 
            // txtDisplayPeakOffset
            // 
            this.txtDisplayPeakOffset.BackColor = System.Drawing.Color.Black;
            this.txtDisplayPeakOffset.BorderStyle = System.Windows.Forms.BorderStyle.None;
            this.txtDisplayPeakOffset.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtDisplayPeakOffset, "txtDisplayPeakOffset");
            this.txtDisplayPeakOffset.ForeColor = System.Drawing.Color.DodgerBlue;
            this.txtDisplayPeakOffset.Name = "txtDisplayPeakOffset";
            this.txtDisplayPeakOffset.ReadOnly = true;
            this.txtDisplayPeakOffset.GotFocus += new System.EventHandler(this.HideFocus);
            // 
            // txtDisplayCursorOffset
            // 
            this.txtDisplayCursorOffset.BackColor = System.Drawing.Color.Black;
            this.txtDisplayCursorOffset.BorderStyle = System.Windows.Forms.BorderStyle.None;
            this.txtDisplayCursorOffset.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtDisplayCursorOffset, "txtDisplayCursorOffset");
            this.txtDisplayCursorOffset.ForeColor = System.Drawing.Color.DodgerBlue;
            this.txtDisplayCursorOffset.Name = "txtDisplayCursorOffset";
            this.txtDisplayCursorOffset.ReadOnly = true;
            this.txtDisplayCursorOffset.GotFocus += new System.EventHandler(this.HideFocus);
            // 
            // txtOverload
            // 
            this.txtOverload.BackColor = System.Drawing.Color.Black;
            this.txtOverload.BorderStyle = System.Windows.Forms.BorderStyle.None;
            this.txtOverload.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtOverload, "txtOverload");
            this.txtOverload.ForeColor = System.Drawing.Color.Red;
            this.txtOverload.Name = "txtOverload";
            this.txtOverload.ReadOnly = true;
            // 
            // txtDisplayCursorPower
            // 
            this.txtDisplayCursorPower.BackColor = System.Drawing.Color.Black;
            this.txtDisplayCursorPower.BorderStyle = System.Windows.Forms.BorderStyle.None;
            this.txtDisplayCursorPower.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtDisplayCursorPower, "txtDisplayCursorPower");
            this.txtDisplayCursorPower.ForeColor = System.Drawing.Color.DodgerBlue;
            this.txtDisplayCursorPower.Name = "txtDisplayCursorPower";
            this.txtDisplayCursorPower.ReadOnly = true;
            // 
            // lblDisplayZoom
            // 
            this.lblDisplayZoom.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblDisplayZoom, "lblDisplayZoom");
            this.lblDisplayZoom.Name = "lblDisplayZoom";
            // 
            // txtDisplayCursorFreq
            // 
            this.txtDisplayCursorFreq.BackColor = System.Drawing.Color.Black;
            this.txtDisplayCursorFreq.BorderStyle = System.Windows.Forms.BorderStyle.None;
            this.txtDisplayCursorFreq.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtDisplayCursorFreq, "txtDisplayCursorFreq");
            this.txtDisplayCursorFreq.ForeColor = System.Drawing.Color.DodgerBlue;
            this.txtDisplayCursorFreq.Name = "txtDisplayCursorFreq";
            this.txtDisplayCursorFreq.ReadOnly = true;
            // 
            // txtDisplayPeakPower
            // 
            this.txtDisplayPeakPower.BackColor = System.Drawing.Color.Black;
            this.txtDisplayPeakPower.BorderStyle = System.Windows.Forms.BorderStyle.None;
            this.txtDisplayPeakPower.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtDisplayPeakPower, "txtDisplayPeakPower");
            this.txtDisplayPeakPower.ForeColor = System.Drawing.Color.DodgerBlue;
            this.txtDisplayPeakPower.Name = "txtDisplayPeakPower";
            this.txtDisplayPeakPower.ReadOnly = true;
            // 
            // txtDisplayPeakFreq
            // 
            this.txtDisplayPeakFreq.BackColor = System.Drawing.Color.Black;
            this.txtDisplayPeakFreq.BorderStyle = System.Windows.Forms.BorderStyle.None;
            this.txtDisplayPeakFreq.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtDisplayPeakFreq, "txtDisplayPeakFreq");
            this.txtDisplayPeakFreq.ForeColor = System.Drawing.Color.DodgerBlue;
            this.txtDisplayPeakFreq.Name = "txtDisplayPeakFreq";
            this.txtDisplayPeakFreq.ReadOnly = true;
            // 
            // lblDisplayPan
            // 
            this.lblDisplayPan.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblDisplayPan, "lblDisplayPan");
            this.lblDisplayPan.Name = "lblDisplayPan";
            // 
            // panelMode
            // 
            resources.ApplyResources(this.panelMode, "panelMode");
            this.panelMode.BackColor = System.Drawing.Color.Transparent;
            this.panelMode.Controls.Add(this.radModeAM);
            this.panelMode.Controls.Add(this.radModeLSB);
            this.panelMode.Controls.Add(this.radModeSAM);
            this.panelMode.Controls.Add(this.radModeCWL);
            this.panelMode.Controls.Add(this.radModeDSB);
            this.panelMode.Controls.Add(this.radModeUSB);
            this.panelMode.Controls.Add(this.radModeCWU);
            this.panelMode.Controls.Add(this.radModeFMN);
            this.panelMode.Controls.Add(this.radModeDIGU);
            this.panelMode.Controls.Add(this.radModeDRM);
            this.panelMode.Controls.Add(this.radModeDIGL);
            this.panelMode.Controls.Add(this.radModeSPEC);
            this.panelMode.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.panelMode.Name = "panelMode";
            // 
            // panelBandHF
            // 
            resources.ApplyResources(this.panelBandHF, "panelBandHF");
            this.panelBandHF.BackColor = System.Drawing.Color.Transparent;
            this.panelBandHF.Controls.Add(this.radBandGEN);
            this.panelBandHF.Controls.Add(this.radBandWWV);
            this.panelBandHF.Controls.Add(this.radBand2);
            this.panelBandHF.Controls.Add(this.radBand6);
            this.panelBandHF.Controls.Add(this.radBand10);
            this.panelBandHF.Controls.Add(this.radBand12);
            this.panelBandHF.Controls.Add(this.radBand15);
            this.panelBandHF.Controls.Add(this.radBand17);
            this.panelBandHF.Controls.Add(this.radBand20);
            this.panelBandHF.Controls.Add(this.radBand30);
            this.panelBandHF.Controls.Add(this.radBand40);
            this.panelBandHF.Controls.Add(this.radBand60);
            this.panelBandHF.Controls.Add(this.radBand160);
            this.panelBandHF.Controls.Add(this.radBand80);
            this.panelBandHF.Controls.Add(this.btnBandVHF);
            this.panelBandHF.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            this.panelBandHF.Name = "panelBandHF";
            // 
            // txtVFOAFreq
            // 
            this.txtVFOAFreq.BackColor = System.Drawing.Color.Black;
            this.txtVFOAFreq.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtVFOAFreq, "txtVFOAFreq");
            this.txtVFOAFreq.ForeColor = System.Drawing.Color.Olive;
            this.txtVFOAFreq.Name = "txtVFOAFreq";
            this.txtVFOAFreq.KeyPress += new System.Windows.Forms.KeyPressEventHandler(this.txtVFOAFreq_KeyPress);
            this.txtVFOAFreq.LostFocus += new System.EventHandler(this.txtVFOAFreq_LostFocus);
            this.txtVFOAFreq.MouseLeave += new System.EventHandler(this.txtVFOAFreq_MouseLeave);
            this.txtVFOAFreq.MouseMove += new System.Windows.Forms.MouseEventHandler(this.txtVFOAFreq_MouseMove);
            // 
            // grpVFOA
            // 
            this.grpVFOA.BackColor = System.Drawing.Color.Transparent;
            this.grpVFOA.Controls.Add(this.lblModeLabel);
            this.grpVFOA.Controls.Add(this.lblFilterLabel);
            this.grpVFOA.Controls.Add(this.chkVFOATX);
            this.grpVFOA.Controls.Add(this.panelVFOASubHover);
            this.grpVFOA.Controls.Add(this.panelVFOAHover);
            this.grpVFOA.Controls.Add(this.txtVFOALSD);
            this.grpVFOA.Controls.Add(this.txtVFOABand);
            this.grpVFOA.Controls.Add(this.txtVFOAMSD);
            this.grpVFOA.Controls.Add(this.txtVFOAFreq);
            this.grpVFOA.Controls.Add(this.btnHidden);
            resources.ApplyResources(this.grpVFOA, "grpVFOA");
            this.grpVFOA.ForeColor = System.Drawing.Color.Red;
            this.grpVFOA.Name = "grpVFOA";
            this.grpVFOA.TabStop = false;
            // 
            // lblModeLabel
            // 
            resources.ApplyResources(this.lblModeLabel, "lblModeLabel");
            this.lblModeLabel.BackColor = System.Drawing.Color.Black;
            this.lblModeLabel.ForeColor = System.Drawing.Color.DarkOrange;
            this.lblModeLabel.Name = "lblModeLabel";
            // 
            // lblFilterLabel
            // 
            resources.ApplyResources(this.lblFilterLabel, "lblFilterLabel");
            this.lblFilterLabel.BackColor = System.Drawing.Color.Black;
            this.lblFilterLabel.ForeColor = System.Drawing.Color.DarkOrange;
            this.lblFilterLabel.Name = "lblFilterLabel";
            // 
            // panelVFOASubHover
            // 
            this.panelVFOASubHover.BackColor = System.Drawing.Color.Black;
            this.panelVFOASubHover.ForeColor = System.Drawing.Color.Black;
            resources.ApplyResources(this.panelVFOASubHover, "panelVFOASubHover");
            this.panelVFOASubHover.Name = "panelVFOASubHover";
            this.panelVFOASubHover.Paint += new System.Windows.Forms.PaintEventHandler(this.panelVFOASubHover_Paint);
            this.panelVFOASubHover.MouseMove += new System.Windows.Forms.MouseEventHandler(this.panelVFOASubHover_MouseMove);
            // 
            // panelVFOAHover
            // 
            this.panelVFOAHover.BackColor = System.Drawing.Color.Black;
            resources.ApplyResources(this.panelVFOAHover, "panelVFOAHover");
            this.panelVFOAHover.Name = "panelVFOAHover";
            this.panelVFOAHover.Paint += new System.Windows.Forms.PaintEventHandler(this.panelVFOAHover_Paint);
            this.panelVFOAHover.MouseMove += new System.Windows.Forms.MouseEventHandler(this.panelVFOAHover_MouseMove);
            // 
            // txtVFOALSD
            // 
            this.txtVFOALSD.BackColor = System.Drawing.Color.Black;
            this.txtVFOALSD.BorderStyle = System.Windows.Forms.BorderStyle.None;
            this.txtVFOALSD.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtVFOALSD, "txtVFOALSD");
            this.txtVFOALSD.ForeColor = System.Drawing.Color.Olive;
            this.txtVFOALSD.Name = "txtVFOALSD";
            this.txtVFOALSD.MouseDown += new System.Windows.Forms.MouseEventHandler(this.txtVFOALSD_MouseDown);
            this.txtVFOALSD.MouseMove += new System.Windows.Forms.MouseEventHandler(this.txtVFOALSD_MouseMove);
            // 
            // txtVFOABand
            // 
            this.txtVFOABand.BackColor = System.Drawing.Color.Black;
            resources.ApplyResources(this.txtVFOABand, "txtVFOABand");
            this.txtVFOABand.ForeColor = System.Drawing.Color.Green;
            this.txtVFOABand.Name = "txtVFOABand";
            this.txtVFOABand.ReadOnly = true;
            this.txtVFOABand.KeyPress += new System.Windows.Forms.KeyPressEventHandler(this.txtVFOABand_KeyPress);
            this.txtVFOABand.LostFocus += new System.EventHandler(this.txtVFOABand_LostFocus);
            this.txtVFOABand.MouseLeave += new System.EventHandler(this.txtVFOABand_MouseLeave);
            this.txtVFOABand.MouseMove += new System.Windows.Forms.MouseEventHandler(this.txtVFOABand_MouseMove);
            // 
            // txtVFOAMSD
            // 
            this.txtVFOAMSD.BackColor = System.Drawing.Color.Black;
            this.txtVFOAMSD.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtVFOAMSD, "txtVFOAMSD");
            this.txtVFOAMSD.ForeColor = System.Drawing.Color.Olive;
            this.txtVFOAMSD.Name = "txtVFOAMSD";
            this.txtVFOAMSD.ShortcutsEnabled = false;
            this.txtVFOAMSD.MouseDown += new System.Windows.Forms.MouseEventHandler(this.txtVFOAMSD_MouseDown);
            this.txtVFOAMSD.MouseLeave += new System.EventHandler(this.txtVFOAMSD_MouseLeave);
            this.txtVFOAMSD.MouseMove += new System.Windows.Forms.MouseEventHandler(this.txtVFOAMSD_MouseMove);
            // 
            // btnHidden
            // 
            resources.ApplyResources(this.btnHidden, "btnHidden");
            this.btnHidden.Name = "btnHidden";
            // 
            // grpVFOB
            // 
            this.grpVFOB.BackColor = System.Drawing.Color.Transparent;
            this.grpVFOB.Controls.Add(this.chkVFOBTX);
            this.grpVFOB.Controls.Add(this.txtVFOBLSD);
            this.grpVFOB.Controls.Add(this.panelVFOBHover);
            this.grpVFOB.Controls.Add(this.txtVFOBMSD);
            this.grpVFOB.Controls.Add(this.lblVFOBLSD);
            this.grpVFOB.Controls.Add(this.txtVFOBBand);
            this.grpVFOB.Controls.Add(this.txtVFOBFreq);
            resources.ApplyResources(this.grpVFOB, "grpVFOB");
            this.grpVFOB.ForeColor = System.Drawing.Color.White;
            this.grpVFOB.Name = "grpVFOB";
            this.grpVFOB.TabStop = false;
            // 
            // txtVFOBLSD
            // 
            this.txtVFOBLSD.BackColor = System.Drawing.Color.Black;
            this.txtVFOBLSD.BorderStyle = System.Windows.Forms.BorderStyle.None;
            this.txtVFOBLSD.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtVFOBLSD, "txtVFOBLSD");
            this.txtVFOBLSD.ForeColor = System.Drawing.Color.Olive;
            this.txtVFOBLSD.Name = "txtVFOBLSD";
            this.txtVFOBLSD.MouseDown += new System.Windows.Forms.MouseEventHandler(this.txtVFOBLSD_MouseDown);
            this.txtVFOBLSD.MouseMove += new System.Windows.Forms.MouseEventHandler(this.txtVFOBLSD_MouseMove);
            // 
            // panelVFOBHover
            // 
            this.panelVFOBHover.BackColor = System.Drawing.Color.Black;
            resources.ApplyResources(this.panelVFOBHover, "panelVFOBHover");
            this.panelVFOBHover.Name = "panelVFOBHover";
            this.panelVFOBHover.Paint += new System.Windows.Forms.PaintEventHandler(this.panelVFOBHover_Paint);
            this.panelVFOBHover.MouseMove += new System.Windows.Forms.MouseEventHandler(this.panelVFOBHover_MouseMove);
            // 
            // txtVFOBMSD
            // 
            this.txtVFOBMSD.BackColor = System.Drawing.Color.Black;
            this.txtVFOBMSD.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtVFOBMSD, "txtVFOBMSD");
            this.txtVFOBMSD.ForeColor = System.Drawing.Color.Olive;
            this.txtVFOBMSD.Name = "txtVFOBMSD";
            this.txtVFOBMSD.MouseDown += new System.Windows.Forms.MouseEventHandler(this.txtVFOBMSD_MouseDown);
            this.txtVFOBMSD.MouseLeave += new System.EventHandler(this.txtVFOBMSD_MouseLeave);
            this.txtVFOBMSD.MouseMove += new System.Windows.Forms.MouseEventHandler(this.txtVFOBMSD_MouseMove);
            // 
            // lblVFOBLSD
            // 
            this.lblVFOBLSD.BackColor = System.Drawing.Color.Cyan;
            resources.ApplyResources(this.lblVFOBLSD, "lblVFOBLSD");
            this.lblVFOBLSD.ForeColor = System.Drawing.Color.OrangeRed;
            this.lblVFOBLSD.Name = "lblVFOBLSD";
            // 
            // txtVFOBBand
            // 
            this.txtVFOBBand.BackColor = System.Drawing.Color.Black;
            resources.ApplyResources(this.txtVFOBBand, "txtVFOBBand");
            this.txtVFOBBand.ForeColor = System.Drawing.Color.Green;
            this.txtVFOBBand.Name = "txtVFOBBand";
            this.txtVFOBBand.ReadOnly = true;
            this.txtVFOBBand.GotFocus += new System.EventHandler(this.HideFocus);
            // 
            // txtVFOBFreq
            // 
            this.txtVFOBFreq.BackColor = System.Drawing.Color.Black;
            this.txtVFOBFreq.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtVFOBFreq, "txtVFOBFreq");
            this.txtVFOBFreq.ForeColor = System.Drawing.Color.Olive;
            this.txtVFOBFreq.Name = "txtVFOBFreq";
            this.txtVFOBFreq.KeyPress += new System.Windows.Forms.KeyPressEventHandler(this.txtVFOBFreq_KeyPress);
            this.txtVFOBFreq.LostFocus += new System.EventHandler(this.txtVFOBFreq_LostFocus);
            this.txtVFOBFreq.MouseLeave += new System.EventHandler(this.txtVFOBFreq_MouseLeave);
            this.txtVFOBFreq.MouseMove += new System.Windows.Forms.MouseEventHandler(this.txtVFOBFreq_MouseMove);
            // 
            // btnBandHF
            // 
            this.btnBandHF.FlatAppearance.BorderSize = 0;
            resources.ApplyResources(this.btnBandHF, "btnBandHF");
            this.btnBandHF.ForeColor = System.Drawing.Color.White;
            this.btnBandHF.Name = "btnBandHF";
            this.btnBandHF.Click += new System.EventHandler(this.btnBandHF_Click);
            // 
            // grpMultimeter
            // 
            this.grpMultimeter.BackColor = System.Drawing.Color.Transparent;
            this.grpMultimeter.Controls.Add(this.comboMeterTXMode);
            this.grpMultimeter.Controls.Add(this.comboMeterRXMode);
            this.grpMultimeter.Controls.Add(this.txtMultiText);
            this.grpMultimeter.Controls.Add(this.picMultiMeterDigital);
            this.grpMultimeter.Controls.Add(this.lblMultiSMeter);
            this.grpMultimeter.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.grpMultimeter, "grpMultimeter");
            this.grpMultimeter.Name = "grpMultimeter";
            this.grpMultimeter.TabStop = false;
            // 
            // txtMultiText
            // 
            this.txtMultiText.BackColor = System.Drawing.Color.Black;
            this.txtMultiText.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtMultiText, "txtMultiText");
            this.txtMultiText.ForeColor = System.Drawing.Color.Yellow;
            this.txtMultiText.Name = "txtMultiText";
            this.txtMultiText.ReadOnly = true;
            this.txtMultiText.GotFocus += new System.EventHandler(this.HideFocus);
            // 
            // picMultiMeterDigital
            // 
            this.picMultiMeterDigital.BackColor = System.Drawing.Color.Black;
            this.picMultiMeterDigital.BorderStyle = System.Windows.Forms.BorderStyle.Fixed3D;
            resources.ApplyResources(this.picMultiMeterDigital, "picMultiMeterDigital");
            this.picMultiMeterDigital.Name = "picMultiMeterDigital";
            this.picMultiMeterDigital.TabStop = false;
            this.picMultiMeterDigital.Paint += new System.Windows.Forms.PaintEventHandler(this.picMultiMeterDigital_Paint);
            // 
            // lblMultiSMeter
            // 
            this.lblMultiSMeter.BackColor = System.Drawing.Color.Transparent;
            this.lblMultiSMeter.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.lblMultiSMeter, "lblMultiSMeter");
            this.lblMultiSMeter.Name = "lblMultiSMeter";
            // 
            // lblTuneStep
            // 
            this.lblTuneStep.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.lblTuneStep, "lblTuneStep");
            this.lblTuneStep.Name = "lblTuneStep";
            // 
            // grpVFOBetween
            // 
            this.grpVFOBetween.BackColor = System.Drawing.Color.Transparent;
            this.grpVFOBetween.Controls.Add(this.chkVFOSync);
            this.grpVFOBetween.Controls.Add(this.lblTuneStep);
            this.grpVFOBetween.Controls.Add(this.chkFullDuplex);
            this.grpVFOBetween.Controls.Add(this.btnTuneStepChangeLarger);
            this.grpVFOBetween.Controls.Add(this.btnTuneStepChangeSmaller);
            this.grpVFOBetween.Controls.Add(this.chkVFOLock);
            this.grpVFOBetween.Controls.Add(this.txtWheelTune);
            this.grpVFOBetween.Controls.Add(this.btnMemoryQuickRestore);
            this.grpVFOBetween.Controls.Add(this.btnMemoryQuickSave);
            this.grpVFOBetween.Controls.Add(this.txtMemoryQuick);
            resources.ApplyResources(this.grpVFOBetween, "grpVFOBetween");
            this.grpVFOBetween.Name = "grpVFOBetween";
            this.grpVFOBetween.TabStop = false;
            // 
            // lblDisplayModeTop
            // 
            resources.ApplyResources(this.lblDisplayModeTop, "lblDisplayModeTop");
            this.lblDisplayModeTop.Name = "lblDisplayModeTop";
            // 
            // lblDisplayModeBottom
            // 
            resources.ApplyResources(this.lblDisplayModeBottom, "lblDisplayModeBottom");
            this.lblDisplayModeBottom.Name = "lblDisplayModeBottom";
            // 
            // grpDisplaySplit
            // 
            this.grpDisplaySplit.Controls.Add(this.chkSplitDisplay);
            this.grpDisplaySplit.Controls.Add(this.comboDisplayModeTop);
            this.grpDisplaySplit.Controls.Add(this.comboDisplayModeBottom);
            this.grpDisplaySplit.Controls.Add(this.lblDisplayModeTop);
            this.grpDisplaySplit.Controls.Add(this.lblDisplayModeBottom);
            resources.ApplyResources(this.grpDisplaySplit, "grpDisplaySplit");
            this.grpDisplaySplit.Name = "grpDisplaySplit";
            this.grpDisplaySplit.TabStop = false;
            // 
            // chkRX2
            // 
            resources.ApplyResources(this.chkRX2, "chkRX2");
            this.chkRX2.FlatAppearance.BorderSize = 0;
            this.chkRX2.Name = "chkRX2";
            this.chkRX2.CheckedChanged += new System.EventHandler(this.chkRX2_CheckedChanged);
            // 
            // grpRX2Meter
            // 
            this.grpRX2Meter.BackColor = System.Drawing.Color.Transparent;
            this.grpRX2Meter.Controls.Add(this.picRX2Meter);
            this.grpRX2Meter.Controls.Add(this.lblRX2Meter);
            this.grpRX2Meter.Controls.Add(this.comboRX2MeterMode);
            this.grpRX2Meter.Controls.Add(this.txtRX2Meter);
            this.grpRX2Meter.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.grpRX2Meter, "grpRX2Meter");
            this.grpRX2Meter.Name = "grpRX2Meter";
            this.grpRX2Meter.TabStop = false;
            // 
            // picRX2Meter
            // 
            this.picRX2Meter.BackColor = System.Drawing.Color.Black;
            this.picRX2Meter.BorderStyle = System.Windows.Forms.BorderStyle.Fixed3D;
            resources.ApplyResources(this.picRX2Meter, "picRX2Meter");
            this.picRX2Meter.Name = "picRX2Meter";
            this.picRX2Meter.TabStop = false;
            this.picRX2Meter.Paint += new System.Windows.Forms.PaintEventHandler(this.picRX2Meter_Paint);
            // 
            // lblRX2Meter
            // 
            resources.ApplyResources(this.lblRX2Meter, "lblRX2Meter");
            this.lblRX2Meter.Name = "lblRX2Meter";
            // 
            // txtRX2Meter
            // 
            this.txtRX2Meter.BackColor = System.Drawing.Color.Black;
            this.txtRX2Meter.Cursor = System.Windows.Forms.Cursors.Default;
            resources.ApplyResources(this.txtRX2Meter, "txtRX2Meter");
            this.txtRX2Meter.ForeColor = System.Drawing.Color.Yellow;
            this.txtRX2Meter.Name = "txtRX2Meter";
            this.txtRX2Meter.ReadOnly = true;
            // 
            // lblRX2Band
            // 
            this.lblRX2Band.BackColor = System.Drawing.Color.Transparent;
            this.lblRX2Band.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.lblRX2Band, "lblRX2Band");
            this.lblRX2Band.Name = "lblRX2Band";
            // 
            // panelBandVHF
            // 
            resources.ApplyResources(this.panelBandVHF, "panelBandVHF");
            this.panelBandVHF.Controls.Add(this.radBandVHF13);
            this.panelBandVHF.Controls.Add(this.radBandVHF12);
            this.panelBandVHF.Controls.Add(this.radBandVHF11);
            this.panelBandVHF.Controls.Add(this.radBandVHF10);
            this.panelBandVHF.Controls.Add(this.radBandVHF9);
            this.panelBandVHF.Controls.Add(this.radBandVHF8);
            this.panelBandVHF.Controls.Add(this.radBandVHF7);
            this.panelBandVHF.Controls.Add(this.radBandVHF6);
            this.panelBandVHF.Controls.Add(this.radBandVHF5);
            this.panelBandVHF.Controls.Add(this.radBandVHF4);
            this.panelBandVHF.Controls.Add(this.radBandVHF3);
            this.panelBandVHF.Controls.Add(this.radBandVHF2);
            this.panelBandVHF.Controls.Add(this.radBandVHF1);
            this.panelBandVHF.Controls.Add(this.radBandVHF0);
            this.panelBandVHF.Controls.Add(this.btnBandHF);
            this.panelBandVHF.Name = "panelBandVHF";
            // 
            // radBandVHF13
            // 
            resources.ApplyResources(this.radBandVHF13, "radBandVHF13");
            this.radBandVHF13.FlatAppearance.BorderSize = 0;
            this.radBandVHF13.ForeColor = System.Drawing.Color.White;
            this.radBandVHF13.Name = "radBandVHF13";
            this.radBandVHF13.TabStop = true;
            this.radBandVHF13.UseVisualStyleBackColor = true;
            this.radBandVHF13.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF12
            // 
            resources.ApplyResources(this.radBandVHF12, "radBandVHF12");
            this.radBandVHF12.FlatAppearance.BorderSize = 0;
            this.radBandVHF12.ForeColor = System.Drawing.Color.White;
            this.radBandVHF12.Name = "radBandVHF12";
            this.radBandVHF12.TabStop = true;
            this.radBandVHF12.UseVisualStyleBackColor = true;
            this.radBandVHF12.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF11
            // 
            resources.ApplyResources(this.radBandVHF11, "radBandVHF11");
            this.radBandVHF11.FlatAppearance.BorderSize = 0;
            this.radBandVHF11.ForeColor = System.Drawing.Color.White;
            this.radBandVHF11.Name = "radBandVHF11";
            this.radBandVHF11.TabStop = true;
            this.radBandVHF11.UseVisualStyleBackColor = true;
            this.radBandVHF11.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF10
            // 
            resources.ApplyResources(this.radBandVHF10, "radBandVHF10");
            this.radBandVHF10.FlatAppearance.BorderSize = 0;
            this.radBandVHF10.ForeColor = System.Drawing.Color.White;
            this.radBandVHF10.Name = "radBandVHF10";
            this.radBandVHF10.TabStop = true;
            this.radBandVHF10.UseVisualStyleBackColor = true;
            this.radBandVHF10.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF9
            // 
            resources.ApplyResources(this.radBandVHF9, "radBandVHF9");
            this.radBandVHF9.FlatAppearance.BorderSize = 0;
            this.radBandVHF9.ForeColor = System.Drawing.Color.White;
            this.radBandVHF9.Name = "radBandVHF9";
            this.radBandVHF9.TabStop = true;
            this.radBandVHF9.UseVisualStyleBackColor = true;
            this.radBandVHF9.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF8
            // 
            resources.ApplyResources(this.radBandVHF8, "radBandVHF8");
            this.radBandVHF8.FlatAppearance.BorderSize = 0;
            this.radBandVHF8.ForeColor = System.Drawing.Color.White;
            this.radBandVHF8.Name = "radBandVHF8";
            this.radBandVHF8.TabStop = true;
            this.radBandVHF8.UseVisualStyleBackColor = true;
            this.radBandVHF8.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF7
            // 
            resources.ApplyResources(this.radBandVHF7, "radBandVHF7");
            this.radBandVHF7.FlatAppearance.BorderSize = 0;
            this.radBandVHF7.ForeColor = System.Drawing.Color.White;
            this.radBandVHF7.Name = "radBandVHF7";
            this.radBandVHF7.TabStop = true;
            this.radBandVHF7.UseVisualStyleBackColor = true;
            this.radBandVHF7.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF6
            // 
            resources.ApplyResources(this.radBandVHF6, "radBandVHF6");
            this.radBandVHF6.FlatAppearance.BorderSize = 0;
            this.radBandVHF6.ForeColor = System.Drawing.Color.White;
            this.radBandVHF6.Name = "radBandVHF6";
            this.radBandVHF6.TabStop = true;
            this.radBandVHF6.UseVisualStyleBackColor = true;
            this.radBandVHF6.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF5
            // 
            resources.ApplyResources(this.radBandVHF5, "radBandVHF5");
            this.radBandVHF5.FlatAppearance.BorderSize = 0;
            this.radBandVHF5.ForeColor = System.Drawing.Color.White;
            this.radBandVHF5.Name = "radBandVHF5";
            this.radBandVHF5.TabStop = true;
            this.radBandVHF5.UseVisualStyleBackColor = true;
            this.radBandVHF5.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF4
            // 
            resources.ApplyResources(this.radBandVHF4, "radBandVHF4");
            this.radBandVHF4.FlatAppearance.BorderSize = 0;
            this.radBandVHF4.ForeColor = System.Drawing.Color.White;
            this.radBandVHF4.Name = "radBandVHF4";
            this.radBandVHF4.TabStop = true;
            this.radBandVHF4.UseVisualStyleBackColor = true;
            this.radBandVHF4.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF3
            // 
            resources.ApplyResources(this.radBandVHF3, "radBandVHF3");
            this.radBandVHF3.FlatAppearance.BorderSize = 0;
            this.radBandVHF3.ForeColor = System.Drawing.Color.White;
            this.radBandVHF3.Name = "radBandVHF3";
            this.radBandVHF3.TabStop = true;
            this.radBandVHF3.UseVisualStyleBackColor = true;
            this.radBandVHF3.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF2
            // 
            resources.ApplyResources(this.radBandVHF2, "radBandVHF2");
            this.radBandVHF2.FlatAppearance.BorderSize = 0;
            this.radBandVHF2.ForeColor = System.Drawing.Color.White;
            this.radBandVHF2.Name = "radBandVHF2";
            this.radBandVHF2.TabStop = true;
            this.radBandVHF2.UseVisualStyleBackColor = true;
            this.radBandVHF2.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF1
            // 
            resources.ApplyResources(this.radBandVHF1, "radBandVHF1");
            this.radBandVHF1.FlatAppearance.BorderSize = 0;
            this.radBandVHF1.ForeColor = System.Drawing.Color.White;
            this.radBandVHF1.Name = "radBandVHF1";
            this.radBandVHF1.TabStop = true;
            this.radBandVHF1.UseVisualStyleBackColor = true;
            this.radBandVHF1.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // radBandVHF0
            // 
            resources.ApplyResources(this.radBandVHF0, "radBandVHF0");
            this.radBandVHF0.FlatAppearance.BorderSize = 0;
            this.radBandVHF0.ForeColor = System.Drawing.Color.White;
            this.radBandVHF0.Name = "radBandVHF0";
            this.radBandVHF0.TabStop = true;
            this.radBandVHF0.UseVisualStyleBackColor = true;
            this.radBandVHF0.Click += new System.EventHandler(this.radBandVHF_Click);
            // 
            // panelRX2DSP
            // 
            resources.ApplyResources(this.panelRX2DSP, "panelRX2DSP");
            this.panelRX2DSP.BackColor = System.Drawing.Color.Transparent;
            this.panelRX2DSP.Controls.Add(this.chkRX2NB2);
            this.panelRX2DSP.Controls.Add(this.chkRX2NR);
            this.panelRX2DSP.Controls.Add(this.chkRX2NB);
            this.panelRX2DSP.Controls.Add(this.lblRX2AGC);
            this.panelRX2DSP.Controls.Add(this.chkRX2ANF);
            this.panelRX2DSP.Controls.Add(this.comboRX2AGC);
            this.panelRX2DSP.Controls.Add(this.chkRX2SR);
            this.panelRX2DSP.Controls.Add(this.chkRX2BIN);
            this.panelRX2DSP.Name = "panelRX2DSP";
            // 
            // ptbSquelch
            // 
            resources.ApplyResources(this.ptbSquelch, "ptbSquelch");
            this.ptbSquelch.HeadImage = null;
            this.ptbSquelch.LargeChange = 1;
            this.ptbSquelch.Maximum = 0;
            this.ptbSquelch.Minimum = -160;
            this.ptbSquelch.Name = "ptbSquelch";
            this.ptbSquelch.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbSquelch.SmallChange = 1;
            this.ptbSquelch.TabStop = false;
            this.ptbSquelch.Value = -150;
            this.ptbSquelch.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbSquelch_Scroll);
            // 
            // panelModeSpecificFM
            // 
            resources.ApplyResources(this.panelModeSpecificFM, "panelModeSpecificFM");
            this.panelModeSpecificFM.Controls.Add(this.ptbFMMic);
            this.panelModeSpecificFM.Controls.Add(this.chkFMTXRev);
            this.panelModeSpecificFM.Controls.Add(this.chkFMTXHigh);
            this.panelModeSpecificFM.Controls.Add(this.chkFMTXLow);
            this.panelModeSpecificFM.Controls.Add(this.lblMicValFM);
            this.panelModeSpecificFM.Controls.Add(this.radFMDeviation2kHz);
            this.panelModeSpecificFM.Controls.Add(this.labelTS7);
            this.panelModeSpecificFM.Controls.Add(this.lblFMOffset);
            this.panelModeSpecificFM.Controls.Add(this.btnFMMemoryDown);
            this.panelModeSpecificFM.Controls.Add(this.btnFMMemoryUp);
            this.panelModeSpecificFM.Controls.Add(this.btnFMMemory);
            this.panelModeSpecificFM.Controls.Add(this.lblFMDeviation);
            this.panelModeSpecificFM.Controls.Add(this.chkFMCTCSS);
            this.panelModeSpecificFM.Controls.Add(this.chkFMVAC);
            this.panelModeSpecificFM.Controls.Add(this.comboFMCTCSS);
            this.panelModeSpecificFM.Controls.Add(this.comboFMMemory);
            this.panelModeSpecificFM.Controls.Add(this.chkFMTXSimplex);
            this.panelModeSpecificFM.Controls.Add(this.udFMOffset);
            this.panelModeSpecificFM.Controls.Add(this.comboFMTXProfile);
            this.panelModeSpecificFM.Controls.Add(this.radFMDeviation5kHz);
            this.panelModeSpecificFM.Controls.Add(this.lblFMMic);
            this.panelModeSpecificFM.Name = "panelModeSpecificFM";
            this.panelModeSpecificFM.Paint += new System.Windows.Forms.PaintEventHandler(this.panelModeSpecificFM_Paint);
            // 
            // ptbFMMic
            // 
            resources.ApplyResources(this.ptbFMMic, "ptbFMMic");
            this.ptbFMMic.HeadImage = null;
            this.ptbFMMic.LargeChange = 1;
            this.ptbFMMic.Maximum = 70;
            this.ptbFMMic.Minimum = -96;
            this.ptbFMMic.Name = "ptbFMMic";
            this.ptbFMMic.Orientation = System.Windows.Forms.Orientation.Horizontal;
            this.ptbFMMic.SmallChange = 1;
            this.ptbFMMic.TabStop = false;
            this.ptbFMMic.Value = 6;
            this.ptbFMMic.Scroll += new PowerSDR.PrettyTrackBar.ScrollHandler(this.ptbFMMic_Scroll);
            // 
            // lblMicValFM
            // 
            this.lblMicValFM.BackColor = System.Drawing.Color.Transparent;
            resources.ApplyResources(this.lblMicValFM, "lblMicValFM");
            this.lblMicValFM.ForeColor = System.Drawing.Color.White;
            this.lblMicValFM.Name = "lblMicValFM";
            // 
            // labelTS7
            // 
            this.labelTS7.BackColor = System.Drawing.Color.Transparent;
            this.labelTS7.ForeColor = System.Drawing.Color.White;
            resources.ApplyResources(this.labelTS7, "labelTS7");
            this.labelTS7.Name = "labelTS7";
            // 
            // lblFMOffset
            // 
            this.lblFMOffset.BackColor = System.Drawing.Color.Transparent;
            resources.ApplyResources(this.lblFMOffset, "lblFMOffset");
            this.lblFMOffset.ForeColor = System.Drawing.Color.White;
            this.lblFMOffset.Name = "lblFMOffset";
            // 
            // lblFMDeviation
            // 
            this.lblFMDeviation.BackColor = System.Drawing.Color.Transparent;
            resources.ApplyResources(this.lblFMDeviation, "lblFMDeviation");
            this.lblFMDeviation.ForeColor = System.Drawing.Color.White;
            this.lblFMDeviation.Name = "lblFMDeviation";
            // 
            // comboFMMemory
            // 
            this.comboFMMemory.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(46)))), ((int)(((byte)(46)))), ((int)(((byte)(46)))));
            this.comboFMMemory.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList;
            this.comboFMMemory.DropDownWidth = 96;
            this.comboFMMemory.ForeColor = System.Drawing.SystemColors.ControlLightLight;
            resources.ApplyResources(this.comboFMMemory, "comboFMMemory");
            this.comboFMMemory.Name = "comboFMMemory";
            this.comboFMMemory.SelectedIndexChanged += new System.EventHandler(this.comboFMMemory_SelectedIndexChanged);
            // 
            // lblFMMic
            // 
            this.lblFMMic.BackColor = System.Drawing.Color.Transparent;
            resources.ApplyResources(this.lblFMMic, "lblFMMic");
            this.lblFMMic.ForeColor = System.Drawing.Color.White;
            this.lblFMMic.Name = "lblFMMic";
            // 
            // Console
            // 
            resources.ApplyResources(this, "$this");
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Dpi;
            this.BackColor = System.Drawing.SystemColors.Control;
            this.Controls.Add(this.menuStrip1);
            this.Controls.Add(this.lblRF2);
            this.Controls.Add(this.picRX2Squelch);
            this.Controls.Add(this.ptbRX2Squelch);
            this.Controls.Add(this.ptbRX2RF);
            this.Controls.Add(this.panelOptions);
            this.Controls.Add(this.panelRX2Filter);
            this.Controls.Add(this.panelRX2Mode);
            this.Controls.Add(this.panelRX2Display);
            this.Controls.Add(this.panelRX2DSP);
            this.Controls.Add(this.panelRX2Mixer);
            this.Controls.Add(this.panelMultiRX);
            this.Controls.Add(this.lblAF2);
            this.Controls.Add(this.panelDisplay2);
            this.Controls.Add(this.panelDSP);
            this.Controls.Add(this.panelVFO);
            this.Controls.Add(this.panelDateTime);
            this.Controls.Add(this.panelSoundControls);
            this.Controls.Add(this.comboRX2Band);
            this.Controls.Add(this.lblRX2Band);
            this.Controls.Add(this.chkRX2Preamp);
            this.Controls.Add(this.chkRX2Squelch);
            this.Controls.Add(this.lblRX2RF);
            this.Controls.Add(this.grpRX2Meter);
            this.Controls.Add(this.grpDisplaySplit);
            this.Controls.Add(this.picSquelch);
            this.Controls.Add(this.grpVFOBetween);
            this.Controls.Add(this.grpMultimeter);
            this.Controls.Add(this.grpVFOA);
            this.Controls.Add(this.grpVFOB);
            this.Controls.Add(this.chkSquelch);
            this.Controls.Add(this.chkRX2);
            this.Controls.Add(this.panelDisplay);
            this.Controls.Add(this.ptbSquelch);
            this.Controls.Add(this.panelFilter);
            this.Controls.Add(this.panelPower);
            this.Controls.Add(this.panelMode);
            this.Controls.Add(this.panelBandHF);
            this.Controls.Add(this.panelBandVHF);
            this.Controls.Add(this.panelModeSpecificCW);
            this.Controls.Add(this.panelModeSpecificPhone);
            this.Controls.Add(this.panelModeSpecificFM);
            this.Controls.Add(this.panelModeSpecificDigital);
            this.KeyPreview = true;
            this.Name = "Console";
            this.Closing += new System.ComponentModel.CancelEventHandler(this.Console_Closing);
            this.KeyDown += new System.Windows.Forms.KeyEventHandler(this.Console_KeyDown);
            this.KeyPress += new System.Windows.Forms.KeyPressEventHandler(this.Console_KeyPress);
            this.KeyUp += new System.Windows.Forms.KeyEventHandler(this.Console_KeyUp);
            this.MouseWheel += new System.Windows.Forms.MouseEventHandler(this.Console_MouseWheel);
            this.Resize += new System.EventHandler(this.Console_Resize);
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX2RF)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbFilterShift)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbFilterWidth)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.udFilterHigh)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.udFilterLow)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbCWSpeed)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.udCWPitch)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.udCWBreakInDelay)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.udRX2FilterHigh)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.udRX2FilterLow)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.udRIT)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.udXIT)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbDisplayZoom)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbDisplayPan)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbPWR)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRF)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbAF)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbPanMainRX)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbPanSubRX)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX2Gain)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX2Pan)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX0Gain)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX1Gain)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbVACRXGain)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbVACTXGain)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.udFMOffset)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.picSquelch)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.picRX2Squelch)).EndInit();
            this.contextMenuStripFilterRX1.ResumeLayout(false);
            this.contextMenuStripFilterRX2.ResumeLayout(false);
            this.contextMenuStripNotch.ResumeLayout(false);
            this.menuStrip1.ResumeLayout(false);
            this.menuStrip1.PerformLayout();
            ((System.ComponentModel.ISupportInitialize)(this.ptbRX2Squelch)).EndInit();
            this.panelOptions.ResumeLayout(false);
            this.panelPower.ResumeLayout(false);
            this.panelFilter.ResumeLayout(false);
            this.panelModeSpecificCW.ResumeLayout(false);
            this.grpSemiBreakIn.ResumeLayout(false);
            this.panelAntenna.ResumeLayout(false);
            this.panelRX2Filter.ResumeLayout(false);
            this.panelRX2Mode.ResumeLayout(false);
            this.panelRX2Display.ResumeLayout(false);
            this.panelRX2Mixer.ResumeLayout(false);
            this.panelMultiRX.ResumeLayout(false);
            this.panelDisplay2.ResumeLayout(false);
            this.panelDSP.ResumeLayout(false);
            this.panelVFO.ResumeLayout(false);
            this.panelDateTime.ResumeLayout(false);
            this.panelDateTime.PerformLayout();
            this.panelSoundControls.ResumeLayout(false);
            this.panelModeSpecificPhone.ResumeLayout(false);
            ((System.ComponentModel.ISupportInitialize)(this.picNoiseGate)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbNoiseGate)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.picVOX)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbVOX)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbCPDR)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbDX)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.ptbMic)).EndInit();
            this.panelModeSpecificDigital.ResumeLayout(false);
            this.grpVACStereo.ResumeLayout(false);
            this.grpDIGSampleRate.ResumeLayout(false);
            this.panelDisplay.ResumeLayout(false);
            this.panelDisplay.PerformLayout();
            ((System.ComponentModel.ISupportInitialize)(this.picDisplay)).EndInit();
            this.panelMode.ResumeLayout(false);
            this.panelBandHF.ResumeLayout(false);
            this.grpVFOA.ResumeLayout(false);
            this.grpVFOA.PerformLayout();
            this.grpVFOB.ResumeLayout(false);
            this.grpVFOB.PerformLayout();
            this.grpMultimeter.ResumeLayout(false);
            this.grpMultimeter.PerformLayout();
            ((System.ComponentModel.ISupportInitialize)(this.picMultiMeterDigital)).EndInit();
            this.grpVFOBetween.ResumeLayout(false);
            this.grpVFOBetween.PerformLayout();
            this.grpDisplaySplit.ResumeLayout(false);
            this.grpRX2Meter.ResumeLayout(false);
            this.grpRX2Meter.PerformLayout();
            ((System.ComponentModel.ISupportInitialize)(this.picRX2Meter)).EndInit();
            this.panelBandVHF.ResumeLayout(false);
            this.panelRX2DSP.ResumeLayout(false);
            ((System.ComponentModel.ISupportInitialize)(this.ptbSquelch)).EndInit();
            this.panelModeSpecificFM.ResumeLayout(false);
            ((System.ComponentModel.ISupportInitialize)(this.ptbFMMic)).EndInit();
            this.ResumeLayout(false);
            this.PerformLayout();

        }
        #endregion

        #region Main
        // ======================================================
        // Main
        // ======================================================

        [STAThread]
        static void Main(string[] args)
        {
            string app_data_path = "";
            foreach (string s in args)
            {
                if (s.StartsWith("-datapath:"))
                {
                    string path = s.Trim().Substring(s.Trim().IndexOf(":") + 1);
                    if (path.EndsWith("\"")) path = path.Substring(0, path.Length - 1);
                    if (!path.EndsWith("\\")) path += "\\";
#if(DEBUG)
                    path += "Debug\\";
#endif
                    if (Directory.Exists(path))
                        app_data_path = path;
                    else
                    {
                        DialogResult dr = MessageBox.Show("-datapath: command line option found, but the folder specified was not found.\n" +
                            "Would you like to create this folder?  If not, the default folder will be used.\n\n" +
                            "(" + s + ")",
                            "Command Line Option: Create Folder?",
                            MessageBoxButtons.YesNo,
                            MessageBoxIcon.Question);

                        if (dr == DialogResult.Yes)
                        {
                            Directory.CreateDirectory(path);
                            app_data_path = path;
                        }
                    }
                }
            }

            if (app_data_path == "")
            {
                Assembly assembly = Assembly.GetExecutingAssembly();
                FileVersionInfo fvi = FileVersionInfo.GetVersionInfo(assembly.Location);
                string version = fvi.FileVersion; //.Substring(0, fvi.FileVersion.LastIndexOf("."));
                // app_data_path = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData)
                //   + "\\FlexRadio Systems\\PowerSDR v" + version + "\\";
                app_data_path = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData)
                    + "\\FlexRadio Systems\\PowerSDR (W5WC)" + "\\";
#if(DEBUG)
                app_data_path += "Debug\\";
#endif
            }
            try
            {
                if (!File.Exists(app_data_path + "wisdom"))
                {
                    // Need to create the directory in %appdata% before we go run wisdom
                    if (!Directory.Exists(app_data_path))
                        Directory.CreateDirectory(app_data_path);
                    Process p = Process.Start(Application.StartupPath + "\\fftw_wisdom.exe", "\"" + app_data_path);
                    MessageBox.Show("Running one time optimization.  Please wait patiently for " +
                        "this process to finish.\nTypically the optimization takes no more than 3-5 minutes.",
                        "Optimizing...",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Information);
                    p.WaitForExit();
                }
                /*	if(!File.Exists(app_data_path+"wisdom"))
                            {
                                Process p = Process.Start(Application.StartupPath + "\\fftw_wisdom.exe", "\""+app_data_path);
                                MessageBox.Show("Running one time optimization.  Please wait patiently for "+
                                    "this process to finish.\nTypically the optimization takes no more than 3-5 minutes.",
                                    "Optimizing...",
                                    MessageBoxButtons.OK,
                                    MessageBoxIcon.Information);
                                p.WaitForExit();
                            } */

                /*				else 
                                {
                                    string path = "wisdom";
                                    using (StreamReader sr = new StreamReader(path)) 
                                    {
                                        char [] block = new char[12];
                                        sr.ReadBlock(block,0,11);
                                        Debug.WriteLine("the block is "+block + "so let's check it");
                                        if (block.ToString() != "(fftw-3.2al")
                                        {
                                            sr.Close();
                                            File.Delete(Application.StartupPath+"\\wisdom");
                                            Process p = Process.Start(Application.StartupPath+"\\fftw_wisdom.exe");
                                            MessageBox.Show("Running one time optimization.  Wisdom is from wrong version. Please wait patiently for "+
                                                "this process to finish.\nTypically the optimization takes no more than 3-5 minutes.",
                                                "Optimizing...",
                                                MessageBoxButtons.OK,
                                                MessageBoxIcon.Information);
                                            p.WaitForExit();
                                        }
                                    }

                                } */
                try
                {
                    if (!CheckForOpenProcesses())
                        return;
                }
                catch (Exception)
                {

                }
                Application.EnableVisualStyles();
                Application.DoEvents();

                //Application.Run(new Console(args));
                // wjt hacked
                theConsole = new Console(args);
                Application.Run(theConsole);
            }
            catch (Exception ex)
            {
                string msg = ex.Message + "\n\n" + ex.StackTrace.ToString();
                if (ex.InnerException != null) msg += "\n\n" + ex.InnerException.Message;
                MessageBox.Show(msg, "Fatal Error",
                    MessageBoxButtons.OK, MessageBoxIcon.Error);

            }
        }

        #endregion

        #region Misc Routines
        // ======================================================
        // Misc Routines
        // ======================================================

        private bool fwc_rca_ptt = false;
        public bool FWCRCAPTT
        {
            get { return fwc_rca_ptt; }
            set { fwc_rca_ptt = value; }
        }

        private bool fwc_mic_ptt = false;
        public bool FWCMicPTT
        {
            get { return fwc_mic_ptt; }
            set { fwc_mic_ptt = value; }
        }

        private bool mic_ptt = false;
        public bool MicPTT
        {
            get { return mic_ptt; }
            set { mic_ptt = value; }
        }


        private void InitConsole()
        {
            /*   // EHR add nav support
               try
               {
                   TDxDevice = new TDxInput.DeviceClass();
                   TDxSensor = TDxDevice.Sensor;
                   TDxDevice.Connect();
                   if (TDxDevice.IsConnected)
                   {
                       this.timer_navigate.Interval = 100;
                       this.timer_navigate.Enabled = true;
                   }
               }
               catch (Exception)
               {
                   //MessageBox.Show("SpaceNavigator not installed.", "No Navigator",
                   //MessageBoxButtons.OK, MessageBoxIcon.Information);
               }
               // EHR end */

            Thread.Sleep(100);
            UpdateBandStackRegisters();

            Audio.console = this;
            //FWCMidi.console = this;
            FWC.console = this;
            Display.console = this;

            chkDSPNB2.Enabled = true;

            vfoa_hover_digit = -1;
            vfob_hover_digit = -1;

            rx1_ant_by_band = new FWCAnt[(int)Band.LAST];
            for (int i = 0; i < (int)Band.LAST; i++) rx1_ant_by_band[i] = FWCAnt.ANT1;
            rx2_ant_by_band = new FWCAnt[(int)Band.LAST];
            for (int i = 0; i < (int)Band.LAST; i++) rx2_ant_by_band[i] = FWCAnt.RX2IN;
            tx_ant_by_band = new FWCAnt[(int)Band.LAST];
            for (int i = 0; i < (int)Band.LAST; i++) tx_ant_by_band[i] = FWCAnt.ANT1;
            rx1_loop_by_band = new bool[(int)Band.LAST];
            rx1_preamp_by_band = new PreampMode[(int)Band.LAST];

            for (int i = 0; i < (int)Band.LAST; i++)
            {
                switch (current_model)
                {
                    case Model.FLEX3000:
                        switch ((Band)i)
                        {
                            case Band.B6M:
                            case Band.B10M:
                                rx1_preamp_by_band[i] = PreampMode.HIGH;
                                break;
                            case Band.B12M:
                            case Band.B15M:
                                rx1_preamp_by_band[i] = PreampMode.MED;
                                break;
                            default:
                                rx1_preamp_by_band[i] = PreampMode.LOW;
                                break;
                        }
                        break;
                    case Model.FLEX5000:
                        switch ((Band)i)
                        {
                            case Band.B6M:
                            case Band.B10M:
                            case Band.B12M:
                            case Band.B15M:
                                rx1_preamp_by_band[i] = PreampMode.HIGH;
                                break;
                            default:
                                rx1_preamp_by_band[i] = PreampMode.OFF;
                                break;
                        }
                        break;
                    case Model.HERMES:
                    case Model.HPSDR:
                        switch ((Band)i)
                        {
                            case Band.B6M:
                            case Band.B10M:
                            case Band.B12M:
                            case Band.B15M:
                                rx1_preamp_by_band[i] = PreampMode.HPSDR_ON;
                                break;
                            default:
                                rx1_preamp_by_band[i] = PreampMode.HPSDR_OFF;
                                break;
                        }
                        break;
                    default:
                        rx1_preamp_by_band[i] = PreampMode.HPSDR_OFF;
                        break;
                }
            }

            rx2_preamp_by_band = new PreampMode[(int)Band.LAST];
            for (int i = 0; i < (int)Band.LAST; i++) rx2_preamp_by_band[i] = PreampMode.HIGH;

            power_by_band = new int[(int)Band.LAST];
            for (int i = 0; i < (int)Band.LAST; i++) power_by_band[i] = 50;

            fm_tx_offset_by_band_mhz = new double[(int)Band.LAST];
            for (int i = 0; i < (int)Band.LAST; i++) // setup default FM offsets
            {
                switch ((Band)i)
                {
                    case Band.B6M: fm_tx_offset_by_band_mhz[i] = 1; break; // 1MHz
                    case Band.B10M: fm_tx_offset_by_band_mhz[i] = 0.1; break; // 100kHz
                    case Band.VHF0: fm_tx_offset_by_band_mhz[i] = 0.6; break; // 600kHz
                    case Band.VHF1: fm_tx_offset_by_band_mhz[i] = 5; break; // 5MHz
                    default: fm_tx_offset_by_band_mhz[i] = 0.1; break; // 100kHz
                }
            }

            rx1_agct_by_band = new int[(int)Band.LAST];
            rx2_agct_by_band = new int[(int)Band.LAST];
            for (int i = 0; i < (int)Band.LAST; i++)
            {
                switch ((Band)i)
                {
                    case Band.B6M:
                        switch (current_model)
                        {
                            case Model.FLEX3000:
                                rx1_agct_by_band[i] = 100;
                                break;
                            default:
                                rx1_agct_by_band[i] = 110;
                                break;
                        }
                        rx2_agct_by_band[i] = 110;
                        break;
                    default:
                        rx1_agct_by_band[i] = 90;
                        rx2_agct_by_band[i] = 90;
                        break;
                }
            }
            tx1_by_band = new bool[(int)Band.LAST];
            tx2_by_band = new bool[(int)Band.LAST];
            tx3_by_band = new bool[(int)Band.LAST];

            for (int i = 0; i < (int)Band.LAST; i++)
                tx1_by_band[i] = tx2_by_band[i] = tx3_by_band[i] = true;

            vhf_text = new RadioButtonTS[15];
            vhf_text[0] = radBandVHF0;
            vhf_text[1] = radBandVHF1;
            vhf_text[2] = radBandVHF2;
            vhf_text[3] = radBandVHF3;
            vhf_text[4] = radBandVHF4;
            vhf_text[5] = radBandVHF5;
            vhf_text[6] = radBandVHF6;
            vhf_text[7] = radBandVHF7;
            vhf_text[8] = radBandVHF8;
            vhf_text[9] = radBandVHF9;
            vhf_text[10] = radBandVHF10;
            vhf_text[11] = radBandVHF11;
            vhf_text[12] = radBandVHF12;
            vhf_text[13] = radBandVHF13;

            power_table = new float[(int)Band.LAST][];
            for (int i = 0; i < (int)Band.LAST; i++)
                power_table[i] = new float[13];

            rx1_image_gain_table = new float[(int)Band.LAST];
            rx1_image_phase_table = new float[(int)Band.LAST];
            rx2_image_gain_table = new float[(int)Band.LAST];
            rx2_image_phase_table = new float[(int)Band.LAST];
            tx_image_gain_table = new float[(int)Band.LAST];
            tx_image_phase_table = new float[(int)Band.LAST];

            tx_carrier_table = new int[(int)Band.LAST][];
            for (int i = 0; i < (int)Band.LAST; i++)
            {
                tx_carrier_table[i] = new int[4];
                for (int j = 0; j < 4; j++)
                    tx_carrier_table[i][j] = 128;
            }

            pa_bias_table = new int[4][]; // 4 groups of 8 pot settings
            for (int i = 0; i < 4; i++)
            {
                pa_bias_table[i] = new int[8];
                for (int j = 0; j < 8; j++)
                    pa_bias_table[i][j] = 0;
            }

            rx1_level_table = new float[(int)Band.LAST][]; // 3 settings per band (display_offset, preamp, multimeter offset)
            switch (current_model)
            {
                case Model.FLEX3000:
                    for (int i = 0; i < (int)Band.LAST; i++)
                    {
                        rx1_level_table[i] = new float[3];
                        rx1_level_table[i][0] = -71.0f;	// setup defaults;
                        rx1_level_table[i][1] = 19.8f;
                        rx1_level_table[i][2] = -26.0f;
                    }
                    break;
                default:
                    for (int i = 0; i < (int)Band.LAST; i++)
                    {
                        rx1_level_table[i] = new float[3];
                        rx1_level_table[i][0] = -59.2f;	// setup defaults;
                        rx1_level_table[i][1] = 20.0f;
                        rx1_level_table[i][2] = -32.0f;
                    }
                    break;
            }

            rx2_level_table = new float[(int)Band.LAST][]; // 3 settings per band (display_offset, preamp, multimeter offset)
            for (int i = 0; i < (int)Band.LAST; i++)
            {
                rx2_level_table[i] = new float[3];
                rx2_level_table[i][0] = -59.2f;	// setup defaults;
                rx2_level_table[i][1] = -13.5f;
                rx2_level_table[i][2] = -32.0f;
            }

            pa_bridge_table = new float[(int)Band.LAST][];
            for (int i = 0; i < (int)Band.LAST; i++)
            {
                pa_bridge_table[i] = new float[6]; // 1, 2, 5, 10, 20, 90
                for (int j = 0; j < 6; j++)
                    pa_bridge_table[i][j] = 0.0f;
            }

            swr_table = new float[(int)Band.LAST];
            for (int i = 0; i < (int)Band.LAST; i++)
                swr_table[i] = 1.0f;

            atu_swr_table = new float[(int)Band.LAST];
            for (int i = 0; i < (int)Band.LAST; i++)
                atu_swr_table[i] = 1.0f;

            atu_tuning = false;
            tune_power = 10;
            calibrating = false;
            run_setup_wizard = true;

            // get culture specific decimal separator
            separator = CultureInfo.CurrentCulture.NumberFormat.NumberDecimalSeparator;

            last_band = "";						// initialize bandstack

            tune_step_list = new List<TuneStep>();  // initialize wheel tuning list array
            tune_step_list.Add(new TuneStep(1, "1Hz"));
            tune_step_list.Add(new TuneStep(10, "10Hz"));
            tune_step_list.Add(new TuneStep(50, "50Hz"));
            tune_step_list.Add(new TuneStep(100, "100Hz"));
            tune_step_list.Add(new TuneStep(250, "250Hz"));
            tune_step_list.Add(new TuneStep(500, "500Hz"));
            tune_step_list.Add(new TuneStep(1000, "1kHz"));
            tune_step_list.Add(new TuneStep(2500, "2.5kHz"));
            tune_step_list.Add(new TuneStep(5000, "5kHz"));
            tune_step_list.Add(new TuneStep(6250, "6.25kHz"));
            tune_step_list.Add(new TuneStep(9000, "9kHz"));
            tune_step_list.Add(new TuneStep(10000, "10kHz"));
            tune_step_list.Add(new TuneStep(12500, "12.5kHz"));
            tune_step_list.Add(new TuneStep(15000, "15kHz"));
            tune_step_list.Add(new TuneStep(20000, "20kHz"));
            tune_step_list.Add(new TuneStep(25000, "25kHz"));
            tune_step_list.Add(new TuneStep(30000, "30kHz"));
            tune_step_list.Add(new TuneStep(50000, "50kHz"));
            tune_step_list.Add(new TuneStep(100000, "100kHz"));
            tune_step_list.Add(new TuneStep(250000, "250kHz"));
            tune_step_list.Add(new TuneStep(500000, "500kHz"));
            tune_step_list.Add(new TuneStep(1000000, "1MHz"));
            tune_step_list.Add(new TuneStep(10000000, "10MHz"));

            tune_step_index = 2;

            meter_text_history = new float[multimeter_text_peak_samples];

            current_meter_data = -200.0f;

            rx1_preamp_offset = new float[11];
            rx1_preamp_offset[(int)PreampMode.OFF] = 10.0f;
            rx1_preamp_offset[(int)PreampMode.LOW] = 0.0f;
            rx1_preamp_offset[(int)PreampMode.MED] = -16.0f;
            rx1_preamp_offset[(int)PreampMode.HIGH] = -26.0f;

            rx1_preamp_offset[(int)PreampMode.HPSDR_ON] = -20.0f;
            rx1_preamp_offset[(int)PreampMode.HPSDR_OFF] = 0.0f;
            rx1_preamp_offset[(int)PreampMode.HPSDR_MINUS10] = 10.0f;
            rx1_preamp_offset[(int)PreampMode.HPSDR_MINUS20] = 20.0f;
            rx1_preamp_offset[(int)PreampMode.HPSDR_MINUS30] = 30.0f;
            rx1_preamp_offset[(int)PreampMode.HPSDR_MINUS40] = 40.0f;
            rx1_preamp_offset[(int)PreampMode.HPSDR_MINUS50] = 50.0f;

            rx2_preamp_offset = new float[4];
            rx2_preamp_offset[(int)PreampMode.OFF] = 0.0f;
            rx2_preamp_offset[(int)PreampMode.HIGH] = 14.0f;


            this.ActiveControl = chkPower;		// Power has focus initially

            Display.Target = picDisplay;
            Display.Init();						// Initialize Display variables
            Init60mChannels();
            InitDisplayModes();					// Initialize Display Modes
            InitAGCModes();						// Initialize AGC Modes
            InitMultiMeterModes();				// Initialize MultiMeter Modes
            ProcessSampleThreadController[] pstc = new ProcessSampleThreadController[3];
            audio_process_thread = new Thread[3];
            for (uint proc_thread = 0; proc_thread < 3; proc_thread++)
            {
                pstc[proc_thread] = new ProcessSampleThreadController(proc_thread);
                audio_process_thread[proc_thread] = new Thread(new ThreadStart(pstc[proc_thread].ProcessSampleThread));
                audio_process_thread[proc_thread].Name = "Audio Process Thread " + proc_thread.ToString();
                audio_process_thread[proc_thread].Priority = ThreadPriority.Highest;
                audio_process_thread[proc_thread].IsBackground = true;
                audio_process_thread[proc_thread].Start();

                /*				DttSP.SetThreadCom(proc_thread);

                                audio_process_thread = new Thread(	// create audio process thread
                                    new ThreadStart(DttSP.ProcessSamplesThread));
                                audio_process_thread.Name = "Audio Process Thread ";
                                audio_process_thread.Priority = ThreadPriority.Highest;
                                audio_process_thread.IsBackground = true;
                                audio_process_thread.Start();
                */
            }

            //if(current_model == Model.SDR1000)
            hw = new HW(0x378);					// create hardware object

            siolisten = new SIOListenerII(this);

            // Keyer = new CWKeyer2(this);			// create new Keyer
            CWSensorItem.Init();
            CWPTT.Init();
            CWPTT.MoxChanged += new CWPTT.MoxCallback(SetConsoleMox);
            CWPTT.MuteChanged += new CWPTT.MuteCallback(SetTRMute);

            EQForm = new EQForm(this);

            InitFilterPresets();					// Initialize filter values

            SetupForm = new Setup(this);		// create Setup form
            SetupForm.StartPosition = FormStartPosition.Manual;

            switch (current_model)
            {
                case Model.SDR1000:
                    Hdw.Init();							// Power down hardware
                    Hdw.StandBy();						// initialize hardware device
                    break;

                case Model.HPSDR:
                case Model.HERMES:
                    // kd5tfd bug bug .. why are we going thru Hdw for HPSDR .. we should not need it. 
                    // Hdw.Init(); 							// Power down hardware
                    // Hdw.StandBy(); 						// initialize hardware device				
                    SetupForm.AddHPSDRPages();
                    SetComboPreampForHPSDR();
                    break;
            }

            //SetupForm.GetTxProfiles();
            UpdateTXProfile(SetupForm.TXProfile);

            Common.RestoreForm(EQForm, "EQForm", false);

            XVTRForm = new XVTRForm(this);

            WaveForm = new WaveControl(this);	// create Wave form
            WaveForm.StartPosition = FormStartPosition.Manual;

            MemoryList = MemoryList.Restore();
            MemoryList.CheckVersion();

            InitMemoryFrontPanel();

            //rx1_filter = Filter.F2600;

            //RX1AGCMode = AGCMode.MED;				// Initialize front panel controls
            comboPreamp.Text = "High";
            chkRX1Preamp.Checked = true;
            vfob_dsp_mode = DSPMode.LSB;
            vfob_filter = Filter.F3;
            comboDisplayMode.Text = "Panadapter";
            comboRX2DisplayMode.Text = "Panadapter";
            comboMeterRXMode.SelectedIndex = 0;
            comboRX2MeterMode.SelectedIndex = 0;
            comboTuneMode.SelectedIndex = 0;
            quick_save_filter = Filter.F3;
            quick_save_mode = DSPMode.LSB;
            ptbPWR.Value = 100;
            btnDisplayPanCenter_Click(this, EventArgs.Empty);
            comboTXProfile.Text = SetupForm.TXProfile;
            comboDigTXProfile.Text = SetupForm.TXProfile;
            comboFMTXProfile.Text = SetupForm.TXProfile;
            comboFMCTCSS.Text = "100.0";

            GetState();							// recall saved state
            chkFullDuplex.Checked = false;
            if (rx1_dsp_mode == DSPMode.FIRST || rx1_dsp_mode == DSPMode.LAST)
                radModeLSB.Checked = true;
            if (rx2_dsp_mode == DSPMode.FIRST || rx2_dsp_mode == DSPMode.LAST)
                radRX2ModeLSB.Checked = true;
            if (rx1_filter == Filter.FIRST || rx1_filter == Filter.LAST ||
               (rx1_filter == Filter.NONE && rx1_dsp_mode != DSPMode.DRM && rx1_dsp_mode != DSPMode.SPEC))
                radFilter3.Checked = true;
            if (rx2_filter == Filter.FIRST || rx2_filter == Filter.LAST ||
               (rx2_filter == Filter.NONE && rx2_dsp_mode != DSPMode.DRM && rx2_dsp_mode != DSPMode.SPEC))
                radRX2Filter3.Checked = true;

            chkVFOATX_CheckedChanged(this, EventArgs.Empty);
            chkVFOBTX_CheckedChanged(this, EventArgs.Empty);

            txtVFOAFreq_LostFocus(this, EventArgs.Empty);

            if (fwc_init && !run_setup_wizard &&
                (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
            {
                CheckCalData();
                if (!FWCEEPROM.TRXChecksumPresent)
                    WriteTRXChecksums();
                VerifyTRXChecksums();
                if (fwcAntForm != null && !fwcAntForm.IsDisposed)
                {
                    fwcAntForm.SetBand(rx1_band);
                    fwcAntForm.CurrentAntMode = current_ant_mode;
                    fwcAntForm.RX1Ant = rx1_ant;
                    fwcAntForm.RX1Loop = rx1_loop;
                    fwcAntForm.RX2Ant = rx2_ant;
                    fwcAntForm.TXAnt = tx_ant;
                }
                RX1Ant = rx1_ant;
                if (FWCEEPROM.RX2OK)
                {
                    CheckRX2CalData();
                    if (!FWCEEPROM.RX2ChecksumPresent)
                        WriteRX2Checksums();
                    VerifyRX2Checksums();
                    RX2Ant = rx2_ant;
                }
            }
            else PAPresent = pa_present;

            if (comboAGC.SelectedIndex < 0)
                RX1AGCMode = AGCMode.MED;
            if (comboRX2AGC.SelectedIndex < 0)
                comboRX2AGC.Text = "Med";
            txtVFOBFreq_LostFocus(this, EventArgs.Empty);
            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            ptbPWR_Scroll(this, EventArgs.Empty);
            ptbAF_Scroll(this, EventArgs.Empty);
            ptbSquelch_Scroll(this, EventArgs.Empty);
            ptbMic_Scroll(this, EventArgs.Empty);
            ptbDX_Scroll(this, EventArgs.Empty);
            ptbCPDR_Scroll(this, EventArgs.Empty);
            ptbVOX_Scroll(this, EventArgs.Empty);
            ptbNoiseGate_Scroll(this, EventArgs.Empty);
            ptbCWSpeed_Scroll(this, EventArgs.Empty);
            ptbPanMainRX_Scroll(this, EventArgs.Empty);
            ptbPanSubRX_Scroll(this, EventArgs.Empty);
            ptbRX2RF_Scroll(this, EventArgs.Empty);
            ptbRX2Squelch_Scroll(this, EventArgs.Empty);
            initializing = false;
            RX1PreampMode = rx1_preamp_mode;
            RX2PreampMode = rx2_preamp_mode;
            initializing = true;
            ptbDisplayZoom_Scroll(this, EventArgs.Empty);
            ptbRX0Gain_Scroll(this, EventArgs.Empty);
            ptbRX1Gain_Scroll(this, EventArgs.Empty);
            ptbPanMainRX_Scroll(this, EventArgs.Empty);
            ptbPanSubRX_Scroll(this, EventArgs.Empty);
            ptbRX2Pan_Scroll(this, EventArgs.Empty);
            ptbRX2Gain_Scroll(this, EventArgs.Empty);
            chkRX2Preamp_CheckedChanged(this, EventArgs.Empty);
            ptbRF_Scroll(this, EventArgs.Empty);
            ptbVACRXGain_Scroll(this, EventArgs.Empty);
            ptbVACTXGain_Scroll(this, EventArgs.Empty);
            radFilter_CheckedChanged(this, EventArgs.Empty);
            radModeButton_CheckedChanged(this, EventArgs.Empty);
            chkTNF_CheckedChanged(this, EventArgs.Empty);
            chkFWCATUBypass_CheckedChanged(this, EventArgs.Empty);
            /*  radFilter1_CheckedChanged(this, EventArgs.Empty);
               radFilter2_CheckedChanged(this, EventArgs.Empty);
               radFilter3_CheckedChanged(this, EventArgs.Empty);
               radFilter4_CheckedChanged(this, EventArgs.Empty);
               radFilter5_CheckedChanged(this, EventArgs.Empty);
               radFilter6_CheckedChanged(this, EventArgs.Empty);
               radFilter7_CheckedChanged(this, EventArgs.Empty);
               radFilter8_CheckedChanged(this, EventArgs.Empty);
               radFilter9_CheckedChanged(this, EventArgs.Empty);
               radFilter10_CheckedChanged(this, EventArgs.Empty);
               radFilterVar1_CheckedChanged(this, EventArgs.Empty);
               radFilterVar2_CheckedChanged(this, EventArgs.Empty);
               radModeLSB_CheckedChanged(this, EventArgs.Empty);
               radModeUSB_CheckedChanged(this, EventArgs.Empty);
               radModeDSB_CheckedChanged(this, EventArgs.Empty);
               radModeCWL_CheckedChanged(this, EventArgs.Empty);
               radModeCWU_CheckedChanged(this, EventArgs.Empty);
               radModeFMN_CheckedChanged(this, EventArgs.Empty);
               radModeAM_CheckedChanged(this, EventArgs.Empty);
               radModeSAM_CheckedChanged(this, EventArgs.Empty);
               radModeSPEC_CheckedChanged(this, EventArgs.Empty);
               radModeDIGL_CheckedChanged(this, EventArgs.Empty);
               radModeDIGU_CheckedChanged(this, EventArgs.Empty);
               radModeSPEC_CheckedChanged(this, EventArgs.Empty);*/
            CalcDisplayFreq();
            CpuUsage();

            tune_step_index--;					// Setup wheel tuning
            ChangeTuneStepUp();
            UpdateDisplayOffsets();

            SetupForm.initCATandPTTprops();   // wjt added -- get console props setup for cat and ptt 
            if (CmdLineArgs != null)
            {
                foreach (string t in CmdLineArgs)
                {
                    switch (t)
                    {
                        case "--disable-swr-prot-at-my-risk":
                            DisableSWRProtection = true;
                            this.Text = this.Text + "  *** SWR Protection Disabled! ***";
                            break;
                        case "--high-pwr-am":
                            Audio.high_pwr_am = true;
                            MessageBox.Show("high power am");
                            break;
                        // the next 4 opts are for various experimental HPSDR xmit and receive options 							

                        case "--force-16bit-IQ":
                            Force16bitIQ = true;
                            this.Text = this.Text + " *** 16 bit IQ ***";
                            break;

                        case "--mercury-xmit-hack":
                            DttSP.SetMercuryXmit(true);
                            this.Text = this.Text + " *** MercXmit ***";
                            break;

                        case "--eer-xmit-hack":
                            DttSP.SetEerXmit(true);
                            this.Text = this.Text + " *** EerXmit ***";
                            break;

                        case "--no-send-to-Janus":
                            NoJanusSend = true;
                            this.Text = this.Text + "*** NoJanusSend ***";
                            break;


                        case "--allowOOBxmit":
                            Extended = true;
                            this.Text = this.Text + " OOBok";
                            break;

                        case "--no-firmware-version-check":
                            this.Text = this.Text + " NoFWVerCheck";
                            JanusAudio.forceFWGood = true;
                            break;

                        case "--Atlas10MHz":
                        case "--Penny10MHz":
                        case "--Mercury10Mhz":
                        case "--Mercury125MHz":
                        case "--CfgPenny":
                        case "--CfgMercury":
                        case "--CfgBoth":
                        case "--PennyMic":
                            string title_text = JanusAudio.setC1Opts(t);
                            if (title_text != null)
                            {
                                this.Text = this.Text + " " + title_text;
                            }
                            break;

                    }
                }
            }

            if (comboMeterTXMode.Items.Count > 0 && comboMeterTXMode.SelectedIndex < 0)
                comboMeterTXMode.SelectedIndex = 0;
            chkMOX.Enabled = false;

            if (!collapsedDisplay)
            {
                modeToolStripMenuItem.Visible = false;
                bandToolStripMenuItem.Visible = false;
            }

            //siolisten = new SIOListenerII(this);
            // Init60mChannels();						// Load 60m Channel Freqs
        }

        public void Init60mChannels()
        {
            channels_60m = new List<Channel>();
            switch (CurrentRegion)
            {
                case FRSRegion.UK:
                    channels_60m.Add(new Channel(5.2600, 2800));
                    channels_60m.Add(new Channel(5.2800, 2800));
                    channels_60m.Add(new Channel(5.2900, 2800));
                    channels_60m.Add(new Channel(5.3680, 2800));
                    channels_60m.Add(new Channel(5.3730, 2800));
                    channels_60m.Add(new Channel(5.4000, 2800));
                    channels_60m.Add(new Channel(5.4050, 2800));
                    break;

                case FRSRegion.US:
                    channels_60m.Add(new Channel(5.3320, 2800));
                    channels_60m.Add(new Channel(5.3480, 2800));
                    channels_60m.Add(new Channel(5.3585, 2800));
                    channels_60m.Add(new Channel(5.3730, 2800));
                    channels_60m.Add(new Channel(5.4050, 2800));
                    break;

                default:
                    channels_60m.Add(new Channel(5.3320, 2800));
                    channels_60m.Add(new Channel(5.3480, 2800));
                    channels_60m.Add(new Channel(5.3585, 2800));
                    channels_60m.Add(new Channel(5.3730, 2800));
                    channels_60m.Add(new Channel(5.4050, 2800));
                    break;
            }
        }

        private void SyncDSP()
        {
            for (int i = 0; i < 2; i++)
            {
                for (int j = 0; j < 2; j++)
                {
                    RadioDSPRX dsp_rx = radio.GetDSPRX(i, j);
                    dsp_rx.Update = true;
                    dsp_rx.Force = true;
                    dsp_rx.BufferSize = dsp_rx.BufferSize;
                    dsp_rx.Force = false;
                }
            }

            for (int i = 0; i < 1; i++)
            {
                RadioDSPTX dsp_tx = radio.GetDSPTX(i);
                dsp_tx.Update = true;
                dsp_tx.Force = true;
                dsp_tx.BufferSize = dsp_tx.BufferSize;
                dsp_tx.Force = false;
            }

            RadioDSP.SyncStatic();

            for (int i = 0; i < 2; i++)
            {
                for (int j = 0; j < 2; j++)
                {
                    RadioDSPRX dsp_rx = radio.GetDSPRX(i, j);
                    dsp_rx.Update = false;
                    dsp_rx.Force = true;
                    dsp_rx.Update = true;
                    dsp_rx.Force = false;
                }
            }

            for (int i = 0; i < 1; i++)
            {
                RadioDSPTX dsp_tx = radio.GetDSPTX(i);
                dsp_tx.Update = false;
                dsp_tx.Force = true;
                dsp_tx.Update = true;
                dsp_tx.Force = false;
            }
        }

        public bool Force16bitIQ = false;
        public bool NoJanusSend = false;
        public void ExitConsole()
        {
            /*  try
              {
                  if (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)
                      Pal.Exit();
              }
              catch (Exception)
              {

              }*/
            if (SetupForm != null)		// make sure Setup form is deallocated
                SetupForm.Dispose();
            if (CWXForm != null)			// make sure CWX form is deallocated
                CWXForm.Dispose();
            chkPower.Checked = false;	// make sure power is off		
            ckQuickRec.Checked = false; // make sure recording is stopped

            //			if(draw_display_thread != null)
            //				draw_display_thread.Abort();

            //Parallel.ExitPortTalk();	// close parallel port driver
            PA19.PA_Terminate();		// terminate audio interface
            DB.Exit();					// close and save database
            //Mixer.RestoreState();		// restore initial mixer state
            DttSP.Exit();				// deallocate DSP variables
        }

        public void SaveState()
        {
            // Automatically saves all control settings to the database in the tab
            // pages on this form of the following types: CheckBox, ComboBox,
            // NumericUpDown, RadioButton, TextBox, and TrackBar (slider)
            string s;
            chkPower.Checked = false;		// turn off the power first

            ArrayList a = new ArrayList();

            foreach (Control c in this.Controls)			// For each control
            {
                // if it is a groupbox or panel, check for sub controls
                if (c.GetType() == typeof(GroupBoxTS) || c.GetType() == typeof(PanelTS))
                {
                    foreach (Control c2 in c.Controls)	// for each sub-control
                    {	// check to see if it is a value type we need to save
                        if (c2.Enabled)
                        {
                            if (c2.GetType() == typeof(CheckBoxTS))
                                a.Add(c2.Name + "/" + ((CheckBoxTS)c2).Checked.ToString());
                            else if (c2.GetType() == typeof(ComboBoxTS))
                            {
                                if (((ComboBoxTS)c2).Items.Count > 0)
                                    a.Add(c2.Name + "/" + ((ComboBoxTS)c2).Text);
                            }
                            else if (c2.GetType() == typeof(NumericUpDownTS))
                                a.Add(c2.Name + "/" + ((NumericUpDownTS)c2).Value.ToString());
                            else if (c2.GetType() == typeof(RadioButtonTS))
                                a.Add(c2.Name + "/" + ((RadioButtonTS)c2).Checked.ToString());
                            else if (c2.GetType() == typeof(TextBoxTS))
                            {
                                if (((TextBoxTS)c2).ReadOnly == false)
                                    a.Add(c2.Name + "/" + ((TextBoxTS)c2).Text);
                            }
                            else if (c2.GetType() == typeof(TrackBarTS))
                                a.Add(c2.Name + "/" + ((TrackBarTS)c2).Value.ToString());
                            else if (c2.GetType() == typeof(PrettyTrackBar))
                                a.Add(c2.Name + "/" + ((PrettyTrackBar)c2).Value.ToString());
#if(DEBUG)
                            else if (c2.GetType() == typeof(GroupBox) ||
                                c2.GetType() == typeof(CheckBox) ||
                                c2.GetType() == typeof(ComboBox) ||
                                c2.GetType() == typeof(NumericUpDown) ||
                                c2.GetType() == typeof(RadioButton) ||
                                c2.GetType() == typeof(TextBox) ||
                                c2.GetType() == typeof(TrackBar))
                                Debug.WriteLine(c2.Name + " needs to be converted to a Thread Safe control.");
#endif
                        }
                    }
                }
                else // it is not a group box
                {	// check to see if it is a value type we need to save
                    if (c.Enabled)
                    {
                        if (c.GetType() == typeof(CheckBoxTS))
                            a.Add(c.Name + "/" + ((CheckBoxTS)c).Checked.ToString());
                        else if (c.GetType() == typeof(ComboBoxTS))
                        {
                            if (((ComboBoxTS)c).SelectedIndex >= 0)
                                a.Add(c.Name + "/" + ((ComboBoxTS)c).Text);
                        }
                        else if (c.GetType() == typeof(NumericUpDownTS))
                            a.Add(c.Name + "/" + ((NumericUpDownTS)c).Value.ToString());
                        else if (c.GetType() == typeof(RadioButtonTS))
                            a.Add(c.Name + "/" + ((RadioButtonTS)c).Checked.ToString());
                        else if (c.GetType() == typeof(TextBoxTS))
                        {
                            if (((TextBoxTS)c).ReadOnly == false)
                                a.Add(c.Name + "/" + ((TextBoxTS)c).Text);
                        }
                        else if (c.GetType() == typeof(TrackBarTS))
                            a.Add(c.Name + "/" + ((TrackBarTS)c).Value.ToString());
                        else if (c.GetType() == typeof(PrettyTrackBar))
                            a.Add(c.Name + "/" + ((PrettyTrackBar)c).Value.ToString());
#if(DEBUG)
                        else if (c.GetType() == typeof(GroupBox) ||
                            c.GetType() == typeof(CheckBox) ||
                            c.GetType() == typeof(ComboBox) ||
                            c.GetType() == typeof(NumericUpDown) ||
                            c.GetType() == typeof(RadioButton) ||
                            c.GetType() == typeof(TextBox) ||
                            c.GetType() == typeof(TrackBar))
                            Debug.WriteLine(c.Name + " needs to be converted to a Thread Safe control.");
#endif
                    }
                }
            }

            a.Add("current_datetime_mode/" + (int)current_datetime_mode);
            a.Add("rx1_display_cal_offset/" + rx1_display_cal_offset.ToString("f3"));
            a.Add("rx1_meter_cal_offset/" + rx1_meter_cal_offset);

            a.Add("txtMemoryQuick/" + txtMemoryQuick.Text);		// save quick memory settings
            a.Add("quick_save_mode/" + (int)quick_save_mode);
            a.Add("quick_save_filter/" + (int)quick_save_filter);

            a.Add("fwc_last_cal_date_time/" + fwc_last_cal_date_time);
            a.Add("fwc_serial_num/" + fwc_serial_num);
            a.Add("fwc_trx_serial_num/" + fwc_trx_serial_num);

            a.Add("rx2_last_cal_date_time/" + rx2_last_cal_date_time);
            a.Add("rx2_serial_num/" + rx2_serial_num);
            a.Add("rx2_trx_match_serial/" + rx2_trx_match_serial);

            //FM Squelch Save
            a.Add("rx1_squelch_on/" + rx1_squelch_on);
            a.Add("rx1_squelch_threshold_scroll/" + rx1_squelch_threshold_scroll);
            a.Add("rx1_fm_squelch_threshold_scroll/" + rx1_fm_squelch_threshold_scroll);

            a.Add("rx2_squelch_on/" + rx2_squelch_on);
            a.Add("rx2_squelch_threshold_scroll/" + rx2_squelch_threshold_scroll);
            a.Add("rx2_fm_squelch_threshold_scroll/" + rx2_fm_squelch_threshold_scroll);

            for (int m = (int)DSPMode.FIRST + 1; m < (int)DSPMode.LAST; m++)
            {	// save filter settings per mode
                for (Filter f = Filter.FIRST + 1; f < Filter.LAST; f++)
                {
                    a.Add("rx1_filters[" + m.ToString() + "][" + ((int)f).ToString() + "]/" + rx1_filters[m].ToString(f));
                }
                a.Add("last_rx1_filter[" + m.ToString() + "]/" + rx1_filters[m].LastFilter.ToString());
            }

            for (int m = (int)DSPMode.FIRST + 1; m < (int)DSPMode.LAST; m++)
            {	// save filter settings per mode
                for (Filter f = Filter.FIRST + 1; f < Filter.LAST; f++)
                {
                    a.Add("rx2_filters[" + m.ToString() + "][" + ((int)f).ToString() + "]/" + rx2_filters[m].ToString(f));
                }
                a.Add("last_rx2_filter[" + m.ToString() + "]/" + rx2_filters[m].LastFilter.ToString());
            }

            for (int i = 0; i < NotchList.List.Count; i++)
            {
                // only save off the permanent notches (ones where a right-click remember has been performed)
                if (NotchList.List[i].Permanent)
                {
                    a.Add("notchlist[" + i + "]/" + NotchList.List[i].ToString());
                }
            }

            for (int i = 0; i < (int)Band.LAST; i++)
            {
                s = "power_table[" + i + "]/";
                for (int j = 0; j < 13; j++)
                    s += power_table[i][j].ToString("f4") + "|";
                s = s.Substring(0, s.Length - 1);
                a.Add(s);
            }

            for (int i = 0; i < (int)Band.LAST; i++)
            {
                s = "tx_carrier_table[" + i + "]/";
                for (int j = 0; j < 4; j++)
                    s += tx_carrier_table[i][j].ToString() + "|";
                s = s.Substring(0, s.Length - 1);
                a.Add(s);
            }

            for (int i = 0; i < 4; i++)
            {
                s = "pa_bias_table[" + i + "]/";
                for (int j = 0; j < 8; j++)
                    s += pa_bias_table[i][j].ToString() + "|";
                s = s.Substring(0, s.Length - 1);
                a.Add(s);
            }

            for (int i = 0; i < (int)Band.LAST; i++)
            {
                s = "rx1_level_table[" + i + "]/";
                for (int j = 0; j < 3; j++)
                    s += rx1_level_table[i][j].ToString("f3") + "|";
                s = s.Substring(0, s.Length - 1);
                a.Add(s);
            }

            for (int i = 0; i < (int)Band.LAST; i++)
            {
                s = "rx2_level_table[" + i + "]/";
                for (int j = 0; j < 3; j++)
                    s += rx2_level_table[i][j].ToString("f3") + "|";
                s = s.Substring(0, s.Length - 1);
                a.Add(s);
            }

            if (FWCEEPROM.RX2OK)
            {
                a.Add("rx2_res_offset/" + rx2_res_offset.ToString("f6"));
            }

            for (int i = 0; i < (int)Band.LAST; i++)
            {
                s = "pa_bridge_table[" + i + "]/";
                for (int j = 0; j < 6; j++)
                    s += pa_bridge_table[i][j].ToString("f4") + "|";
                s = s.Substring(0, s.Length - 1);
                a.Add(s);
            }

            for (int i = 0; i < (int)Band.LAST; i++)
            {
                s = "swr_table[" + i + "]/";
                s += swr_table[i].ToString("f4");
                a.Add(s);
            }

            for (int i = 0; i < (int)Band.LAST; i++)
            {
                s = "atu_swr_table[" + i + "]/";
                s += atu_swr_table[i].ToString("f4");
                a.Add(s);
            }

            a.Add("current_ant_mode/" + ((int)current_ant_mode).ToString());
            a.Add("rx1_ant/" + ((int)rx1_ant).ToString());
            s = "rx1_ant_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += ((int)rx1_ant_by_band[i]).ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);
            a.Add("rx1_loop/" + rx1_loop.ToString());

            a.Add("rx2_ant/" + ((int)rx2_ant).ToString());
            s = "rx2_ant_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += ((int)rx2_ant_by_band[i]).ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            a.Add("tx_ant/" + ((int)tx_ant).ToString());
            s = "tx_ant_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += ((int)tx_ant_by_band[i]).ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "rx1_loop_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += Convert.ToUInt16(rx1_loop_by_band[i]).ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            rx1_preamp_by_band[(int)rx1_band] = rx1_preamp_mode;
            s = "rx1_preamp_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += ((int)rx1_preamp_by_band[i]).ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            rx2_preamp_by_band[(int)rx2_band] = rx2_preamp_mode;
            s = "rx2_preamp_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += ((int)rx2_preamp_by_band[i]).ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "power_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += power_by_band[i].ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "fm_tx_offset_by_band_mhz/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += fm_tx_offset_by_band_mhz[i].ToString("R") + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "rx1_agct_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += rx1_agct_by_band[i].ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "rx2_agct_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += rx2_agct_by_band[i].ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "tx1_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += Convert.ToUInt16(tx1_by_band[i]).ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "tx2_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += Convert.ToUInt16(tx2_by_band[i]).ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "tx3_by_band/";
            for (int i = 0; i < (int)Band.LAST; i++)
                s += Convert.ToUInt16(tx3_by_band[i]).ToString() + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "rx1_image_gain_table/";
            for (int i = 0; i <= (int)Band.B6M; i++)
                s += rx1_image_gain_table[i].ToString("R") + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "rx1_image_phase_table/";
            for (int i = 0; i <= (int)Band.B6M; i++)
                s += rx1_image_phase_table[i].ToString("R") + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "rx2_image_gain_table/";
            for (int i = 0; i <= (int)Band.B6M; i++)
                s += rx2_image_gain_table[i].ToString("R") + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "rx2_image_phase_table/";
            for (int i = 0; i <= (int)Band.B6M; i++)
                s += rx2_image_phase_table[i].ToString("R") + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "tx_image_gain_table/";
            for (int i = 0; i <= (int)Band.B6M; i++)
                s += tx_image_gain_table[i].ToString("R") + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            s = "tx_image_phase_table/";
            for (int i = 0; i <= (int)Band.B6M; i++)
                s += tx_image_phase_table[i].ToString("R") + "|";
            s = s.Substring(0, s.Length - 1);
            a.Add(s);

            a.Add("rx1_level_checksum/" + rx1_level_checksum.ToString());
            a.Add("rx1_image_gain_checksum/" + rx1_image_gain_checksum.ToString());
            a.Add("rx1_image_phase_checksum/" + rx1_image_phase_checksum.ToString());
            a.Add("tx_image_gain_checksum/" + tx_image_gain_checksum.ToString());
            a.Add("tx_image_phase_checksum/" + tx_image_phase_checksum.ToString());
            a.Add("tx_carrier_checksum/" + tx_carrier_checksum.ToString());
            a.Add("pa_bias_checksum/" + pa_bias_checksum.ToString());
            a.Add("pa_bridge_checksum/" + pa_bridge_checksum.ToString());
            a.Add("pa_power_checksum/" + pa_power_checksum.ToString());
            a.Add("pa_swr_checksum/" + pa_swr_checksum.ToString());
            a.Add("atu_swr_checksum/" + atu_swr_checksum.ToString());
            a.Add("rx2_level_checksum/" + rx2_level_checksum.ToString());
            a.Add("rx2_image_gain_checksum/" + rx2_image_gain_checksum.ToString());
            a.Add("rx2_image_phase_checksum/" + rx2_image_phase_checksum.ToString());

            try
            {
                StreamWriter writer = new StreamWriter(app_data_path + "\\power.csv");
                writer.WriteLine("Band, 1, 2, 5, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100");
                for (int i = 1; i <= (int)Band.B6M; i++)
                {
                    writer.Write(((Band)i).ToString() + ",");
                    for (int j = 0; j < 13; j++)
                        writer.Write(power_table[i][j].ToString("f4") + ",");
                    writer.WriteLine("");
                }
                writer.Close();
            }
            catch (Exception)
            {
                MessageBox.Show("Error writing power.csv file.  Please make sure this file is not open and try again.",
                    "Error writing power.csv",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
            }

            /*try
            {
                StreamWriter writer = new StreamWriter(app_data_path+"\\rx1_level.csv");
                writer.WriteLine("Band, 0, 1, 2");
                for(int i=1; i<=(int)Band.B6M; i++)
                {
                    writer.Write(((Band)i).ToString()+",");
                    for(int j=0; j<3; j++)
                        writer.Write(rx1_level_table[i][j].ToString("f10")+",");
                    writer.WriteLine("");
                }
                writer.Close();
            }
            catch(Exception)
            {
                MessageBox.Show("Error writing rx1_level.csv file.  Please make sure this file is not open and try again.",
                    "Error writing rx1_level.csv",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
            }*/

            a.Add("rx2_fixed_gain/" + rx2_fixed_gain.ToString());
            a.Add("rx2_max_gain/" + rx2_max_gain.ToString());

            a.Add("band_160m_index/" + band_160m_index.ToString());
            a.Add("band_80m_index/" + band_80m_index.ToString());
            a.Add("band_60m_index/" + band_60m_index.ToString());
            a.Add("band_40m_index/" + band_40m_index.ToString());
            a.Add("band_30m_index/" + band_30m_index.ToString());
            a.Add("band_20m_index/" + band_20m_index.ToString());
            a.Add("band_17m_index/" + band_17m_index.ToString());
            a.Add("band_15m_index/" + band_15m_index.ToString());
            a.Add("band_12m_index/" + band_12m_index.ToString());
            a.Add("band_10m_index/" + band_10m_index.ToString());
            a.Add("band_6m_index/" + band_6m_index.ToString());
            a.Add("band_2m_index/" + band_2m_index.ToString());
            a.Add("band_wwv_index/" + band_wwv_index.ToString());
            a.Add("band_gen_index/" + band_gen_index.ToString());
            a.Add("band_vhf0_index/" + band_vhf0_index.ToString());
            a.Add("band_vhf1_index/" + band_vhf1_index.ToString());
            a.Add("band_vhf2_index/" + band_vhf2_index.ToString());
            a.Add("band_vhf3_index/" + band_vhf3_index.ToString());
            a.Add("band_vhf4_index/" + band_vhf4_index.ToString());
            a.Add("band_vhf5_index/" + band_vhf5_index.ToString());
            a.Add("band_vhf6_index/" + band_vhf6_index.ToString());
            a.Add("band_vhf7_index/" + band_vhf7_index.ToString());
            a.Add("band_vhf8_index/" + band_vhf8_index.ToString());
            a.Add("band_vhf9_index/" + band_vhf9_index.ToString());
            a.Add("band_vhf10_index/" + band_vhf10_index.ToString());
            a.Add("band_vhf11_index/" + band_vhf11_index.ToString());
            a.Add("band_vhf12_index/" + band_vhf12_index.ToString());
            a.Add("band_vhf13_index/" + band_vhf13_index.ToString());

            a.Add("panelBandHF.Visible/" + whatisHF);//w3sz added
            a.Add("panelBandVHF.Visible/" + whatisVHF);//w3sz added
            a.Add("iscollapsed/" + iscollapsed);//w3sz added
            a.Add("isexpanded/" + isexpanded);//w3sz added

            for (int i = (int)PreampMode.FIRST + 1; i < (int)PreampMode.LAST; i++)
                a.Add("rx1_preamp_offset[" + i.ToString() + "]/" + rx1_preamp_offset[i].ToString("f3"));

            //a.Add("fwc_preamp_offset/"+fwc_preamp_offset.ToString());
            /*for(int i=0; i<32; i++)
                a.Add("fwc_att_offset["+i.ToString()+"]/"+fwc_att_offset[i].ToString());*/

            a.Add("wheel_tune_index/" + tune_step_index.ToString());		// Save wheel tune value

            a.Add("vfob_dsp_mode/" + ((int)vfob_dsp_mode).ToString());			// Save VFO B values 
            a.Add("vfob_filter/" + ((int)vfob_filter).ToString());

            a.Add("console_top/" + this.Top.ToString());		// save form positions
            a.Add("console_left/" + this.Left.ToString());
            a.Add("console_width/" + this.Width.ToString());
            a.Add("console_height/" + this.Height.ToString());
            a.Add("setup_top/" + SetupForm.Top.ToString());
            a.Add("setup_left/" + SetupForm.Left.ToString());
            a.Add("rxonly_hf_enabled/" + rxonly_hf_enabled.ToString());
            a.Add("mon_recall/" + mon_recall.ToString());

            a.Add("Version/" + this.Text);		// save the current version

            DB.PurgeNotches();                  // remove old notches from DB
            DB.SaveVars("State", ref a);		// save the values to the DB
        }

        public void GetState()
        {
            // Automatically restores all controls from the database in the
            // tab pages on this form of the following types: CheckBox, ComboBox,
            // NumericUpDown, RadioButton, TextBox, and TrackBar (slider)

            ArrayList checkbox_list = new ArrayList();
            ArrayList combobox_list = new ArrayList();
            ArrayList numericupdown_list = new ArrayList();
            ArrayList radiobutton_list = new ArrayList();
            ArrayList textbox_list = new ArrayList();
            ArrayList trackbar_list = new ArrayList();
            ArrayList prettytrackbar_list = new ArrayList();

            //ArrayList controls = new ArrayList();	// list of controls to restore
            foreach (Control c in this.Controls)
            {
                // if control is a groupbox or panel, retrieve all subcontrols
                if (c.GetType() == typeof(GroupBoxTS) || c.GetType() == typeof(PanelTS))
                {
                    foreach (Control c2 in c.Controls)
                    {
                        if (c2.Enabled)
                        {
                            if (c2.GetType() == typeof(CheckBoxTS))			// the control is a CheckBox
                                checkbox_list.Add(c2);
                            else if (c2.GetType() == typeof(ComboBoxTS))		// the control is a ComboBox
                                combobox_list.Add(c2);
                            else if (c2.GetType() == typeof(NumericUpDownTS))	// the control is a NumericUpDown
                                numericupdown_list.Add(c2);
                            else if (c2.GetType() == typeof(RadioButtonTS))	// the control is a RadioButton
                                radiobutton_list.Add(c2);
                            else if (c2.GetType() == typeof(TextBoxTS))		// the control is a TextBox
                                textbox_list.Add(c2);
                            else if (c2.GetType() == typeof(TrackBarTS))		// the control is a TrackBar (slider)
                                trackbar_list.Add(c2);
                            else if (c2.GetType() == typeof(PrettyTrackBar))
                                prettytrackbar_list.Add(c2);
                        }
                    }
                }
                else
                {
                    if (c.Enabled)
                    {
                        if (c.GetType() == typeof(CheckBoxTS))				// the control is a CheckBox
                            checkbox_list.Add(c);
                        else if (c.GetType() == typeof(ComboBoxTS))		// the control is a ComboBox
                            combobox_list.Add(c);
                        else if (c.GetType() == typeof(NumericUpDownTS))	// the control is a NumericUpDown
                            numericupdown_list.Add(c);
                        else if (c.GetType() == typeof(RadioButtonTS))		// the control is a RadioButton
                            radiobutton_list.Add(c);
                        else if (c.GetType() == typeof(TextBoxTS))			// the control is a TextBox
                            textbox_list.Add(c);
                        else if (c.GetType() == typeof(TrackBarTS))		// the control is a TrackBar (slider)
                            trackbar_list.Add(c);
                        else if (c.GetType() == typeof(PrettyTrackBar))
                            prettytrackbar_list.Add(c);
                    }
                }
            }

            ArrayList a = DB.GetVars("State");							// Get the saved list of controls
            a.Sort();
            int num_controls = checkbox_list.Count + combobox_list.Count +
                numericupdown_list.Count + radiobutton_list.Count +
                textbox_list.Count + trackbar_list.Count;

            foreach (string s in a)				// string is in the format "name,value"
            {
                string[] vals = s.Split('/');
                if (vals.Length > 2)
                {
                    for (int i = 2; i < vals.Length; i++)
                        vals[1] += "/" + vals[i];
                }

                string name = vals[0];
                string val = vals[1];
                int num = 0;

                if (name.StartsWith("rx1_filters["))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int mode_index = Int32.Parse(name.Substring(start, length));

                    start = name.LastIndexOf("[") + 1;
                    length = name.LastIndexOf("]") - start;
                    int filter_mode = Int32.Parse(name.Substring(start, length));

                    length = val.IndexOf(":");
                    string n = val.Substring(0, length);

                    if (!val.Contains("|"))
                        val = val.Replace(",", "|");

                    start = val.IndexOf(":") + 2;
                    length = val.IndexOf("|") - start;
                    int low = Int32.Parse(val.Substring(start, length));

                    start = val.IndexOf("|") + 1;
                    int high = Int32.Parse(val.Substring(start));

                    rx1_filters[mode_index].SetFilter((Filter)filter_mode, low, high, n);
                }
                else if (name.StartsWith("rx2_filters["))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int mode_index = Int32.Parse(name.Substring(start, length));

                    start = name.LastIndexOf("[") + 1;
                    length = name.LastIndexOf("]") - start;
                    int filter_mode = Int32.Parse(name.Substring(start, length));

                    length = val.IndexOf(":");
                    string n = val.Substring(0, length);

                    if (!val.Contains("|"))
                        val = val.Replace(",", "|");

                    start = val.IndexOf(":") + 2;
                    length = val.IndexOf("|") - start;
                    int low = Int32.Parse(val.Substring(start, length));

                    start = val.IndexOf("|") + 1;
                    int high = Int32.Parse(val.Substring(start));

                    rx2_filters[mode_index].SetFilter((Filter)filter_mode, low, high, n);
                }
                else if (name.StartsWith("notchlist"))
                {
                    NotchList.List.Add(Notch.Parse(val));
                }
                else if (name.StartsWith("last_rx1_filter["))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int mode_index = Int32.Parse(name.Substring(start, length));

                    rx1_filters[mode_index].LastFilter = (Filter)Enum.Parse(typeof(Filter), val);
                }
                else if (name.StartsWith("last_rx2_filter["))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int mode_index = Int32.Parse(name.Substring(start, length));

                    rx2_filters[mode_index].LastFilter = (Filter)Enum.Parse(typeof(Filter), val);
                }
                else if (name.StartsWith("rx1_preamp_offset["))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int index = Int32.Parse(name.Substring(start, length));

                    rx1_preamp_offset[index] = (float)Math.Round(float.Parse(val), 3);
                }
                /*else if(name.StartsWith("fwc_att_offset"))
                {
                    int start = name.IndexOf("[")+1;
                    int length = name.IndexOf("]")-start;
                    int index = int.Parse(name.Substring(start, length));

                    fwc_att_offset[index] = float.Parse(val);
                }*/
                else if (name.StartsWith("power_table"))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int index = int.Parse(name.Substring(start, length));

                    string[] list = val.Split('|');
                    for (int i = 0; i < 13 && i < list.Length; i++)
                        power_table[index][i] = (float)Math.Round(float.Parse(list[i]), 4);
                }
                else if (name.StartsWith("tx_carrier_table"))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int index = int.Parse(name.Substring(start, length));

                    string[] list = val.Split('|');
                    for (int i = 0; i < 4; i++)
                        tx_carrier_table[index][i] = int.Parse(list[i]);
                }
                else if (name.StartsWith("pa_bias_table"))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int index = int.Parse(name.Substring(start, length));

                    string[] list = val.Split('|');
                    for (int i = 0; i < 8 && i < list.Length; i++)
                        pa_bias_table[index][i] = int.Parse(list[i]);

                    if (fwc_init && index == 0 &&
                        (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                    {
                        if (flex5000DebugForm != null && !flex5000DebugForm.IsDisposed)
                        {
                            for (int i = 0; i < 8; i++)
                                flex5000DebugForm.SetPAPot(i, (byte)pa_bias_table[index][i]);
                        }
                    }
                }
                else if (name.StartsWith("rx1_level_table"))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int index = int.Parse(name.Substring(start, length));

                    string[] list = val.Split('|');
                    for (int i = 0; i < 3; i++)
                        rx1_level_table[index][i] = (float)Math.Round(float.Parse(list[i]), 3);
                }
                else if (name.StartsWith("rx2_level_table"))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int index = int.Parse(name.Substring(start, length));

                    string[] list = val.Split('|');
                    for (int i = 0; i < 3; i++)
                        rx2_level_table[index][i] = (float)Math.Round(float.Parse(list[i]), 3);
                }
                else if (name.StartsWith("pa_bridge_table"))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int index = int.Parse(name.Substring(start, length));

                    string[] list = val.Split('|');
                    for (int i = 0; i < 6; i++)
                        pa_bridge_table[index][i] = (float)Math.Round(float.Parse(list[i]), 4);
                }
                else if (name.StartsWith("swr_table"))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int index = int.Parse(name.Substring(start, length));

                    swr_table[index] = (float)Math.Round(float.Parse(val), 4);
                }
                else if (name.StartsWith("atu_swr_table"))
                {
                    int start = name.IndexOf("[") + 1;
                    int length = name.IndexOf("]") - start;
                    int index = int.Parse(name.Substring(start, length));

                    atu_swr_table[index] = (float)Math.Round(float.Parse(val), 4);
                }
                else if (name.StartsWith("rx1_ant_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        rx1_ant_by_band[i] = (FWCAnt)int.Parse(list[i]);
                }
                else if (name.StartsWith("rx2_ant_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        rx2_ant_by_band[i] = (FWCAnt)int.Parse(list[i]);
                }
                else if (name.StartsWith("tx_ant_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        tx_ant_by_band[i] = (FWCAnt)int.Parse(list[i]);
                }
                else if (name.StartsWith("rx1_loop_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        rx1_loop_by_band[i] = Convert.ToBoolean(int.Parse(list[i]));
                }
                else if (name.StartsWith("rx1_preamp_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        rx1_preamp_by_band[i] = (PreampMode)(int.Parse(list[i]));
                }
                else if (name.StartsWith("rx2_preamp_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        rx2_preamp_by_band[i] = (PreampMode)(int.Parse(list[i]));
                }
                else if (name.StartsWith("power_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        power_by_band[i] = int.Parse(list[i]);
                }
                else if (name.StartsWith("fm_tx_offset_by_band_mhz"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        fm_tx_offset_by_band_mhz[i] = double.Parse(list[i]);
                }
                else if (name.StartsWith("rx1_agct_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        rx1_agct_by_band[i] = int.Parse(list[i]);
                }
                else if (name.StartsWith("rx2_agct_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        rx2_agct_by_band[i] = int.Parse(list[i]);
                }
                else if (name.StartsWith("tx1_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        tx1_by_band[i] = Convert.ToBoolean(int.Parse(list[i]));
                }
                else if (name.StartsWith("tx2_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        tx2_by_band[i] = Convert.ToBoolean(int.Parse(list[i]));
                }
                else if (name.StartsWith("tx3_by_band"))
                {
                    string[] list = val.Split('|');
                    for (int i = 0; i < (int)Band.LAST; i++)
                        tx3_by_band[i] = Convert.ToBoolean(int.Parse(list[i]));
                }

                switch (name)
                {
                    case "rx2_res_offset":
                        rx2_res_offset = float.Parse(val);
                        break;
                    case "current_ant_mode":
                        current_ant_mode = (AntMode)int.Parse(val);
                        break;
                    /*case "rx1_ant":
                        rx1_ant = (FWCAnt)int.Parse(val);
                        break;
                    case "rx1_loop":
                        rx1_loop = bool.Parse(val);
                        break;
                    case "rx2_ant":
                        rx2_ant = (FWCAnt)int.Parse(val);
                        break;
                    case "tx_ant":
                        tx_ant = (FWCAnt)int.Parse(val);
                        break;*/
                    case "fwc_preamp_offset":
                        fwc_preamp_offset = float.Parse(val);
                        break;
                    case "fwc_last_cal_date_time":
                        fwc_last_cal_date_time = long.Parse(val);
                        break;
                    case "fwc_serial_num":
                        fwc_serial_num = uint.Parse(val);
                        break;
                    case "fwc_trx_serial_num":
                        fwc_trx_serial_num = uint.Parse(val);
                        break;
                    case "rx2_last_cal_date_time":
                        rx2_last_cal_date_time = long.Parse(val);
                        break;
                    case "rx2_serial_num":
                        rx2_serial_num = uint.Parse(val);
                        break;
                    case "rx2_trx_match_serial":
                        rx2_trx_match_serial = uint.Parse(val);
                        break;
                    case "rx2_fixed_gain":
                        rx2_fixed_gain = int.Parse(val);
                        break;
                    case "rx2_max_gain":
                        rx2_max_gain = int.Parse(val);
                        break;
                    case "band_160m_index":
                        band_160m_index = Int32.Parse(val);
                        break;
                    case "band_80m_index":
                        band_80m_index = Int32.Parse(val);
                        break;
                    case "band_60m_index":
                        band_60m_index = Int32.Parse(val);
                        break;
                    case "band_40m_index":
                        band_40m_index = Int32.Parse(val);
                        break;
                    case "band_30m_index":
                        band_30m_index = Int32.Parse(val);
                        break;
                    case "band_20m_index":
                        band_20m_index = Int32.Parse(val);
                        break;
                    case "band_17m_index":
                        band_17m_index = Int32.Parse(val);
                        break;
                    case "band_15m_index":
                        band_15m_index = Int32.Parse(val);
                        break;
                    case "band_12m_index":
                        band_12m_index = Int32.Parse(val);
                        break;
                    case "band_10m_index":
                        band_10m_index = Int32.Parse(val);
                        break;
                    case "band_6m_index":
                        band_6m_index = Int32.Parse(val);
                        break;
                    case "band_2m_index":
                        band_2m_index = Int32.Parse(val);
                        break;
                    case "band_wwv_index":
                        band_wwv_index = Int32.Parse(val);
                        break;
                    case "band_gen_index":
                        band_gen_index = Int32.Parse(val);
                        break;
                    case "band_vhf0_index":
                        band_vhf0_index = Int32.Parse(val);
                        break;
                    case "band_vhf1_index":
                        band_vhf1_index = Int32.Parse(val);
                        break;
                    case "band_vhf2_index":
                        band_vhf2_index = Int32.Parse(val);
                        break;
                    case "band_vhf3_index":
                        band_vhf3_index = Int32.Parse(val);
                        break;
                    case "band_vhf4_index":
                        band_vhf4_index = Int32.Parse(val);
                        break;
                    case "band_vhf5_index":
                        band_vhf5_index = Int32.Parse(val);
                        break;
                    case "band_vhf6_index":
                        band_vhf6_index = Int32.Parse(val);
                        break;
                    case "band_vhf7_index":
                        band_vhf7_index = Int32.Parse(val);
                        break;
                    case "band_vhf8_index":
                        band_vhf8_index = Int32.Parse(val);
                        break;
                    case "band_vhf9_index":
                        band_vhf9_index = Int32.Parse(val);
                        break;
                    case "band_vhf10_index":
                        band_vhf10_index = Int32.Parse(val);
                        break;
                    case "band_vhf11_index":
                        band_vhf11_index = Int32.Parse(val);
                        break;
                    case "band_vhf12_index":
                        band_vhf12_index = Int32.Parse(val);
                        break;
                    case "band_vhf13_index":
                        band_vhf13_index = Int32.Parse(val);
                        break;
                    case "current_datetime_mode":
                        CurrentDateTimeMode = (DateTimeMode)(Int32.Parse(val));
                        break;
                    case "wheel_tune_index":
                        tune_step_index = Int32.Parse(val);
                        break;
                    case "txtMemoryQuick":
                        txtMemoryQuick.Text = val;
                        break;
                    case "rx1_display_cal_offset":
                        RX1DisplayCalOffset = float.Parse(val);
                        break;
                    //  case "tx_display_cal_offset":
                    //    TXDisplayCalOffset = float.Parse(val);
                    //     break;
                    case "rx1_meter_cal_offset":
                        rx1_meter_cal_offset = float.Parse(val);
                        break;
                    case "panelBandHF.Visible": //added by w3sz
                        whatisHF = Boolean.Parse(val); //added by w3sz
                        panelBandHF.Visible = whatisHF; //added by w3sz
                        if (panelBandHF.Visible) //added by w3sz
                            btnBandHF_Click(btnBandHF, EventArgs.Empty); //added by w3sz
                        break; //added by w3sz
                    case "panelBandVHF.Visible": //added by w3sz
                        whatisVHF = Boolean.Parse(val); //added by w3sz
                        panelBandVHF.Visible = whatisVHF; //added by w3sz
                        if (panelBandVHF.Visible) //added by w3sz
                            btnBandVHF_Click(btnBandVHF, EventArgs.Empty); //added by w3sz
                        break;  //added by w3sz
                    case "iscollapsed":  //added by w3sz
                        iscollapsed = Boolean.Parse(val);    //added by w3sz
                        if (iscollapsed)   //added by w3sz
                        {
                            this.CollapseDisplay();
                            iscollapsed = true;
                            isexpanded = false; 
                       }
                        break; //added by w3sz
                    case "isexpanded":  //added by w3sz
                        isexpanded = Boolean.Parse(val);    //added by w3sz
                        if (isexpanded)   //added by w3sz
                        {
                           // this.ExpandDisplay();
                            isexpanded = true;
                            iscollapsed = false;
                        }
                            break; //added by w3sz

                    case "quick_save_mode":
                        quick_save_mode = (DSPMode)(Int32.Parse(val));
                        break;
                    case "quick_save_filter":
                        quick_save_filter = (Filter)(Int32.Parse(val));
                        break;
                    case "vfob_dsp_mode":
                        vfob_dsp_mode = (DSPMode)(Int32.Parse(val));
                        break;
                    case "vfob_filter":
                        vfob_filter = (Filter)(Int32.Parse(val));
                        break;
                    case "console_top":
                        num = Int32.Parse(val);
                        /*if((num < 0) || (num > Screen.PrimaryScreen.Bounds.Height && Screen.AllScreens.Length == 1))
                            num = 0;*/
                        this.Top = num;
                        break;
                    case "console_left":
                        num = Int32.Parse(val);
                        /*if((num < 0) || (num > Screen.PrimaryScreen.Bounds.Width && Screen.AllScreens.Length == 1))
                            num = 0;*/
                        this.Left = num;
                        break;
                    case "console_width":
                        if (dpi <= 96) this.Width = int.Parse(val);
                        break;
                    case "console_height":
                        if (dpi <= 96) this.Height = int.Parse(val);
                        break;
                    case "setup_top":
                        num = Int32.Parse(val);
                        /*if((num < 0) || (num > Screen.PrimaryScreen.Bounds.Height && Screen.AllScreens.Length == 1))
                            num = 0;*/
                        SetupForm.Top = num;
                        break;
                    case "setup_left":
                        num = Int32.Parse(val);
                        /*if((num < 0) || (num > Screen.PrimaryScreen.Bounds.Width && Screen.AllScreens.Length == 1))
                            num = 0;*/
                        SetupForm.Left = num;
                        break;
                    /*	case "mem_top":
                            num = Int32.Parse(val);
                            if((num < 0) || (num > Screen.PrimaryScreen.Bounds.Height && Screen.AllScreens.Length == 1))
                                num = 0;
                            MemForm.Top = num;
                            break;
                        case "mem_left":
                            num = Int32.Parse(val);
                            if((num < 0) || (num > Screen.PrimaryScreen.Bounds.Width && Screen.AllScreens.Length == 1))
                                num = 0;
                            MemForm.Left = num;
                            break; */
                    case "SetupWizard":
                        if (val == "1")
                            run_setup_wizard = false;
                        break;
                    //case "show_alpha_warning":
                    //	show_alpha_warning = bool.Parse(val);
                    //	break;
                    // case "show_mobile_warning":
                    //    show_mobile_warning = bool.Parse(val);
                    //    break;
                    case "rx1_image_gain_table":
                        string[] list = val.Split('|');
                        for (int i = 0; i <= (int)Band.B6M && i < list.Length; i++)
                            rx1_image_gain_table[i] = float.Parse(list[i]);
                        break;
                    case "rx1_image_phase_table":
                        list = val.Split('|');
                        for (int i = 0; i <= (int)Band.B6M && i < list.Length; i++)
                            rx1_image_phase_table[i] = float.Parse(list[i]);
                        break;
                    case "rx2_image_gain_table":
                        list = val.Split('|');
                        for (int i = 0; i <= (int)Band.B6M && i < list.Length; i++)
                            rx2_image_gain_table[i] = float.Parse(list[i]);
                        break;
                    case "rx2_image_phase_table":
                        list = val.Split('|');
                        for (int i = 0; i <= (int)Band.B6M && i < list.Length; i++)
                            rx2_image_phase_table[i] = float.Parse(list[i]);
                        break;
                    case "tx_image_gain_table":
                        list = val.Split('|');
                        for (int i = 0; i <= (int)Band.B6M && i < list.Length; i++)
                            tx_image_gain_table[i] = float.Parse(list[i]);
                        break;
                    case "tx_image_phase_table":
                        list = val.Split('|');
                        for (int i = 0; i <= (int)Band.B6M && i < list.Length; i++)
                            tx_image_phase_table[i] = float.Parse(list[i]);
                        break;
                    case "rx1_level_checksum":
                        rx1_level_checksum = byte.Parse(val);
                        break;
                    case "rx1_image_gain_checksum":
                        rx1_image_gain_checksum = byte.Parse(val);
                        break;
                    case "rx1_image_phase_checksum":
                        rx1_image_phase_checksum = byte.Parse(val);
                        break;
                    case "tx_image_gain_checksum":
                        tx_image_gain_checksum = byte.Parse(val);
                        break;
                    case "tx_image_phase_checksum":
                        tx_image_phase_checksum = byte.Parse(val);
                        break;
                    case "tx_carrier_checksum":
                        tx_carrier_checksum = byte.Parse(val);
                        break;
                    case "pa_bias_checksum":
                        pa_bias_checksum = byte.Parse(val);
                        break;
                    case "pa_bridge_checksum":
                        pa_bridge_checksum = byte.Parse(val);
                        break;
                    case "pa_power_checksum":
                        pa_power_checksum = byte.Parse(val);
                        break;
                    case "pa_swr_checksum":
                        pa_swr_checksum = byte.Parse(val);
                        break;
                    case "atu_swr_checksum":
                        atu_swr_checksum = byte.Parse(val);
                        break;
                    case "rx2_level_checksum":
                        rx2_level_checksum = byte.Parse(val);
                        break;
                    case "rx2_image_gain_checksum":
                        rx2_image_gain_checksum = byte.Parse(val);
                        break;
                    case "rx2_image_phase_checksum":
                        rx2_image_phase_checksum = byte.Parse(val);
                        break;
                    case "rxonly_hf_enabled":
                        RXOnly_HF_Enabled = bool.Parse(val);
                        break;
                    case "mon_recall":
                        mon_recall = bool.Parse(val);
                        break;
                    case "rx1_squelch_on":
                        rx1_squelch_on = bool.Parse(val);
                        break;
                    case "rx1_squelch_threshold_scroll":
                        rx1_squelch_threshold_scroll = int.Parse(val);
                        break;
                    case "rx1_fm_squelch_threshold_scroll":
                        rx1_fm_squelch_threshold_scroll = int.Parse(val);
                        break;
                    /* case "rx2_squelch_on":
                         rx1_squelch_on = bool.Parse(val);
                         break;
                     case "rx2_squelch_threshold_scroll":
                         rx2_squelch_threshold_scroll = int.Parse(val);
                         break;
                     case "rx2_fm_squelch_threshold_scroll":
                         rx2_fm_squelch_threshold_scroll = int.Parse(val);
                         break; */
                }
            }

            // restore saved values to the controls
            foreach (string s in a)				// string is in the format "name,value"
            {
                string[] vals = s.Split('/');
                string name = vals[0];
                string val = vals[1];

                if (s.StartsWith("chk"))			// control is a CheckBox
                {
                    for (int i = 0; i < checkbox_list.Count; i++)
                    {	// look through each control to find the matching name
                        CheckBoxTS c = (CheckBoxTS)checkbox_list[i];
                        if (c.Name.Equals(name))		// name found
                        {
                            c.Checked = bool.Parse(val);	// restore value
                            i = checkbox_list.Count + 1;
                        }
                        if (i == checkbox_list.Count)
                            MessageBox.Show("Control not found: " + name, "GetState Error",
                                MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    }
                }
                else if (s.StartsWith("combo"))	// control is a ComboBox
                {
                    for (int i = 0; i < combobox_list.Count; i++)
                    {	// look through each control to find the matching name
                        ComboBoxTS c = (ComboBoxTS)combobox_list[i];
                        if (c.Name.Equals(name))		// name found
                        {
                            c.Text = val;	// restore value
                            i = combobox_list.Count + 1;
                        }
                        if (i == combobox_list.Count)
                            MessageBox.Show("Control not found: " + name, "GetState Error",
                                MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    }
                }
                else if (s.StartsWith("ud"))
                {
                    for (int i = 0; i < numericupdown_list.Count; i++)
                    {	// look through each control to find the matching name
                        NumericUpDownTS c = (NumericUpDownTS)numericupdown_list[i];
                        if (c.Name.Equals(name))		// name found
                        {
                            decimal num = decimal.Parse(val);

                            if (num > c.Maximum) num = c.Maximum;		// check endpoints
                            else if (num < c.Minimum) num = c.Minimum;
                            c.Value = num;			// restore value
                            i = numericupdown_list.Count + 1;
                        }
                        if (i == numericupdown_list.Count)
                            MessageBox.Show("Control not found: " + name, "GetState Error",
                                MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    }
                }
                else if (s.StartsWith("rad"))
                {	// look through each control to find the matching name
                    for (int i = 0; i < radiobutton_list.Count; i++)
                    {
                        RadioButtonTS c = (RadioButtonTS)radiobutton_list[i];
                        if (c.Name.Equals(name))		// name found
                        {
                            if (!val.ToLower().Equals("true") && !val.ToLower().Equals("false"))
                                val = "True";
                            c.Checked = bool.Parse(val);	// restore value
                            i = radiobutton_list.Count + 1;
                        }
                        if (i == radiobutton_list.Count)
                            MessageBox.Show("Control not found: " + name, "GetState Error",
                                MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    }
                }
                else if (s.StartsWith("txt"))
                {	// look through each control to find the matching name
                    for (int i = 0; i < textbox_list.Count; i++)
                    {
                        TextBoxTS c = (TextBoxTS)textbox_list[i];
                        if (c.Name.Equals(name))		// name found
                        {
                            c.Text = val;	// restore value
                            i = textbox_list.Count + 1;
                        }
                        if (i == textbox_list.Count)
                            MessageBox.Show("Control not found: " + name, "GetState Error",
                                MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    }
                }
                else if (s.StartsWith("tb"))
                {
                    // look through each control to find the matching name
                    for (int i = 0; i < trackbar_list.Count; i++)
                    {
                        TrackBarTS c = (TrackBarTS)trackbar_list[i];
                        if (c.Name.Equals(name))		// name found
                        {
                            c.Value = Int32.Parse(val);
                            i = trackbar_list.Count + 1;
                        }
                        if (i == trackbar_list.Count)
                            MessageBox.Show("Control not found: " + name, "GetState Error",
                                MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    }
                }
                else if (s.StartsWith("ptb"))
                {
                    // look through each control to find the matching name
                    for (int i = 0; i < prettytrackbar_list.Count; i++)
                    {
                        PrettyTrackBar c = (PrettyTrackBar)prettytrackbar_list[i];
                        if (c.Name.Equals(name))		// name found
                        {
                            c.Value = Int32.Parse(val);
                            i = prettytrackbar_list.Count + 1;
                        }
                        if (i == prettytrackbar_list.Count)
                            MessageBox.Show("Control not found: " + name, "GetState Error",
                                MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    }
                }

            }

            Common.ForceFormOnScreen(this);
            Common.ForceFormOnScreen(SetupForm);
            //Common.ForceFormOnScreen(MemForm);
        }

        private void InitRadio()
        {
            uint val;
            FWC.GetFirmwareRev(out val);
            if (val == 0)
            {
                Splash.HideForm();
                MessageBox.Show("Error communicating with the radio.  Please reload PowerSDR to try again.\n" +
                    "Note that starting PowerSDR too quickly after powering on the radio can cause this problem.",
                    "Error: Radio Communication Problem",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                fwc_init = false;
                return;
            }

            switch (current_model)
            {
                case Model.FLEX3000:
                    if (val < 0x02000001 || val > 0x0200FFFF) // revs outside of v2.0.*.*
                    {
                        string s = ((byte)(val >> 24)).ToString() + "." + ((byte)(val >> 16)).ToString() + "." +
                            ((byte)(val >> 8)).ToString() + "." + ((byte)val).ToString();
                        Splash.HideForm();
                        MessageBox.Show("FLEX-3000 Firmware Change Required.\n" +
                            "Please visit our website at www.flex-radio.com\n" +
                            "and click the Download Firmware link.\n" +
                            "(Looked for v2.0.0.1+ and found v" + s + ")",
                            "Error: Radio Firmware Version",
                            MessageBoxButtons.OK,
                            MessageBoxIcon.Error);
                        fwc_init = false;
                        return;
                    }
                    break;
                case Model.FLEX5000:
                    if (val < 0x02000001 || val > 0x0200FFFF) // revs outside of v2.0.*.*
                    {
                        string s = ((byte)(val >> 24)).ToString() + "." + ((byte)(val >> 16)).ToString() + "." +
                            ((byte)(val >> 8)).ToString() + "." + ((byte)val).ToString();
                        Splash.HideForm();
                        MessageBox.Show("FLEX-5000 Firmware Change Required.\n" +
                            "Please visit our website at www.flex-radio.com\n" +
                            "and click the Download FLEX-5000 Firmware link.\n" +
                            "(Looked for v2.0.0.1+ and found v" + s + ")",
                            "Error: FLEX-5000 Firmware Version",
                            MessageBoxButtons.OK,
                            MessageBoxIcon.Error);
                        fwc_init = false;
                        return;
                    }
                    break;
            }

            FWC.Initialize();
            FWC.SetTRXPreamp(false);
            if (current_model == Model.FLEX3000)
                FWC.SetRXAttn(false);
        }

        private void CheckCalData()
        {
            if (!fwc_init || (current_model != Model.FLEX5000 && current_model != Model.FLEX3000)) return;
            if (FWCEEPROM.LastCalDateTime == unchecked((long)0xffffffffffffffff))
            {
                //MessageBox.Show("No Calibration Date/Time Found.");
                return;
            }

            if (fwc_serial_num != FWCEEPROM.SerialNumber)
            {
                if (fwc_serial_num != 0)
                {
                    /*string old_s = FWCEEPROM.SerialToString(fwc_serial_num);
                    string new_s = FWCEEPROM.SerialToString(FWCEEPROM.SerialNumber);

                    Splash.HideForm();
                    DialogResult dr = MessageBox.Show("New Radio Detected: Old Serial: "+old_s+"  New Serial: "+new_s+"\n"+
                        "Do you want to update the PowerSDR calibration data from the EEPROM?\n"+
                        "(Note that this may take as long as 90 seconds)",
                        "New Radio: Update Cal?",
                        MessageBoxButtons.YesNo,
                        MessageBoxIcon.Question);

                    if(dr == DialogResult.No) return;*/
                }
                else
                {
                    /*MessageBox.Show("Please wait patiently while a one-time transfer of the\n"+
                        "calibration data from the EEPROM is performed.  This\n"+
                        "can take as long as 90 seconds.  Click OK to continue.",
                        "Please wait for Cal Data Transfer",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Information);*/
                }
            }
            else if (fwc_trx_serial_num != FWCEEPROM.TRXSerial)
            {
                /*string old_s = FWCEEPROM.SerialToString(fwc_trx_serial_num);
                string new_s = FWCEEPROM.SerialToString(FWCEEPROM.TRXSerial);

                Splash.HideForm();
                DialogResult dr = MessageBox.Show("New Radio Detected: Old TRX Serial: "+old_s+"  New Serial: "+new_s+"\n"+
                    "Do you want to update the PowerSDR calibration data from the EEPROM?\n"+
                    "(Note that this may take as long as 90 seconds)",
                    "New Radio: Update Cal?",
                    MessageBoxButtons.YesNo,
                    MessageBoxIcon.Question);

                if(dr == DialogResult.No) return;*/
            }
            else if (fwc_last_cal_date_time < FWCEEPROM.LastCalDateTime)
            {
                /*try
                {
                    DateTime old_date = DateTime.FromFileTimeUtc(fwc_last_cal_date_time);
                    string old_d = old_date.ToShortDateString()+" "+old_date.ToShortTimeString();
                    DateTime new_date = DateTime.FromFileTimeUtc(FWCEEPROM.LastCalDateTime);
                    string new_d = new_date.ToShortDateString()+" "+new_date.ToShortTimeString();
				
                    Splash.HideForm();
                    DialogResult dr = MessageBox.Show("Updated Calibration Data Detected:  Old: "+old_d+"  New: "+new_d+"\n"+
                        "Do you want to update the PowerSDR calibration data from the EEPROM?\n"+
                        "(Note that this may take as long as 90 seconds)",
                        "New Data: Update Cal?",
                        MessageBoxButtons.YesNo,
                        MessageBoxIcon.Question);

                    if(dr == DialogResult.No) return;
                }
                catch(Exception) { }*/
            }
            else return;

            // download cal data from EEPROM
            RestoreCalData();
        }

        private void CheckRX2CalData()
        {
            if (!fwc_init || current_model != Model.FLEX5000 || !FWCEEPROM.RX2OK) return;
            if (FWCEEPROM.LastRX2CalDateTime == unchecked((long)0xffffffffffffffff))
            {
                //MessageBox.Show("No Calibration Date/Time Found.");
                return;
            }

            if (rx2_serial_num != FWCEEPROM.RX2Serial)
            {
                if (rx2_serial_num != 0)
                {
                    /*string old_s = FWCEEPROM.SerialToString(rx2_serial_num);
                    string new_s = FWCEEPROM.SerialToString(FWCEEPROM.RX2Serial);

                    Splash.HideForm();
                    DialogResult dr = MessageBox.Show("New RX2 Detected: Old Serial: "+old_s+"  New Serial: "+new_s+"\n"+
                        "Do you want to update the PowerSDR calibration data from the EEPROM?\n"+
                        "(Note that this may take as long as 30 seconds)",
                        "New RX2: Update Cal?",
                        MessageBoxButtons.YesNo,
                        MessageBoxIcon.Question);

                    if(dr == DialogResult.No) return;*/
                }
                else
                {
                    /*MessageBox.Show("Please wait patiently while a one-time transfer of the\n"+
                         "RX2 calibration data from the EEPROM is performed.  This\n"+
                         "can take as long as 30 seconds.  Click OK to continue.",
                         "Please wait for Cal Data Transfer",
                         MessageBoxButtons.OK,
                         MessageBoxIcon.Information);*/
                }
            }
            else if (rx2_last_cal_date_time < FWCEEPROM.LastRX2CalDateTime)
            {
                /*try
                {
                    DateTime old_date = DateTime.FromFileTimeUtc(rx2_last_cal_date_time);
                    string old_d = old_date.ToShortDateString()+" "+old_date.ToShortTimeString();
                    DateTime new_date = DateTime.FromFileTimeUtc(FWCEEPROM.LastRX2CalDateTime);
                    string new_d = new_date.ToShortDateString()+" "+new_date.ToShortTimeString();
				
                    Splash.HideForm();
                    DialogResult dr = MessageBox.Show("Updated RX2 Calibration Data Detected:  Old: "+old_d+"  New: "+new_d+"\n"+
                        "Do you want to update the PowerSDR calibration data from the EEPROM?\n"+
                        "(Note that this may take as long as 30 seconds)",
                        "New Data: Update Cal?",
                        MessageBoxButtons.YesNo,
                        MessageBoxIcon.Question);

                    if(dr == DialogResult.No) return;
                }
                catch(Exception) { }*/
            }
            else return;

            // download cal data from EEPROM
            RX2RestoreCalData();
        }

        public void SyncCalDateTime()
        {
            fwc_serial_num = FWCEEPROM.SerialNumber;
            fwc_trx_serial_num = FWCEEPROM.TRXSerial;
            fwc_last_cal_date_time = FWCEEPROM.LastCalDateTime;
        }

        public void RX2SyncCalDateTime()
        {
            rx2_serial_num = FWCEEPROM.RX2Serial;
            rx2_last_cal_date_time = FWCEEPROM.LastRX2CalDateTime;
        }

        public void WriteTRXChecksums()
        {
            rx1_level_checksum = Checksum.Calc(rx1_level_table);
            FWCEEPROM.WriteRXLevelChecksum(rx1_level_checksum);

            rx1_image_gain_checksum = Checksum.Calc(rx1_image_gain_table);
            FWCEEPROM.WriteRXImageGainChecksum(rx1_image_gain_checksum);

            rx1_image_phase_checksum = Checksum.Calc(rx1_image_phase_table);
            FWCEEPROM.WriteRXImagePhaseChecksum(rx1_image_phase_checksum);

            tx_image_gain_checksum = Checksum.Calc(tx_image_gain_table);
            FWCEEPROM.WriteTXImageGainChecksum(tx_image_gain_checksum);

            tx_image_phase_checksum = Checksum.Calc(tx_image_phase_table);
            FWCEEPROM.WriteTXImagePhaseChecksum(tx_image_phase_checksum);

            tx_carrier_checksum = Checksum.Calc(tx_carrier_table, true);
            FWCEEPROM.WriteTXCarrierChecksum(tx_carrier_checksum);

            if (FWCEEPROM.PAOK)
            {
                pa_bias_checksum = Checksum.Calc(pa_bias_table, false);
                FWCEEPROM.WritePABiasChecksum(pa_bias_checksum);

                pa_bridge_checksum = Checksum.Calc(pa_bridge_table);
                FWCEEPROM.WritePABridgeChecksum(pa_bridge_checksum);

                pa_power_checksum = Checksum.Calc(power_table);
                FWCEEPROM.WritePAPowerChecksum(pa_power_checksum);

                pa_swr_checksum = Checksum.Calc(swr_table);
                FWCEEPROM.WritePASWRChecksum(pa_swr_checksum);

                if (current_model == Model.FLEX3000)
                {
                    atu_swr_checksum = Checksum.Calc(atu_swr_table);
                    FWCEEPROM.WriteATUSWRChecksum(atu_swr_checksum);
                }
            }
            FWCEEPROM.TRXChecksumPresent = true;
        }

        public void VerifyTRXChecksums()
        {
            byte calc = 0, eeprom = 0;
            bool error_flag = false;
            string error = "";

            eeprom = FWCEEPROM.ReadRXLevelChecksum();
            calc = Checksum.Calc(rx1_level_table);
            if (rx1_level_checksum != eeprom ||
                rx1_level_checksum != calc)
            {
                error_flag = true;
                error += "RX1 Level Checksum Error " +
                    "DB: " + rx1_level_checksum.ToString("X") +
                    " EEPROM: " + eeprom.ToString("X") +
                    " Calculated: " + calc.ToString("X") + "\n";
            }

            eeprom = FWCEEPROM.ReadRXImageGainChecksum();
            calc = Checksum.Calc(rx1_image_gain_table);
            if (rx1_image_gain_checksum != eeprom ||
                rx1_image_gain_checksum != calc)
            {
                error_flag = true;
                error += "RX1 Image Gain Checksum Error " +
                    "DB: " + rx1_image_gain_checksum.ToString("X") +
                    " EEPROM: " + eeprom.ToString("X") +
                    " Calculated: " + calc.ToString("X") + "\n"; ;
            }

            eeprom = FWCEEPROM.ReadRXImagePhaseChecksum();
            calc = Checksum.Calc(rx1_image_phase_table);
            if (rx1_image_phase_checksum != eeprom ||
                rx1_image_phase_checksum != calc)
            {
                error_flag = true;
                error += "RX1 Image Phase Checksum Error " +
                    "DB: " + rx1_image_phase_checksum.ToString("X") +
                    " EEPROM: " + eeprom.ToString("X") +
                    " Calculated: " + calc.ToString("X") + "\n";
            }

            eeprom = FWCEEPROM.ReadTXImageGainChecksum();
            calc = Checksum.Calc(tx_image_gain_table);
            if (tx_image_gain_checksum != eeprom ||
                tx_image_gain_checksum != calc)
            {
                error_flag = true;
                error += "TX Image Gain Checksum Error " +
                    "DB: " + tx_image_gain_checksum.ToString("X") +
                    " EEPROM: " + eeprom.ToString("X") +
                    " Calculated: " + calc.ToString("X") + "\n";
            }

            eeprom = FWCEEPROM.ReadTXImagePhaseChecksum();
            calc = Checksum.Calc(tx_image_phase_table);
            if (tx_image_phase_checksum != eeprom ||
                tx_image_phase_checksum != calc)
            {
                error_flag = true;
                error += "TX Image Phase Checksum Error " +
                    "DB: " + tx_image_phase_checksum.ToString("X") +
                    " EEPROM: " + eeprom.ToString("X") +
                    " Calculated: " + calc.ToString("X") + "\n";
            }

            eeprom = FWCEEPROM.ReadTXCarrierChecksum();
            calc = Checksum.Calc(tx_carrier_table, true);
            if (tx_carrier_checksum != eeprom ||
                tx_carrier_checksum != calc)
            {
                error_flag = true;
                error += "TX Carrier Checksum Error " +
                    "DB: " + tx_carrier_checksum.ToString("X") +
                    " EEPROM: " + eeprom.ToString("X") +
                    " Calculated: " + calc.ToString("X") + "\n";
            }

            if (FWCEEPROM.PAOK)
            {
                eeprom = FWCEEPROM.ReadPABiasChecksum();
                calc = Checksum.Calc(pa_bias_table, false);
                if (pa_bias_checksum != eeprom ||
                    pa_bias_checksum != calc)
                {
                    error_flag = true;
                    error += "PA Bias Checksum Error " +
                        "DB: " + pa_bias_checksum.ToString("X") +
                        " EEPROM: " + eeprom.ToString("X") +
                        " Calculated: " + calc.ToString("X") + "\n";
                }

                eeprom = FWCEEPROM.ReadPABridgeChecksum();
                calc = Checksum.Calc(pa_bridge_table);
                if (pa_bridge_checksum != eeprom ||
                    pa_bridge_checksum != calc)
                {
                    error_flag = true;
                    error += "PA Bridge Checksum Error " +
                        "DB: " + pa_bridge_checksum.ToString("X") +
                        " EEPROM: " + eeprom.ToString("X") +
                        " Calculated: " + calc.ToString("X") + "\n";
                }

                eeprom = FWCEEPROM.ReadPAPowerChecksum();
                calc = Checksum.Calc(power_table);
                if (pa_power_checksum != eeprom ||
                    pa_power_checksum != calc)
                {
                    error_flag = true;
                    error += "PA Power Checksum Error " +
                        "DB: " + pa_power_checksum.ToString("X") +
                        " EEPROM: " + eeprom.ToString("X") +
                        " Calculated: " + calc.ToString("X") + "\n";
                }

                eeprom = FWCEEPROM.ReadPASWRChecksum();
                calc = Checksum.Calc(swr_table);
                if (pa_swr_checksum != eeprom ||
                    pa_swr_checksum != calc)
                {
                    error_flag = true;
                    error += "PA SWR Checksum Error " +
                        "DB: " + pa_swr_checksum.ToString("X") +
                        " EEPROM: " + eeprom.ToString("X") +
                        " Calculated: " + calc.ToString("X") + "\n";
                }

                if (current_model == Model.FLEX3000)
                {
                    eeprom = FWCEEPROM.ReadATUSWRChecksum();
                    calc = Checksum.Calc(atu_swr_table);
                    if (atu_swr_checksum != eeprom ||
                        atu_swr_checksum != calc)
                    {
                        error_flag = true;
                        error += "ATU SWR Checksum Error " +
                            "DB: " + atu_swr_checksum.ToString("X") +
                            " EEPROM: " + eeprom.ToString("X") +
                            " CAlculated: " + calc.ToString("X") + "\n";
                    }
                }
            }

            if (error_flag)
            {
                TextWriter writer = new StreamWriter(app_data_path + "\\checksum_error.log", true);
                string s = DateTime.Now.ToShortDateString() + "  " + DateTime.Now.ToShortTimeString();
                writer.WriteLine(s + "  " + error);
                writer.Close();
                FWCEEPROM.TRXChecksumPresent = false;
            }
        }

        public void WriteRX2Checksums()
        {
            rx2_level_checksum = Checksum.Calc(rx2_level_table);
            FWCEEPROM.WriteRX2LevelChecksum(rx2_level_checksum);

            rx2_image_gain_checksum = Checksum.Calc(rx2_image_gain_table);
            FWCEEPROM.WriteRX2ImageGainChecksum(rx2_image_gain_checksum);

            rx2_image_phase_checksum = Checksum.Calc(rx2_image_phase_table);
            FWCEEPROM.WriteRX2ImagePhaseChecksum(rx2_image_phase_checksum);

            FWCEEPROM.RX2ChecksumPresent = true;
        }

        public void VerifyRX2Checksums()
        {
            byte calc = 0, eeprom = 0;
            bool error_flag = false;
            string error = "";

            eeprom = FWCEEPROM.ReadRX2LevelChecksum();
            calc = Checksum.Calc(rx2_level_table);
            if (rx2_level_checksum != eeprom ||
                rx2_level_checksum != calc)
            {
                error_flag = true;
                error += "RX2 Level Checksum Error " +
                    "DB: " + rx2_level_checksum.ToString("X") +
                    " EEPROM: " + eeprom.ToString("X") +
                    " Calculated: " + calc.ToString("X");
            }

            eeprom = FWCEEPROM.ReadRX2ImageGainChecksum();
            calc = Checksum.Calc(rx2_image_gain_table);
            if (rx2_image_gain_checksum != eeprom ||
                rx2_image_gain_checksum != calc)
            {
                error_flag = true;
                error += "RX2 Image Gain Checksum Error " +
                    "DB: " + rx2_image_gain_checksum.ToString("X") +
                    " EEPROM: " + eeprom.ToString("X") +
                    " Calculated: " + calc.ToString("X");
            }

            eeprom = FWCEEPROM.ReadRX2ImagePhaseChecksum();
            calc = Checksum.Calc(rx2_image_phase_table);
            if (rx2_image_phase_checksum != eeprom ||
                rx2_image_phase_checksum != calc)
            {
                error_flag = true;
                error += "RX2 Image Phase Checksum Error.\n" +
                    "DB: " + rx2_image_phase_checksum.ToString("X") +
                    " EEPROM: " + eeprom.ToString("X") +
                    " Calculated: " + calc.ToString("X");
            }

            if (error_flag)
            {
                TextWriter writer = new StreamWriter(app_data_path + "\\checksum_error.log", true);
                string s = DateTime.Now.ToShortDateString() + "  " + DateTime.Now.ToShortTimeString();
                writer.WriteLine(s + "  " + error);
                writer.Close();
                FWCEEPROM.RX2ChecksumPresent = false;
            }
        }

        public void RestoreCalData()
        {
            bool trx_checksum_present = FWCEEPROM.TRXChecksumPresent;
            int checksum_error = 0;
            bool error_flag = false;
            string error = "";
            Progress p = new Progress("Retrieving Calibration Data from TRX EEPROM");
            p.SetPercent(0.0f);
            this.Invoke(new MethodInvoker(p.Show));
            Application.DoEvents();
            float total_reads = 324.0f;
            if (current_model == Model.FLEX3000)
                total_reads += 11.0f;  // for ATU SWR table
            int count = 0;

            checksum_error = 0;
            while (true)
            {
                FWCEEPROM.ReadRXLevel(rx1_level_table); // 33 reads
                rx1_level_checksum = Checksum.Calc(rx1_level_table);
                if (!trx_checksum_present) FWCEEPROM.WriteRXLevelChecksum(rx1_level_checksum);
                if (Checksum.Match(rx1_level_table, FWCEEPROM.ReadRXLevelChecksum())) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "RX1 Level Checksum verification error.\n" +
                        "DB: " + rx1_level_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadRXLevelChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(rx1_level_table).ToString("X") + "\n";
                    break;
                }
            }
            p.SetPercent((count += 33) / total_reads);
            Application.DoEvents();

            checksum_error = 0;
            while (true)
            {
                FWCEEPROM.ReadRXImage(rx1_image_gain_table, rx1_image_phase_table); // 22 reads
                rx1_image_gain_checksum = Checksum.Calc(rx1_image_gain_table);
                if (!trx_checksum_present) FWCEEPROM.WriteRXImageGainChecksum(rx1_image_gain_checksum);
                if (Checksum.Match(rx1_image_gain_table, FWCEEPROM.ReadRXImageGainChecksum())) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "RX1 Image Gain Checksum verification error.\n" +
                        "DB: " + rx1_image_gain_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadRXImageGainChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(rx1_image_gain_table).ToString("X") + "\n";
                    break;
                }
            }

            checksum_error = 0;
            do
            {
                rx1_image_phase_checksum = Checksum.Calc(rx1_image_phase_table);
                if (!trx_checksum_present) FWCEEPROM.WriteRXImagePhaseChecksum(rx1_image_phase_checksum);
                if (Checksum.Match(rx1_image_phase_table, FWCEEPROM.ReadRXImagePhaseChecksum())) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "RX1 Image Phase Checksum verification error.\n" +
                        "DB: " + rx1_image_phase_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadRXImagePhaseChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(rx1_image_phase_table).ToString("X") + "\n";
                    break;
                }
                FWCEEPROM.ReadRXImage(rx1_image_gain_table, rx1_image_phase_table); // 22 reads
            } while (true);
            p.SetPercent((count += 22) / total_reads);
            Application.DoEvents();

            checksum_error = 0;
            while (true)
            {
                FWCEEPROM.ReadTXImage(tx_image_gain_table, tx_image_phase_table); // 22 reads
                tx_image_gain_checksum = Checksum.Calc(tx_image_gain_table);
                if (!trx_checksum_present) FWCEEPROM.WriteTXImageGainChecksum(tx_image_gain_checksum);
                if (Checksum.Match(tx_image_gain_table, FWCEEPROM.ReadTXImageGainChecksum())) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "TX Image Gain Checksum verification error.\n" +
                        "DB: " + tx_image_gain_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadTXImageGainChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(tx_image_gain_table).ToString("X") + "\n";
                    break;
                }
            }

            checksum_error = 0;
            do
            {
                tx_image_phase_checksum = Checksum.Calc(tx_image_phase_table);
                if (!trx_checksum_present) FWCEEPROM.WriteTXImagePhaseChecksum(tx_image_phase_checksum);
                if (Checksum.Match(tx_image_phase_table, FWCEEPROM.ReadTXImagePhaseChecksum())) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "TX Image Phase Checksum verification error.\n" +
                        "DB: " + tx_image_phase_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadTXImagePhaseChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(tx_image_phase_table).ToString("X") + "\n";
                    break;
                }
                FWCEEPROM.ReadTXImage(tx_image_gain_table, tx_image_phase_table); // 22 reads
            } while (true);
            p.SetPercent((count += 22) / total_reads);
            Application.DoEvents();

            checksum_error = 0;
            while (true)
            {
                FWCEEPROM.ReadTXCarrier(tx_carrier_table); // 11 reads
                tx_carrier_checksum = Checksum.Calc(tx_carrier_table, true);
                if (!trx_checksum_present) FWCEEPROM.WriteTXCarrierChecksum(tx_carrier_checksum);
                if (Checksum.Match(tx_carrier_table, FWCEEPROM.ReadTXCarrierChecksum(), true)) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "TX Carrier Checksum verification error.\n" +
                        "DB: " + tx_carrier_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadTXCarrierChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(tx_carrier_table, true).ToString("X") + "\n";
                    break;
                }
            }
            p.SetPercent((count += 11) / total_reads);
            Application.DoEvents();

            checksum_error = 0;
            while (true)
            {
                FWCEEPROM.ReadPABias(pa_bias_table); // 8 reads
                pa_bias_checksum = Checksum.Calc(pa_bias_table, false);
                if (!trx_checksum_present) FWCEEPROM.WritePABiasChecksum(pa_bias_checksum);
                if (Checksum.Match(pa_bias_table, FWCEEPROM.ReadPABiasChecksum(), false)) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "PA Bias Checksum verification error.\n" +
                        "DB: " + pa_bias_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadPABiasChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(pa_bias_table, false).ToString("X") + "\n";
                    break;
                }
            }
            p.SetPercent((count += 8) / total_reads);
            Application.DoEvents();

            checksum_error = 0;
            while (true)
            {
                FWCEEPROM.ReadPAPower(power_table); // 143 reads
                pa_power_checksum = Checksum.Calc(power_table);
                if (!trx_checksum_present) FWCEEPROM.WritePAPowerChecksum(pa_power_checksum);
                if (Checksum.Match(power_table, FWCEEPROM.ReadPAPowerChecksum())) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "PA Power Checksum verification error.\n" +
                        "DB: " + pa_power_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadPAPowerChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(power_table).ToString("X") + "\n";
                    break;
                }
            }
            p.SetPercent((count += 143) / total_reads);
            Application.DoEvents();

            checksum_error = 0;
            while (true)
            {
                FWCEEPROM.ReadPABridge(pa_bridge_table); // 66 reads
                pa_bridge_checksum = Checksum.Calc(pa_bridge_table);
                if (!trx_checksum_present) FWCEEPROM.WritePABridgeChecksum(pa_bridge_checksum);
                if (Checksum.Match(pa_bridge_table, FWCEEPROM.ReadPABridgeChecksum())) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "PA Bridge Checksum verification error.\n" +
                        "DB: " + pa_bridge_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadPABridgeChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(pa_bridge_table).ToString("X") + "\n";
                    break;
                }
            }
            p.SetPercent((count += 66) / total_reads);
            Application.DoEvents();

            checksum_error = 0;
            while (true)
            {
                FWCEEPROM.ReadPASWR(swr_table); // 11 reads
                pa_swr_checksum = Checksum.Calc(swr_table);
                if (!trx_checksum_present) FWCEEPROM.WritePASWRChecksum(pa_swr_checksum);
                if (Checksum.Match(swr_table, FWCEEPROM.ReadPASWRChecksum())) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "PA SWR Checksum verification error.\n" +
                        "DB: " + pa_swr_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadPASWRChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(swr_table).ToString("X") + "\n";
                    break;
                }
            }
            p.SetPercent((count += 11) / total_reads);
            Application.DoEvents();

            if (current_model == Model.FLEX3000)
            {
                checksum_error = 0;
                while (true)
                {
                    FWCEEPROM.ReadATUSWR(atu_swr_table); // 11 reads
                    atu_swr_checksum = Checksum.Calc(atu_swr_table);
                    if (!trx_checksum_present) FWCEEPROM.WriteATUSWRChecksum(atu_swr_checksum);
                    if (Checksum.Match(atu_swr_table, FWCEEPROM.ReadATUSWRChecksum())) break;

                    checksum_error++;
                    if (checksum_error > 2)
                    {
                        error_flag = true;
                        error += "ATU SWR Checksum verification error.\n" +
                            "DB: " + atu_swr_checksum.ToString("X") +
                            " EEPROM: " + FWCEEPROM.ReadATUSWRChecksum().ToString("X") +
                            " Calculated: " + Checksum.Calc(atu_swr_table).ToString("X") + "\n";
                        break;
                    }
                }
                p.SetPercent((count += 11) / total_reads);
                Application.DoEvents();
            }

            if (error_flag)
            {
                TextWriter writer = new StreamWriter(app_data_path + "\\checksum_error.log", true);
                string s = DateTime.Now.ToShortDateString() + "  " + DateTime.Now.ToShortTimeString();
                writer.WriteLine(s + "  " + error);
                writer.Close();
                FWCEEPROM.TRXChecksumPresent = false;
            }

            if (flex5000DebugForm != null && !flex5000DebugForm.IsDisposed)
            {
                for (int i = 0; i < 8; i++)
                    flex5000DebugForm.SetPAPot(i, (byte)pa_bias_table[0][i]);
            }
            p.SetPercent((count += 8) / total_reads);
            Application.DoEvents();

            SyncCalDateTime();
            p.Hide();
            p.Close();
            Application.DoEvents();

            for (int i = (int)Band.B2M; i < (int)Band.LAST; i++)
                for (int j = 0; j < 13; j++)
                    power_table[i][j] = power_table[10][j];

            bool save_init = initializing;
            initializing = true;
            RX1Band = rx1_band;
            TXBand = tx_band;
            initializing = save_init;
        }

        public void RX2RestoreCalData()
        {
            bool rx2_checksum_present = FWCEEPROM.RX2ChecksumPresent;
            int checksum_error = 0;
            bool error_flag = false;
            string error = "";
            Progress p = new Progress("Retrieving Calibration Data from RX2 EEPROM");
            p.SetPercent(0.0f);
            this.Invoke(new MethodInvoker(p.Show));
            Application.DoEvents();
            float total_reads = 55.0f;
            int count = 0;

            checksum_error = 0;
            while (true)
            {
                FWCEEPROM.ReadRX2Level(rx2_level_table); // 33 reads
                rx2_level_checksum = Checksum.Calc(rx2_level_table);
                if (!rx2_checksum_present) FWCEEPROM.WriteRX2LevelChecksum(rx2_level_checksum);
                if (Checksum.Match(rx2_level_table, FWCEEPROM.ReadRX2LevelChecksum())) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "RX2 Level Checksum verification error.\n" +
                        "DB: " + rx2_level_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadRX2LevelChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(rx2_level_table).ToString("X") + "\n";
                    break;
                }
            }
            p.SetPercent((count += 33) / total_reads);
            Application.DoEvents();

            checksum_error = 0;
            while (true)
            {
                FWCEEPROM.ReadRX2Image(rx2_image_gain_table, rx2_image_phase_table); // 22 reads
                rx2_image_gain_checksum = Checksum.Calc(rx2_image_gain_table);
                if (!rx2_checksum_present) FWCEEPROM.WriteRX2ImageGainChecksum(rx2_image_gain_checksum);
                if (Checksum.Match(rx2_image_gain_table, FWCEEPROM.ReadRX2ImageGainChecksum())) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "RX2 Image Gain Checksum verification error.\n" +
                        "DB: " + rx2_image_gain_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadRX2ImageGainChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(rx2_image_gain_table).ToString("X") + "\n";
                    break;
                }
            }

            checksum_error = 0;
            do
            {
                rx2_image_phase_checksum = Checksum.Calc(rx2_image_phase_table);
                if (!rx2_checksum_present) FWCEEPROM.WriteRX2ImagePhaseChecksum(rx2_image_phase_checksum);
                if (Checksum.Match(rx2_image_phase_table, FWCEEPROM.ReadRX2ImagePhaseChecksum())) break;

                checksum_error++;
                if (checksum_error > 2)
                {
                    error_flag = true;
                    error += "RX2 Image Phase Checksum verification error.\n" +
                        "DB: " + rx2_image_phase_checksum.ToString("X") +
                        " EEPROM: " + FWCEEPROM.ReadRX2ImagePhaseChecksum().ToString("X") +
                        " Calculated: " + Checksum.Calc(rx2_image_phase_table).ToString("X") + "\n";
                    break;
                }
                FWCEEPROM.ReadRX2Image(rx2_image_gain_table, rx2_image_phase_table); // 22 reads
            } while (true);
            p.SetPercent((count += 22) / total_reads);
            Application.DoEvents();

            if (error_flag)
            {
                TextWriter writer = new StreamWriter(app_data_path + "\\checksum_error.log", true);
                string s = DateTime.Now.ToShortDateString() + "  " + DateTime.Now.ToShortTimeString();
                writer.WriteLine(s + "  " + error);
                writer.Close();
                FWCEEPROM.RX2ChecksumPresent = false;
            }

            RX2SyncCalDateTime();
            p.Hide();
            p.Close();

            bool save_init = initializing;
            initializing = true;
            RX2Band = rx2_band;
            initializing = save_init;
        }

        public void WriteCalData()
        {
            if (!fwc_init || (current_model != Model.FLEX5000 && current_model != Model.FLEX3000)) return;

            FWCEEPROM.WriteRXLevel(rx1_level_table, out rx1_level_checksum);
            FWCEEPROM.WriteRXImage(rx1_image_gain_table, rx1_image_phase_table, out rx1_image_gain_checksum, out rx1_image_phase_checksum);
            FWCEEPROM.WriteTXImage(tx_image_gain_table, tx_image_phase_table, out tx_image_gain_checksum, out tx_image_phase_checksum);
            FWCEEPROM.WriteTXCarrier(tx_carrier_table, out tx_carrier_checksum);
            FWCEEPROM.WritePABias(pa_bias_table, out pa_bias_checksum);
            FWCEEPROM.WritePABridge(pa_bridge_table, out pa_bridge_checksum);
            FWCEEPROM.WritePAPower(power_table, out pa_power_checksum);
            FWCEEPROM.WritePASWR(swr_table, out pa_swr_checksum);

            SyncCalDateTime();
        }

        public float GetRX1Level(Band b, int index)
        {
            return rx1_level_table[(int)b][index];
        }

        public float GetRX2Level(Band b, int index)
        {
            return rx2_level_table[(int)b][index];
        }

        /* public void ResetMemForm()
        {
            MemForm = null;
            MemForm = new Memory(this);
            MemForm.StartPosition = FormStartPosition.Manual;
        } */

        public FilterPreset[] rx1_filters = new FilterPreset[(int)DSPMode.LAST];
        public FilterPreset[] rx2_filters = new FilterPreset[(int)DSPMode.LAST];

        private void InitFilterPresets()
        {
            InitFilterPresets(rx1_filters);
            InitFilterPresets(rx2_filters);
        }

        private void InitFilterPresets(FilterPreset[] preset)
        {
            // used to initialize all the filter variables

            for (int m = (int)DSPMode.FIRST + 1; m < (int)DSPMode.LAST; m++)
            {
                preset[m] = new FilterPreset();
                for (Filter f = Filter.F1; f != Filter.LAST; f++)
                {
                    switch (m)
                    {
                        case (int)DSPMode.LSB:
                            //case (int)DSPMode.DIGL:
                            switch (f)
                            {
                                case Filter.F1:
                                    preset[m].SetFilter(f, -5150, -150, "5.0k");
                                    break;
                                case Filter.F2:
                                    preset[m].SetFilter(f, -4550, -150, "4.4k");
                                    break;
                                case Filter.F3:
                                    preset[m].SetFilter(f, -3950, -150, "3.8k");
                                    break;
                                case Filter.F4:
                                    preset[m].SetFilter(f, -3450, -150, "3.3k");
                                    break;
                                case Filter.F5:
                                    preset[m].SetFilter(f, -3050, -150, "2.9k");
                                    break;
                                case Filter.F6:
                                    preset[m].SetFilter(f, -2850, -150, "2.7k");
                                    break;
                                case Filter.F7:
                                    preset[m].SetFilter(f, -2550, -150, "2.4k");
                                    break;
                                case Filter.F8:
                                    preset[m].SetFilter(f, -2250, -150, "2.1k");
                                    break;
                                case Filter.F9:
                                    preset[m].SetFilter(f, -1950, -150, "1.8k");
                                    break;
                                case Filter.F10:
                                    preset[m].SetFilter(f, -1150, -150, "1.0k");
                                    break;
                                case Filter.VAR1:
                                    preset[m].SetFilter(f, -2850, -150, "Var 1");
                                    break;
                                case Filter.VAR2:
                                    preset[m].SetFilter(f, -2850, -150, "Var 2");
                                    break;
                            }
                            preset[m].LastFilter = Filter.F6;
                            break;
                        case (int)DSPMode.USB:
                            //case (int)DSPMode.DIGU:
                            switch (f)
                            {
                                case Filter.F1:
                                    preset[m].SetFilter(f, 150, 5150, "5.0k");
                                    break;
                                case Filter.F2:
                                    preset[m].SetFilter(f, 150, 4550, "4.4k");
                                    break;
                                case Filter.F3:
                                    preset[m].SetFilter(f, 150, 3950, "3.8k");
                                    break;
                                case Filter.F4:
                                    preset[m].SetFilter(f, 150, 3450, "3.3k");
                                    break;
                                case Filter.F5:
                                    preset[m].SetFilter(f, 150, 3050, "2.9k");
                                    break;
                                case Filter.F6:
                                    preset[m].SetFilter(f, 150, 2850, "2.7k");
                                    break;
                                case Filter.F7:
                                    preset[m].SetFilter(f, 150, 2550, "2.4k");
                                    break;
                                case Filter.F8:
                                    preset[m].SetFilter(f, 150, 2250, "2.1k");
                                    break;
                                case Filter.F9:
                                    preset[m].SetFilter(f, 150, 1950, "1.8k");
                                    break;
                                case Filter.F10:
                                    preset[m].SetFilter(f, 150, 1150, "1.0k");
                                    break;
                                case Filter.VAR1:
                                    preset[m].SetFilter(f, 150, 2850, "Var 1");
                                    break;
                                case Filter.VAR2:
                                    preset[m].SetFilter(f, 150, 2850, "Var 2");
                                    break;
                            }
                            preset[m].LastFilter = Filter.F6;
                            break;
                        case (int)DSPMode.DIGL:
                            switch (f)
                            {
                                case Filter.F1:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 1500, -digl_click_tune_offset + 1500, "3.0k");
                                    break;
                                case Filter.F2:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 1250, -digl_click_tune_offset + 1250, "2.5k");
                                    break;
                                case Filter.F3:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 1000, -digl_click_tune_offset + 1000, "2.0k");
                                    break;
                                case Filter.F4:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 750, -digl_click_tune_offset + 750, "1.5k");
                                    break;
                                case Filter.F5:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 500, -digl_click_tune_offset + 500, "1.0k");
                                    break;
                                case Filter.F6:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 400, -digl_click_tune_offset + 400, "800");
                                    break;
                                case Filter.F7:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 300, -digl_click_tune_offset + 300, "600");
                                    break;
                                case Filter.F8:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 150, -digl_click_tune_offset + 150, "300");
                                    break;
                                case Filter.F9:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 75, -digl_click_tune_offset + 75, "150");
                                    break;
                                case Filter.F10:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 38, -digl_click_tune_offset + 38, "75");
                                    break;
                                case Filter.VAR1:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 400, -digl_click_tune_offset + 400, "Var 1");
                                    break;
                                case Filter.VAR2:
                                    preset[m].SetFilter(f, -digl_click_tune_offset - 400, -digl_click_tune_offset + 400, "Var 2");
                                    break;
                            }
                            preset[m].LastFilter = Filter.F5;
                            break;
                        case (int)DSPMode.DIGU:
                            switch (f)
                            {
                                case Filter.F1:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 1500, digu_click_tune_offset + 1500, "3.0k");
                                    break;
                                case Filter.F2:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 1250, digu_click_tune_offset + 1250, "2.5k");
                                    break;
                                case Filter.F3:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 1000, digu_click_tune_offset + 1000, "2.0k");
                                    break;
                                case Filter.F4:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 750, digu_click_tune_offset + 750, "1.5k");
                                    break;
                                case Filter.F5:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 500, digu_click_tune_offset + 500, "1.0k");
                                    break;
                                case Filter.F6:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 400, digu_click_tune_offset + 400, "800");
                                    break;
                                case Filter.F7:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 300, digu_click_tune_offset + 300, "600");
                                    break;
                                case Filter.F8:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 150, digu_click_tune_offset + 150, "300");
                                    break;
                                case Filter.F9:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 75, digu_click_tune_offset + 75, "150");
                                    break;
                                case Filter.F10:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 38, digu_click_tune_offset + 38, "75");
                                    break;
                                case Filter.VAR1:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 400, digu_click_tune_offset + 400, "Var 1");
                                    break;
                                case Filter.VAR2:
                                    preset[m].SetFilter(f, digu_click_tune_offset - 400, digu_click_tune_offset + 400, "Var 2");
                                    break;
                            }
                            preset[m].LastFilter = Filter.F5;
                            break;
                        case (int)DSPMode.CWL:
                            switch (f)
                            {
                                case Filter.F1:
                                    preset[m].SetFilter(f, -cw_pitch - 500, -cw_pitch + 500, "1.0k");
                                    break;
                                case Filter.F2:
                                    preset[m].SetFilter(f, -cw_pitch - 400, -cw_pitch + 400, "800");
                                    break;
                                case Filter.F3:
                                    preset[m].SetFilter(f, -cw_pitch - 375, -cw_pitch + 375, "750");
                                    break;
                                case Filter.F4:
                                    preset[m].SetFilter(f, -cw_pitch - 300, -cw_pitch + 300, "600");
                                    break;
                                case Filter.F5:
                                    preset[m].SetFilter(f, -cw_pitch - 250, -cw_pitch + 250, "500");
                                    break;
                                case Filter.F6:
                                    preset[m].SetFilter(f, -cw_pitch - 200, -cw_pitch + 200, "400");
                                    break;
                                case Filter.F7:
                                    preset[m].SetFilter(f, -cw_pitch - 125, -cw_pitch + 125, "250");
                                    break;
                                case Filter.F8:
                                    preset[m].SetFilter(f, -cw_pitch - 50, -cw_pitch + 50, "100");
                                    break;
                                case Filter.F9:
                                    preset[m].SetFilter(f, -cw_pitch - 25, -cw_pitch + 25, "50");
                                    break;
                                case Filter.F10:
                                    preset[m].SetFilter(f, -cw_pitch - 13, -cw_pitch + 13, "25");
                                    break;
                                case Filter.VAR1:
                                    preset[m].SetFilter(f, -cw_pitch - 250, -cw_pitch + 250, "Var 1");
                                    break;
                                case Filter.VAR2:
                                    preset[m].SetFilter(f, -cw_pitch - 250, -cw_pitch + 250, "Var 2");
                                    break;
                            }
                            preset[m].LastFilter = Filter.F5;
                            break;
                        case (int)DSPMode.CWU:
                            switch (f)
                            {
                                case Filter.F1:
                                    preset[m].SetFilter(f, cw_pitch - 500, cw_pitch + 500, "1.0k");
                                    break;
                                case Filter.F2:
                                    preset[m].SetFilter(f, cw_pitch - 400, cw_pitch + 400, "800");
                                    break;
                                case Filter.F3:
                                    preset[m].SetFilter(f, cw_pitch - 375, cw_pitch + 375, "750");
                                    break;
                                case Filter.F4:
                                    preset[m].SetFilter(f, cw_pitch - 300, cw_pitch + 300, "600");
                                    break;
                                case Filter.F5:
                                    preset[m].SetFilter(f, cw_pitch - 250, cw_pitch + 250, "500");
                                    break;
                                case Filter.F6:
                                    preset[m].SetFilter(f, cw_pitch - 200, cw_pitch + 200, "400");
                                    break;
                                case Filter.F7:
                                    preset[m].SetFilter(f, cw_pitch - 125, cw_pitch + 125, "250");
                                    break;
                                case Filter.F8:
                                    preset[m].SetFilter(f, cw_pitch - 50, cw_pitch + 50, "100");
                                    break;
                                case Filter.F9:
                                    preset[m].SetFilter(f, cw_pitch - 25, cw_pitch + 25, "50");
                                    break;
                                case Filter.F10:
                                    preset[m].SetFilter(f, cw_pitch - 13, cw_pitch + 13, "25");
                                    break;
                                case Filter.VAR1:
                                    preset[m].SetFilter(f, cw_pitch - 250, cw_pitch + 250, "Var 1");
                                    break;
                                case Filter.VAR2:
                                    preset[m].SetFilter(f, cw_pitch - 250, cw_pitch + 250, "Var 2");
                                    break;
                            }
                            preset[m].LastFilter = Filter.F5;
                            break;
                        case (int)DSPMode.AM:
                            switch (f)
                            {
                                case Filter.F1:
                                    preset[m].SetFilter(f, -10000, 10000, "20k");
                                    //preset[m].SetFilter(f, -8000, 8000, "16k");
                                    break;
                                case Filter.F2:
                                    preset[m].SetFilter(f, -9000, 9000, "18k");
                                    //preset[m].SetFilter(f, -6000, 6000, "12k");
                                    break;
                                case Filter.F3:
                                    preset[m].SetFilter(f, -8000, 8000, "16k");
                                    //preset[m].SetFilter(f, -5000, 5000, "10k");
                                    break;
                                case Filter.F4:
                                    preset[m].SetFilter(f, -6000, 6000, "12k");
                                    //preset[m].SetFilter(f, -4000, 4000, "8.0k");
                                    break;
                                case Filter.F5:
                                    preset[m].SetFilter(f, -5000, 5000, "10k");
                                    //preset[m].SetFilter(f, -3300, 3300, "6.6k");
                                    break;
                                case Filter.F6:
                                    preset[m].SetFilter(f, -4500, 4500, "9.0k");
                                    //preset[m].SetFilter(f, -2600, 2600, "5.2k");
                                    break;
                                case Filter.F7:
                                    preset[m].SetFilter(f, -4000, 4000, "8.0k");
                                    //preset[m].SetFilter(f, -2000, 2000, "4.0k");
                                    break;
                                case Filter.F8:
                                    preset[m].SetFilter(f, -3500, 3500, "7.0k");
                                    //preset[m].SetFilter(f, -1550, 1550, "3.1k");
                                    break;
                                case Filter.F9:
                                    preset[m].SetFilter(f, -3000, 3000, "6.0k");
                                    //preset[m].SetFilter(f, -1450, 1450, "2.9k");
                                    break;
                                case Filter.F10:
                                    preset[m].SetFilter(f, -2500, 2500, "5.0k");
                                    //preset[m].SetFilter(f, -1200, 1200, "2.4k");
                                    break;
                                case Filter.VAR1:
                                    preset[m].SetFilter(f, -3000, 3000, "Var 1");
                                    break;
                                case Filter.VAR2:
                                    preset[m].SetFilter(f, -3000, 3000, "Var 2");
                                    break;
                            }
                            preset[m].LastFilter = Filter.F5;
                            break;
                        case (int)DSPMode.SAM:
                            switch (f)
                            {
                                case Filter.F1:
                                    preset[m].SetFilter(f, -10000, 10000, "20k");
                                    //preset[m].SetFilter(f, -8000, 8000, "16k");
                                    break;
                                case Filter.F2:
                                    preset[m].SetFilter(f, -9000, 9000, "18k");
                                    //preset[m].SetFilter(f, -6000, 6000, "12k");
                                    break;
                                case Filter.F3:
                                    preset[m].SetFilter(f, -8000, 8000, "16k");
                                    //preset[m].SetFilter(f, -5000, 5000, "10k");
                                    break;
                                case Filter.F4:
                                    preset[m].SetFilter(f, -6000, 6000, "12k");
                                    //preset[m].SetFilter(f, -4000, 4000, "8.0k");
                                    break;
                                case Filter.F5:
                                    preset[m].SetFilter(f, -5000, 5000, "10k");
                                    //preset[m].SetFilter(f, -3300, 3300, "6.6k");
                                    break;
                                case Filter.F6:
                                    preset[m].SetFilter(f, -4500, 4500, "9.0k");
                                    //preset[m].SetFilter(f, -2600, 2600, "5.2k");
                                    break;
                                case Filter.F7:
                                    preset[m].SetFilter(f, -4000, 4000, "8.0k");
                                    //preset[m].SetFilter(f, -2000, 2000, "4.0k");
                                    break;
                                case Filter.F8:
                                    preset[m].SetFilter(f, -3500, 3500, "7.0k");
                                    //preset[m].SetFilter(f, -1550, 1550, "3.1k");
                                    break;
                                case Filter.F9:
                                    preset[m].SetFilter(f, -3000, 3000, "6.0k");
                                    //preset[m].SetFilter(f, -1450, 1450, "2.9k");
                                    break;
                                case Filter.F10:
                                    preset[m].SetFilter(f, -2500, 2500, "5.0k");
                                    //preset[m].SetFilter(f, -1200, 1200, "2.4k");
                                    break;
                                case Filter.VAR1:
                                    preset[m].SetFilter(f, -3000, 3000, "Var 1");
                                    break;
                                case Filter.VAR2:
                                    preset[m].SetFilter(f, -3000, 3000, "Var 2");
                                    break;
                            }
                            preset[m].LastFilter = Filter.F5;
                            break;
                        /*        case (int)DSPMode.FM:
                                    switch (f)
                                    {
                                        case Filter.F1:
                                            preset[m].SetFilter(f, -8000, 8000, "16k");
                                            break;
                                        case Filter.F2:
                                            preset[m].SetFilter(f, -6000, 6000, "12k");
                                            break;
                                        case Filter.F3:
                                            preset[m].SetFilter(f, -5000, 5000, "10k");
                                            break;
                                        case Filter.F4:
                                            preset[m].SetFilter(f, -4000, 4000, "8.0k");
                                            break;
                                        case Filter.F5:
                                            preset[m].SetFilter(f, -3300, 3300, "6.6k");
                                            break;
                                        case Filter.F6:
                                            preset[m].SetFilter(f, -2600, 2600, "5.2k");
                                            break;
                                        case Filter.F7:
                                            preset[m].SetFilter(f, -2000, 2000, "4.0k");
                                            break;
                                        case Filter.F8:
                                            preset[m].SetFilter(f, -1550, 1550, "3.1k");
                                            break;
                                        case Filter.F9:
                                            preset[m].SetFilter(f, -1450, 1450, "2.9k");
                                            break;
                                        case Filter.F10:
                                            preset[m].SetFilter(f, -1200, 1200, "2.4k");
                                            break;
                                        case Filter.VAR1:
                                            preset[m].SetFilter(f, -3300, 3300, "Var 1");
                                            break;
                                        case Filter.VAR2:
                                            preset[m].SetFilter(f, -3300, 3300, "Var 2");
                                            break;
                                    }
                                    preset[m].LastFilter = Filter.F5;
                                    break; */
                        case (int)DSPMode.DSB:
                            switch (f)
                            {
                                case Filter.F1:
                                    preset[m].SetFilter(f, -8000, 8000, "16k");
                                    break;
                                case Filter.F2:
                                    preset[m].SetFilter(f, -6000, 6000, "12k");
                                    break;
                                case Filter.F3:
                                    preset[m].SetFilter(f, -5000, 5000, "10k");
                                    break;
                                case Filter.F4:
                                    preset[m].SetFilter(f, -4000, 4000, "8.0k");
                                    break;
                                case Filter.F5:
                                    preset[m].SetFilter(f, -3300, 3300, "6.6k");
                                    break;
                                case Filter.F6:
                                    preset[m].SetFilter(f, -2600, 2600, "5.2k");
                                    break;
                                case Filter.F7:
                                    preset[m].SetFilter(f, -2000, 2000, "4.0k");
                                    break;
                                case Filter.F8:
                                    preset[m].SetFilter(f, -1550, 1550, "3.1k");
                                    break;
                                case Filter.F9:
                                    preset[m].SetFilter(f, -1450, 1450, "2.9k");
                                    break;
                                case Filter.F10:
                                    preset[m].SetFilter(f, -1200, 1200, "2.4k");
                                    break;
                                case Filter.VAR1:
                                    preset[m].SetFilter(f, -3300, 3300, "Var 1");
                                    break;
                                case Filter.VAR2:
                                    preset[m].SetFilter(f, -3300, 3300, "Var 2");
                                    break;
                            }
                            preset[m].LastFilter = Filter.F5;
                            break;
                        default:
                            preset[m].LastFilter = Filter.NONE;
                            break;
                    }
                }
            }
        }

        private void InitDisplayModes()
        {
            // populate the display mode list
            for (DisplayMode dm = DisplayMode.FIRST + 1; dm < DisplayMode.LAST; dm++)
            {
                string s = dm.ToString().ToLower();
                s = s.Substring(0, 1).ToUpper() + s.Substring(1, s.Length - 1);
                comboDisplayMode.Items.Add(s);
            }
        }

        private void InitAGCModes()
        {
            // populate the AGC mode list
            for (AGCMode agc = AGCMode.FIRST + 1; agc < AGCMode.LAST; agc++)
            {
                string s = agc.ToString().ToLower();
                s = s.Substring(0, 1).ToUpper() + s.Substring(1, s.Length - 1);
                comboAGC.Items.Add(s);
            }

            for (AGCMode agc = AGCMode.FIRST + 1; agc < AGCMode.CUSTOM; agc++)
            {
                string s = agc.ToString().ToLower();
                s = s.Substring(0, 1).ToUpper() + s.Substring(1, s.Length - 1);
                comboRX2AGC.Items.Add(s);
            }
        }

        private void InitMultiMeterModes()
        {
            comboMeterRXMode.Items.Add("Signal");
            comboMeterRXMode.Items.Add("Sig Avg");
            comboMeterRXMode.Items.Add("ADC L");
            comboMeterRXMode.Items.Add("ADC R");
            comboMeterRXMode.Items.Add("ADC2 L");
            comboMeterRXMode.Items.Add("ADC2 R");
            comboMeterRXMode.Items.Add("Off");

            comboRX2MeterMode.Items.Add("Signal");
            comboRX2MeterMode.Items.Add("Sig Avg");
            comboRX2MeterMode.Items.Add("ADC L");
            comboRX2MeterMode.Items.Add("ADC R");
            comboRX2MeterMode.Items.Add("ADC2 L");
            comboRX2MeterMode.Items.Add("ADC2 R");
            comboRX2MeterMode.Items.Add("Off");

            comboMeterTXMode.Items.Add("Fwd Pwr");
            comboMeterTXMode.Items.Add("Ref Pwr");
            comboMeterTXMode.Items.Add("SWR");
            comboMeterTXMode.Items.Add("Mic");
            comboMeterTXMode.Items.Add("EQ");
            comboMeterTXMode.Items.Add("Leveler");
            comboMeterTXMode.Items.Add("Lev Gain");
            comboMeterTXMode.Items.Add("ALC");
            comboMeterTXMode.Items.Add("ALC Comp");
            comboMeterTXMode.Items.Add("CPDR");
            comboMeterTXMode.Items.Add("Off");
        }

        private void DisableAllFilters()
        {
            foreach (Control c in panelFilter.Controls)
            {
                if (c.GetType() == typeof(RadioButtonTS))
                {
                    c.Enabled = false;
                }
            }
            filterToolStripMenuItem.Enabled = false;
        }

        private void EnableAllFilters()
        {
            foreach (Control c in panelFilter.Controls)
            {
                if (c.GetType() == typeof(RadioButtonTS))
                {
                    c.Enabled = true;

                    if (c.BackColor == vfo_text_dark_color)
                    {
                        c.BackColor = button_selected_color;
                    }
                }
            }
            filterToolStripMenuItem.Enabled = true;
        }

        private void DisableAllBands()
        {
            foreach (Control c in panelBandHF.Controls)
            {
                c.Enabled = false;

                RadioButtonTS b = c as RadioButtonTS;
                if (b != null)
                {
                    if (b.BackColor == button_selected_color)
                    {
                        b.BackColor = vfo_text_dark_color;
                    }
                }
            }

            foreach (Control c in panelBandVHF.Controls)
            {
                c.Enabled = false;

                RadioButtonTS b = c as RadioButtonTS;
                if (b != null)
                {
                    if (b.BackColor == button_selected_color)
                    {
                        b.BackColor = vfo_text_dark_color;
                    }
                }
            }
        }

        private void EnableAllBands()
        {
            foreach (Control c in panelBandHF.Controls)
            {
                RadioButtonTS b = c as RadioButtonTS;
                if (b != null)
                {
                    b.Enabled = b.Text != "2" || XVTRPresent;

                    if (b.BackColor == vfo_text_dark_color)
                        b.BackColor = button_selected_color;
                }
                else c.Enabled = true;
            }

            foreach (Control c in panelBandVHF.Controls)
            {
                RadioButtonTS b = c as RadioButtonTS;
                if (b != null)
                {
                    if (b.Name == "panelBandHF")
                        b.Enabled = true;
                    else
                    {
                        int index = Int32.Parse(b.Name.Substring(10));
                        if (XVTRForm.GetEnabled(index))
                            b.Enabled = true;
                    }

                    if (b.BackColor == vfo_text_dark_color)
                        b.BackColor = button_selected_color;
                }
                else c.Enabled = true;
            }
        }

        private void DisableAllModes()
        {
            foreach (RadioButtonTS r in panelMode.Controls)
            {
                r.Enabled = false;
                if (r.BackColor == button_selected_color)
                    r.BackColor = vfo_text_dark_color;
            }
        }

        private void EnableAllModes()
        {
            foreach (RadioButtonTS r in panelMode.Controls)
            {
                if (r.Text != "")
                    r.Enabled = true;
                if (r.BackColor == vfo_text_dark_color)
                    r.BackColor = button_selected_color;
            }
        }

        private void DisableFilters(int lowcutoff)
        {
            // Disables all filters below the number passed in. 
            // For example, DisableFilters(100) would cause the
            // 100Hz, 50Hz and 25Hz filters to be disabled.

            foreach (Control c in panelFilter.Controls)
            {
                if (c.GetType() != typeof(RadioButtonTS) || c.Name.IndexOf("Var") >= 0) continue;
                string name = c.Name;
                int len;
                int begin = name.IndexOf("Filter") + 6;
                len = name.Length - begin;

                int filter_width = Int32.Parse(name.Substring(begin, len));
                if (filter_width >= lowcutoff) continue;
                c.Enabled = false;
                ((RadioButtonTS)c).Checked = false;
            }
        }

        private void GetVFOCharWidth()
        {
            // This function calculates the pixel width of the VFO display.
            // This information is used for mouse wheel hover tuning.

            Graphics g = txtVFOAFreq.CreateGraphics();

            SizeF size = g.MeasureString("0", txtVFOAFreq.Font, 1000, StringFormat.GenericTypographic);
            vfo_char_width = (int)Math.Round(size.Width - 2.0f, 0);	// subtract 2 since measure string includes 1 pixel border on each side
            float float_char_width = size.Width - 2.0f;

            size = g.MeasureString("00", txtVFOAFreq.Font, 1000, StringFormat.GenericTypographic);
            vfo_char_space = (int)Math.Round(size.Width - 2.0f - 2 * float_char_width, 0);

            size = g.MeasureString(separator, txtVFOAFreq.Font, 1000, StringFormat.GenericTypographic);
            vfo_decimal_width = (int)(size.Width - 2.0f);

            size = g.MeasureString("0" + separator + "0", txtVFOAFreq.Font, 1000, StringFormat.GenericTypographic);
            vfo_decimal_space = (int)Math.Round(size.Width - 2.0f - 2 * float_char_width, 0);

            size = g.MeasureString("1234.678901", txtVFOAFreq.Font, 1000, StringFormat.GenericTypographic);
            vfo_pixel_offset = (int)Math.Round(size.Width - 2.0f, 0);

            size = g.MeasureString("0", txtVFOALSD.Font, 1000, StringFormat.GenericTypographic);
            vfo_small_char_width = (int)Math.Round(size.Width - 2.0f, 0);
            float_char_width = size.Width - 2.0f;

            size = g.MeasureString("00", txtVFOALSD.Font, 1000, StringFormat.GenericTypographic);
            vfo_small_char_space = (int)Math.Round(size.Width - 2.0f - 2 * float_char_width, 0);

            g.Dispose();
        }

        private void GetVFOSubCharWidth()
        {
            // This function calculates the pixel width of the VFO display.
            // This information is used for mouse wheel hover tuning.

            Graphics g = txtVFOABand.CreateGraphics();

            SizeF size = g.MeasureString("0", txtVFOABand.Font, 1000, StringFormat.GenericTypographic);
            vfo_sub_char_width = (int)Math.Round(size.Width - 2.0f, 0);	// subtract 2 since measure string includes 1 pixel border on each side
            float float_char_width = size.Width - 2.0f;

            size = g.MeasureString("00", txtVFOABand.Font, 1000, StringFormat.GenericTypographic);
            vfo_sub_char_space = (int)Math.Round(size.Width - 2.0f - 2 * float_char_width, 0);

            size = g.MeasureString(separator, txtVFOABand.Font, 1000, StringFormat.GenericTypographic);
            vfo_sub_decimal_width = (int)(size.Width - 2.0f);

            size = g.MeasureString("0" + separator + "0", txtVFOABand.Font, 1000, StringFormat.GenericTypographic);
            vfo_sub_decimal_space = (int)Math.Round(size.Width - 2.0f - 2 * float_char_width, 0);

            size = g.MeasureString("1234.678901", txtVFOABand.Font, 1000, StringFormat.GenericTypographic);
            vfo_sub_pixel_offset = (int)Math.Round(size.Width - 2.0f, 0);

            /*size = g.MeasureString("0", txtVFOALSD.Font, 1000, StringFormat.GenericTypographic);
            vfo_small_char_width = (int)Math.Round(size.Width-2.0f, 0);
            float_char_width = size.Width-2.0f;

            size = g.MeasureString("00", txtVFOALSD.Font, 1000, StringFormat.GenericTypographic);
            vfo_small_char_space = (int)Math.Round(size.Width-2.0f - 2*float_char_width, 0);*/

            g.Dispose();
        }

        private void SaveBand()
        {
            // Used in Bandstacking algorithm
            double freq = Math.Round(VFOAFreq, 6);
            string filter = rx1_filter.ToString();
            string mode = rx1_dsp_mode.ToString();

            switch (rx1_band)
            {
                case Band.B160M:
                    if (freq >= 1.8 && freq < 2.0)
                        DB.SaveBandStack("160M", band_160m_index, mode, filter, freq);
                    break;
                case Band.B80M:
                    if (freq >= 3.5 && freq < 4.0)
                        DB.SaveBandStack("80M", band_80m_index, mode, filter, freq);
                    break;
                case Band.B60M:
                    if (extended || (current_region != FRSRegion.US || current_region != FRSRegion.UK))
                    {
                        if (freq >= 5.0 && freq < 6.0)
                            DB.SaveBandStack("60M", band_60m_index, mode, filter, freq);
                    }
                    else
                    {
                        if (RX1IsOn60mChannel())
                            DB.SaveBandStack("60M", band_60m_index, mode, filter, freq);
                    }
                    break;
                case Band.B40M:
                    if (freq >= 7.0 && freq < 7.3)
                        DB.SaveBandStack("40M", band_40m_index, mode, filter, freq);
                    break;
                case Band.B30M:
                    if (freq >= 10.1 && freq < 10.15)
                        DB.SaveBandStack("30M", band_30m_index, mode, filter, freq);
                    break;
                case Band.B20M:
                    if (freq >= 14.0 && freq < 14.350)
                        DB.SaveBandStack("20M", band_20m_index, mode, filter, freq);
                    break;
                case Band.B17M:
                    if (freq >= 18.068 && freq < 18.168)
                        DB.SaveBandStack("17M", band_17m_index, mode, filter, freq);
                    break;
                case Band.B15M:
                    if (freq >= 21.0 && freq < 21.45)
                        DB.SaveBandStack("15M", band_15m_index, mode, filter, freq);
                    break;
                case Band.B12M:
                    if (freq >= 24.890 && freq < 24.990)
                        DB.SaveBandStack("12M", band_12m_index, mode, filter, freq);
                    break;
                case Band.B10M:
                    if (freq >= 28.0 && freq < 29.7)
                        DB.SaveBandStack("10M", band_10m_index, mode, filter, freq);
                    break;
                case Band.B6M:
                    if (freq >= 50.0 && freq < 54.0)
                        DB.SaveBandStack("6M", band_6m_index, mode, filter, freq);
                    break;
                case Band.B2M:
                    if (freq >= 144.0 && freq < 146.0)
                        DB.SaveBandStack("2M", band_2m_index, mode, filter, freq);
                    break;
                case Band.WWV:
                    if (freq == 2.5 || freq == 5.0 || freq == 10.0 || freq == 15.0 || freq == 20.0)
                        DB.SaveBandStack("WWV", band_wwv_index, mode, filter, freq);
                    break;
                case Band.GEN:
                    DB.SaveBandStack("GEN", band_gen_index, mode, filter, freq);
                    break;
                case Band.VHF0:
                    if (freq >= XVTRForm.GetBegin(0) && freq <= XVTRForm.GetEnd(0))
                        DB.SaveBandStack("VHF0", band_vhf0_index, mode, filter, freq);
                    break;
                case Band.VHF1:
                    if (freq >= XVTRForm.GetBegin(1) && freq <= XVTRForm.GetEnd(1))
                        DB.SaveBandStack("VHF1", band_vhf1_index, mode, filter, freq);
                    break;
                case Band.VHF2:
                    if (freq >= XVTRForm.GetBegin(2) && freq <= XVTRForm.GetEnd(2))
                        DB.SaveBandStack("VHF2", band_vhf2_index, mode, filter, freq);
                    break;
                case Band.VHF3:
                    if (freq >= XVTRForm.GetBegin(3) && freq <= XVTRForm.GetEnd(3))
                        DB.SaveBandStack("VHF3", band_vhf3_index, mode, filter, freq);
                    break;
                case Band.VHF4:
                    if (freq >= XVTRForm.GetBegin(4) && freq <= XVTRForm.GetEnd(4))
                        DB.SaveBandStack("VHF4", band_vhf4_index, mode, filter, freq);
                    break;
                case Band.VHF5:
                    if (freq >= XVTRForm.GetBegin(5) && freq <= XVTRForm.GetEnd(5))
                        DB.SaveBandStack("VHF5", band_vhf5_index, mode, filter, freq);
                    break;
                case Band.VHF6:
                    if (freq >= XVTRForm.GetBegin(6) && freq <= XVTRForm.GetEnd(6))
                        DB.SaveBandStack("VHF6", band_vhf6_index, mode, filter, freq);
                    break;
                case Band.VHF7:
                    if (freq >= XVTRForm.GetBegin(7) && freq <= XVTRForm.GetEnd(7))
                        DB.SaveBandStack("VHF7", band_vhf7_index, mode, filter, freq);
                    break;
                case Band.VHF8:
                    if (freq >= XVTRForm.GetBegin(8) && freq <= XVTRForm.GetEnd(8))
                        DB.SaveBandStack("VHF8", band_vhf8_index, mode, filter, freq);
                    break;
                case Band.VHF9:
                    if (freq >= XVTRForm.GetBegin(9) && freq <= XVTRForm.GetEnd(9))
                        DB.SaveBandStack("VHF9", band_vhf9_index, mode, filter, freq);
                    break;
                case Band.VHF10:
                    if (freq >= XVTRForm.GetBegin(10) && freq <= XVTRForm.GetEnd(10))
                        DB.SaveBandStack("VHF10", band_vhf10_index, mode, filter, freq);
                    break;
                case Band.VHF11:
                    if (freq >= XVTRForm.GetBegin(11) && freq <= XVTRForm.GetEnd(11))
                        DB.SaveBandStack("VHF11", band_vhf11_index, mode, filter, freq);
                    break;
                case Band.VHF12:
                    if (freq >= XVTRForm.GetBegin(12) && freq <= XVTRForm.GetEnd(12))
                        DB.SaveBandStack("VHF12", band_vhf12_index, mode, filter, freq);
                    break;
                case Band.VHF13:
                    if (freq >= XVTRForm.GetBegin(13) && freq <= XVTRForm.GetEnd(13))
                        DB.SaveBandStack("VHF13", band_vhf13_index, mode, filter, freq);
                    break;
            }
        }

        private void SetBand(string mode, string filter, double freq)
        {
            // Set mode, filter, and frequency according to passed parameters
            RX1DSPMode = (DSPMode)Enum.Parse(typeof(DSPMode), mode, true);

            if (rx1_dsp_mode != DSPMode.DRM &&
                rx1_dsp_mode != DSPMode.SPEC)
            {
                RX1Filter = (Filter)Enum.Parse(typeof(Filter), filter, true);
            }

            VFOAFreq = freq;
        }

        private void ChangeTuneStepUp()
        {
            tune_step_index = (tune_step_index + 1) % tune_step_list.Count;
            txtWheelTune.Text = tune_step_list[tune_step_index].Name;
        }

        private void ChangeTuneStepDown()
        {
            tune_step_index = (tune_step_index - 1 + tune_step_list.Count) % tune_step_list.Count;
            txtWheelTune.Text = tune_step_list[tune_step_index].Name;
        }

        private void UpdateBandButtonColors()
        {
            /*SetRX1BandButtonColor(rx1_band);
            SetTXBandButtonColor(tx_band);
            SetRX2BandButtonColor(rx2_band);*/
            SetRX1BandButton(rx1_band);
        }

        private void DeselectHF()
        {
            radBand160.Checked = false;
            radBand80.Checked = false;
            radBand60.Checked = false;
            radBand40.Checked = false;
            radBand30.Checked = false;
            radBand20.Checked = false;
            radBand17.Checked = false;
            radBand15.Checked = false;
            radBand12.Checked = false;
            radBand10.Checked = false;
            radBand6.Checked = false;
            radBandWWV.Checked = false;
            radBandGEN.Checked = false;
            radBand2.Checked = false;
        }

        private void DeselectVHF()
        {
            radBandVHF0.Checked = false;
            radBandVHF1.Checked = false;
            radBandVHF2.Checked = false;
            radBandVHF3.Checked = false;
            radBandVHF4.Checked = false;
            radBandVHF5.Checked = false;
            radBandVHF6.Checked = false;
            radBandVHF7.Checked = false;
            radBandVHF8.Checked = false;
            radBandVHF9.Checked = false;
            radBandVHF10.Checked = false;
            radBandVHF11.Checked = false;
            radBandVHF12.Checked = false;
            radBandVHF13.Checked = false;
        }

        private void SetRX1BandButton(Band b)
        {
            switch (b)
            {
                case Band.B160M:
                    radBand160.Checked = true;
                    DeselectVHF();
                    break;
                case Band.B80M:
                    radBand80.Checked = true;
                    DeselectVHF();
                    break;
                case Band.B60M:
                    radBand60.Checked = true;
                    DeselectVHF();
                    break;
                case Band.B40M:
                    radBand40.Checked = true;
                    DeselectVHF();
                    break;
                case Band.B30M:
                    radBand30.Checked = true;
                    DeselectVHF();
                    break;
                case Band.B20M:
                    radBand20.Checked = true;
                    DeselectVHF();
                    break;
                case Band.B17M:
                    radBand17.Checked = true;
                    DeselectVHF();
                    break;
                case Band.B15M:
                    radBand15.Checked = true;
                    DeselectVHF();
                    break;
                case Band.B12M:
                    radBand12.Checked = true;
                    DeselectVHF();
                    break;
                case Band.B10M:
                    radBand10.Checked = true;
                    DeselectVHF();
                    break;
                case Band.B6M:
                    radBand6.Checked = true;
                    DeselectVHF();
                    break;
                case Band.B2M:
                    radBand2.Checked = true;
                    DeselectVHF();
                    break;
                case Band.WWV:
                    radBandWWV.Checked = true;
                    DeselectVHF();
                    break;
                case Band.GEN:
                    radBandGEN.Checked = true;
                    DeselectVHF();
                    break;
                case Band.VHF0:
                    radBandVHF0.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF1:
                    radBandVHF1.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF2:
                    radBandVHF2.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF3:
                    radBandVHF3.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF4:
                    radBandVHF4.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF5:
                    radBandVHF5.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF6:
                    radBandVHF6.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF7:
                    radBandVHF7.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF8:
                    radBandVHF8.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF9:
                    radBandVHF9.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF10:
                    radBandVHF10.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF11:
                    radBandVHF11.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF12:
                    radBandVHF12.Checked = true;
                    DeselectHF();
                    break;
                case Band.VHF13:
                    radBandVHF13.Checked = true;
                    DeselectHF();
                    break;
            }
        }

        private void SetRX1BandButtonColor(Band b)
        {
            // Sets band button color based on passed band.

            /*Button btn = null;
            switch(b)
            {
                case Band.GEN:
                    btn = btnBandGEN;
                    break;
                case Band.B160M:
                    btn = btnBand160;
                    break;
                case Band.B80M:
                    btn = btnBand80;
                    break;
                case Band.B60M:
                    btn = btnBand60;
                    break;
                case Band.B40M:
                    btn = btnBand40;
                    break;
                case Band.B30M:
                    btn = btnBand30;
                    break;
                case Band.B20M:
                    btn = btnBand20;
                    break;
                case Band.B17M:
                    btn = btnBand17;
                    break;
                case Band.B15M:
                    btn = btnBand15;
                    break;
                case Band.B12M:
                    btn = btnBand12;
                    break;
                case Band.B10M:
                    btn = btnBand10;
                    break;
                case Band.B6M:
                    btn = btnBand6;
                    break;
                case Band.B2M:
                    btn = btnBand2;
                    break;
                case Band.WWV:
                    btn = btnBandWWV;
                    break;
                case Band.VHF0:
                    btn = btnBandVHF0;
                    break;
                case Band.VHF1:
                    btn = btnBandVHF1;
                    break;
                case Band.VHF2:
                    btn = btnBandVHF2;
                    break;
                case Band.VHF3:
                    btn = btnBandVHF3;
                    break;
                case Band.VHF4:
                    btn = btnBandVHF4;
                    break;
                case Band.VHF5:
                    btn = btnBandVHF5;
                    break;
                case Band.VHF6:
                    btn = btnBandVHF6;
                    break;
                case Band.VHF7:
                    btn = btnBandVHF7;
                    break;
                case Band.VHF8:
                    btn = btnBandVHF8;
                    break;
                case Band.VHF9:
                    btn = btnBandVHF9;
                    break;
                case Band.VHF10:
                    btn = btnBandVHF10;
                    break;
                case Band.VHF11:
                    btn = btnBandVHF11;
                    break;
                case Band.VHF12:
                    btn = btnBandVHF12;
                    break;
                case Band.VHF13:
                    btn = btnBandVHF13;
                    break;
            }

            foreach(Button b2 in panelBandHF.Controls)
            {
                if(b2 == btn)
                {
                    b2.BackColor = rx1_band_color;
                }
                else
                {
                    if(b2.BackColor == rx1_band_color)
                        b2.BackColor = SystemColors.Control;
                }
            }

            foreach(Button b2 in panelBandVHF.Controls)
            {
                if(b2 == btn)
                {
                    b2.BackColor = rx1_band_color;
                }
                else
                {
                    if(b2.BackColor == rx1_band_color)
                        b2.BackColor = SystemColors.Control;
                }
            }*/
        }

        private void SetRX2BandButtonColor(Band b)
        {
            /*// Sets band button color based on passed band.
            if(!rx2_enabled) b = Band.FIRST;
            Button btn = null;
            switch(b)
            {
                case Band.GEN:
                    btn = btnBandGEN;
                    break;
                case Band.B160M:
                    btn = btnBand160;
                    break;
                case Band.B80M:
                    btn = btnBand80;
                    break;
                case Band.B60M:
                    btn = btnBand60;
                    break;
                case Band.B40M:
                    btn = btnBand40;
                    break;
                case Band.B30M:
                    btn = btnBand30;
                    break;
                case Band.B20M:
                    btn = btnBand20;
                    break;
                case Band.B17M:
                    btn = btnBand17;
                    break;
                case Band.B15M:
                    btn = btnBand15;
                    break;
                case Band.B12M:
                    btn = btnBand12;
                    break;
                case Band.B10M:
                    btn = btnBand10;
                    break;
                case Band.B6M:
                    btn = btnBand6;
                    break;
                case Band.B2M:
                    btn = btnBand2;
                    break;
                case Band.WWV:
                    btn = btnBandWWV;
                    break;
                case Band.VHF0:
                    btn = btnBandVHF0;
                    break;
                case Band.VHF1:
                    btn = btnBandVHF1;
                    break;
                case Band.VHF2:
                    btn = btnBandVHF2;
                    break;
                case Band.VHF3:
                    btn = btnBandVHF3;
                    break;
                case Band.VHF4:
                    btn = btnBandVHF4;
                    break;
                case Band.VHF5:
                    btn = btnBandVHF5;
                    break;
                case Band.VHF6:
                    btn = btnBandVHF6;
                    break;
                case Band.VHF7:
                    btn = btnBandVHF7;
                    break;
                case Band.VHF8:
                    btn = btnBandVHF8;
                    break;
                case Band.VHF9:
                    btn = btnBandVHF9;
                    break;
                case Band.VHF10:
                    btn = btnBandVHF10;
                    break;
                case Band.VHF11:
                    btn = btnBandVHF11;
                    break;
                case Band.VHF12:
                    btn = btnBandVHF12;
                    break;
                case Band.VHF13:
                    btn = btnBandVHF13;
                    break;
            }

            foreach(Button b2 in panelBandHF.Controls)
            {
                if(b2 == btn && b2.BackColor != rx1_band_color && b2.BackColor != tx_band_color)
                {
                    b2.BackColor = rx2_band_color;
                }
                else
                {
                    if(b2.BackColor == rx2_band_color)
                        b2.BackColor = SystemColors.Control;
                }
            }

            foreach(Button b2 in panelBandVHF.Controls)
            {
                if(b2 == btn && b2.BackColor != rx1_band_color && b2.BackColor != tx_band_color)
                {
                    b2.BackColor = rx2_band_color;
                }
                else
                {
                    if(b2.BackColor == rx2_band_color)
                        b2.BackColor = SystemColors.Control;
                }
            }
            /*if(b < Band.VHF0)
            {
//				if(!grpBandHF.Visible)
//				{
//					grpBandHF.Visible = true;
//					grpBandVHF.Visible = false;
//				}

                foreach(Button b2 in grpBandVHF.Controls)
                    b2.BackColor = SystemColors.Control;

                foreach(Button b2 in grpBandHF.Controls)
                {
                    if(b2 == btn && b2.BackColor != rx1_band_color && b2.BackColor != tx_band_color)
                    {
                        b2.BackColor = rx2_band_color;
                    }
                    else
                    {
                        if(b2.BackColor == rx2_band_color)
                            b2.BackColor = SystemColors.Control;
                    }

//					Color c = SystemColors.Control;
//					if(b2 == btn)
//						c = button_selected_color;
//
//					b2.BackColor = c;
                }
            }
            else
            {
//				if(!grpBandVHF.Visible)
//				{
//					grpBandVHF.Visible = true;
//					grpBandHF.Visible = false;
//				}

                foreach(Button b2 in grpBandHF.Controls)
                    b2.BackColor = SystemColors.Control;

                foreach(Button b2 in grpBandVHF.Controls)
                {
                    if(b2 == btn && b2.BackColor != rx1_band_color && b2.BackColor != tx_band_color)
                    {
                        b2.BackColor = rx2_band_color;
                    }
                    else
                    {
                        if(b2.BackColor == rx2_band_color)
                            b2.BackColor = SystemColors.Control;
                    }

//					Color c = SystemColors.Control;
//					if(b2 == btn)
//						c = button_selected_color;
//
//					b2.BackColor = c;
                }
            }*/
        }

        private void SetTXBandButtonColor(Band b)
        {
            /*// Sets band button color based on passed band.

            Button btn = null;
            switch(b)
            {
                case Band.GEN:
                    btn = btnBandGEN;
                    break;
                case Band.B160M:
                    btn = btnBand160;
                    break;
                case Band.B80M:
                    btn = btnBand80;
                    break;
                case Band.B60M:
                    btn = btnBand60;
                    break;
                case Band.B40M:
                    btn = btnBand40;
                    break;
                case Band.B30M:
                    btn = btnBand30;
                    break;
                case Band.B20M:
                    btn = btnBand20;
                    break;
                case Band.B17M:
                    btn = btnBand17;
                    break;
                case Band.B15M:
                    btn = btnBand15;
                    break;
                case Band.B12M:
                    btn = btnBand12;
                    break;
                case Band.B10M:
                    btn = btnBand10;
                    break;
                case Band.B6M:
                    btn = btnBand6;
                    break;
                case Band.B2M:
                    btn = btnBand2;
                    break;
                case Band.WWV:
                    btn = btnBandWWV;
                    break;
                case Band.VHF0:
                    btn = btnBandVHF0;
                    break;
                case Band.VHF1:
                    btn = btnBandVHF1;
                    break;
                case Band.VHF2:
                    btn = btnBandVHF2;
                    break;
                case Band.VHF3:
                    btn = btnBandVHF3;
                    break;
                case Band.VHF4:
                    btn = btnBandVHF4;
                    break;
                case Band.VHF5:
                    btn = btnBandVHF5;
                    break;
                case Band.VHF6:
                    btn = btnBandVHF6;
                    break;
                case Band.VHF7:
                    btn = btnBandVHF7;
                    break;
                case Band.VHF8:
                    btn = btnBandVHF8;
                    break;
                case Band.VHF9:
                    btn = btnBandVHF9;
                    break;
                case Band.VHF10:
                    btn = btnBandVHF10;
                    break;
                case Band.VHF11:
                    btn = btnBandVHF11;
                    break;
                case Band.VHF12:
                    btn = btnBandVHF12;
                    break;
                case Band.VHF13:
                    btn = btnBandVHF13;
                    break;
            }

            foreach(Button b2 in panelBandHF.Controls)
            {
                if(b2 == btn && b2.BackColor != rx1_band_color)
                {
                    b2.BackColor = tx_band_color;
                }
                else
                {
                    if(b2.BackColor == tx_band_color)
                        b2.BackColor = SystemColors.Control;
                }
            }
            /*if(b < Band.VHF0)
            {
//				if(!grpBandHF.Visible)
//				{
//					grpBandHF.Visible = true;
//					grpBandVHF.Visible = false;
//				}

                foreach(Button b2 in grpBandVHF.Controls)
                    b2.BackColor = SystemColors.Control;

                foreach(Button b2 in grpBandHF.Controls)
                {
                    if(b2 == btn && b2.BackColor != rx1_band_color)
                    {
                        b2.BackColor = tx_band_color;
                    }
                    else
                    {
                        if(b2.BackColor == tx_band_color)
                            b2.BackColor = SystemColors.Control;
                    }

//					Color c = SystemColors.Control;
//					if(b2 == btn)
//						c = button_selected_color;
//
//					b2.BackColor = c;
                }
            }
            else
            {
//				if(!grpBandVHF.Visible)
//				{
//					grpBandVHF.Visible = true;
//					grpBandHF.Visible = false;
//				}

                foreach(Button b2 in grpBandHF.Controls)
                    b2.BackColor = SystemColors.Control;

                foreach(Button b2 in grpBandVHF.Controls)
                {
                    if(b2 == btn && b2.BackColor != rx1_band_color)
                    {
                        b2.BackColor = tx_band_color;
                    }
                    else
                    {
                        if(b2.BackColor == tx_band_color)
                            b2.BackColor = SystemColors.Control;
                    }

//					Color c = SystemColors.Control;
//					if(b2 == btn)
//						c = button_selected_color;
//
//					b2.BackColor = c;
                }
            }*/
        }

        private Band BandByFreq(double freq, int xvtr_index, bool tx, FRSRegion region)
        {
            if (xvtr_index >= 0)
                return (Band)(Band.VHF0 + xvtr_index);

            if (extended) //w5wc
            // if(extended && tx)
            {
                if (freq >= 0.0 && freq <= 2.75)
                    return Band.B160M;
                else if (freq > 2.75 && freq < 5.0)
                    return Band.B80M;
                else if (freq >= 5.0 && freq < 7.0)
                    return Band.B60M;
                else if (freq >= 7.0 && freq <= 8.7)
                    return Band.B40M;
                else if (freq >= 8.7 && freq <= 12.075)
                    return Band.B30M;
                else if (freq >= 12.075 && freq <= 16.209)
                    return Band.B20M;
                else if (freq >= 16.209 && freq <= 19.584)
                    return Band.B17M;
                else if (freq >= 19.584 && freq <= 23.17)
                    return Band.B15M;
                else if (freq >= 23.17 && freq <= 26.495)
                    return Band.B12M;
                else if (freq >= 26.495 && freq <= 29.7)
                    return Band.B10M;
                else if (freq >= 50.0 && freq <= 54.0)
                    return Band.B6M;
                else if (freq >= 144.0 && freq <= 148.0)
                    return Band.B2M;
                else if (freq == 2.5 || freq == 5.0 ||
                    freq == 10.0 || freq == 15.0 ||
                    freq == 20.0)
                    return Band.WWV;
                else
                    return Band.GEN;
            }

            switch (region)
            {
                case FRSRegion.US:
                    if (freq >= 1.8 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 4.0)
                        return Band.B80M;
                    else if (freq >= 5.1 && freq <= 5.5)
                        return Band.B60M;
                    else if (freq >= 7.0 && freq <= 7.3)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.450)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 54.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Spain:
                    if (freq >= 1.81 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 54.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Europe:
                    if (freq >= 1.81 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.08 && freq <= 51.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Israel:
                    if (freq >= 1.81 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 50.2)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 146.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;
                
                case FRSRegion.UK:
                    if (freq >= 1.8 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 5.25 && freq <= 5.41)
                        return Band.B60M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 52.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Italy_Plus:
                    if (freq >= 1.81 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 6.975 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.08 && freq <= 51.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Japan:
                    if (freq >= 1.81 && freq <= 1.9125)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.805)
                        return Band.B80M;
                    else if (freq >= 5.1 && freq <= 5.5)
                        return Band.B60M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 54.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 || freq == 8.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Australia:
                    if (freq >= 1.8 && freq <= 1.875)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.3)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 54.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Norway:
                    if (freq >= 1.81 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 5.25 && freq <= 5.45)
                        return Band.B60M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 52.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Denmark:
                    if (freq >= 1.81 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 5.25 && freq <= 5.45)
                        return Band.B60M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 52.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Latvia:
                    if (freq >= 1.81 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 51.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Slovakia:
                    if (freq >= 1.81 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 52.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Bulgaria:
                    if (freq >= 1.81 && freq <= 1.85)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.05 && freq <= 50.2)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Greece:
                    if (freq >= 1.81 && freq <= 1.85)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 52.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Hungary:
                    if (freq >= 1.81 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.1)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 52.0)
                        return Band.B10M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Netherlands:
                    if (freq >= 1.81 && freq <= 1.88)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.0 && freq <= 52.0)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.France:
                    if (freq >= 1.81 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 24.99)
                        return Band.B12M;
                    else if (freq >= 28.0 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 50.08 && freq <= 51.2)
                        return Band.B6M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;

                case FRSRegion.Russia:
                    if (freq >= 1.81 && freq <= 2.0)
                        return Band.B160M;
                    else if (freq >= 3.5 && freq <= 3.8)
                        return Band.B80M;
                    else if (freq >= 7.0 && freq <= 7.2)
                        return Band.B40M;
                    else if (freq >= 10.1 && freq <= 10.15)
                        return Band.B30M;
                    else if (freq >= 14.0 && freq <= 14.35)
                        return Band.B20M;
                    else if (freq >= 18.068 && freq <= 18.168)
                        return Band.B17M;
                    else if (freq >= 21.0 && freq <= 21.45)
                        return Band.B15M;
                    else if (freq >= 24.89 && freq <= 25.14)
                        return Band.B12M;
                    else if (freq >= 26.97 && freq <= 29.7)
                        return Band.B10M;
                    else if (freq >= 144.0 && freq <= 148.0)
                        return Band.B2M;
                    else if (freq == 2.5 || freq == 5.0 ||
                        freq == 10.0 || freq == 15.0 ||
                        freq == 20.0)
                        return Band.WWV;
                    else
                        return Band.GEN;
            }
            // if nothing matched to this point, just put it in the GEN band
            return Band.GEN;
        }

        private void SetRX1Band(Band b)
        {
            if (disable_split_on_bandchange)
            {
                if (RX1Band != b && !tuning)
                {
                    if (chkVFOSplit.Checked)
                        chkVFOSplit.Checked = false;
                }
            }

            Band old_band = rx1_band;
            RX1Band = b;
            if (old_band != b) UpdateBandButtonColors();
        }

        private void SetRX2Band(Band b)
        {
            Band old_band = rx2_band;
            RX2Band = b;
            if (old_band != b)
                UpdateBandButtonColors();
        }

        private void SetTXBand(Band b)
        {
            if (disable_split_on_bandchange)
            {
                if (TXBand != b && !tuning)
                {
                    if (chkVFOSplit.Checked)
                        chkVFOSplit.Checked = false;
                }
            }

            Band old_band = tx_band;
            TXBand = b;
            if (old_band != b)
                UpdateBandButtonColors();

            if (!(fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)))
            {
                if (atu_present && xvtr_present)
                {
                    if (b == Band.B2M)
                        comboTuneMode.Enabled = false;
                    else
                        comboTuneMode.Enabled = true;
                }

                if (xvtr_present)
                {
                    if (atu_present &&
                        comboTuneMode.SelectedIndex > 0 &&
                        (ATUTuneMode)comboTuneMode.SelectedIndex != ATUTuneMode.BYPASS &&
                        (tuned_band != b) &&
                        tuned_band != Band.FIRST)
                    {
                        Hdw.PA_ATUTune(ATUTuneMode.BYPASS);
                        tuned_band = Band.FIRST;
                        chkTUN.BackColor = SystemColors.Control;
                    }

                    if (b == Band.B2M)
                    {
                        if (comboPreamp.Items.Contains("Off"))
                            comboPreamp.Items.Remove("Off");
                        if (comboPreamp.Items.Contains("Med"))
                            comboPreamp.Items.Remove("Med");
                        if (comboPreamp.SelectedIndex < 0)
                            comboPreamp.Text = "High";
                    }
                    else
                    {
                        if (!comboPreamp.Items.Contains("Off"))
                            comboPreamp.Items.Insert(0, "Off");
                        if (!comboPreamp.Items.Contains("Med"))
                            comboPreamp.Items.Insert(2, "Med");
                    }
                }
            }
        }

        private float GainByBand(Band b)
        {
            float retval = 0;
            switch (b)
            {
                case Band.B160M:
                    retval = SetupForm.PAGain160;
                    break;
                case Band.B80M:
                    retval = SetupForm.PAGain80;
                    break;
                case Band.B60M:
                    retval = SetupForm.PAGain60;
                    break;
                case Band.B40M:
                    retval = SetupForm.PAGain40;
                    break;
                case Band.B30M:
                    retval = SetupForm.PAGain30;
                    break;
                case Band.B20M:
                    retval = SetupForm.PAGain20;
                    break;
                case Band.B17M:
                    retval = SetupForm.PAGain17;
                    break;
                case Band.B15M:
                    retval = SetupForm.PAGain15;
                    break;
                case Band.B12M:
                    retval = SetupForm.PAGain12;
                    break;
                case Band.B10M:
                    retval = SetupForm.PAGain10;
                    break;
                case Band.B6M:
                    if (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)
                        retval = SetupForm.PAGain10;
                    else if (ModelIsHPSDRorHermes())
                        retval = SetupForm.PAGain6;
                    else retval = 1000;
                    break;
                case Band.VHF0:
                    retval = SetupForm.PAGainVHF0;
                    break;
                case Band.VHF1:
                    retval = SetupForm.PAGainVHF1;
                    break;
                case Band.VHF2:
                    retval = SetupForm.PAGainVHF2;
                    break;
                case Band.VHF3:
                    retval = SetupForm.PAGainVHF3;
                    break;
                case Band.VHF4:
                    retval = SetupForm.PAGainVHF4;
                    break;
                case Band.VHF5:
                    retval = SetupForm.PAGainVHF5;
                    break;
                case Band.VHF6:
                    retval = SetupForm.PAGainVHF6;
                    break;
                case Band.VHF7:
                    retval = SetupForm.PAGainVHF7;
                    break;
                case Band.VHF8:
                    retval = SetupForm.PAGainVHF8;
                    break;
                case Band.VHF9:
                    retval = SetupForm.PAGainVHF9;
                    break;
                case Band.VHF10:
                    retval = SetupForm.PAGainVHF10;
                    break;
                case Band.VHF11:
                    retval = SetupForm.PAGainVHF11;
                    break;
                case Band.VHF12:
                    retval = SetupForm.PAGainVHF12;
                    break;
                case Band.VHF13:
                    retval = SetupForm.PAGainVHF13;
                    break;
                default:
                    retval = 1000;
                    break;
            }

            return retval;
        }

        public void CheckSelectedButtonColor()
        {
            // used when changing the background color of selected buttons
            foreach (Control c in this.Controls)
            {
                if (c.GetType() == typeof(GroupBoxTS))
                {
                    foreach (Control c2 in ((GroupBoxTS)c).Controls)
                    {
                        if (c2.GetType() == typeof(RadioButtonTS))
                        {
                            RadioButtonTS r = (RadioButtonTS)c2;
                            if (r.Checked && r.BackColor != SystemColors.Control)
                            {
                                c2.BackColor = button_selected_color;
                            }
                        }
                        else if (c2.GetType() == typeof(CheckBoxTS))
                        {
                            CheckBoxTS chk = (CheckBoxTS)c2;
                            if (chk.Checked && chk.BackColor != SystemColors.Control)
                            {
                                c2.BackColor = button_selected_color;
                            }
                        }
                        else if (c2.GetType() == typeof(NumericUpDownTS))
                        {
                            NumericUpDownTS ud = (NumericUpDownTS)c2;
                            if (ud.BackColor != SystemColors.Window)
                            {
                                c2.BackColor = button_selected_color;
                            }
                        }
                        else if (c2.GetType() == typeof(ButtonTS))
                        {
                            ButtonTS b = (ButtonTS)c2;
                            if (b.BackColor != SystemColors.Control)
                            {
                                c2.BackColor = button_selected_color;
                            }
                        }
                    }
                }
                else if (c.GetType() == typeof(RadioButtonTS))
                {
                    RadioButtonTS r = (RadioButtonTS)c;
                    if (r.Checked && r.BackColor != SystemColors.Control)
                        c.BackColor = button_selected_color;
                }
                else if (c.GetType() == typeof(CheckBoxTS))
                {
                    CheckBoxTS chk = (CheckBoxTS)c;
                    if (chk.Checked && chk.BackColor != SystemColors.Control)
                        c.BackColor = button_selected_color;
                }
                else if (c.GetType() == typeof(NumericUpDownTS))
                {
                    NumericUpDownTS ud = (NumericUpDownTS)c;
                    if (ud.BackColor != SystemColors.Window)
                        c.BackColor = button_selected_color;
                }
                else if (c.GetType() == typeof(ButtonTS))
                {
                    ButtonTS b = (ButtonTS)c;
                    if (b.BackColor != SystemColors.Control)
                        c.BackColor = button_selected_color;
                }
            }
        }

        private double PABandOffset(Band b)
        {
            double num = 0;
            switch (b)
            {
                case Band.B160M:
                    num = SetupForm.PAADC160;
                    break;
                case Band.B80M:
                    num = SetupForm.PAADC80;
                    break;
                case Band.B60M:
                    num = SetupForm.PAADC60;
                    break;
                case Band.B40M:
                    num = SetupForm.PAADC40;
                    break;
                case Band.B30M:
                    num = SetupForm.PAADC30;
                    break;
                case Band.B20M:
                    num = SetupForm.PAADC20;
                    break;
                case Band.B17M:
                    num = SetupForm.PAADC17;
                    break;
                case Band.B15M:
                    num = SetupForm.PAADC15;
                    break;
                case Band.B12M:
                    num = SetupForm.PAADC12;
                    break;
                case Band.B10M:
                    num = SetupForm.PAADC10;
                    break;
            }

            if (num == 0) return 0;
            //return 100000 / Math.Pow(num, 2);
            return (double)108 / num;
        }

        private double SWR(int adc_fwd, int adc_rev)
        {
            if (adc_fwd == 0 && adc_rev == 0)
                return 1.0;
            else if (adc_rev > adc_fwd)
                return 50.0;

            double Ef = ScaledVoltage(adc_fwd);
            double Er = ScaledVoltage(adc_rev);

            double swr = (Ef + Er) / (Ef - Er);

            return swr;
        }

        public double ALEXSWR(double g_fwd, double g_rev)
        {
            double swr;
            if (!swrprotection || !alexpresent || (g_fwd == 0 && g_rev == 0) || g_fwd < 1)
            {
                JanusAudio.SetSWRProtect(1.0f);
                return 1.0;
            }

            if (g_rev > g_fwd)
            {
                HighSWR = true;
                UpdateDisplay();
                swr = 50.0;
            }
            else
            {
                double rho = Math.Sqrt(g_rev / g_fwd);
                swr = (1.0 + rho) / (1.0 - rho);
            }
            if (swr > 2)
            {
                JanusAudio.SetSWRProtect(0.5f);
                HighSWR = true;
                UpdateDisplay();
                if (swr > 3) JanusAudio.SetSWRProtect(0.25f);
            }
            else
            {
                JanusAudio.SetSWRProtect(1.0f);
                HighSWR = false;
                UpdateDisplay();
            }
            return swr;
        }

        public double FWCSWR(int adc_fwd, int adc_rev)
        {
            double f = FWCPAPower(adc_fwd);
            double r = FWCPAPower(adc_rev) * swr_table[(int)tx_band];
            //Debug.WriteLine("FWCSWR: fwd:"+adc_fwd+" rev:"+adc_rev+" f:"+f.ToString("f2")+" r:"+r.ToString("f2"));

            if ((adc_fwd == 0 && adc_rev == 0) || (f < 1.0 && r < 1.0)) return 1.0;
            if (adc_rev > adc_fwd) return 50.0;

            double sqrt_r_over_f = Math.Sqrt(r / f);
            return (1.0 + sqrt_r_over_f) / (1.0 - sqrt_r_over_f);
        }

        private double ScaledVoltage(int adc)
        {
            double v_det = adc * 0.062963;			// scale factor in V/bit including pot ratio
            double v_out = v_det * 10.39853;		// scale factor in V/V for bridge output to detector voltage
            return v_out * PABandOffset(tx_band);
            //double v_det = adc * 0.0304;
            //			double v_out = 0;
            //			if(v_det >= 1.6)
            //				v_out = (-0.241259304*v_det+12.07915098)*v_det*PABandOffset(CurrentBand);
            //			else if(v_det > 0.35)
            //				v_out = (1/Math.Pow(v_det, 2)+11.3025111)*v_det*PABandOffset(CurrentBand);
            //return v_out;
        }

        private double ADCtodBm(int adc_data)
        {
            if (adc_data == 0)
                return 0;

            double mult = 100000 / Math.Pow(225 / PABandOffset(tx_band), 2);
            return 10 * Math.Log10(mult * Math.Pow(adc_data, 2));
        }

        private double PAPower(int adc)
        {
            double v_out = ScaledVoltage(adc);
            double pow = Math.Pow(v_out, 2) / 50;
            pow = Math.Max(pow, 0.0);
            return pow;
        }

        private double WattsTodBm(double watts)
        {
            return 10 * Math.Log10(watts / 0.001);
        }

        private double dBmToWatts(double dBm)
        {
            return Math.Pow(10, dBm / 10) * 0.001;
        }

        public double FWCPAPower(int adc) // adc in, watts out
        {
            if (adc < 2) return 0.0;
            double[] table = { 1.0, 2.0, 5.0, 10.0, 20.0, 90.0 };

            double watts = 0.0;
            double volts = (double)adc / 4096 * 2.5;
            double v2 = Math.Pow(volts, 2);

            int high_index = 0;
            for (int i = 0; i < 6; i++)
            {
                if (volts < pa_bridge_table[(int)tx_band][i])
                {
                    high_index = i;
                    break;
                }
                if (i == 5) high_index = 6;
            }

            if (high_index != 6)
            {
                double v_low = 0.0, v_high = 0.0;
                double p_low = 0.0, p_high = 0.0;

                if (high_index != 0) v_low = pa_bridge_table[(int)tx_band][high_index - 1];
                v_high = pa_bridge_table[(int)tx_band][high_index];
                if (high_index != 0) p_low = table[high_index - 1];
                p_high = table[high_index];
                Debug.Assert(v_low <= volts && v_high >= volts);

                double v_low_2 = Math.Pow(v_low, 2.0);
                double v_high_2 = Math.Pow(v_high, 2.0);

                watts = p_low + (p_high - p_low) * ((v2 - v_low_2) / (v_high_2 - v_low_2));
            }
            else
            {
                double v_low_2 = Math.Pow(pa_bridge_table[(int)tx_band][4], 2.0);
                double v_high_2 = Math.Pow(pa_bridge_table[(int)tx_band][5], 2.0);

                if (v_low_2 != v_high_2)
                {
                    double a = 70.0 / (v_high_2 - v_low_2);
                    double b = 90.0 / (a * v_high_2);

                    watts = a * v2 + b;
                }
            }

            return watts;
        }

        private static bool CheckForOpenProcesses()
        {
            // find all open PowerSDR processes
            Process[] p = Process.GetProcessesByName("PowerSDR");
            if (p.Length > 1)
            {
                DialogResult dr = MessageBox.Show("There are other PowerSDR instances running.\n" +
                    "Are you sure you want to continue?",
                    "Continue?",
                    MessageBoxButtons.YesNo,
                    MessageBoxIcon.Question);
                if (dr == DialogResult.No)
                {
                    return false;
                }
            }
            return true;
        }

        public int VersionTextToInt(string version)	// takes a version string like "1.0.6" 
        {											// and converts it to an int like 010006.
            string[] nums = version.Split('.');
            if (nums.Length < 3 || nums.Length > 4) return -1;

            int num1 = Int32.Parse(nums[0]);
            int num2 = Int32.Parse(nums[1]);
            int num3 = Int32.Parse(nums[2]);
            int num4 = 0;
            if (nums.Length == 4) num4 = Int32.Parse(nums[3]);

            return num1 * 1000000 + num2 * 10000 + num3 * 100 + num4;
        }

        public void CheckForUpdates()
        {
            // notes taken from http://free.netartmedia.net/CSharp/CSharp5.html
            try
            {
                // Create a 'WebRequest' object with the specified url. 
                WebRequest myWebRequest = WebRequest.Create("http://www.flex-radio.com/PowerSDR_Update.txt");

                // Send the 'WebRequest' and wait for response. 
                WebResponse myWebResponse = myWebRequest.GetResponse();

                // Obtain a 'Stream' object associated with the response object. 
                Stream ReceiveStream = myWebResponse.GetResponseStream();

                // Pipe the stream to a higher level stream reader. 
                StreamReader readStream = new StreamReader(ReceiveStream);

                // Read the entire stream into a string object.
                string strResponse = readStream.ReadToEnd();

                // Release the resources. 
                readStream.Close();
                myWebResponse.Close();

                // Split the lines into a string array.
                string[] lines = strResponse.Split('\n');

                string temp = "";
                int begin_index = 0, end_index = 0, line_index = 0;
                int version_value = 0;

                // find first line of Beta release info
                for (int i = 0; i < lines.Length; i++)
                {
                    if (lines[i].StartsWith("========"))
                    {
                        line_index = i + 1;
                        break;
                    }
                }

                // get current version value in integer form (i.e. 1.1.6 = 1106)
                Assembly assembly = Assembly.GetExecutingAssembly();
                FileVersionInfo fvi = FileVersionInfo.GetVersionInfo(assembly.Location);
                int current_version = VersionTextToInt(fvi.FileVersion);

                if (notify_on_release)
                {
                    // find release version value in integer form.
                    begin_index = 0;
                    end_index = lines[0].IndexOf("Released");
                    temp = lines[0].Substring(begin_index, end_index - begin_index);
                    temp = temp.Replace("//", "");
                    // line should be something like v1.6.1 Released 05/04/06 Rev 469

                    version_value = VersionTextToInt(temp.Substring(1, temp.IndexOf(" ") - 1));

                    // if the new value is higher, display form
                    if (version_value > current_version)
                    {
                        string s = "";
                        // search for Bug Fixes
                        for (int i = 0; i < line_index; i++)
                        {
                            temp = lines[i].Replace("//", "").Trim();
                            if (temp.StartsWith("Bug Fixes"))
                            {
                                s = "\n\n\nBug Fixes:\n\n";
                                for (int j = i + 1; j < line_index; j++)
                                {
                                    temp = lines[j].Replace("//", "").Trim();
                                    if (temp.StartsWith("Issue:"))
                                    {
                                        temp = temp.Substring(temp.IndexOf(":") + 1).Trim();
                                        while (!temp.EndsWith("."))
                                            temp += " " + lines[++j].Replace("//", "").Trim();
                                        s += temp + "\n";
                                    }
                                }
                                break;
                            }
                        }

                        // search for Modifications
                        for (int i = 0; i < line_index; i++)
                        {
                            temp = lines[i].Replace("//", "").Trim();
                            if (temp.StartsWith("Modifications"))
                            {
                                s += "\n\nModifications:\n\n";
                                for (int j = i + 1; j < line_index; j++)
                                {
                                    temp = lines[j].Replace("//", "").Trim();
                                    if (temp.StartsWith("Feature:"))
                                    {
                                        temp = temp.Substring(temp.IndexOf(":") + 1).Trim();
                                        while (!temp.EndsWith("."))
                                            temp += " " + lines[++j].Replace("//", "").Trim();
                                        s += temp + "\n";
                                    }
                                }
                                break;
                            }
                        }

                        // search for New Features
                        for (int i = 0; i < line_index; i++)
                        {
                            temp = lines[i].Replace("//", "").Trim();
                            if (temp.StartsWith("New Features"))
                            {
                                s += "\n\nNew Features:\n\n";
                                for (int j = i + 1; j < line_index; j++)
                                {
                                    temp = lines[j].Replace("//", "").Trim();
                                    if (temp.StartsWith("Feature:"))
                                    {
                                        temp = temp.Substring(temp.IndexOf(":") + 1).Trim();
                                        while (!temp.EndsWith("."))
                                            temp += " " + lines[++j].Replace("//", "").Trim();
                                        s += temp + "\n";
                                    }
                                }
                                break;
                            }
                        }

                        MessageBox.Show("New Release: " + lines[0].Substring(2) + s,
                            "New Release", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    }
                }

                // if the line_index = 0, then the response was bad
                // or the file is not formatted correctly.
                if (line_index == 0)
                    return;

                if (notify_on_beta)
                {
                    int beta_line = line_index;

                    // find beta version value in integer form.
                    end_index = lines[line_index].IndexOf("Released");
                    temp = lines[line_index].Substring(0, end_index - begin_index);
                    temp = temp.Replace("//", "");

                    version_value = VersionTextToInt(temp.Substring(1, temp.IndexOf(" ") - 1));

                    // if the new value is higher, display form
                    if (version_value > current_version)
                    {
                        string s = "";
                        // search for Bug Fixes
                        for (int i = line_index; i < lines.Length - 1; i++)
                        {
                            temp = lines[i].Replace("//", "").Trim();
                            if (temp.StartsWith("Bug Fixes"))
                            {
                                s = "\n\n\nBug Fixes:\n\n";
                                for (int j = i + 1; j < lines.Length - 1; j++)
                                {
                                    temp = lines[j].Replace("//", "").Trim();
                                    if (temp.StartsWith("Issue:"))
                                    {
                                        temp = temp.Substring(temp.IndexOf(":") + 1).Trim();
                                        while (!temp.EndsWith("."))
                                            temp += " " + lines[++j].Replace("//", "").Trim();
                                        s += temp + "\n";
                                    }
                                }
                                line_index = i;
                                break;
                            }
                        }


                        // search for Modifications
                        for (int i = line_index; i < lines.Length - 1; i++)
                        {
                            temp = lines[i].Replace("//", "").Trim();
                            if (temp.StartsWith("Modifications"))
                            {
                                s += "\n\nModifications:\n\n";
                                for (int j = i + 1; j < lines.Length - 1; j++)
                                {
                                    temp = lines[j].Replace("//", "").Trim();
                                    if (temp.StartsWith("Feature:"))
                                    {
                                        temp = temp.Substring(temp.IndexOf(":") + 1).Trim();
                                        while (!temp.EndsWith("."))
                                            temp += " " + lines[++j].Replace("//", "").Trim();
                                        s += temp + "\n";
                                    }
                                }
                                line_index = i;
                                break;
                            }
                        }

                        // search for New Features
                        for (int i = line_index; i < lines.Length - 1; i++)
                        {
                            temp = lines[i].Replace("//", "").Trim();
                            if (temp.StartsWith("New Features"))
                            {
                                s += "\n\nNew Features:\n\n";
                                for (int j = i + 1; j < lines.Length - 1; j++)
                                {
                                    temp = lines[j].Replace("//", "").Trim();
                                    if (temp.StartsWith("Feature:"))
                                    {
                                        temp = temp.Substring(temp.IndexOf(":") + 1).Trim();
                                        while (!temp.EndsWith("."))
                                            temp += " " + lines[++j].Replace("//", "").Trim();
                                        s += temp + "\n";
                                    }
                                }
                                break;
                            }
                        }
                        MessageBox.Show("New Beta Release: " + lines[beta_line].Substring(2) + s,
                            "New Beta Release", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    }
                }

            }
            catch (Exception)
            {
                //#if(DEBUG)
                //				MessageBox.Show("Error in CheckForUpdates() in console.cs\n\n"+e.Message);
                //#endif
                // do nothing here as internet may just not be present
            }
        }

        public bool CheckValidTXFreq(FRSRegion r, double f, DSPMode mode)
        {
            if (extended || tx_xvtr_index > -1)
                return true;

            bool retval = false;

            switch (mode)
            {
                case DSPMode.LSB:
                case DSPMode.DIGL:
                case DSPMode.USB:
                case DSPMode.DIGU:
                case DSPMode.DSB:
                case DSPMode.AM:
                case DSPMode.SAM:
                case DSPMode.FM:
                    retval = !CheckValidTXFreq_Private(r, f + Display.TXFilterLow * 1e-6) ? false :
                        CheckValidTXFreq_Private(r, f + Display.TXFilterHigh * 1e-6);
                    break;
                case DSPMode.CWL:
                case DSPMode.CWU:
                    retval = CheckValidTXFreq_Private(r, f);
                    break;
                case DSPMode.DRM:
                    retval = CheckValidTXFreq_Private(r, f - 0.012 + Display.TXFilterLow * 1e-6) ? false :
                       CheckValidTXFreq_Private(r, f - 0.012 + Display.TXFilterHigh * 1e-6);
                    break;
            }

            return retval;
        }

        private bool CheckValidTXFreq_Private(FRSRegion r, double f)
        {
            if (extended || tx_xvtr_index > -1)
                return true;

            bool ret_val = false;
            f = Math.Round(f, 6);

            switch (r)
            {
                case FRSRegion.US:
                    if (f >= 1.8 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 4.0) ret_val = true;
                    else if (f >= 5.3305 && f <= 5.3334) ret_val = true; // allow for default 3100Hz TX Filter High Cut
                    else if (f >= 5.3465 && f <= 5.3494) ret_val = true;
                    else if (f >= 5.357 && f <= 5.3599) ret_val = true;
                    else if (f >= 5.3715 && f <= 5.3744) ret_val = true;
                    else if (f >= 5.4035 && f <= 5.4064) ret_val = true;
                    else if (f >= 7.0 && f <= 7.3) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 54.0) ret_val = true;
                    else if (f >= 144.0 && f <= 146.0)
                    {
                        if (xvtr_present)
                            ret_val = true;
                        else
                            ret_val = false;
                    }
                    else ret_val = false;
                    break;
                case FRSRegion.Spain:
                    if (f >= 1.81 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 54.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Europe:
                    if (f >= 1.81 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.08 && f <= 51.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Israel:
                    if (f >= 1.81 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 50.2) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.UK:
                    if (f >= 1.81 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 5.2585 && f <= 5.2615) ret_val = true;
                    else if (f >= 5.2785 && f <= 5.2815) ret_val = true;
                    else if (f >= 5.2885 && f <= 5.2915) ret_val = true;
                    else if (f >= 5.3665 && f <= 5.3695) ret_val = true;
                    else if (f >= 5.3715 && f <= 5.3745) ret_val = true;
                    else if (f >= 5.3985 && f <= 5.4015) ret_val = true;
                    else if (f >= 5.4035 && f <= 5.4065) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 52.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Italy_Plus:
                    if (f >= 1.81 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 6.975 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.08 && f <= 51.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Japan:
                    if (f >= .1357 && f <= .1378) ret_val = true;
                    else if (f >= 1.81 && f <= 1.825) ret_val = true;
                    else if (f >= 1.9075 && f <= 1.9125) ret_val = true;
                    else if (f >= 3.5 && f <= 3.575) ret_val = true;
                    else if (f >= 3.599 && f <= 3.612) ret_val = true;
                    else if (f >= 3.680 && f <= 3.687) ret_val = true;
                    else if (f >= 3.702 && f <= 3.716) ret_val = true;
                    else if (f >= 3.745 && f <= 3.770) ret_val = true;
                    else if (f >= 3.791 && f <= 3.805) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 54.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Australia:
                    if (f >= 1.8 && f <= 1.875) ret_val = true;
                    else if (f >= 3.5 && f <= 3.7) ret_val = true;
                    else if (f >= 3.776 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.3) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 54.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Norway:
                    if (f >= 1.8 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 5.25 && f <= 5.45) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 54.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Denmark: // 6
                    if (f >= 1.81 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 5.25 && f <= 5.45) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 52.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Latvia: // 7
                    if (f >= 1.81 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 51.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Slovakia: // 8
                    if (f >= 1.81 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 52.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Bulgaria: // 9
                    if (f >= 1.81 && f <= 1.85) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.05 && f <= 50.2) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Greece: // 10
                    if (f >= 1.81 && f <= 1.85) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Hungary: // 11
                    if (f >= 1.81 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.1) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 52.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Netherlands: // 12
                    if (f >= 1.81 && f <= 1.88) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.0 && f <= 52.0) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.France:
                    if (f >= 1.81 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 24.99) ret_val = true;
                    else if (f >= 28.0 && f <= 29.7) ret_val = true;
                    else if (f >= 50.08 && f <= 51.2) ret_val = true;
                    else ret_val = false;
                    break;
                case FRSRegion.Russia: // 14
                    if (f >= 1.81 && f <= 2.0) ret_val = true;
                    else if (f >= 3.5 && f <= 3.8) ret_val = true;
                    else if (f >= 7.0 && f <= 7.2) ret_val = true;
                    else if (f >= 10.1 && f <= 10.15) ret_val = true;
                    else if (f >= 14.0 && f <= 14.35) ret_val = true;
                    else if (f >= 18.068 && f <= 18.168) ret_val = true;
                    else if (f >= 21.0 && f <= 21.45) ret_val = true;
                    else if (f >= 24.89 && f <= 25.14) ret_val = true;
                    else if (f >= 26.97 && f <= 29.7) ret_val = true;
                    else ret_val = false;
                    break;
                default:
                    ret_val = false;
                    break;
            }

            return ret_val;
        }

        public void SetHWFilters(double freq)
        {
            /*   if (PowerOn && ModelIsHPSDRorHermes() && SetupForm.radAlexManualCntl.Checked)
               {
                   if (alex_hpf_bypass)
                   {
                       JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                       SetupForm.radBPHPFled.Checked = true;
                   }

                   else if ((decimal)freq >= SetupForm.udAlex1_5HPFStart.Value && // 1.5 MHz HPF
                        (decimal)freq <= SetupForm.udAlex1_5HPFEnd.Value)
                   {
                       if (SetupForm.chkAlex1_5BPHPF.Checked)
                       {
                           JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                           SetupForm.radBPHPFled.Checked = true;
                       }
                       else
                       {
                           JanusAudio.SetAlexHPFBits(0x10);
                           SetupForm.rad1_5HPFled.Checked = true;
                       }
                   }

                   else if ((decimal)freq >= SetupForm.udAlex6_5HPFStart.Value && // 6.5 MHz HPF
                            (decimal)freq <= SetupForm.udAlex6_5HPFEnd.Value)
                   {
                       if (SetupForm.chkAlex6_5BPHPF.Checked)
                       {
                           JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                           SetupForm.radBPHPFled.Checked = true;
                       }
                       else
                       {
                           JanusAudio.SetAlexHPFBits(0x08);
                           SetupForm.rad6_5HPFled.Checked = true;
                       }
                   }

                   else if ((decimal)freq >= SetupForm.udAlex9_5HPFStart.Value && // 9.5 MHz HPF
                            (decimal)freq <= SetupForm.udAlex9_5HPFEnd.Value)
                   {
                       if (SetupForm.chkAlex9_5BPHPF.Checked)
                       {
                           JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                           SetupForm.radBPHPFled.Checked = true;
                       }
                       else
                       {
                           JanusAudio.SetAlexHPFBits(0x04);
                           SetupForm.rad9_5HPFled.Checked = true;
                       }
                   }

                   else if ((decimal)freq >= SetupForm.udAlex13HPFStart.Value && // 13 MHz HPF
                            (decimal)freq <= SetupForm.udAlex13HPFEnd.Value)
                   {
                       if (SetupForm.chkAlex13BPHPF.Checked)
                       {
                           JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                           SetupForm.radBPHPFled.Checked = true;
                       }
                       else
                       {
                           JanusAudio.SetAlexHPFBits(0x01);
                           SetupForm.rad13HPFled.Checked = true;
                       }
                   }

                   else if ((decimal)freq >= SetupForm.udAlex20HPFStart.Value && // 20 MHz HPF
                            (decimal)freq <= SetupForm.udAlex20HPFEnd.Value)
                   {
                       if (SetupForm.chkAlex20BPHPF.Checked)
                       {
                           JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                           SetupForm.radBPHPFled.Checked = true;
                       }
                       else
                       {
                           JanusAudio.SetAlexHPFBits(0x02);
                           SetupForm.rad20HPFled.Checked = true;
                       }
                   }

                   else if ((decimal)freq >= SetupForm.udAlex6BPFStart.Value && // 6m BPF/LNA
                            (decimal)freq <= SetupForm.udAlex6BPFEnd.Value)
                   {
                       if (SetupForm.chkAlex6BPHPF.Checked)
                       {
                           JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                           SetupForm.radBPHPFled.Checked = true;
                       }
                       else
                       {
                           JanusAudio.SetAlexHPFBits(0x40);
                           SetupForm.rad6BPFled.Checked = true;
                       }
                   }
                   else
                   {
                       JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                       SetupForm.radBPHPFled.Checked = true;
                   }

                   if (SetupForm.rad6BPFled.Checked) // Alex 6m preamp offset 23dB
                        AlexPreampOffset = 23;
                    else
                        AlexPreampOffset = 0; 

                   if ((decimal)freq >= SetupForm.udAlex160mLPFStart.Value && // 160m LPF
                       (decimal)freq <= SetupForm.udAlex160mLPFEnd.Value)
                   {
                       JanusAudio.SetAlexLPFBits(0x08);
                       SetupForm.rad160LPFled.Checked = true;
                   }

                   else if ((decimal)freq >= SetupForm.udAlex80mLPFStart.Value && // 80m LPF
                            (decimal)freq <= SetupForm.udAlex80mLPFEnd.Value)
                   {
                       JanusAudio.SetAlexLPFBits(0x04);
                       SetupForm.rad80LPFled.Checked = true;
                   }

                   else if ((decimal)freq >= SetupForm.udAlex40mLPFStart.Value && // 60/40m LPF
                            (decimal)freq <= SetupForm.udAlex40mLPFEnd.Value)
                   {
                       JanusAudio.SetAlexLPFBits(0x02);
                       SetupForm.rad40LPFled.Checked = true;
                   }

                   else if ((decimal)freq >= SetupForm.udAlex20mLPFStart.Value && // 30/20m LPF
                            (decimal)freq <= SetupForm.udAlex20mLPFEnd.Value)
                   {
                       JanusAudio.SetAlexLPFBits(0x01);
                       SetupForm.rad20LPFled.Checked = true;
                   }

                   else if ((decimal)freq >= SetupForm.udAlex15mLPFStart.Value && // 17/15 LPF
                            (decimal)freq <= SetupForm.udAlex15mLPFEnd.Value)
                   {
                       JanusAudio.SetAlexLPFBits(0x40);
                       SetupForm.rad15LPFled.Checked = true;
                   }

                   else if ((decimal)freq >= SetupForm.udAlex10mLPFStart.Value && // 12/10m LPF
                            (decimal)freq <= SetupForm.udAlex10mLPFEnd.Value)
                   {
                       JanusAudio.SetAlexLPFBits(0x20);
                       SetupForm.rad10LPFled.Checked = true;
                   }

                   else if ((decimal)freq >= SetupForm.udAlex6mLPFStart.Value && // 6m LPF
                            (decimal)freq <= SetupForm.udAlex6mLPFEnd.Value)
                   {
                       JanusAudio.SetAlexLPFBits(0x10);
                       SetupForm.rad6LPFled.Checked = true;
                   }
                   else
                   {
                       JanusAudio.SetAlexLPFBits(0x10); // 6m LPF
                       SetupForm.rad6LPFled.Checked = true;
                   }

               }
               else */
            {
                //Use shift registers on RFE to control BPF and LPF banks
                if (freq <= 2.5)					// DC to 2.5MHz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.B160;

                    if (!mox && chkBCI.Checked) //rx & BCI
                        Hdw.BPFRelay = BPFBand.B60;		//sets next higher BPF for improved 160M operation
                    else
                        Hdw.BPFRelay = BPFBand.B160;

                    if (freq <= 0.3 && enable_LPF0)
                        Hdw.RFE_LPF = RFELPFBand.AUX;
                    else
                        Hdw.RFE_LPF = RFELPFBand.B160;
                }
                else if (freq <= 4)				// 2.5MHz to 4MHz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.B80;

                    Hdw.BPFRelay = BPFBand.B60;
                    Hdw.RFE_LPF = RFELPFBand.B80;
                }
                else if (freq <= 6)				// 4MHz to 6MHz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.B6040;

                    Hdw.BPFRelay = BPFBand.B60;
                    Hdw.RFE_LPF = RFELPFBand.B60;
                }
                else if (freq <= 7.3)			// 6MHz to 7.3MHz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.B6040;

                    Hdw.BPFRelay = BPFBand.B40;
                    Hdw.RFE_LPF = RFELPFBand.B40;
                }
                else if (freq <= 10.2)			// 7.3MHz to 10.2MHz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.B3020;

                    Hdw.BPFRelay = BPFBand.B40;
                    Hdw.RFE_LPF = RFELPFBand.B30;
                }
                else if (freq <= 12)				// 10.2MHz to 12MHz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.NONE;

                    Hdw.BPFRelay = BPFBand.B40;
                    Hdw.RFE_LPF = RFELPFBand.B30;
                }
                else if (freq <= 14.5)			// 12MHz to 14.5MHz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.B3020;

                    Hdw.BPFRelay = BPFBand.B20;
                    Hdw.RFE_LPF = RFELPFBand.B20;
                }
                else if (freq <= 21.5)			// 14.5MHz to 21.5MHz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.B1715;

                    Hdw.BPFRelay = BPFBand.B20;
                    Hdw.RFE_LPF = RFELPFBand.B1715;
                }
                else if (freq <= 24)				// 21.5MHz to 24MHz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.B1210;

                    Hdw.BPFRelay = BPFBand.B20;
                    Hdw.RFE_LPF = RFELPFBand.B1210;
                }
                else if (freq <= 30)				// 24MHz to 30MHz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.B1210;

                    Hdw.BPFRelay = BPFBand.B10;
                    Hdw.RFE_LPF = RFELPFBand.B1210;
                }
                else if (freq <= 36)				// 30MHz to 36MHz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.NONE;

                    Hdw.BPFRelay = BPFBand.B10;
                    Hdw.RFE_LPF = RFELPFBand.B6;
                }
                else if (freq <= 65)				// 36MHz to 65Mhz
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.NONE;

                    Hdw.BPFRelay = BPFBand.B6;
                    Hdw.RFE_LPF = RFELPFBand.B6;
                }
                else if (xvtr_present && freq >= 144 && freq <= 146)			//28MHz IF for transverter
                {
                    if (pa_present)
                        Hdw.PA_LPF = PAFBand.NONE;

                    Hdw.BPFRelay = BPFBand.B10;
                    Hdw.RFE_LPF = RFELPFBand.B1210;
                    Hdw.XVTR_RF = true;
                }
                if (xvtr_present && freq < 144)
                    Hdw.XVTR_RF = false;

                if (rx1_xvtr_index >= 0)
                {
                    Hdw.XVTR_RF = XVTRForm.GetXVTRRF(rx1_xvtr_index);
                }
            }

        }

        public void SetAlexRXFilters(double freq)
        {
            if (chkPower.Checked && alexpresent && SetupForm.radAlexManualCntl.Checked)
            {
                if (alex_hpf_bypass)
                {
                    JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                    SetupForm.radBPHPFled.Checked = true;
                    return;
                }

                if ((decimal)freq >= SetupForm.udAlex1_5HPFStart.Value && // 1.5 MHz HPF
                     (decimal)freq <= SetupForm.udAlex1_5HPFEnd.Value)
                {
                    if (alex1_5bphpf_bypass)
                    {
                        JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                        SetupForm.radBPHPFled.Checked = true;
                    }
                    else
                    {
                        JanusAudio.SetAlexHPFBits(0x10);
                        SetupForm.rad1_5HPFled.Checked = true;
                    }
                }

                else if ((decimal)freq >= SetupForm.udAlex6_5HPFStart.Value && // 6.5 MHz HPF
                         (decimal)freq <= SetupForm.udAlex6_5HPFEnd.Value)
                {
                    if (alex6_5bphpf_bypass)
                    {
                        JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                        SetupForm.radBPHPFled.Checked = true;
                    }
                    else
                    {
                        JanusAudio.SetAlexHPFBits(0x08);
                        SetupForm.rad6_5HPFled.Checked = true;
                    }
                }

                else if ((decimal)freq >= SetupForm.udAlex9_5HPFStart.Value && // 9.5 MHz HPF
                         (decimal)freq <= SetupForm.udAlex9_5HPFEnd.Value)
                {
                    if (alex9_5bphpf_bypass)
                    {
                        JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                        SetupForm.radBPHPFled.Checked = true;
                    }
                    else
                    {
                        JanusAudio.SetAlexHPFBits(0x04);
                        SetupForm.rad9_5HPFled.Checked = true;
                    }
                }

                else if ((decimal)freq >= SetupForm.udAlex13HPFStart.Value && // 13 MHz HPF
                         (decimal)freq <= SetupForm.udAlex13HPFEnd.Value)
                {
                    if (alex13bphpf_bypass)
                    {
                        JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                        SetupForm.radBPHPFled.Checked = true;
                    }
                    else
                    {
                        JanusAudio.SetAlexHPFBits(0x01);
                        SetupForm.rad13HPFled.Checked = true;
                    }
                }

                else if ((decimal)freq >= SetupForm.udAlex20HPFStart.Value && // 20 MHz HPF
                         (decimal)freq <= SetupForm.udAlex20HPFEnd.Value)
                {
                    if (alex20bphpf_bypass)
                    {
                        JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                        SetupForm.radBPHPFled.Checked = true;
                    }
                    else
                    {
                        JanusAudio.SetAlexHPFBits(0x02);
                        SetupForm.rad20HPFled.Checked = true;
                    }
                }

                else if ((decimal)freq >= SetupForm.udAlex6BPFStart.Value && // 6m BPF/LNA
                         (decimal)freq <= SetupForm.udAlex6BPFEnd.Value)
                {
                    if (alex6bphpf_bypass)
                    {
                        JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                        SetupForm.radBPHPFled.Checked = true;
                    }
                    else
                    {
                        JanusAudio.SetAlexHPFBits(0x40);
                        SetupForm.rad6BPFled.Checked = true;
                    }
                }
                else
                {
                    JanusAudio.SetAlexHPFBits(0x20); // Bypass HPF
                    SetupForm.radBPHPFled.Checked = true;
                }

            }
        }

        public void SetAlexTXFilters(double freq)
        {
            if (chkPower.Checked && alexpresent && SetupForm.radAlexManualCntl.Checked)
            {
                if ((decimal)freq >= SetupForm.udAlex20mLPFStart.Value && // 30/20m LPF
                          (decimal)freq <= SetupForm.udAlex20mLPFEnd.Value)
                {
                    JanusAudio.SetAlexLPFBits(0x01);
                    SetupForm.rad20LPFled.Checked = true;
                }

                else if ((decimal)freq >= SetupForm.udAlex40mLPFStart.Value && // 60/40m LPF
                        (decimal)freq <= SetupForm.udAlex40mLPFEnd.Value)
                {
                    JanusAudio.SetAlexLPFBits(0x02);
                    SetupForm.rad40LPFled.Checked = true;
                }

                else if ((decimal)freq >= SetupForm.udAlex80mLPFStart.Value && // 80m LPF
                         (decimal)freq <= SetupForm.udAlex80mLPFEnd.Value)
                {
                    JanusAudio.SetAlexLPFBits(0x04);
                    SetupForm.rad80LPFled.Checked = true;
                }

                else if ((decimal)freq >= SetupForm.udAlex160mLPFStart.Value && // 160m LPF
                     (decimal)freq <= SetupForm.udAlex160mLPFEnd.Value)
                {
                    JanusAudio.SetAlexLPFBits(0x08);
                    SetupForm.rad160LPFled.Checked = true;
                }

                else if ((decimal)freq >= SetupForm.udAlex6mLPFStart.Value && // 6m LPF
                        (decimal)freq <= SetupForm.udAlex6mLPFEnd.Value)
                {
                    JanusAudio.SetAlexLPFBits(0x10);
                    SetupForm.rad6LPFled.Checked = true;
                }

                else if ((decimal)freq >= SetupForm.udAlex10mLPFStart.Value && // 12/10m LPF
                         (decimal)freq <= SetupForm.udAlex10mLPFEnd.Value)
                {
                    JanusAudio.SetAlexLPFBits(0x20);
                    SetupForm.rad10LPFled.Checked = true;
                }

                else if ((decimal)freq >= SetupForm.udAlex15mLPFStart.Value && // 17/15 LPF
                          (decimal)freq <= SetupForm.udAlex15mLPFEnd.Value)
                {
                    JanusAudio.SetAlexLPFBits(0x40);
                    SetupForm.rad15LPFled.Checked = true;
                }

                else
                {
                    JanusAudio.SetAlexLPFBits(0x10); // 6m LPF
                    SetupForm.rad6LPFled.Checked = true;
                }

            }
        }


        // kb9yig sr40 mod 		
        // check and see if the band data includes alias data -- if so 
        // zero out (very negative) the portions of the data that are 
        // aliased 
        public void AdjustDisplayDataForBandEdge(ref float[] display_data)
        {
            if (current_model != Model.SOFTROCK40)  // -- no aliasing going on 
                return;

            if (rx1_dsp_mode == DSPMode.DRM)  // for now don't worry about aliasing in DRM land 
            {
                return;
            }

            double hz_per_bin = sample_rate1 / Display.BUFFER_SIZE;
            double data_center_freq = tuned_freq;
            if (data_center_freq == 0)
            {
                return;
            }
            double data_low_edge_hz = (1000000.0 * data_center_freq) - sample_rate1 / 2;
            double data_high_edge_hz = (1000000.0 * data_center_freq) + sample_rate1 / 2;
            double alias_free_low_edge_hz = (1000000.0 * soft_rock_center_freq) - sample_rate1 / 2;
            double alias_free_high_edge_hz = (1000000.0 * soft_rock_center_freq) + sample_rate1 / 2;
            if (data_low_edge_hz < alias_free_low_edge_hz)   // data we have goes below alias free region -- zero it 
            {
                double hz_this_bin = data_low_edge_hz;
                int bin_num = 0;
                while (hz_this_bin < alias_free_low_edge_hz)
                {
                    display_data[bin_num] = -200.0f;
                    ++bin_num;
                    hz_this_bin += hz_per_bin;
                }
                // Debug.WriteLine("data_low: " + bin_num); 
            }
            else if (data_high_edge_hz > alias_free_high_edge_hz)
            {
                double hz_this_bin = data_high_edge_hz;
                int bin_num = Display.BUFFER_SIZE - 1;
                while (hz_this_bin > alias_free_high_edge_hz)
                {
                    display_data[bin_num] = -200.0f;
                    --bin_num;
                    hz_this_bin -= hz_per_bin;
                }
                // Debug.WriteLine("data_high: " + bin_num); 
            }
            return;
        }
        // end kb9yig sr40 mod 

        public void SelectRX1VarFilter()
        {
            if (rx1_filter == Filter.VAR1) return;
            if (rx1_filter == Filter.VAR2) return;

            // save current filter bounds, reset to var, set filter bounds 
            int high = (int)udFilterHigh.Value;
            int low = (int)udFilterLow.Value;
            radFilterVar1.Checked = true;
            //SetFilter(Filter.VAR1); 
            UpdateRX1Filters(low, high);
        }

        public void SelectRX2VarFilter()
        {
            if (rx2_filter == Filter.VAR1) return;
            if (rx2_filter == Filter.VAR2) return;

            // save current filter bounds, reset to var, set filter bounds 
            int high = (int)udRX2FilterHigh.Value;
            int low = (int)udRX2FilterLow.Value;
            radRX2FilterVar1.Checked = true;
            //SetFilter(Filter.VAR1); 
            UpdateRX2Filters(low, high);
        }

        private void UpdateExtCtrl()
        {
            if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)) return;
            switch (TXBand)
            {
                case Band.B160M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_160_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_160_tx);
                    break;
                case Band.B80M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_80_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_80_tx);
                    break;
                case Band.B60M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_60_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_60_tx);
                    break;
                case Band.B40M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_40_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_40_tx);
                    break;
                case Band.B30M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_30_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_30_tx);
                    break;
                case Band.B20M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_20_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_20_tx);
                    break;
                case Band.B17M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_17_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_17_tx);
                    break;
                case Band.B15M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_15_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_15_tx);
                    break;
                case Band.B12M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_12_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_12_tx);
                    break;
                case Band.B10M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_10_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_10_tx);
                    break;
                case Band.B6M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_6_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_6_tx);
                    break;
                case Band.B2M:
                    if (!mox)
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_2_rx);
                    else
                        Hdw.X2 = (byte)((Hdw.X2 & 0xC0) | x2_2_tx);
                    break;
            }
        }

        // Added 06/24/05 BT for CAT commands
        public void CATMemoryQS()
        {
            btnMemoryQuickSave_Click(this.btnMemoryQuickSave, EventArgs.Empty);
        }

        // Added 06/25/05 BT for CAT commands
        public void CATMemoryQR()
        {
            btnMemoryQuickRestore_Click(this.btnMemoryQuickRestore, EventArgs.Empty);
        }

        // BT 06/30/05 Added for CAT commands
        public int CATBandGroup
        {
            get
            {
                if (panelBandHF.Visible)
                    return 0;
                else
                    return 1;
            }
            set
            {
                if (value == 0)
                    btnBandHF_Click(btnBandHF, EventArgs.Empty);
                else if (value == 1)
                    btnBandVHF_Click(btnBandVHF, EventArgs.Empty);
            }
        }

        //BT 06/17/05 added for CAT commands
        public void SetCATBand(Band pBand)
        {
            Band b = pBand;
            switch (b)
            {
                case Band.B160M:
                    radBand160_Click(this, EventArgs.Empty);
                    break;
                case Band.B80M:
                    radBand80_Click(this, EventArgs.Empty);
                    break;
                case Band.B60M:
                    radBand60_Click(this, EventArgs.Empty);
                    break;
                case Band.B40M:
                    radBand40_Click(this, EventArgs.Empty);
                    break;
                case Band.B30M:
                    radBand30_Click(this, EventArgs.Empty);
                    break;
                case Band.B20M:
                    radBand20_Click(this, EventArgs.Empty);
                    break;
                case Band.B17M:
                    radBand17_Click(this, EventArgs.Empty);
                    break;
                case Band.B15M:
                    radBand15_Click(this, EventArgs.Empty);
                    break;
                case Band.B12M:
                    radBand12_Click(this, EventArgs.Empty);
                    break;
                case Band.B10M:
                    radBand10_Click(this, EventArgs.Empty);
                    break;
                case Band.B6M:
                    radBand6_Click(this, EventArgs.Empty);
                    break;
                case Band.B2M:
                    radBand2_Click(this, EventArgs.Empty);
                    break;
                case Band.GEN:
                    radBandGEN_Click(this, EventArgs.Empty);
                    break;
                case Band.WWV:
                    radBandWWV_Click(this, EventArgs.Empty);
                    break;
                case Band.VHF0:
                    radBandVHF0.PerformClick();
                    break;
                case Band.VHF1:
                    radBandVHF1.PerformClick();
                    break;
                case Band.VHF2:
                    radBandVHF2.PerformClick();
                    break;
                case Band.VHF3:
                    radBandVHF3.PerformClick();
                    break;
                case Band.VHF4:
                    radBandVHF4.PerformClick();
                    break;
                case Band.VHF5:
                    radBandVHF5.PerformClick();
                    break;
                case Band.VHF6:
                    radBandVHF6.PerformClick();
                    break;
                case Band.VHF7:
                    radBandVHF7.PerformClick();
                    break;
                case Band.VHF8:
                    radBandVHF8.PerformClick();
                    break;
                case Band.VHF9:
                    radBandVHF9.PerformClick();
                    break;
                case Band.VHF10:
                    radBandVHF10.PerformClick();
                    break;
                case Band.VHF11:
                    radBandVHF11.PerformClick();
                    break;
                case Band.VHF12:
                    radBandVHF12.PerformClick();
                    break;
                case Band.VHF13:
                    radBandVHF13.PerformClick();
                    break;
                default:
                    radBandGEN_Click(this, EventArgs.Empty);
                    break;
            }
        }


        public void SetVHFText(int index, string text)
        {
            vhf_text[index].Text = text;
        }

        public void SetVHFEnabled(int index, bool b)
        {
            vhf_text[index].Enabled = b;
        }

        private void UpdateBandStackRegisters()
        {
            int[] band_stacks = DB.GetBandStackNum();
            band_160m_register = band_stacks[0];
            band_80m_register = band_stacks[1];
            band_60m_register = band_stacks[2];
            band_40m_register = band_stacks[3];
            band_30m_register = band_stacks[4];
            band_20m_register = band_stacks[5];
            band_17m_register = band_stacks[6];
            band_15m_register = band_stacks[7];
            band_12m_register = band_stacks[8];
            band_10m_register = band_stacks[9];
            band_6m_register = band_stacks[10];
            band_2m_register = band_stacks[11];
            band_wwv_register = band_stacks[12];
            band_gen_register = band_stacks[13];
            band_vhf0_register = band_stacks[14];
            band_vhf1_register = band_stacks[15];
            band_vhf2_register = band_stacks[16];
            band_vhf3_register = band_stacks[17];
            band_vhf4_register = band_stacks[18];
            band_vhf5_register = band_stacks[19];
            band_vhf6_register = band_stacks[20];
            band_vhf7_register = band_stacks[21];
            band_vhf8_register = band_stacks[22];
            band_vhf9_register = band_stacks[23];
            band_vhf10_register = band_stacks[24];
            band_vhf11_register = band_stacks[25];
            band_vhf12_register = band_stacks[26];
            band_vhf13_register = band_stacks[27];
        }

        public void UpdateRX1Filters(int low, int high)
        {
            // System.Console.WriteLine("updf lo: " + low + " hi: " + high); 
            // qualify settings
            //if(low > high) return;

            switch (rx1_dsp_mode)
            {
                case DSPMode.LSB:
                case DSPMode.DIGL:
                case DSPMode.CWL:
                    if (low > high - 10) low = high - 10;
                    break;
                case DSPMode.USB:
                case DSPMode.DIGU:
                case DSPMode.CWU:
                    if (high < low + 10) high = low + 10;
                    break;
                case DSPMode.AM:
                case DSPMode.SAM:
                case DSPMode.DSB:
                    if (high < low + 20)
                    {
                        if (Math.Abs(high) < Math.Abs(low))
                            high = low + 20;
                        else
                            low = high - 20;
                    }
                    break;
                case DSPMode.FM:
                    if (radio.GetDSPTX(0).TXFMDeviation == 5000)
                    {
                        low = -8000;
                        high = 8000;
                        lblFilterLabel.Text = "16k";
                    }
                    else if (radio.GetDSPTX(0).TXFMDeviation == 2500)
                    {
                        low = -4000;
                        high = 4000;
                        lblFilterLabel.Text = "8k";
                    }
                    break;
            }

            if (low < -9999)
                low = -9999;
            if (high > 9999)
                high = 9999;
            if (high < -9999)
                high = -9999;
            if (low > 9999)
                low = 9999;
            // if (low < -14999)
            //   low = -14999;
            // if (high > 14999)
            //  high = 14999;
            // if (low == high) high = low + 25;
            // System.Console.WriteLine("updf lo: " + low + " hi: " + high); 

            // send the settings to the DSP
            if (low == high) return;

            {
                radio.GetDSPRX(0, 0).SetRXFilter(low, high);
                radio.GetDSPRX(0, 1).SetRXFilter(low, high);
            }

            // send the setting to the display
            Display.RX1FilterLow = low;
            Display.RX1FilterHigh = high;

            // update var filter controls
            udFilterLow.Value = low;
            udFilterHigh.Value = high;

            // update Filter Shift
            ptbFilterShift_Update(low, high);

            // update Filter Width
            ptbFilterWidth_Update(low, high);

            // Update Display data if not in panadapter mode
            if (!radio.GetDSPRX(0, 0).SpectrumPreFilter)
                UpdateRXDisplayVars(low, high);

            // update display
            if (!chkPower.Checked)
                Display.DrawBackground();

            // reset average and peak
            switch (Display.CurrentDisplayMode)
            {
                case DisplayMode.SPECTRUM:
                case DisplayMode.HISTOGRAM:
                case DisplayMode.WATERFALL:
                case DisplayMode.SPECTRASCOPE:
                    if (chkDisplayAVG.Checked)
                        Display.ResetRX1DisplayAverage();
                    if (chkDisplayPeak.Checked)
                        Display.ResetRX1DisplayPeak();
                    break;
                case DisplayMode.PANADAPTER:
                    break;
            }

            // set XIT step rate
            if ((high - low) > 250)
            {
                udXIT.Increment = 10;
                udRIT.Increment = 10;
            }
            else
            {
                udXIT.Increment = 5;
                udRIT.Increment = 5;
            }

            if (filterRX1Form != null && !filterRX1Form.IsDisposed)
            {
                if (filterRX1Form.DSPMode == rx1_dsp_mode)
                    filterRX1Form.CurrentFilter = rx1_filter;
            }
        }

        public void UpdateRX2Filters(int low, int high)
        {
            switch (rx2_dsp_mode)
            {
                case DSPMode.LSB:
                case DSPMode.DIGL:
                case DSPMode.CWL:
                    if (low > high - 10) low = high - 10;
                    break;
                case DSPMode.USB:
                case DSPMode.DIGU:
                case DSPMode.CWU:
                    if (high < low + 10) high = low + 10;
                    break;
                case DSPMode.AM:
                case DSPMode.SAM:
                case DSPMode.DSB:
                    if (high < low + 20)
                    {
                        if (Math.Abs(high) < Math.Abs(low))
                            high = low + 20;
                        else
                            low = high - 20;
                    }
                    break;
                case DSPMode.FM:
                    if (radio.GetDSPTX(0).TXFMDeviation == 5000)
                    {
                        low = -8000;
                        high = 8000;
                    }
                    else if (radio.GetDSPTX(0).TXFMDeviation == 2500)
                    {
                        low = -4000;
                        high = 4000;
                    }
                    break;
            }

            if (low < -9999)
                low = -9999;
            if (high > 9999)
                high = 9999;
            if (high < -9999)
                high = -9999;
            if (low > 9999)
                low = 9999;
            // if (low < -14999)
            //   low = -14999;
            // if (high > 14999)
            //  high = 14999;
            // if (low == high) high = low + 25;
            // System.Console.WriteLine("updf lo: " + low + " hi: " + high); 

            // send the settings to the DSP
            if (low == high) return;

            // send the settings to the DSP
            radio.GetDSPRX(1, 0).SetRXFilter(low, high);
            radio.GetDSPRX(1, 1).SetRXFilter(low, high);

            // send the setting to the display
            Display.RX2FilterLow = low;
            Display.RX2FilterHigh = high;

            // update var filter controls
            udRX2FilterLow.Value = low;
            udRX2FilterHigh.Value = high;

            // update display
            if (!chkPower.Checked)
                Display.DrawBackground();

            if (filterRX2Form != null && !filterRX2Form.IsDisposed)
            {
                if (filterRX2Form.DSPMode == rx2_dsp_mode)
                    filterRX2Form.CurrentFilter = rx2_filter;
            }
        }

        public void UpdateRX1FilterNames(Filter f)
        {
            switch (f)
            {
                case Filter.F1:
                    radFilter1.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F1);
                    break;
                case Filter.F2:
                    radFilter2.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F2);
                    break;
                case Filter.F3:
                    radFilter3.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F3);
                    break;
                case Filter.F4:
                    radFilter4.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F4);
                    break;
                case Filter.F5:
                    radFilter5.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F5);
                    break;
                case Filter.F6:
                    radFilter6.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F6);
                    break;
                case Filter.F7:
                    radFilter7.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F7);
                    break;
                case Filter.F8:
                    radFilter8.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F8);
                    break;
                case Filter.F9:
                    radFilter9.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F9);
                    break;
                case Filter.F10:
                    radFilter10.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F10);
                    break;
                case Filter.VAR1:
                    radFilterVar1.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.VAR1);
                    break;
                case Filter.VAR2:
                    radFilterVar2.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.VAR2);
                    break;
            }

            if (f == rx1_filter)
                panelFilter.Text = "Filter - " + rx1_filters[(int)rx1_dsp_mode].GetName(f);
        }

        public void UpdateRX1FilterPresetLow(int val)
        {
            UpdateRX1Filters(val, (int)udFilterHigh.Value);
        }

        public void UpdateRX1FilterPresetHigh(int val)
        {
            UpdateRX1Filters((int)udFilterLow.Value, val);
        }

        public void UpdateRX2FilterNames(Filter f)
        {
            switch (f)
            {
                case Filter.F1:
                    radRX2Filter1.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F1);
                    break;
                case Filter.F2:
                    radRX2Filter2.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F2);
                    break;
                case Filter.F3:
                    radRX2Filter3.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F3);
                    break;
                case Filter.F4:
                    radRX2Filter4.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F4);
                    break;
                case Filter.F5:
                    radRX2Filter5.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F5);
                    break;
                case Filter.F6:
                    radRX2Filter6.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F6);
                    break;
                case Filter.F7:
                    radRX2Filter7.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F7);
                    break;
                case Filter.VAR1:
                    radRX2FilterVar1.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.VAR1);
                    break;
                case Filter.VAR2:
                    radRX2FilterVar2.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.VAR2);
                    break;
            }

            if (f == rx2_filter)
                panelRX2Filter.Text = "RX2 Filter - " + rx2_filters[(int)rx2_dsp_mode].GetName(f);
        }

        public void UpdateRX2FilterPresetLow(int val)
        {
            UpdateRX2Filters(val, (int)udRX2FilterHigh.Value);
        }

        public void UpdateRX2FilterPresetHigh(int val)
        {
            UpdateRX2Filters((int)udRX2FilterLow.Value, val);
        }

        public void UpdateVFOAFreq(string freq)
        {	// only do this routine if there are six digits after the decimal point.
            txtVFOAFreq.Text = freq;
            txtVFOAMSD.Text = freq;

            string temp = freq;
            int index = temp.IndexOf(separator) + 4;
            txtVFOALSD.Text = temp.Remove(0, index);
            if (KWAutoInformation)
                BroadcastFreqChange("A", freq);
        }

        private void BroadcastFreqChange(string vfo, string freq)
        {
            freq = "F" + vfo + freq.Replace(separator, "").PadLeft(11, '0') + ";";
            byte[] bfreq = ASCIIEncoding.ASCII.GetBytes(freq);
            try
            {
                // siolisten.SIO.put(bfreq, (uint)bfreq.Length);
                siolisten.SIO.put(freq);
            }
            catch { }
        }

        public void UpdateVFOBFreq(string freq)
        {	// only do this routine if there are six digits after the decimal point.
            txtVFOBFreq.Text = freq;
            txtVFOBMSD.Text = freq;

            string temp = freq;
            int index = temp.IndexOf(separator) + 4;
            txtVFOBLSD.Text = temp.Remove(0, index);
            if (KWAutoInformation)
                BroadcastFreqChange("B", freq);
        }

        public void CalcDisplayFreq()
        {
            if (Display.CurrentDisplayMode != DisplayMode.PANADAPTER &&
                Display.CurrentDisplayMode != DisplayMode.WATERFALL &&
                Display.CurrentDisplayMode != DisplayMode.PANAFALL &&
                Display.CurrentDisplayMode != DisplayMode.PANASCOPE)
                return;

            //double edge_alias = 7200.0;
            //double if_freq = 11025.0;
            double spur_tune_width = 200e6 / Math.Pow(2, 16);
            if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                spur_tune_width = 500e6 / Math.Pow(2, 16);
            double zoom_factor = (ptbDisplayZoom.Maximum + ptbDisplayZoom.Minimum - ptbDisplayZoom.Value) * 0.01;

            int low = (int)(-10000.0 * sample_rate1 / 48000.0 * zoom_factor);
            int high = -low;
            int abs_low;
            int abs_high;
            int width = high - low;
            if (width > sample_rate1 - 2 * spur_tune_width)
                width = (int)(sample_rate1 - 2 * spur_tune_width);
            if (ModelIsHPSDRorHermes())
            {
                abs_low = (int)(-(double)sample_rate1 * 0.5 + spur_tune_width);
                abs_high = (int)((double)sample_rate1 * 0.5 - spur_tune_width);
            }
            else
            {
                abs_low = (int)(-(double)sample_rate1 * 0.5 - if_freq * 1000000.0 + spur_tune_width);
                abs_high = (int)((double)sample_rate1 * 0.5 - if_freq * 1000000.0 - spur_tune_width);
            }

            if (high > abs_high)
            {
                //Debug.WriteLine("high: "+high+"  abs_high: "+abs_high);
                high = abs_high;
                low = high - width;
            }

            if (low < abs_low)
            {
                //Debug.WriteLine("low: "+low+"  abs_low: "+abs_low);
                low = abs_low;
                high = low + width;
            }

            int max_pan_width = (int)(sample_rate1 - 2 * spur_tune_width - width);
            int pan_freq = max_pan_width * ptbDisplayPan.Value / ptbDisplayPan.Maximum;

            low = abs_low + pan_freq;
            high = low + width;

            Display.RXDisplayLow = Display.TXDisplayLow = low;
            Display.RXDisplayHigh = Display.TXDisplayHigh = high;

            UpdateDisplay();
        }

        private void UpdateRXDisplayVars(int l, int h)
        {
            int low = 0, high = 0;
            if (l < 0 && h <= 0)
            {
                high = 0;
                if (l >= -910)
                    low = -1000;
                else
                    low = (int)(l * 1.1);
            }
            else if (l >= 0 && h > 0)
            {
                low = 0;
                if (h <= 910)
                    high = 1000;
                else
                    high = (int)(h * 1.1);
            }
            else if (l < 0 && h > 0)
            {
                int max_edge = Math.Max(-l, h);
                low = (int)(max_edge * -1.1);
                high = (int)(max_edge * 1.1);
            }
            Display.RXDisplayLow = low;
            Display.RXDisplayHigh = high;
        }

        public static void UpdateTXDisplayVars(int l, int h)
        {
            int low = 0, high = 0;
            if (l < 0 && h <= 0)
            {
                high = 0;
                if (l >= -910)
                    low = -1000;
                else
                    low = (int)(l * 1.1);
            }
            else if (l >= 0 && h > 0)
            {
                low = 0;
                if (h <= 910)
                    high = 1000;
                else
                    high = (int)(h * 1.1);
            }
            else if (l < 0 && h > 0)
            {
                int max_edge = Math.Max(-l, h);
                low = (int)(max_edge * -1.1);
                high = (int)(max_edge * 1.1);
            }

            Display.TXDisplayLow = low;
            Display.TXDisplayHigh = high;
        }

        public void SetTXFilters(DSPMode mode, int low, int high)
        {
            int l = 0, h = 0;
            low = (int)Math.Max(low, 50);
            switch (mode)
            {
                case DSPMode.LSB:
                case DSPMode.CWL:
                case DSPMode.DIGL:
                    l = -high;
                    h = -low;
                    break;
                case DSPMode.USB:
                case DSPMode.CWU:
                case DSPMode.DIGU:
                    l = low;
                    h = high;
                    break;
                case DSPMode.DSB:
                    l = -high;
                    h = high;
                    break;
                case DSPMode.AM:
                case DSPMode.SAM:
                    l = -high;
                    h = high;
                    break;
                case DSPMode.FM:
                    if (radio.GetDSPTX(0).TXFMDeviation == 5000)
                    {
                        l = -8000;
                        h = 8000;
                    }
                    else if (radio.GetDSPTX(0).TXFMDeviation == 2500)
                    {
                        l = -4000;
                        h = 4000;
                    }
                    break;
                case DSPMode.DRM:
                    l = 7000;
                    h = 17000;
                    break;
            }

            switch (Display.CurrentDisplayMode)
            {
                case DisplayMode.PANADAPTER:
                case DisplayMode.WATERFALL:
                case DisplayMode.PANAFALL:
                case DisplayMode.PANASCOPE:
                    break;
                default:
                    UpdateTXDisplayVars(l, h);
                    break;
            }

            radio.GetDSPTX(0).SetTXFilter(l, h);
            if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                FWC.SetTXDSPFilter(l, h);

            Display.TXFilterLow = l;
            Display.TXFilterHigh = h;
        }

        public void UpdateTXProfile(string name)
        {
            if (SetupForm == null) return;

            //string old = comboTXProfile.Text;
            comboTXProfile.Items.Clear();
            comboDigTXProfile.Items.Clear();
            comboFMTXProfile.Items.Clear();
            string[] s = SetupForm.GetTXProfileStrings();

            /*for(int i=0; i<s.Length; i++)
            {
                comboTXProfile.Items.Add(s[i]);
                comboDigTXProfile.Items.Add(s[i]);
            }*/
            comboTXProfile.Items.AddRange(s);
            comboDigTXProfile.Items.AddRange(s);
            comboFMTXProfile.Items.AddRange(s);

            if (name != "") comboTXProfile.Text = name;
        }

        public bool RX1IsIn60m()
        {
            double freq = VFOAFreq;
            return (freq >= 5.1 && freq <= 5.5);
        }

        public bool RX1IsOn60mChannel(Channel c)
        {
            double freq = VFOAFreq - ModeFreqOffset(rx1_dsp_mode);
            freq = Math.Round(freq, 6);

            return (c.Freq == freq);
        }

        public bool RX1IsOn60mChannel()
        {
            double freq = VFOAFreq - ModeFreqOffset(rx1_dsp_mode);
            freq = Math.Round(freq, 6);

            foreach (Channel c in Channels60m)
            {
                if (c.Freq == freq)
                    return true;
            }

            return false; // nothing matched, return false
        }

        public bool RX2IsIn60m()
        {
            double freq = VFOBFreq;
            return (freq >= 5.1 && freq <= 5.5);
        }

        public bool RX2IsOn60mChannel(Channel c)
        {
            double freq = VFOBFreq - ModeFreqOffset(rx2_dsp_mode);
            freq = Math.Round(freq, 6);

            return (c.Freq == freq);
        }

        public bool RX2IsOn60mChannel()
        {
            double freq = VFOBFreq - ModeFreqOffset(rx2_dsp_mode);
            freq = Math.Round(freq, 6);

            foreach (Channel c in Channels60m)
            {
                if (c.Freq == freq)
                    return true;
            }

            return false; // nothing matched, return false
        }

        private double ModeFreqOffset(DSPMode mode)
        {
            switch (mode)
            {
                case DSPMode.LSB:
                case DSPMode.DIGL:
                    return (1500 * 1e-6);
                case DSPMode.USB:
                case DSPMode.DRM:
                case DSPMode.DIGU:
                    return (-1500 * 1e-6);
                case DSPMode.DSB:
                case DSPMode.CWL:
                case DSPMode.CWU:
                case DSPMode.FM:
                case DSPMode.AM:
                case DSPMode.SAM:
                    return 0;
                default: return 0;
            }
        }

        public string CATGetXVTRBandNames()
        {
            string names = "";
            for (int n = 0; n < 14; n++)
            {
                if (XVTRForm.GetEnabled(n) == true)
                    names += vhf_text[n].Text.ToString().PadLeft(5, ' ');
                else
                    names += "     ";
            }
            return names;
        }

        public string GetFilterPresets(int mode_ndx)
        {
            string mode_info = "";
            for (Filter f = Filter.F1; f < Filter.NONE; f++)
            {

                mode_info += rx1_filters[mode_ndx].GetName(f).PadLeft(5, ' ');
                mode_info += rx1_filters[mode_ndx].GetHigh(f).ToString().PadLeft(5, ' ');
                mode_info += rx1_filters[mode_ndx].GetLow(f).ToString().PadLeft(5, ' ');
            }
            return mode_info;
        }

        public int CurrentTuneStepHz
        {
            get { return tune_step_list[tune_step_index].StepHz; }
        }

        public double CurrentTuneStepMHz
        {
            get { return tune_step_list[tune_step_index].StepHz * 1e-6; }
        }

        #endregion

        #region Test and Calibration Routines

        private Progress p;
        public bool CalibratePABias(Progress progress, float driver_target, float final_target, float tol, int index)
        {
            bool ret_val = false;
            float driver_limit = 10.0f;
            float final_limit = 10.0f;

            if (!(fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)))
            {
                progress.Text = "";
                progress.Hide();
                return false;
            }

            if (rx_only)
            {
                progress.Text = "";
                progress.Hide();
                MessageBox.Show("Cannot run this calibration while RX Only is selected\n(Setup Form -> General Tab)",
                    "Error: RX Only is active",
                    MessageBoxButtons.OK, MessageBoxIcon.Error);
                return false;
            }

            if (chkPower.Checked &&
                (rx1_dsp_mode == DSPMode.CWL || rx1_dsp_mode == DSPMode.CWU))
                RX1DSPMode = DSPMode.DSB;

            int val = 0;
            float volts = 0.0f;
            float current = 0.0f;
            int counter = 0;

            // read 13.8V for a sanity check of the ADC
            FWC.ReadPAADC(2, out val);
            volts = (float)val / 4096 * 2.5f;
            float v138 = volts * 11;

            if (v138 < 13.0 || v138 > 14.5)
            {
                progress.Hide();
                MessageBox.Show("13.8V not within tolerance [13.0, 14.5] -- (read " + v138.ToString("f1") + ")",
                    "ADC/Power Problem",
                    MessageBoxButtons.OK, MessageBoxIcon.Error);
                calibration_running = false;
                return false;
            }

            Thread.Sleep(100);

            int chan = 4;
            switch (current_model)
            {
                case Model.FLEX5000:
                    chan = 4;
                    break;
                case Model.FLEX3000:
                    chan = 3;
                    break;
            }
            FWC.ReadPAADC(chan, out val);
            volts = (float)val / 4096 * 2.5f;
            double temp_c = 301 - volts * 1000 / 2.2;
            if (temp_c > 50 || temp_c < 18)
            {
                progress.Hide();
                MessageBox.Show("Temperature (" + temp_c.ToString("f0") + "C) is outside of normal range (18-50C).",
                    "PA Bias Cal Error: Temp",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                calibration_running = false;
                return false;
            }

            for (int i = 0; i < 8; i++)
                flex5000DebugForm.SetPAPot(i, 0);

            FWC.SetPABias(true);
            tx_cal = true;

            byte Q2 = 128, Q3 = 128;
            // find point where Q2 and Q3 just tickle the driver bias current
            float baseline = 0.0f;
            Thread.Sleep(50);
            baseline = ReadDriverBias(3);
            /*if(baseline > 0.020)
            {
                Thread.Sleep(50);
                baseline = ReadDriverBias(3);
            }
            if(baseline > 0.020) goto error;*/
            //MessageBox.Show("Driver Baseline: "+baseline.ToString("f3"));
            Debug.WriteLine("baseline: " + baseline.ToString("f3"));

            for (int i = 0; i < 4; i++)
                flex5000DebugForm.SetPAPot(i, 128);

            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(0, Q2 += 10);
                if (Q2 < 128)
                {
                    FWC.SetPABias(false);
                    progress.Hide();
                    MessageBox.Show("PA Bias Error: Unable to hit target bias on Q2.  Likely hardware problem.",
                        "PA Bias Error",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    calibration_running = false;
                    return false;
                }
                Thread.Sleep(50);
                current = ReadDriverBias(3);
                if (current > driver_limit) goto high_current;
                if (Q2 == 255) goto error;
            }
            while (current < baseline + 0.002);
            progress.SetPercent(++counter / (float)16);
            flex5000DebugForm.SetPAPot(0, 0);
            Q2 -= 10;

            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(2, Q3 += 10);
                if (Q3 < 128)
                {
                    FWC.SetPABias(false);
                    progress.Hide();
                    MessageBox.Show("PA Bias Error: Unable to hit target bias on Q3.  Likely hardware problem.",
                        "PA Bias Error",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    calibration_running = false;
                    return false;
                }
                Thread.Sleep(50);
                current = ReadDriverBias(3);
                if (current > driver_limit) goto high_current;
                if (Q3 == 255) goto error;
            }
            while (current < baseline + 0.002);
            progress.SetPercent(++counter / (float)16);
            flex5000DebugForm.SetPAPot(2, 0);
            Q3 -= 10;
            Debug.WriteLine("Starting points  Q2:" + Q2 + "  Q3:" + Q3);
            //MessageBox.Show("Starting points  Q2:"+Q2.ToString()+"  Q3:"+Q3.ToString());

            // add half of one driver's target current to Q2
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(0, Q2 += 5);
                if (Q2 < 128)
                {
                    FWC.SetPABias(false);
                    progress.Hide();
                    MessageBox.Show("PA Bias Error: Unable to hit target bias on Q2.  Likely hardware problem.",
                        "PA Bias Error",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    calibration_running = false;
                    return false;
                }
                Thread.Sleep(50);
                current = ReadDriverBias(3);
                if (current > driver_limit) goto high_current;
                if (Q2 == 255) goto error;
            }
            while (current < baseline + driver_target / 4);

            Q2 -= 5;
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(0, Q2 += 1);
                if (Q2 < 128)
                {
                    FWC.SetPABias(false);
                    progress.Hide();
                    MessageBox.Show("PA Bias Error: Unable to hit target bias on Q2.  Likely hardware problem.",
                        "PA Bias Error",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    calibration_running = false;
                    return false;
                }
                Thread.Sleep(50);
                current = ReadDriverBias(3);
                if (current > driver_limit) goto high_current;
                if (Q2 == 255) goto error;
            }
            while (current < baseline + driver_target / 4);
            progress.SetPercent(++counter / (float)16);

            float q2_current = current - baseline;
            Debug.WriteLine("Q2 Current: " + q2_current.ToString("f3") + "  Q2:" + Q2);
            //MessageBox.Show("Q2 Current: "+q2_current.ToString("f3")+"  Q2:"+Q2.ToString());

            // add half of one driver's target current to Q3
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(2, Q3 += 5);
                Thread.Sleep(50);
                current = ReadDriverBias(3);
                if (current > driver_limit) goto high_current;
                if (Q3 == 255) goto error;
            }
            while (current < baseline + q2_current + driver_target / 4);
            Q3 -= 5;

            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(2, Q3 += 1);
                Thread.Sleep(50);
                current = ReadDriverBias(3);
                if (current > driver_limit) goto high_current;
                if (Q3 == 255) goto error;
            }
            while (current < baseline + q2_current + driver_target / 4);
            progress.SetPercent(++counter / (float)16);

            float q3_current = current - baseline - q2_current;
            Debug.WriteLine("Q3 Current: " + q3_current.ToString("f3") + "  Q3:" + Q3);
            //MessageBox.Show("Q3 Current: "+q3_current.ToString("f3")+"  Q3:"+Q3.ToString());

            // add another half of one driver's target current to Q2
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(0, ++Q2);
                Thread.Sleep(50);
                current = ReadDriverBias(3);
                if (current > driver_limit) goto high_current;
                if (Q2 == 255) goto error;
            }
            while (current < baseline + q3_current + driver_target / 2);

            // tweak for just above target
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(0, --Q2);
                Thread.Sleep(100);
                current = ReadDriverBias(5);
                if (current > driver_limit) goto high_current;
            }
            while (current > baseline + q3_current + driver_target / 2);
            progress.SetPercent(++counter / (float)16);
            flex5000DebugForm.SetPAPot(0, ++Q2);
            current = ReadDriverBias(5);
            q2_current = current - q3_current - baseline;
            Debug.WriteLine("Q2 Current: " + q2_current.ToString("f3") + "  Q2:" + Q2);
            //MessageBox.Show("Q2 Current: "+q2_current.ToString("f3")+"  Q2:"+Q2.ToString());

            // add another half of one driver's target current to Q3
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(2, ++Q3);
                Thread.Sleep(50);
                current = ReadDriverBias(3);
                if (current > driver_limit) goto high_current;
                if (Q3 == 255) goto error;
            }
            while (current < baseline + q2_current + driver_target / 2);

            // tweak for just above target
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(2, --Q3);
                Thread.Sleep(100);
                current = ReadDriverBias(5);
                if (current > driver_limit) goto high_current;
            }
            while (current > baseline + q2_current + driver_target / 2);
            progress.SetPercent(++counter / (float)16);
            flex5000DebugForm.SetPAPot(2, ++Q3);
            current = ReadDriverBias(5);
            q3_current = current - q2_current - baseline;
            Debug.WriteLine("Q3 Current: " + q3_current.ToString("f3") + "  Q3:" + Q3);
            //MessageBox.Show("Q3 Current: "+q3_current.ToString("f3")+"  Q3:"+Q3.ToString());

            // tweak fine controls if available
            uint pa_rev;
            FWC.GetPARev(out pa_rev);

            byte Q2_fine = 128, Q3_fine = 128;
            if ((byte)(pa_rev >> 8) != 0) // not a beta radio
            {
                while (Math.Abs(q2_current - driver_target / 2) > 0.005)
                {
                    if (!progress.Visible) goto end;
                    if (q2_current > driver_target / 2) Q2_fine--;
                    else Q2_fine++;
                    flex5000DebugForm.SetPAPot(1, Q2_fine);
                    Thread.Sleep(50);
                    current = ReadDriverBias(5);
                    q2_current = current - q3_current - baseline;
                    if (current > driver_limit) goto high_current;
                    if (Q2_fine == 255 || Q2_fine == 0) goto error;
                }

                progress.SetPercent(++counter / (float)16);
                Debug.WriteLine("Q2 Current: " + q2_current.ToString("f3") + "  Q2_fine:" + Q2_fine);
                //MessageBox.Show("Q2 Current: "+q2_current.ToString("f3")+"  Q2_fine:"+Q2_fine.ToString());

                while (Math.Abs(q3_current - driver_target / 2) > 0.005)
                {
                    if (!progress.Visible) goto end;
                    if (q3_current > driver_target / 2) Q3_fine--;
                    else Q3_fine++;
                    flex5000DebugForm.SetPAPot(3, Q3_fine);
                    Thread.Sleep(50);
                    current = ReadDriverBias(5);
                    q3_current = current - q2_current - baseline;
                    if (current > driver_limit) goto high_current;
                    if (Q3_fine == 255 || Q3_fine == 0) goto error;
                }

                progress.SetPercent(++counter / (float)16);
                Debug.WriteLine("Q3 Current: " + q3_current.ToString("f3") + "  Q3_fine:" + Q3_fine);
                //MessageBox.Show("Q3 Current: "+q3_current.ToString("f3")+"  Q3_fine:"+Q3_fine.ToString());
            }
            else counter += 2;

            byte Q4 = 128, Q1 = 128;
            // find point where Q4 and Q1 just tickle the final bias current
            Thread.Sleep(50);
            baseline = ReadFinalBias(3, true);
            /*if(baseline > 0.100) 
            {
                Thread.Sleep(50);
                baseline = ReadFinalBias(3);
            }
            if(baseline > 0.100) goto error;*/
            //MessageBox.Show("Final baseline: "+baseline.ToString("f3"));
            Debug.WriteLine("baseline: " + baseline.ToString("f3"));
            for (int i = 4; i < 8; i++)
                flex5000DebugForm.SetPAPot(i, 128);

            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(4, Q4 += 10);
                if (Q4 < 128)
                {
                    FWC.SetPABias(false);
                    progress.Hide();
                    MessageBox.Show("PA Bias Error: Unable to hit target bias on Q4.  Likely hardware problem.",
                        "PA Bias Error",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    calibration_running = false;
                    return false;
                }
                Thread.Sleep(50);
                current = ReadFinalBias(3, true);
                if (current > final_limit) goto high_current;
                if (Q4 == 255) goto error;
            }
            while (current < baseline + 0.005);
            progress.SetPercent(++counter / (float)16);
            flex5000DebugForm.SetPAPot(4, Q4 -= 10);

            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(6, Q1 += 10);
                if (Q1 < 128)
                {
                    FWC.SetPABias(false);
                    progress.Hide();
                    MessageBox.Show("PA Bias Error: Unable to hit target bias on Q1.  Likely hardware problem.",
                        "PA Bias Error",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    calibration_running = false;
                    return false;
                }
                Thread.Sleep(50);
                current = ReadFinalBias(3, true);
                if (current > final_limit) goto high_current;
                if (Q1 == 255) goto error;
            }
            while (current < baseline + 0.005);
            progress.SetPercent(++counter / (float)16);
            flex5000DebugForm.SetPAPot(6, Q1 -= 10);
            Debug.WriteLine("Starting points  Q4:" + Q4 + "  Q1:" + Q1);
            //MessageBox.Show("Starting points  Q4:"+Q4.ToString()+"  Q1:"+Q1.ToString());

            // add half of one finals target current to Q4
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(4, Q4 += 5);
                if (Q4 < 128)
                {
                    FWC.SetPABias(false);
                    progress.Hide();
                    MessageBox.Show("PA Bias Error: Unable to hit target bias on Q4.  Likely hardware problem.",
                        "PA Bias Error",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    calibration_running = false;
                    return false;
                }
                Thread.Sleep(50);
                current = ReadFinalBias(3, true);
                if (current > final_limit) goto high_current;
                if (Q4 == 255) goto error;
            }
            while (current < baseline + final_target / 4);
            Q4 -= 5;

            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(4, Q4 += 1);
                if (Q4 < 128)
                {
                    FWC.SetPABias(false);
                    progress.Hide();
                    MessageBox.Show("PA Bias Error: Unable to hit target bias on Q4.  Likely hardware problem.",
                        "PA Bias Error",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    calibration_running = false;
                    return false;
                }
                Thread.Sleep(50);
                current = ReadFinalBias(3, true);
                if (current > final_limit) goto high_current;
                if (Q4 == 255) goto error;
            }
            while (current < baseline + final_target / 4);
            progress.SetPercent(++counter / (float)16);

            float q4_current = current - baseline;
            Debug.WriteLine("Q4 Current: " + q4_current.ToString("f3") + "  Q4:" + Q4);
            //MessageBox.Show("Q4 Current: "+q4_current.ToString("f3")+"  Q4:"+Q4.ToString());

            // add half of one finals target current to Q1
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(6, Q1 += 5);
                if (Q1 < 128)
                {
                    FWC.SetPABias(false);
                    progress.Hide();
                    MessageBox.Show("PA Bias Error: Unable to hit target bias on Q1.  Likely hardware problem.",
                        "PA Bias Error",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    calibration_running = false;
                    return false;
                }
                Thread.Sleep(50);
                current = ReadFinalBias(3, true);
                if (current > final_limit) goto high_current;
                if (Q1 == 255) goto error;
            }
            while (current < baseline + q4_current + final_target / 4);
            Q1 -= 5;

            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(6, Q1 += 1);
                if (Q1 < 128)
                {
                    FWC.SetPABias(false);
                    progress.Hide();
                    MessageBox.Show("PA Bias Error: Unable to hit target bias on Q1.  Likely hardware problem.",
                        "PA Bias Error",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    calibration_running = false;
                    return false;
                }
                Thread.Sleep(50);
                current = ReadFinalBias(3, true);
                if (current > final_limit) goto high_current;
                if (Q1 == 255) goto error;
            }
            while (current < baseline + q4_current + final_target / 4);
            progress.SetPercent(++counter / (float)16);

            float q1_current = current - baseline - q4_current;
            Debug.WriteLine("Q1 Current: " + q1_current.ToString("f3") + "  Q1:" + Q1);
            //MessageBox.Show("Q1 Current: "+q1_current.ToString("f3")+"  Q1:"+Q1.ToString());

            // add another half of one finals target current to Q4
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(4, ++Q4);
                Thread.Sleep(50);
                current = ReadFinalBias(3, true);
                if (current > final_limit) goto high_current;
                if (Q4 == 255) goto error;
            }
            while (current < baseline + q1_current + final_target / 2);

            // tweak for just above target
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(4, --Q4);
                Thread.Sleep(100);
                current = ReadFinalBias(5, true);
                if (current > final_limit) goto high_current;
            }
            while (current > baseline + q1_current + final_target / 2);
            progress.SetPercent(++counter / (float)16);
            flex5000DebugForm.SetPAPot(4, ++Q4);
            current = ReadFinalBias(5, true);
            q4_current = current - q1_current - baseline;
            Debug.WriteLine("Q4 Current: " + q4_current.ToString("f3") + "  Q4:" + Q4);
            //MessageBox.Show("Q4 Current: "+q4_current.ToString("f3")+"  Q4:"+Q4.ToString());

            // add another half of one finals target current to Q1
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(6, ++Q1);
                Thread.Sleep(50);
                current = ReadFinalBias(3, true);
                if (current > final_limit) goto high_current;
                if (Q1 == 255) goto error;
            }
            while (current < baseline + q4_current + final_target / 2);

            // tweak for just above target
            do
            {
                if (!progress.Visible) goto end;
                flex5000DebugForm.SetPAPot(6, --Q1);
                Thread.Sleep(100);
                current = ReadFinalBias(5, true);
                if (current > final_limit) goto high_current;
            }
            while (current > baseline + q4_current + final_target / 2);
            progress.SetPercent(++counter / (float)16);
            flex5000DebugForm.SetPAPot(6, ++Q1);
            current = ReadFinalBias(5, true);
            q1_current = current - q4_current - baseline;
            Debug.WriteLine("Q1 Current: " + q1_current.ToString("f3") + "  Q1:" + Q1);
            //MessageBox.Show("Q1 Current: "+q1_current.ToString("f3")+"  Q1:"+Q1.ToString());

            // tweak fine controls if available
            byte Q4_fine = 128, Q1_fine = 128;
            if ((byte)(pa_rev >> 8) != 0) // not a beta radio
            {
                while (Math.Abs(q4_current - final_target / 2) > tol)
                {
                    if (!progress.Visible) goto end;
                    if (q4_current > final_target / 2) Q4_fine--;
                    else Q4_fine++;
                    flex5000DebugForm.SetPAPot(5, Q4_fine);
                    Thread.Sleep(50);
                    current = ReadFinalBias(5, true);
                    q4_current = current - q1_current - baseline;
                    if (current > final_limit) goto high_current;
                    if (Q4_fine == 255 || Q4_fine == 0) goto error;
                }

                progress.SetPercent(++counter / (float)16);
                Debug.WriteLine("Q4 Current: " + q4_current.ToString("f3") + "  Q4_fine:" + Q4_fine);
                //MessageBox.Show("Q4 Current: "+q4_current.ToString("f3")+"  Q4_fine:"+Q4_fine.ToString());

                while (Math.Abs(q1_current - final_target / 2) > tol)
                {
                    if (!progress.Visible) goto end;
                    if (q1_current > final_target / 2) Q1_fine--;
                    else Q1_fine++;
                    flex5000DebugForm.SetPAPot(7, Q1_fine);
                    Thread.Sleep(50);
                    current = ReadFinalBias(5, true);
                    q1_current = current - q4_current - baseline;
                    if (current > final_limit) goto high_current;
                    if (Q1_fine == 255 || Q1_fine == 0) goto error;
                }

                progress.SetPercent(++counter / (float)16);
                Debug.WriteLine("Q1 Current: " + q1_current.ToString("f3") + "  Q1_fine:" + Q1_fine);
                //MessageBox.Show("Q1 Current: "+q1_current.ToString("f3")+"  Q1_fine:"+Q1_fine.ToString());
            }
            else counter += 2;

            ret_val = true;
        end:
            FWC.SetPABias(false);
            tx_cal = false;
            progress.Hide();
            if (progress.Text != "")
            {
                for (int i = 0; i < 8; i++)
                    pa_bias_table[index][i] = flex5000DebugForm.GetPAPot(i);
            }
            return ret_val;
        high_current:
            FWC.SetPABias(false);
            tx_cal = false;
            progress.Hide();
            MessageBox.Show("Error in PA Bias Calibration: High Current Detected.",
                "PA Bias: High Current Detected",
                MessageBoxButtons.OK,
                MessageBoxIcon.Error);
            return false;
        error:
            FWC.SetPABias(false);
            tx_cal = false;
            progress.Hide();
            MessageBox.Show("Error in PA Bias Calibration: Unable to reach current.",
                "PA Bias: Current Error",
                MessageBoxButtons.OK,
                MessageBoxIcon.Error);
            return false;
        }

        public float ReadDriverBias(int num_avg)
        {
            int val;
            int sum = 0;
            for (int i = 0; i < num_avg; i++)
            {
                FWC.ReadPAADC(1, out val);
                sum += val;
                if (i != num_avg - 1) Thread.Sleep(100);
            }
            sum /= num_avg;
            float current = (float)sum / 4096 * 2.5f; // 50 milliohm
            if (((byte)(FWCEEPROM.PARev >> 8)) == 0) current /= 2; // 100 milliohm
            flex5000DebugForm.SetADCText(current.ToString("f3") + " A");
            if (flex5000FinalTestForm != null)
                flex5000FinalTestForm.UpdateDriverBiasDebug(current);
            return current;
        }

        public float ReadFinalBias(int num_avg, bool show_debug)
        {
            int val;
            int sum = 0;
            for (int i = 0; i < num_avg; i++)
            {
                FWC.ReadPAADC(0, out val);
                sum += val;
                if (i != num_avg - 1) Thread.Sleep(100);
            }
            sum /= num_avg;
            float current = (float)sum / 4096 * 2.5f * 10;
            flex5000DebugForm.SetADCText(current.ToString("f3") + " A");
            if (flex5000FinalTestForm != null && show_debug)
                flex5000FinalTestForm.UpdateFinalBiasDebug(current);
            return current;
        }

        public double ReadFwdPower(int num_avg)
        {
            if (current_model != Model.FLEX5000 && current_model != Model.FLEX3000) return 0.0;
            int val;
            int sum = 0;
            int chan = 0;
            switch (current_model)
            {
                case Model.FLEX5000:
                    chan = 7;
                    break;
                case Model.FLEX3000:
                    chan = 5;
                    break;
            }

            for (int i = 0; i < num_avg; i++)
            {
                FWC.ReadPAADC(chan, out val);
                sum += val;
                if (i != num_avg - 1) Thread.Sleep(200);
            }
            sum /= num_avg;

            return FWCPAPower(sum);
        }

        public float ReadFwdPowerVolts(int num_avg)
        {
            if (current_model != Model.FLEX5000 && current_model != Model.FLEX3000) return 0.0f;
            int val;
            int sum = 0;
            int chan = 0;
            switch (current_model)
            {
                case Model.FLEX5000:
                    chan = 7;
                    break;
                case Model.FLEX3000:
                    chan = 5;
                    break;
            }

            for (int i = 0; i < num_avg; i++)
            {
                FWC.ReadPAADC(chan, out val);
                sum += val;
                if (i != num_avg - 1) Thread.Sleep(100);
            }
            sum /= num_avg;
            float volts = (float)sum / 4096 * 2.5f;
            return volts;
        }

        public float ReadRefPowerVolts(int num_avg)
        {
            if (current_model != Model.FLEX5000 && current_model != Model.FLEX3000) return 0.0f;
            int val;
            int sum = 0;
            int chan = 0;
            switch (current_model)
            {
                case Model.FLEX5000:
                    chan = 6;
                    break;
                case Model.FLEX3000:
                    chan = 4;
                    break;
            }

            for (int i = 0; i < num_avg; i++)
            {
                FWC.ReadPAADC(chan, out val);
                sum += val;
                if (i != num_avg - 1) Thread.Sleep(100);
            }
            sum /= num_avg;
            float volts = (float)sum / 4096 * 2.5f;
            return volts;
        }

        public double ReadRefPower(int num_avg)
        {
            if (current_model != Model.FLEX5000 && current_model != Model.FLEX3000) return 0.0;
            int val;
            int sum = 0;
            int chan = 0;
            switch (current_model)
            {
                case Model.FLEX5000:
                    chan = 6;
                    break;
                case Model.FLEX3000:
                    chan = 4;
                    break;
            }

            for (int i = 0; i < num_avg; i++)
            {
                FWC.ReadPAADC(chan, out val);
                sum += val;
                if (i != num_avg - 1) Thread.Sleep(200);
            }
            sum /= num_avg;

            return FWCPAPower(sum) * swr_table[(int)tx_band];
        }

        public float[] min_tx_carrier = new float[(int)Band.LAST];
        public bool CalibrateTXCarrier(float freq, Progress progress, bool suppress_errors)
        {
            if (!(fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)))
            {
                progress.Text = "";
                progress.Hide();
                return false;
            }

            if (!chkPower.Checked)
            {
                MessageBox.Show("Power must be on in order to calibrate TX Carrier.", "Power Is Off",
                    MessageBoxButtons.OK, MessageBoxIcon.Stop);
                calibration_running = false;
                progress.Text = "";
                return false;
            }

            HiPerfTimer t1 = new HiPerfTimer();
            t1.Start();
            HiPerfTimer t2 = new HiPerfTimer();

            bool ret_val = false;
            calibration_running = true;
            progress.SetPercent(0.0f);

            // Setup hardware
            FWC.SetQSD(true);
            //Thread.Sleep(50);
            FWC.SetQSE(true);
            //Thread.Sleep(50);
            FWC.SetTR(true);
            //Thread.Sleep(50);
            FWC.SetSig(true);
            //Thread.Sleep(50);
            FWC.SetGen(false);
            //Thread.Sleep(50);
            FWC.SetTest(true);
            //Thread.Sleep(50);
            FWC.SetTXMon(false);
            //Thread.Sleep(50);
            FWC.SetPDrvMon(true);

            bool duplex = full_duplex;
            FullDuplex = true;

            // bool spur_red = chkSR.Checked;					// save current spur reduction setting
            // chkSR.Checked = false;							// turn spur reduction off

            bool polyphase = SetupForm.Polyphase;			// save current polyphase setting
            SetupForm.Polyphase = false;					// disable polyphase

            int dsp_buf_size = SetupForm.DSPPhoneRXBuffer;		// save current DSP buffer size
            SetupForm.DSPPhoneRXBuffer = 4096;					// set DSP Buffer Size to 4096

            // setup display mode
            string display = comboDisplayMode.Text;
            comboDisplayMode.Text = "Spectrum";

            // setup dsp mode
            DSPMode dsp_mode = RX1DSPMode;
            RX1DSPMode = DSPMode.DSB;

            /*bool rx1_preamp = chkRX1Preamp.Checked;
            chkRX1Preamp.Checked = true;*/
            PreampMode preamp = rx1_preamp_mode;
            switch (current_model)
            {
                case Model.FLEX5000:
                    RX1PreampMode = PreampMode.HIGH;
                    break;
                case Model.FLEX3000:
                    if (BandByFreq(freq, -1, true, current_region) == Band.B160M)
                        RX1PreampMode = PreampMode.LOW;
                    else RX1PreampMode = PreampMode.HIGH;
                    break;
            }

            // setup filter
            Filter filter = RX1Filter;
            UpdateRX1Filters(-1000, 1000);

            double vfoa = VFOAFreq;
            VFOAFreq = freq;

            double vfob = VFOBFreq;
            VFOBFreq = freq;

            // setup transmit to be carrier only
            Audio.TXInputSignal = Audio.SignalSource.SILENCE;

            // default pots
            for (int i = 1; i < 4; i++)
                FWC.TRXPotSetRDAC(i, 0);

            // find carrier peak
            float[] a = new float[Display.BUFFER_SIZE];
            for (int i = 0; i < 5; i++)
            {
                calibration_mutex.WaitOne();
                fixed (float* ptr = &a[0])
                    DttSP.GetSpectrum(0, ptr);// get the spectrum values
                calibration_mutex.ReleaseMutex();
                Thread.Sleep(50);
            }

            // find peak bin
            int peak_bin = 2048 + (int)(0.0 / sample_rate1 * 4096.0);
            float max_signal = float.MinValue;
            float sum = 0.0f;
            int filt_low_bin = 2048 + (int)(-1000.0 / sample_rate1 * 4096.0);
            int filt_high_bin = 2048 + (int)(1000.0 / sample_rate1 * 4096.0);
            for (int i = 0; i < 20; i++)
            {
                calibration_mutex.WaitOne();
                fixed (float* ptr = &a[0])
                    DttSP.GetSpectrum(0, ptr);// get the spectrum values
                calibration_mutex.ReleaseMutex();

                if (i == 19)
                {
                    for (int j = 0; j < Display.BUFFER_SIZE; j++)
                    {
                        if (a[j] > max_signal)
                        {
                            max_signal = a[j];
                            peak_bin = j;
                        }
                    }
                }
                for (int j = filt_low_bin; j < filt_high_bin; j++)
                {
                    if (j < peak_bin - 8 || j > peak_bin + 8)
                        sum += a[j];
                }
                Thread.Sleep(100);
            }
            float noise_floor = (sum / (float)(((filt_high_bin - filt_low_bin) - 17) * 20));
            Debug.WriteLine("noise_floor: " + (noise_floor + Display.RX1DisplayCalOffset + Display.RX1PreampOffset).ToString("f1") + " peak_bin:" + peak_bin);

            int c0_step = 8, c1_step = 8, c2_step = 8, c3_step = 8;
            int c0_global_min = 128, c1_global_min = 128, c2_global_min = 128, c3_global_min = 128;
            int c0_index = 128, c1_index = 128, c2_index = 128, c3_index = 128;
            int c0_dir = 1, c1_dir = 1, c2_dir = 1, c3_dir = 1;
            int c0_count = 1, c1_count = 1, c2_count = 1, c3_count = 1;
            float global_min_value = float.MaxValue;
            float start = 0.0f;
            int wrong_direction_count;
            int switch_direction_count;

            if (max_signal < noise_floor + 30.0)
            {
                if (!suppress_errors)
                {
                    MessageBox.Show("Carrier not found (max signal < noise floor + 30dB).  Please try again.\n" +
                        DateTime.Now.ToShortTimeString(),
                        "Carrier Not Found",
                        MessageBoxButtons.OK, MessageBoxIcon.Stop);
                }
                calibration_running = false;
                //progress.Text = "";
                goto end2;
            }

            for (int i = 0; i < 4; i++)
                FWC.TRXPotSetRDAC(i, 128);

            float tol = 10.0f;
            bool first_time;
            // null 3 of 4 pots (leave first pot alone...pot index 0)
            bool progressing = true;
            while (progressing)
            {
                //find minimum of the peak signal over the range of C1 settings
                float min_signal = float.MaxValue;
                max_signal = float.MinValue;
                wrong_direction_count = switch_direction_count = 0;
                first_time = true;
                t2.Start();
                for (int i = c1_global_min; i >= 0 && i <= 255; i += (c1_step * c1_dir))
                {
                    flex5000DebugForm.SetTRXPot(1, (byte)i);
                    FWC.TRXPotSetRDAC(1, i);
                    Thread.Sleep(200);

                    sum = 0.0f;
                    int num_avg = (int)Math.Min(4, (1.0 / (c1_step / 8.0)));
                    for (int j = 0; j < num_avg; j++)
                    {
                        calibration_mutex.WaitOne();
                        fixed (float* ptr = &a[0])
                            DttSP.GetSpectrum(0, ptr);
                        calibration_mutex.ReleaseMutex();
                        sum += a[peak_bin];
                        if (j < num_avg - 1) Thread.Sleep(50);
                    }
                    sum /= num_avg;
                    a[peak_bin] = sum;

                    if (a[peak_bin] < min_signal)			// if carrier is less than minimum
                    {
                        min_signal = a[peak_bin];
                        c1_index = i;
                        if (min_signal < global_min_value)
                        {
                            global_min_value = a[peak_bin];
                            c1_global_min = c1_index;
                        }
                    }

                    if (first_time)
                    {
                        first_time = false;
                        start = a[peak_bin];
                        max_signal = a[peak_bin];
                    }
                    else
                    {
                        if (a[peak_bin] > max_signal && a[peak_bin] > start + 1.0)
                        {
                            max_signal = a[peak_bin];
                            wrong_direction_count++; Debug.Write("W");
                            if (wrong_direction_count > 1)
                            {
                                wrong_direction_count = 0;
                                if (++switch_direction_count > 1)
                                {
                                    // handle switched direction twice
                                    c1_step /= 2;
                                    if (c1_step < 1) c1_step = 1;
                                    c1_dir *= -1;
                                    Debug.WriteLine("c1 exit dir - c1_step:" + c1_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                    break;
                                }

                                min_signal = start;
                                max_signal = start;
                                c1_dir *= -1;
                                i = c1_global_min;
                            }
                        }
                        else
                        {
                            if (min_signal > noise_floor + 20.0) tol = 3.0f;
                            else tol = 5.0f;
                            if (min_signal < start - 3.0 && a[peak_bin] > min_signal + tol)
                            {
                                c1_step /= 2;
                                if (c1_step < 1) c1_step = 1;
                                c1_dir *= -1;
                                Debug.WriteLine("c1 thresh - c1_step:" + c1_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                break;
                            }
                        }
                    }

                    if (!progress.Visible) goto end;
                    else
                    {
                        t1.Stop();
                        if (t1.Duration > 90.0)
                        {
                            /*MessageBox.Show("TX Carrier Calibration Failed.  Values have been returned to previous settings.\n"+
                                DateTime.Now.ToShortTimeString(),
                                "TX Carrier Failed",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);*/
                            goto end;
                        }
                        else progress.SetPercent((float)(t1.Duration / 45.0));
                    }
                }

                t2.Stop();
                c1_count++;
                Debug.WriteLine("t2 c1(" + c1_count + "): " + t2.Duration);

                flex5000DebugForm.SetTRXPot(1, (byte)c1_global_min);
                FWC.TRXPotSetRDAC(1, c1_global_min);

                if (!progressing) break;

                //find minimum of the peak signal over the range of C2 settings
                min_signal = float.MaxValue;
                max_signal = float.MinValue;
                wrong_direction_count = switch_direction_count = 0;
                first_time = true;
                t2.Start();
                for (int i = c2_global_min; i >= 0 && i <= 255; i += (c2_step * c2_dir))
                {
                    flex5000DebugForm.SetTRXPot(2, (byte)i);
                    FWC.TRXPotSetRDAC(2, i);
                    Thread.Sleep(200);

                    sum = 0.0f;
                    int num_avg = (int)Math.Max(4, (1.0 / (c2_step / 8.0)));
                    for (int j = 0; j < num_avg; j++)
                    {
                        calibration_mutex.WaitOne();
                        fixed (float* ptr = &a[0])
                            DttSP.GetSpectrum(0, ptr);
                        calibration_mutex.ReleaseMutex();
                        sum += a[peak_bin];
                        if (j < num_avg - 1) Thread.Sleep(50);
                    }
                    sum /= num_avg;
                    a[peak_bin] = sum;

                    if (a[peak_bin] < min_signal)			// if carrier is less than minimum
                    {
                        min_signal = a[peak_bin];
                        c2_index = i;
                        if (min_signal < global_min_value)
                        {
                            global_min_value = a[peak_bin];
                            c2_global_min = c2_index;
                        }
                    }

                    if (first_time)
                    {
                        first_time = false;
                        start = a[peak_bin];
                        max_signal = a[peak_bin];
                    }
                    else
                    {
                        if (a[peak_bin] > max_signal && a[peak_bin] > start + 1.0)
                        {
                            max_signal = a[peak_bin];
                            wrong_direction_count++; Debug.Write("W");
                            if (wrong_direction_count > 1)
                            {
                                wrong_direction_count = 0;
                                if (++switch_direction_count > 1)
                                {
                                    // handle switched direction twice
                                    c2_step /= 2;
                                    if (c2_step < 1) c2_step = 1;
                                    c2_dir *= -1;
                                    Debug.WriteLine("c2 exit dir - c2_step:" + c2_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                    break;
                                }

                                min_signal = start;
                                max_signal = start;
                                c2_dir *= -1;
                                i = c2_global_min;
                            }
                        }
                        else
                        {
                            if (min_signal > noise_floor + 20.0) tol = 3.0f;
                            else tol = 5.0f;
                            if (min_signal < start - 3.0 && a[peak_bin] > min_signal + tol)
                            {
                                c2_step /= 2;
                                if (c2_step < 1) c2_step = 1;
                                c2_dir *= -1;
                                Debug.WriteLine("c2 thresh - c2_step:" + c2_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                break;
                            }
                        }
                    }

                    if (!progress.Visible) goto end;
                    else
                    {
                        t1.Stop();
                        if (t1.Duration > 90.0)
                        {
                            /*MessageBox.Show("TX Carrier Calibration Failed.  Values have been returned to previous settings.\n"+
                                DateTime.Now.ToShortTimeString(),
                                "TX Carrier Failed",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);*/
                            goto end;
                        }
                        else progress.SetPercent((float)(t1.Duration / 45.0));
                    }
                }

                t2.Stop();
                c2_count++;
                Debug.WriteLine("t2 c2(" + c2_count + "): " + t2.Duration);

                flex5000DebugForm.SetTRXPot(2, (byte)c2_global_min);
                FWC.TRXPotSetRDAC(2, c2_global_min);

                if (!progressing) break;

                //find minimum of the peak signal over the range of C3 settings
                min_signal = float.MaxValue;
                max_signal = float.MinValue;
                wrong_direction_count = switch_direction_count = 0;
                first_time = true;
                t2.Start();
                for (int i = c3_global_min; i >= 0 && i <= 255; i += (c3_step * c3_dir))
                {
                    flex5000DebugForm.SetTRXPot(3, (byte)i);
                    FWC.TRXPotSetRDAC(3, i);
                    Thread.Sleep(200);

                    sum = 0.0f;
                    int num_avg = (int)Math.Min(4, (1.0 / (c3_step / 8.0)));
                    for (int j = 0; j < num_avg; j++)
                    {
                        calibration_mutex.WaitOne();
                        fixed (float* ptr = &a[0])
                            DttSP.GetSpectrum(0, ptr);
                        calibration_mutex.ReleaseMutex();
                        sum += a[peak_bin];
                        if (j < num_avg - 1) Thread.Sleep(50);
                    }
                    sum /= num_avg;
                    a[peak_bin] = sum;

                    if (a[peak_bin] < min_signal)			// if carrier is less than minimum
                    {
                        min_signal = a[peak_bin];
                        c3_index = i;
                        if (min_signal < global_min_value)
                        {
                            global_min_value = a[peak_bin];
                            c3_global_min = c3_index;
                        }
                    }

                    if (first_time)
                    {
                        first_time = false;
                        start = a[peak_bin];
                        max_signal = a[peak_bin];
                    }
                    else
                    {
                        if (a[peak_bin] > max_signal && a[peak_bin] > start + 1.0)
                        {
                            max_signal = a[peak_bin];
                            wrong_direction_count++; Debug.Write("W");
                            if (wrong_direction_count > 1)
                            {
                                wrong_direction_count = 0;
                                if (++switch_direction_count > 1)
                                {
                                    // handle switched direction twice
                                    c3_step /= 2;
                                    if (c3_step < 1) c3_step = 1;
                                    c3_dir *= -1;
                                    Debug.WriteLine("c3 exit dir - c3_step:" + c3_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                    break;
                                }

                                min_signal = start;
                                max_signal = start;
                                c3_dir *= -1;
                                i = c3_global_min;
                            }
                        }
                        else
                        {
                            if (min_signal > noise_floor + 20.0) tol = 3.0f;
                            else tol = 5.0f;
                            if (min_signal < start - 3.0 && a[peak_bin] > min_signal + tol)
                            {
                                c3_step /= 2;
                                if (c3_step < 1) c3_step = 1;
                                c3_dir *= -1;
                                Debug.WriteLine("c3 thresh - c3_step:" + c3_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                break;
                            }
                        }
                    }

                    if (!progress.Visible) goto end;
                    else
                    {
                        t1.Stop();
                        if (t1.Duration > 90.0)
                        {
                            /*MessageBox.Show("TX Carrier Calibration Failed.  Values have been returned to previous settings.\n"+
                                DateTime.Now.ToShortTimeString(),
                                "TX Carrier Failed",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);*/
                            goto end;
                        }
                        else progress.SetPercent((float)(t1.Duration / 45.0));
                    }
                }

                t2.Stop();
                c3_count++;
                Debug.WriteLine("t2 c3(" + c3_count + "): " + t2.Duration);

                flex5000DebugForm.SetTRXPot(3, (byte)c3_global_min);
                FWC.TRXPotSetRDAC(3, c3_global_min);

                if (!progressing) break;

                //find minimum of the peak signal over the range of C1 settings
                min_signal = float.MaxValue;
                max_signal = float.MinValue;
                wrong_direction_count = switch_direction_count = 0;
                first_time = true;
                t2.Start();
                for (int i = c0_global_min; i >= 0 && i <= 255; i += (c0_step * c0_dir))
                {
                    flex5000DebugForm.SetTRXPot(0, (byte)i);
                    FWC.TRXPotSetRDAC(0, i);
                    Thread.Sleep(200);

                    sum = 0.0f;
                    int num_avg = (int)Math.Min(4, (1.0 / (c0_step / 8.0)));
                    for (int j = 0; j < num_avg; j++)
                    {
                        calibration_mutex.WaitOne();
                        fixed (float* ptr = &a[0])
                            DttSP.GetSpectrum(0, ptr);
                        calibration_mutex.ReleaseMutex();
                        sum += a[peak_bin];
                        if (j < num_avg - 1) Thread.Sleep(50);
                    }
                    sum /= num_avg;
                    a[peak_bin] = sum;

                    if (a[peak_bin] < min_signal)			// if carrier is less than minimum
                    {
                        min_signal = a[peak_bin];
                        c0_index = i;
                        if (min_signal < global_min_value)
                        {
                            global_min_value = a[peak_bin];
                            c0_global_min = c0_index;
                        }
                    }

                    if (first_time)
                    {
                        first_time = false;
                        start = a[peak_bin];
                        max_signal = a[peak_bin];
                    }
                    else
                    {
                        if (a[peak_bin] > max_signal && a[peak_bin] > start + 1.0)
                        {
                            max_signal = a[peak_bin];
                            wrong_direction_count++; Debug.Write("W");
                            if (wrong_direction_count > 1)
                            {
                                wrong_direction_count = 0;
                                if (++switch_direction_count > 1)
                                {
                                    // handle switched direction twice
                                    c0_step /= 2;
                                    if (c0_step < 1) c0_step = 1;
                                    c0_dir *= -1;
                                    Debug.WriteLine("c0 exit dir - c0_step:" + c0_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                    break;
                                }

                                min_signal = start;
                                max_signal = start;
                                c0_dir *= -1;
                                i = c0_global_min;
                            }
                        }
                        else
                        {
                            if (min_signal > noise_floor + 20.0) tol = 3.0f;
                            else tol = 5.0f;
                            if (min_signal < start - 3.0 && a[peak_bin] > min_signal + tol)
                            {
                                c0_step /= 2;
                                if (c0_step < 1) c0_step = 1;
                                c0_dir *= -1;
                                Debug.WriteLine("c0 thresh - c0_step:" + c0_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                break;
                            }
                        }
                    }

                    if (!progress.Visible) goto end;
                    else
                    {
                        t1.Stop();
                        if (t1.Duration > 90.0)
                        {
                            /*MessageBox.Show("TX Carrier Calibration Failed.  Values have been returned to previous settings.\n"+
                                DateTime.Now.ToShortTimeString(),
                                "TX Carrier Failed",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);*/
                            goto end;
                        }
                        else progress.SetPercent((float)(t1.Duration / 45.0));
                    }
                }

                t2.Stop();
                c0_count++;
                Debug.WriteLine("t2 c0(" + c0_count + "): " + t2.Duration);

                flex5000DebugForm.SetTRXPot(0, (byte)c0_global_min);
                FWC.TRXPotSetRDAC(0, c0_global_min);

                if (!progressing) break;

                if (c0_count > 5 && c1_count > 5 && c2_count > 5 && c3_count > 5)
                    progressing = false;
            }
            ret_val = true;
            Debug.WriteLine("Carrier Null: [" + c0_global_min + ", " + c1_global_min + ", " + c2_global_min + ", " + c3_global_min + "]");

        end:
            if (!progress.Visible) progress.Text = "";
            else
            {
                flex5000DebugForm.SetTRXPot(0, (byte)c0_global_min);
                flex5000DebugForm.SetTRXPot(1, (byte)c1_global_min);
                flex5000DebugForm.SetTRXPot(2, (byte)c2_global_min);
                flex5000DebugForm.SetTRXPot(3, (byte)c3_global_min);
                tx_carrier_table[(int)tx_band][0] = c0_global_min;
                tx_carrier_table[(int)tx_band][1] = c1_global_min;
                tx_carrier_table[(int)tx_band][2] = c2_global_min;
                tx_carrier_table[(int)tx_band][3] = c3_global_min;
            }
        end2:
            progress.Hide();
            // return output tone
            Audio.TXInputSignal = Audio.SignalSource.RADIO;

            min_tx_carrier[(int)tx_band] = global_min_value + Display.RX1DisplayCalOffset + Display.RX1PreampOffset;

            // return hardware to normal operation
            //Thread.Sleep(50);
            FWC.SetQSD(true);
            //Thread.Sleep(50);
            FWC.SetQSE(false);
            //Thread.Sleep(50);
            FWC.SetTR(false);
            //Thread.Sleep(50);
            FWC.SetSig(false);
            //Thread.Sleep(50);
            FWC.SetGen(false);
            //Thread.Sleep(50);
            FWC.SetTest(false);
            //Thread.Sleep(50);
            FWC.SetTXMon(false);
            //Thread.Sleep(50);
            FWC.SetPDrvMon(false);
            //Thread.Sleep(50);

            if (current_model == Model.FLEX3000)
                FWC.SetFan(false);

            SetupForm.Polyphase = polyphase;
            SetupForm.DSPPhoneRXBuffer = dsp_buf_size;
            // chkSR.Checked = spur_red;
            FullDuplex = duplex;

            VFOAFreq = vfoa;
            VFOBFreq = vfob;

            comboDisplayMode.Text = display;

            RX1DSPMode = dsp_mode;
            RX1Filter = filter;
            RX1PreampMode = preamp;

            calibration_running = false;
            return ret_val;
        }

        public float[] tx_spur_level = new float[(int)Band.LAST];
        public bool CalTXSpur(float freq, Progress progress)
        {
            if (!(fwc_init && current_model == Model.FLEX5000))
            {
                progress.Text = "";
                progress.Hide();
                return false;
            }

            if (!chkPower.Checked)
            {
                MessageBox.Show("Power must be on in order to calibrate TX Spur.", "Power Is Off",
                    MessageBoxButtons.OK, MessageBoxIcon.Stop);
                calibration_running = false;
                progress.Text = "";
                return false;
            }

            HiPerfTimer t1 = new HiPerfTimer();
            t1.Start();

            bool ret_val = false;
            calibration_running = true;
            progress.SetPercent(0.0f);

            // setup hardware/DSP/Audio
            FWC.SetQSD(true);
            FWC.SetQSE(true);
            FWC.SetTR(true);
            FWC.SetSig(false);
            FWC.SetGen(false);
            FWC.SetTest(false);
            FWC.SetTXMon(true);
            FWC.SetPDrvMon(true);

            bool duplex = full_duplex;
            FullDuplex = true;

            //  bool spur_red = chkSR.Checked;					// save current spur reduction setting
            // chkSR.Checked = false;							// turn spur reduction off

            bool polyphase = SetupForm.Polyphase;			// save current polyphase setting
            SetupForm.Polyphase = false;					// disable polyphase

            int dsp_buf_size = SetupForm.DSPPhoneRXBuffer;		// save current DSP buffer size
            SetupForm.DSPPhoneRXBuffer = 4096;					// set DSP Buffer Size to 4096

            // setup display mode
            string display = comboDisplayMode.Text;
            comboDisplayMode.Text = "Panadapter";

            // setup dsp mode
            DSPMode dsp_mode = RX1DSPMode;
            RX1DSPMode = DSPMode.CWU;

            /*bool rx1_preamp = chkRX1Preamp.Checked;
            chkRX1Preamp.Checked = true;*/
            PreampMode preamp = rx1_preamp_mode;
            switch (current_model)
            {
                case Model.FLEX5000:
                    RX1PreampMode = PreampMode.HIGH;
                    break;
                case Model.FLEX3000:
                    if (BandByFreq(freq, -1, true, current_region) == Band.B160M)
                        RX1PreampMode = PreampMode.LOW;
                    else RX1PreampMode = PreampMode.HIGH;
                    break;
            }

            double vfoa = VFOAFreq;
            VFOAFreq = freq;

            double vfob = VFOBFreq;
            VFOBFreq = freq;

            // setup filter
            Filter filter = RX1Filter;
            UpdateRX1Filters(cw_pitch - 250, cw_pitch + 250);

            DttSP.SetKeyerHarmonicRemove(0.0, 0.0, 0.0);

            bool iambic = chkCWIambic.Checked;
            chkCWIambic.Checked = false;

            Audio.CurrentAudioState1 = Audio.AudioState.CW;
            Audio.MOX = true;

            bool ptt = disable_ptt;
            disable_ptt = true;

            /*int count = 0;
            while (progress.Visible)
            {
                progress.SetPercent(count++ / 1000.0f);
                Thread.Sleep(100);
            }*/

            // Keyer.FWCDot = true;

            /*progress.Show();
            count = 0;
            while (progress.Visible)
            {
                progress.SetPercent(count++ / 1000.0f);
                Thread.Sleep(100);
            }*/

            FWC.SetPABias(true);
            Thread.Sleep(200);

            /*progress.Show();
            count = 0;
            while (progress.Visible)
            {
                progress.SetPercent(count++ / 1000.0f);
                Thread.Sleep(100);
            }*/

            // find spur(s)

            // measure carrier amplitude
            float sum = 0.0f;
            for (int i = 0; i < 10; i++)
            {
                sum += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                Thread.Sleep(50);
            }
            float carrier_ampl = sum / 10;

            // measure spur amplitude
            UpdateRX1Filters(-cw_pitch * 3 - 250, -cw_pitch * 3 + 250);
            Thread.Sleep(200);
            sum = 0.0f;
            for (int i = 0; i < 10; i++)
            {
                sum += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                Thread.Sleep(50);
            }
            float spur_ampl = sum / 10;
            Debug.WriteLine("spur: " + (spur_ampl - carrier_ampl).ToString("f1") + " dBc");

            // measure harmonic amplitude with known drive level
            DttSP.SetKeyerHarmonicRemove(-4.0, 0.0, 0.002);
            UpdateRX1Filters(-cw_pitch * 4 - 250, -cw_pitch * 4 + 250);
            Thread.Sleep(200);
            sum = 0.0f;
            for (int i = 0; i < 10; i++)
            {
                sum += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                Thread.Sleep(50);
            }
            float harm_ampl = sum / 10;

            // match harmonic amplitude to measured value
            float diff = spur_ampl - harm_ampl;
            double ampl = 0.002 * Math.Pow(10.0, diff / 20.0);
            DttSP.SetKeyerHarmonicRemove(-4.0, 0.0, ampl);
            UpdateRX1Filters(-cw_pitch * 3 - 250, -cw_pitch * 3 + 250);
            Thread.Sleep(200);

            /*progress.Show();
            count = 0;
            while (progress.Visible)
            {
                progress.SetPercent(count++ / 1000.0f);
                Thread.Sleep(100);
            }*/

            //progress.Show();
            // find null
            float tol = 3.0f;
            double phase_step = Math.PI * 2 / 100;
            double gain_step = 0.00001;
            double global_min_phase = 0.0;
            double global_min_gain = ampl;
            double gain_index = 0.0, phase_index = 0.0;
            float global_min_value = float.MaxValue;
            int gain_dir = -1;
            int phase_dir = 1;
            int gain_count = 1, phase_count = 1;
            int wrong_direction_count;
            int switch_direction_count;
            bool progressing = true;

            if (predistForm != null && predistForm.Visible)
            {
                predistForm.Ampl = global_min_gain;
                predistForm.Phase = global_min_phase;
            }

            //HiPerfTimer t1 = new HiPerfTimer();
            t1.Start();
            HiPerfTimer t2 = new HiPerfTimer();

            while (progressing)
            {
                // find minimum of the spur over
                // the range of Phase settings

                float min_signal = float.MaxValue;
                float max_signal = float.MinValue;
                wrong_direction_count = switch_direction_count = 0;
                float start = 0.0f;
                bool first_time = true;
                t2.Start();

                for (double i = global_min_phase; i >= 0.0 && i <= Math.PI * 2; )
                {
                    DttSP.SetKeyerHarmonicRemove(-3, i, global_min_gain);
                    if (predistForm != null && predistForm.Visible)
                        predistForm.Phase = i / (Math.PI * 2);
                    Thread.Sleep(200);

                    int num_avg = phase_count * 10;
                    sum = 0.0f;
                    for (int j = 0; j < num_avg; j++)
                    {
                        sum += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                        Thread.Sleep(50);
                    }
                    sum /= num_avg;

                    if (sum < min_signal) // if spur is less than minimum
                    {
                        min_signal = sum;
                        phase_index = i;
                        if (min_signal < global_min_value)
                        {
                            global_min_value = min_signal;
                            global_min_phase = phase_index;
                        }
                    }

                    // check for cal complete condition
                    // check for cal complete condition
                    if (min_signal - carrier_ampl < -80.0f)
                    {
                        progressing = false;
                        break;
                    }

                    if (first_time)
                    {
                        first_time = false;
                        start = sum;
                        max_signal = sum;
                    }
                    else
                    {
                        if (sum > max_signal && sum > start + 1.0f)
                        {
                            max_signal = sum;
                            wrong_direction_count++; Debug.Write("W");
                            if (wrong_direction_count > 1)
                            {
                                //wrong_direction_count = 0;
                                if (++switch_direction_count > 1)
                                {
                                    // handle switched direction twice
                                    phase_step /= 2.0f;
                                    phase_dir *= -1;
                                    Debug.WriteLine("phase exit dir - phase_step:" + phase_step.ToString("f6") + "  now:" + (global_min_value - carrier_ampl).ToString("f1") + " dBc");
                                    break;
                                }
                            }

                            min_signal = start;
                            max_signal = start;
                            phase_step *= -1;
                            i = global_min_phase;
                        }
                        else
                        {
                            if (sum > min_signal + tol)
                            {
                                phase_step /= 2.0f;
                                phase_dir *= -1;
                                Debug.WriteLine("exit phase thresh - phase_step:" + phase_step.ToString("f4") + "  now:" + (global_min_value - carrier_ampl).ToString("f1") + " dBc");
                                break;
                            }
                        }
                    }

                    if (!progress.Visible) goto end;
                    else
                    {
                        t1.Stop();
                        if (t1.Duration > 90.0)
                        {
                            goto end;
                        }
                        else progress.SetPercent((float)(t1.Duration / 90.0));
                    }

                    i += (phase_step * phase_dir);
                    if (i < 0.0) i += Math.PI * 2;
                    if (i > Math.PI * 2) i -= Math.PI * 2;
                }

                t2.Stop();
                Debug.WriteLine("t2 phase(" + phase_count++ + "): " + t2.Duration);

                if (!progressing) break;

                if (predistForm != null && predistForm.Visible)
                    predistForm.Phase = global_min_phase / (Math.PI * 2);

                // find minimum of the spur over 
                // the range of Gain settings
                min_signal = float.MaxValue;
                max_signal = float.MinValue;
                wrong_direction_count = switch_direction_count = 0;
                first_time = true;
                t2.Start();

                for (double i = global_min_gain; i >= 0.0 && i <= 0.01; i += (gain_step * gain_dir))
                {
                    DttSP.SetKeyerHarmonicRemove(-3, global_min_phase, i);
                    if (predistForm != null && predistForm.Visible)
                        predistForm.Ampl = i;
                    Thread.Sleep(200);

                    int num_avg = gain_count * 10;
                    sum = 0.0f;
                    for (int j = 0; j < num_avg; j++)
                    {
                        sum += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                        Thread.Sleep(50);
                    }
                    sum /= num_avg;

                    if (sum < min_signal) // if spur is less than minimum
                    {
                        min_signal = sum;
                        gain_index = i;
                        if (min_signal < global_min_value)
                        {
                            global_min_value = min_signal;
                            global_min_gain = gain_index;
                        }
                    }

                    // check for cal complete condition
                    if (min_signal - carrier_ampl < -80.0f)
                    {
                        progressing = false;
                        break;
                    }

                    if (first_time)
                    {
                        first_time = false;
                        start = sum;
                        max_signal = sum;
                    }
                    else
                    {
                        if (sum > max_signal && sum > start + 1.0f)
                        {
                            max_signal = sum;
                            wrong_direction_count++; Debug.Write("W");
                            if (wrong_direction_count > 1)
                            {
                                //wrong_direction_count = 0;
                                if (++switch_direction_count > 1)
                                {
                                    // handle switched direction twice
                                    gain_step /= 5.0f;
                                    gain_dir *= -1;
                                    Debug.WriteLine("gain exit dir - gain_step:" + gain_step.ToString("f4") + "  now:" + (global_min_value - carrier_ampl).ToString("f1") + " dBc");
                                    break;
                                }

                                min_signal = start;
                                max_signal = start;
                                gain_step *= -1;
                                i = global_min_gain;
                            }
                        }
                        else
                        {
                            if (sum > min_signal + tol)
                            {
                                gain_step /= 5.0f;
                                gain_dir *= -1;
                                Debug.WriteLine("exit gain thresh - gain_step:" + gain_step.ToString("f4") + "  now:" + (global_min_value - carrier_ampl).ToString("f1") + " dBc");
                                break;
                            }
                        }
                    }

                    if (!progress.Visible) goto end;
                    else
                    {
                        t1.Stop();
                        if (t1.Duration > 90.0)
                        {
                            goto end;
                        }
                        else progress.SetPercent((float)(t1.Duration / 90.0));
                    }
                }

                t2.Stop();
                Debug.WriteLine("t2 gain(" + gain_count++ + "): " + t2.Duration);

                if (!progressing) break;

                if (predistForm != null && predistForm.Visible)
                    predistForm.Ampl = global_min_gain;
            }

            // Finish the algorithm and reset the values
            ret_val = true;
        // measure and compare

            // return hardware/dsp/audio to previous settings
        end:
            if (!progress.Visible) progress.Text = "";
            progress.Hide();

            sum = 0.0f;
            for (int i = 0; i < 10; i++)
            {
                sum += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                Thread.Sleep(50);
            }
            float spur_ampl_after = sum / 10;

            Debug.WriteLine("spur after: " + (spur_ampl_after - carrier_ampl).ToString("f1") + " dBc");
            tx_spur_level[(int)tx_band] = spur_ampl_after - carrier_ampl;

            FWC.SetPABias(false);
            // Keyer.FWCDot = false;

            FWC.SetQSD(true);
            FWC.SetQSE(false);
            FWC.SetTR(false);
            FWC.SetSig(false);
            FWC.SetGen(false);
            FWC.SetTest(false);
            FWC.SetTXMon(false);
            FWC.SetPDrvMon(false);

            Audio.MOX = false;
            Audio.CurrentAudioState1 = Audio.AudioState.DTTSP;
            disable_ptt = ptt;

            SetupForm.Polyphase = polyphase;
            SetupForm.DSPPhoneRXBuffer = dsp_buf_size;
            //  chkSR.Checked = spur_red;
            FullDuplex = duplex;

            VFOAFreq = vfoa;
            VFOBFreq = vfob;

            comboDisplayMode.Text = display;

            RX1DSPMode = dsp_mode;
            RX1Filter = filter;
            RX1PreampMode = preamp;

            chkCWIambic.Checked = iambic;

            calibration_running = false;
            return ret_val;
        }

        public void CallCalSigGen()
        {
            p = new Progress("Calibrate Signal Generator");
            Thread t = new Thread(new ThreadStart(CalSigGen));
            t.Name = "Calibrate Signal Generator Thread";
            t.IsBackground = true;
            t.Priority = ThreadPriority.Normal;
            t.Start();
            p.Show();
        }

        private void CalSigGen()
        {
            if (!(fwc_init && current_model == Model.FLEX5000))
            {
                p.Hide();
                return;
            }

            double low = 1.0;
            double high = 65.0;
            double step = 0.1;
            int num_steps = (int)((high - low) / step);
            int count = 0;
            StreamWriter sw = new StreamWriter(app_data_path + "\\sig_gen.csv");

            FullDuplex = true;
            FWC.SetSig(true);
            FWC.SetGen(true);
            FWC.SetTest(true);
            RX1DSPMode = DSPMode.USB;
            RX1Filter = Filter.VAR2;
            UpdateRX1Filters(480, 520);

            for (double i = low; i <= high; i += step)
            {
                VFOAFreq = i;
                //Thread.Sleep(20);
                VFOBFreq = i + 0.0005;
                Thread.Sleep(200);
                float sum = 0.0f;
                for (int j = 0; j < 10; j++)
                {
                    sum += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                    sum = sum +
                        rx1_meter_cal_offset +
                        rx1_preamp_offset[(int)rx1_preamp_mode] +
                        rx1_filter_size_cal_offset;
                    Thread.Sleep(50);
                }
                sum /= 10;

                sw.WriteLine(i.ToString("f6") + "," + sum.ToString("f3"));
                p.SetPercent(count++ / (float)num_steps);
                if (!p.Visible) break;
            }
            sw.Close();
            FWC.SetSig(false);
            FWC.SetGen(false);
            FWC.SetTest(false);
            p.Hide();
        }
        public bool FreqCalibrationRunning = false;
        public bool CalibrateFreq(float freq)
        {
            bool retval = false;
            //bool rx_only = SetupForm.RXOnly;
            //SetupForm.RXOnly = true;

            if (!chkPower.Checked)
            {
                MessageBox.Show("Power must be on in order to calibrate Frequency.", "Power Is Off",
                    MessageBoxButtons.OK, MessageBoxIcon.Stop);
                return false;
            }
            calibration_running = true;
            FreqCalibrationRunning = true;
            string vfo_freq_text = txtVFOAFreq.Text;		// save current frequency

            bool polyphase = SetupForm.Polyphase;			// save current polyphase setting
            SetupForm.Polyphase = false;					// disable polyphase

            int dsp_buf_size = SetupForm.DSPPhoneRXBuffer;	// save current DSP buffer size
            SetupForm.DSPPhoneRXBuffer = 4096;				// set DSP Buffer Size to 4096

            Filter filter = RX1Filter;						// save current filter

            DSPMode dsp_mode = rx1_dsp_mode;				// save current demod mode
            RX1DSPMode = DSPMode.SAM;						// set DSP to AM

            bool rit_on = chkRIT.Checked;					// save current RIT state
            chkRIT.Checked = false;							// set RIT to Off

            int rit_value = (int)udRIT.Value;				// save current RIT value
            udRIT.Value = 0;								// set RIT Value to 0

            Filter am_filter = RX1Filter;					// save am filter
            RX1Filter = Filter.F5;	                        // set filter to 6600Hz

            if (ModelIsHPSDRorHermes())
            {
                SetupForm.HPSDRFreqCorrectFactor = 1.0;
            }

            VFOAFreq = freq;								// set frequency to passed value

            double old_clock = FWCDDSClockCorrection;
            SetupForm.ClockOffset = 0;
            FWCDDSClockCorrection = 0;

            Thread.Sleep(200);
            //int ret = 0;

            float[] buf = new float[Display.BUFFER_SIZE];
            float[] sum = new float[Display.BUFFER_SIZE];
            for (int i = 0; i < 10; i++)
            {
                calibration_mutex.WaitOne();
                fixed (float* ptr = &buf[0])
                    DttSP.GetSpectrum(0, ptr);		// get the spectrum values
                for (int j = 0; j < Display.BUFFER_SIZE; j++)
                    sum[j] += buf[j];
                calibration_mutex.ReleaseMutex();
                Thread.Sleep(50);
            }

            float max = float.MinValue;
            //float avg = 0;
            int max_index = 0;

            for (int i = 0; i < Display.BUFFER_SIZE; i++)						// find the maximum signal
            {
                //avg += buf[i];
                if (sum[i] > max)
                {
                    max = sum[i];
                    max_index = i;
                }
            }

            /* avg -= max;
            avg /= (high - low - 1);

            if(max < (avg + 30))
            {
                MessageBox.Show("Peak is less than 30dB from the noise floor.  " +
                    "Please use a larger signal for frequency calibration.",
                    "Calibration Error - Weak Signal",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                retval = false;
                goto end;
            } */

            // Calculate the difference between the known signal and the measured signal
            float diff = (float)((double)sample_rate1 / Display.BUFFER_SIZE * (Display.BUFFER_SIZE / 2 - max_index));

            //System.Console.WriteLine("diff is: " + diff);

            if (ModelIsHPSDRorHermes())
            {
                double correct_factor = 1.0d - ((double)diff / (double)(freq * 1000000.0));
                SetupForm.HPSDRFreqCorrectFactor = correct_factor;
                goto end;
            }

            // Calculate the DDS offset
            int offset = 0;
            switch (current_model)
            {
                case Model.FLEX5000:
                    offset = (int)(500.0 / freq * diff);
                    break;
                case Model.FLEX3000:
                    offset = (int)(499.201 / freq * diff);
                    break;
                default:
                    offset = (int)(200.0 / freq * diff);
                    break;
            }

            Debug.Write("offset1: " + offset);

            if (Math.Abs(offset) > 40000)
            {
                MessageBox.Show("Peak is outside valid range.",
                    "Calibration Error - Range",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                retval = false;
                goto end;
            }

            if (Math.Abs(offset) > 20000)
            {
                DialogResult dr = MessageBox.Show("This value is outside the specifications of the oscillator.  " +
                    "Do you want to use this value?",
                    "Outside Specifications",
                    MessageBoxButtons.YesNo);
                if (dr == DialogResult.No)
                {
                    retval = false;
                    goto end;
                }
            }

            SetupForm.ClockOffset = offset;				// Offset the clock based on the difference
            Thread.Sleep(200);

            float a, b;
            DttSP.GetSAMPLLvals(0, 0, &a, &b);
            float a1 = a * 0.1f;
            float b1 = 0.25f * a1 * a1;
            DttSP.SetSAMPLLvals(0, 0, a1, b1);
            Thread.Sleep(200);

            float sum1 = 0.0f;
            for (int i = 0; i < 50; i++)
            {
                float temp;
                DttSP.GetSAMFreq(0, 0, &temp);
                sum1 += temp;
                Thread.Sleep(50);
            }
            diff = -(float)(sum1 / 50 * sample_rate1 / (2 * Math.PI));

            DttSP.SetSAMPLLvals(0, 0, a, b);  // reset PLL values

            // Calculate the DDS offset
            offset = 0;
            switch (current_model)
            {
                case Model.FLEX5000:
                    offset = (int)(500.0 / freq * diff);
                    break;
                case Model.FLEX3000:
                    offset = (int)(499.201 / freq * diff);
                    break;
                default:
                    offset = (int)(200.0 / freq * diff);
                    break;
            }

            Debug.WriteLine("  offset2: " + offset);

            int current_clock = SetupForm.ClockOffset;
            if (Math.Abs(current_clock + offset) > 40000 ||
                Math.Abs(current_clock - offset) > 40000)
            {
                MessageBox.Show("Peak is outside valid range.",
                    "Calibration Error - Range",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                retval = false;
                goto end;
            }

            if (Math.Abs(current_clock + offset) > 20000 ||
                Math.Abs(current_clock - offset) > 20000)
            {
                DialogResult dr = MessageBox.Show("This value is outside the specifications of the oscillator.  " +
                    "Do you want to use this value?",
                    "Outside Specifications",
                    MessageBoxButtons.YesNo);
                if (dr == DialogResult.No)
                {
                    retval = false;
                    goto end;
                }
            }

            SetupForm.ClockOffset += offset;				// Offset the clock based on the difference
            retval = true;

        end:
            //SetupForm.RXOnly = rx_only;					// restore RX Only setting
            RX1Filter = am_filter;							// restore AM filter
            RX1DSPMode = dsp_mode;							// restore DSP mode
            RX1Filter = filter;								// restore filter
            chkRIT.Checked = rit_on;						// restore RIT state
            RITValue = rit_value;							// restore RIT value
            VFOAFreq = float.Parse(vfo_freq_text);			// restore frequency
            SetupForm.DSPPhoneRXBuffer = dsp_buf_size;		// restore DSP buffer size
            SetupForm.Polyphase = polyphase;				// restore polyphase
            calibration_running = false;
            FreqCalibrationRunning = false;
            return retval;
        }

        public bool CalibrateLevel(float level, float freq, Progress progress, bool suppress_errors)
        {
            // Calibration routine called by Setup Form.
            bool ret_val = false;
            calibration_running = true;
            if (!chkPower.Checked)
            {
                if (!suppress_errors)
                {
                    MessageBox.Show("Power must be on in order to calibrate RX Level.", "Power Is Off",
                        MessageBoxButtons.OK, MessageBoxIcon.Stop);
                }
                calibration_running = false;
                return false;
            }
            float[] a = new float[Display.BUFFER_SIZE];
            switch (current_model)
            {
                case Model.HPSDR:
                case Model.HERMES:
                    //~~~~~
                    //bool rx_only = SetupForm.RXOnly;					// Save RX Only Setting
                    //SetupForm.RXOnly = true;

                    double vfoa = VFOAFreq;								// save current VFOA

                    bool rit_on = chkRIT.Checked;						// save current RIT On
                    chkRIT.Checked = false;								// turn RIT off
                    int rit_val = (int)udRIT.Value;						// save current RIT value

                    string display = comboDisplayMode.Text;
                    comboDisplayMode.Text = "Spectrum";

                    bool polyphase = SetupForm.Polyphase;				// save current polyphase setting
                    SetupForm.Polyphase = false;						// disable polyphase

                    int dsp_buf_size = SetupForm.DSPPhoneRXBuffer;		// save current DSP buffer size
                    SetupForm.DSPPhoneRXBuffer = 4096;					// set DSP Buffer Size to 2048

                    Filter filter = RX1Filter;						// save current filter

                    DSPMode dsp_mode = rx1_dsp_mode;				// save current DSP demod mode
                    RX1DSPMode = DSPMode.AM;						// set mode to CWU

                    VFOAFreq = freq;									// set VFOA frequency

                    Filter am_filter = RX1Filter;					// save current AM filter
                    RX1Filter = Filter.F1;						   // set filter to 500Hz

                    PreampMode preamp = RX1PreampMode;				// save current preamp mode
                    RX1PreampMode = PreampMode.HPSDR_ON;			// set to high

                    MeterRXMode rx_meter = CurrentMeterRXMode;			// save current RX Meter mode
                    CurrentMeterRXMode = MeterRXMode.OFF;				// turn RX Meter off

                    bool display_avg = chkDisplayAVG.Checked;			// save current average state
                    chkDisplayAVG.Checked = false;
                    chkDisplayAVG.Checked = true;						// set average state to off

                    float old_multimeter_cal = rx1_meter_cal_offset;
                    float old_display_cal = rx1_display_cal_offset;
                    int progress_divisor;
                    if (alexpresent)
                    {
                        progress_divisor = 390;
                    }
                    else
                    {
                        progress_divisor = 120;
                    }

                    comboPreamp.Enabled = false;
                    comboDisplayMode.Enabled = false;
                    comboMeterRXMode.Enabled = false;

                    progress.SetPercent(0.0f);
                    int counter = 0;

                    Thread.Sleep(2000);
                    btnZeroBeat_Click(this, EventArgs.Empty);
                    RX1Filter = Filter.F6;
                    chkDisplayAVG.Checked = false;
                    Thread.Sleep(200);

                    DisableAllFilters();
                    DisableAllModes();
                    VFOLock = true;

                    calibration_mutex.WaitOne();

                    fixed (float* ptr = &a[0])
                        DttSP.GetSpectrum(0, ptr);		// get the spectrum values
                    calibration_mutex.ReleaseMutex();
                    float max = float.MinValue;
                    float avg = 0;
                    int max_index = 0;

                    for (int i = 0; i < 4095; i++)						// find the maximum signal
                    {
                        avg += a[i];
                        if (a[i] > max)
                        {
                            max = a[i];
                            max_index = i;
                        }
                    }
                    avg -= max;
                    avg /= 4095;

                    if (max < (avg + 30))
                    {
                        MessageBox.Show("Peak is less than 30dB from the noise floor.  " +
                            "Please use a larger signal for frequency calibration.",
                            "Calibration Error - Weak Signal",
                            MessageBoxButtons.OK,
                            MessageBoxIcon.Error);
                        ret_val = false;
                        goto end;
                    }

                    rx1_meter_cal_offset = 0.0f;
                    rx1_display_cal_offset = 0.0f;
                    float num = 0.0f, num2 = 0.0f, avg2 = 0.0f;
                    avg = 0.0f;
                    // get the value of the signal strength meter
                    for (int i = 0; i < 50; i++)
                    {
                        num += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                        Thread.Sleep(50);
                        if (!progress.Visible)
                            goto end;
                        else progress.SetPercent((float)((float)++counter / progress_divisor));
                    }
                    avg = num / 50.0f;


                    RX1PreampMode = PreampMode.HPSDR_OFF;
                    Thread.Sleep(100);

                    // get the value of the signal strength meter
                    num2 = 0.0f;
                    for (int i = 0; i < 50; i++)
                    {
                        num2 += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                        Thread.Sleep(50);
                        if (!progress.Visible)
                            goto end;
                        else progress.SetPercent((float)((float)++counter / progress_divisor));
                    }
                    avg2 = num2 / 50.0f;

                    float off_offset = avg2 - avg;

                    rx1_preamp_offset[(int)PreampMode.HPSDR_OFF] = -off_offset;
                    rx1_preamp_offset[(int)PreampMode.HPSDR_ON] = 0.0f;

                    if (alexpresent)
                    {
                        RX1PreampMode = PreampMode.HPSDR_MINUS10; //-10dB
                        Thread.Sleep(100);

                        // get the value of the signal strength meter
                        num2 = 0.0f;
                        for (int i = 0; i < 50; i++)
                        {
                            num2 += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                            Thread.Sleep(50);
                            if (!progress.Visible)
                                goto end;
                            else progress.SetPercent((float)((float)++counter / progress_divisor));
                        }
                        avg2 = num2 / 50.0f;

                        float minus10_offset = avg2 - avg;
                        rx1_preamp_offset[(int)PreampMode.HPSDR_MINUS10] = -minus10_offset;


                        RX1PreampMode = PreampMode.HPSDR_MINUS20; //-20dB
                        Thread.Sleep(100);

                        // get the value of the signal strength meter
                        num2 = 0.0f;
                        for (int i = 0; i < 50; i++)
                        {
                            num2 += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                            Thread.Sleep(50);
                            if (!progress.Visible)
                                goto end;
                            else progress.SetPercent((float)((float)++counter / progress_divisor));
                        }
                        avg2 = num2 / 50.0f;

                        float minus20_offset = avg2 - avg;
                        rx1_preamp_offset[(int)PreampMode.HPSDR_MINUS20] = -minus20_offset;


                        RX1PreampMode = PreampMode.HPSDR_MINUS30; //-30dB
                        Thread.Sleep(100);

                        // get the value of the signal strength meter
                        num2 = 0.0f; avg2 = 0.0f;
                        for (int i = 0; i < 50; i++)
                        {
                            num2 += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                            Thread.Sleep(50);
                            if (!progress.Visible)
                                goto end;
                            else progress.SetPercent((float)((float)++counter / progress_divisor));
                        }
                        avg2 = num2 / 50.0f;

                        float minus30_offset = avg2 - avg;
                        rx1_preamp_offset[(int)PreampMode.HPSDR_MINUS30] = -minus30_offset;

                        RX1PreampMode = PreampMode.HPSDR_MINUS40; //-40dB

                        Thread.Sleep(100);

                        // get the value of the signal strength meter
                        num2 = 0.0f;
                        for (int i = 0; i < 50; i++)
                        {
                            num2 += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                            Thread.Sleep(50);
                            if (!progress.Visible)
                                goto end;
                            else progress.SetPercent((float)((float)++counter / progress_divisor));
                        }
                        avg2 = num2 / 50.0f;

                        float minus40_offset = avg2 - avg;
                        rx1_preamp_offset[(int)PreampMode.HPSDR_MINUS40] = -minus40_offset;

                        RX1PreampMode = PreampMode.HPSDR_MINUS50;

                        Thread.Sleep(100);

                        // get the value of the signal strength meter
                        num2 = 0.0f;
                        for (int i = 0; i < 50; i++)
                        {
                            num2 += DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                            Thread.Sleep(50);
                            if (!progress.Visible)
                                goto end;
                            else progress.SetPercent((float)((float)++counter / progress_divisor));
                        }
                        avg2 = num2 / 50.0f;

                        float minus50_offset = avg2 - avg;
                        rx1_preamp_offset[(int)PreampMode.HPSDR_MINUS50] = -minus50_offset;

                        System.Console.WriteLine("minus10_offset: " + minus10_offset);
                        System.Console.WriteLine("minus20_offset: " + minus20_offset);
                        System.Console.WriteLine("minus30_offset: " + minus30_offset);
                        System.Console.WriteLine("minus40_offset: " + minus40_offset);
                        System.Console.WriteLine("minus50_offset: " + minus50_offset);
                    }
                    System.Console.WriteLine("off_offset: " + off_offset);
                    System.Console.WriteLine("Counter @ end: " + counter);

                    RX1PreampMode = PreampMode.HPSDR_ON;
                    Thread.Sleep(100);

                    num2 = 0.0f; avg2 = 0.0f;
                    for (int i = 0; i < 20; i++)
                    {
                        calibration_mutex.WaitOne();
                        fixed (float* ptr = &a[0])
                            DttSP.GetSpectrum(0, ptr);		// read again to clear out changed DSP
                        calibration_mutex.ReleaseMutex();
                        max = float.MinValue;						// find the max spectrum value
                        for (int j = 0; j < Display.BUFFER_SIZE; j++)
                            if (a[j] > max) max = a[j];

                        num2 += max;

                        Thread.Sleep(100);

                        if (!progress.Visible)
                            goto end;
                        else progress.SetPercent((float)((float)++counter / progress_divisor));
                    }
                    avg2 = num2 / 20.0f;

                    // calculate the difference between the current value and the correct multimeter value
                    float diff = level - (avg + rx1_meter_cal_offset + rx1_preamp_offset[(int)rx1_preamp_mode]);
                    rx1_meter_cal_offset += diff;

                    // calculate the difference between the current value and the correct spectrum value
                    diff = level - (avg2 + rx1_display_cal_offset + rx1_preamp_offset[(int)rx1_preamp_mode]);

                    RX1DisplayCalOffset += diff;
                    ret_val = true;

                end:
                    if (!progress.Visible) progress.Text = "";
                    progress.Hide();
                    EnableAllFilters();
                    EnableAllModes();
                    VFOLock = false;
                    comboPreamp.Enabled = true;
                    comboDisplayMode.Enabled = true;
                    comboMeterRXMode.Enabled = true;

                    if (ret_val == false)
                    {
                        rx1_meter_cal_offset = old_multimeter_cal;
                        rx1_display_cal_offset = old_display_cal;
                    }

                    comboDisplayMode.Text = display;
                    chkRIT.Checked = rit_on;							// restore RIT on
                    udRIT.Value = rit_val;								// restore RIT value
                    //SetupForm.RXOnly = rx_only;						// restore RX Only			
                    DisplayAVG = display_avg;							// restore AVG value
                    RX1PreampMode = preamp;						// restore preamp value
                    RX1Filter = am_filter;							// restore AM filter
                    RX1DSPMode = dsp_mode;							// restore DSP mode
                    RX1Filter = filter;								// restore filter
                    if (dsp_buf_size != 4096)
                        chkPower.Checked = false;						// go to standby
                    SetupForm.DSPPhoneRXBuffer = dsp_buf_size;				// restore DSP Buffer Size
                    VFOAFreq = vfoa;									// restore vfo frequency
                    if (dsp_buf_size != 4096)
                    {
                        Thread.Sleep(100);
                        chkPower.Checked = true;
                    }
                    CurrentMeterRXMode = rx_meter;						// restore RX Meter mode
                    SetupForm.Polyphase = polyphase;					// restore polyphase

                    //			Debug.WriteLine("multimeter_cal_offset: "+multimeter_cal_offset);
                    //			Debug.WriteLine("display_cal_offset: "+display_cal_offset);
                    //			MessageBox.Show("multimeter_cal_offset: "+multimeter_cal_offset.ToString()+"\n"+
                    //				"display_cal_offset: "+display_cal_offset.ToString());

                    break;

            }
            calibration_running = false;
            return ret_val;

        }

        public bool CalibrateRX2Level(float level, float freq, Progress progress, bool suppress_errors)
        {
            // Calibration routine called by Setup Form.
            bool ret_val = false;
            calibration_running = true;
            if (!chkPower.Checked)
            {
                if (!suppress_errors)
                {
                    MessageBox.Show("Power must be on in order to calibrate RX2 Level.", "Power Is Off",
                        MessageBoxButtons.OK, MessageBoxIcon.Stop);
                }
                calibration_running = false;
                return false;
            }

            if (!fwc_init || current_model != Model.FLEX5000)
            {
                calibration_running = false;
                return false;
            }

            float[] a = new float[Display.BUFFER_SIZE];

            bool rx1_sr = SpurReduction;
            SpurReduction = true;
            //Thread.Sleep(50);

            bool rx2_sr = RX2SpurReduction;
            RX2SpurReduction = true;
            //Thread.Sleep(50);

            bool rit_on = chkRIT.Checked;						// save current RIT On
            chkRIT.Checked = false;								// turn RIT off
            int rit_val = (int)udRIT.Value;						// save current RIT value

            double vfoa = VFOAFreq;								// save current VFOA

            string display = comboDisplayMode.Text;
            comboDisplayMode.Text = "Spectrum";

            bool polyphase = SetupForm.Polyphase;				// save current polyphase setting
            SetupForm.Polyphase = false;						// disable polyphase

            int dsp_buf_size = SetupForm.DSPPhoneRXBuffer;		// save current DSP buffer size
            SetupForm.DSPPhoneRXBuffer = 4096;					// set DSP Buffer Size to 2048

            Filter filter = RX1Filter;						// save current filter

            DSPMode dsp_mode = rx1_dsp_mode;				// save current DSP demod mode
            DSPMode dsp2_mode = rx2_dsp_mode;				// save current DSP demod mode

            RX1DSPMode = DSPMode.DSB;						// set mode to DSB
            //Thread.Sleep(50);
            RX2DSPMode = DSPMode.DSB;						// set mode to DSB

            VFOAFreq = freq;									// set VFOA frequency
            //Thread.Sleep(100);
            VFOBFreq = freq;
            //Thread.Sleep(100);

            bool duplex = full_duplex;
            FullDuplex = true;
            //Thread.Sleep(50);
            FWC.SetGen(true);
            //Thread.Sleep(50);
            FWC.SetTest(true);
            //Thread.Sleep(50);
            FWC.SetSig(true);
            //Thread.Sleep(50);

            bool rx2 = rx2_enabled;
            RX2Enabled = true;

            FWCAnt rx2_antenna = rx2_ant;
            RX2Ant = FWCAnt.RX1TAP;
            //Thread.Sleep(50);

            Filter rx1_filter = RX1Filter;					// save current AM filter
            UpdateRX1Filters(-500, 500);

            Filter rx2_filter = RX2Filter;
            UpdateRX2Filters(-500, 500);

            bool rx1_preamp = chkRX1Preamp.Checked;					// save current preamp mode
            chkRX1Preamp.Checked = false;							// turn preamp off
            //Thread.Sleep(50);

            bool rx2_preamp = chkRX2Preamp.Checked;					// save current preamp mode
            chkRX2Preamp.Checked = false;							// turn preamp off
            //Thread.Sleep(50);

            MeterRXMode rx_meter = CurrentMeterRXMode;			// save current RX Meter mode
            CurrentMeterRXMode = MeterRXMode.OFF;				// turn RX Meter off

            MeterRXMode rx2_meter = RX2MeterMode;
            RX2MeterMode = MeterRXMode.OFF;

            bool display_avg = chkDisplayAVG.Checked;			// save current average state
            chkDisplayAVG.Checked = false;
            chkDisplayAVG.Checked = true;						// set average state to off

            float old_multimeter_cal = rx2_meter_cal_offset;
            float old_display_cal = rx2_display_cal_offset;

            chkRX1Preamp.Enabled = false;
            chkRX2Preamp.Enabled = false;
            comboDisplayMode.Enabled = false;
            comboMeterRXMode.Enabled = false;
            comboRX2MeterMode.Enabled = false;

            progress.SetPercent(0.0f);
            int counter = 0;

            Thread.Sleep(2000);
            btnZeroBeat_Click(this, EventArgs.Empty);
            RX1Filter = Filter.F6;
            chkDisplayAVG.Checked = false;

            FWC.SetRX2Preamp(false);
            Thread.Sleep(200);

            DisableAllFilters();
            DisableAllModes();
            VFOLock = true;

            calibration_mutex.WaitOne();
            fixed (float* ptr = &a[0])
                DttSP.GetSpectrum(2, ptr);		// get the spectrum values
            calibration_mutex.ReleaseMutex();

            float max = float.MinValue;
            float avg = 0;
            int max_index = 0;

            for (int i = 0; i < 4095; i++)						// find the maximum signal
            {
                avg += a[i];
                if (a[i] > max)
                {
                    max = a[i];
                    max_index = i;
                }
            }
            avg -= max;
            avg /= 4095;

            if (max < (avg + 30))
            {
                if (!suppress_errors)
                {
                    MessageBox.Show("Peak is less than 30dB from the noise floor.  " +
                        "Please use a larger signal for frequency calibration.",
                        "Calibration Error - Weak Signal",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                }
                ret_val = false;
                goto end2;
            }

            rx2_meter_cal_offset = 0.0f;
            RX2DisplayCalOffset = 0.0f;
            float num = 0.0f; float num2 = 0.0f; float avg2 = 0.0f;
            avg = 0.0f;
            // get the value of the signal strength meter
            for (int i = 0; i < 50; i++)
            {
                num += DttSP.CalculateRXMeter(2, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                Thread.Sleep(50);
                if (!progress.Visible)
                    goto end2;
                else progress.SetPercent((float)((float)++counter / 120));
            }
            avg = num / 50.0f;

            FWC.SetRX2Preamp(true);
            Thread.Sleep(200);

            // get the value of the signal strength meter
            num2 = 0.0f;
            for (int i = 0; i < 50; i++)
            {
                num2 += DttSP.CalculateRXMeter(2, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                Thread.Sleep(50);
                if (!progress.Visible)
                    goto end2;
                else progress.SetPercent((float)((float)++counter / 120));
            }
            avg2 = num2 / 50.0f;

            fwc_preamp_offset = avg2 - avg;
            rx2_preamp_offset[(int)PreampMode.OFF] = 0.0f;
            rx2_preamp_offset[(int)PreampMode.HIGH] = -fwc_preamp_offset;

            Debug.WriteLine("fwc_preamp_offset: " + fwc_preamp_offset.ToString("f6"));

            FWC.SetRX2Preamp(false);
            Thread.Sleep(200);

            num2 = 0.0f;
            for (int i = 0; i < 20; i++)
            {
                calibration_mutex.WaitOne();
                fixed (float* ptr = &a[0])
                    DttSP.GetSpectrum(2, ptr);		// read again to clear out changed DSP
                calibration_mutex.ReleaseMutex();

                //max = float.MinValue;						// find the max spectrum value
                //		for(int j=0; j<Display.BUFFER_SIZE; j++)
                //			if(a[j] > max) max = a[j];

                //num2 += max;
                num2 += a[max_index];
                Thread.Sleep(100);

                if (!progress.Visible)
                    goto end2;
                else progress.SetPercent((float)((float)++counter / 120));
            }
            avg2 = num2 / 20.0f;

            // calculate the difference between the current value and the correct multimeter value
            float diff = level - (avg + rx2_meter_cal_offset);
            rx2_meter_cal_offset = diff;

            // calculate the difference between the current value and the correct spectrum value
            diff = level - (avg2 + RX2DisplayCalOffset);
            RX2DisplayCalOffset = diff;

            UpdateDisplayOffsets();

            rx2_level_table[(int)rx2_band][0] = (float)Math.Round(rx2_display_cal_offset, 3);
            rx2_level_table[(int)rx2_band][1] = (float)Math.Round(-fwc_preamp_offset, 3);
            rx2_level_table[(int)rx2_band][2] = (float)Math.Round(rx2_meter_cal_offset, 3);

            ret_val = true;

        end2:
            if (!progress.Visible) progress.Text = "";
            progress.Hide();
            EnableAllFilters();
            EnableAllModes();
            VFOLock = false;

            FullDuplex = duplex;
            //Thread.Sleep(50);
            FWC.SetGen(false);
            //Thread.Sleep(50);
            FWC.SetTest(false);
            //Thread.Sleep(50);
            FWC.SetSig(false);
            //Thread.Sleep(50);

            chkRX1Preamp.Enabled = true;
            chkRX2Preamp.Enabled = true;
            comboDisplayMode.Enabled = true;
            comboMeterRXMode.Enabled = true;
            comboRX2MeterMode.Enabled = true;

            if (ret_val == false)
            {
                rx2_meter_cal_offset = old_multimeter_cal;
                rx2_display_cal_offset = old_display_cal;
            }

            SpurReduction = rx1_sr;
            //Thread.Sleep(50);
            RX2SpurReduction = rx2_sr;
            //Thread.Sleep(50);
            RX2Enabled = rx2;
            RX2Ant = rx2_antenna;
            //Thread.Sleep(50);
            comboDisplayMode.Text = display;
            chkRIT.Checked = rit_on;							// restore RIT on
            udRIT.Value = rit_val;								// restore RIT value
            //SetupForm.RXOnly = rx_only;						// restore RX Only			
            DisplayAVG = display_avg;							// restore AVG value
            chkRX1Preamp.Checked = rx1_preamp;					// restore preamp value
            chkRX2Preamp.Checked = rx2_preamp;
            FWC.SetRX2Preamp(rx2_preamp);
            RX1Filter = rx1_filter;							// restore AM filter
            RX1DSPMode = dsp_mode;							// restore DSP mode*
            //Thread.Sleep(50);
            RX2DSPMode = dsp2_mode;							// restore DSP mode
            RX1Filter = filter;								// restore filter
            if (dsp_buf_size != 4096)
                chkPower.Checked = false;						// go to standby
            SetupForm.DSPPhoneRXBuffer = dsp_buf_size;				// restore DSP Buffer Size
            VFOAFreq = vfoa;									// restore vfo frequency
            //Thread.Sleep(100);
            if (dsp_buf_size != 4096)
            {
                Thread.Sleep(100);
                chkPower.Checked = true;
            }
            CurrentMeterRXMode = rx_meter;						// restore RX Meter mode
            RX2MeterMode = rx2_meter;
            SetupForm.Polyphase = polyphase;					// restore polyphase

            //			Debug.WriteLine("rx1_meter_cal_offset: "+rx1_meter_cal_offset);
            //			Debug.WriteLine("display_cal_offset: "+display_cal_offset);
            //			MessageBox.Show("rx1_meter_cal_offset: "+rx1_meter_cal_offset.ToString()+"\n"+
            //				"display_cal_offset: "+display_cal_offset.ToString());

            calibration_running = false;
            return ret_val;
        }

        public float[] rx_image_rejection = new float[(int)Band.LAST];
        public float[] rx_image_from_floor = new float[(int)Band.LAST];
        public bool CalibrateRXImage(float freq, Progress progress, bool suppress_errors)
        {
            HiPerfTimer t1 = new HiPerfTimer();
            t1.Start();
            HiPerfTimer t2 = new HiPerfTimer();

            // Setup Rig for Image Null Cal
            bool ret_val = false;
            calibration_running = true;

            if (!chkPower.Checked)
            {
                if (!suppress_errors)
                {
                    MessageBox.Show("Power must be on in order to calibrate RX Image.", "Power Is Off",
                        MessageBoxButtons.OK, MessageBoxIcon.Stop);
                }
                calibration_running = false;
                progress.Text = "";
                return false;
            }

            //  bool spur_red = chkSR.Checked;					// save current spur reduction setting
            // chkSR.Checked = false;							// turn spur reduction off

            //bool rx_only = SetupForm.RXOnly;				// save RX Only Setting
            //SetupForm.RXOnly = true;

            bool split = chkVFOSplit.Checked;
            chkVFOSplit.Checked = false;

            bool polyphase = SetupForm.Polyphase;			// save current polyphase setting
            SetupForm.Polyphase = false;					// disable polyphase

            int dsp_buf_size = SetupForm.DSPPhoneRXBuffer;		// save current DSP buffer size
            SetupForm.DSPPhoneRXBuffer = 4096;					// set DSP Buffer Size to 4096

            string display_mode = comboDisplayMode.Text;
            comboDisplayMode.Text = "Spectrum";

            bool avg = chkDisplayAVG.Checked;		// save current average state
            chkDisplayAVG.Checked = true;

            DSPMode dsp_mode = rx1_dsp_mode;			// save current dsp mode
            RX1DSPMode = DSPMode.DSB;					// set dsp mode to DSB

            int filt_low = RX1FilterLow;
            int filt_high = RX1FilterHigh;
            Filter filter = rx1_filter;					// save current filter
            RX1Filter = Filter.F1;						// set filter to 6kHz

            DttSP.SetCorrectIQEnable(0); // turn off I/Q correction
            DttSP.SetCorrectRXIQw(0, 0, 0.0f, 0.0f, 0);
            DttSP.SetCorrectRXIQw(0, 0, 0.0f, 0.0f, 1);

            PreampMode preamp = rx1_preamp_mode;		// save current preamp setting
            switch (current_model)
            {
                case Model.SDR1000:
                case Model.FLEX5000:
                    RX1PreampMode = PreampMode.HIGH;			// set preamp to high
                    break;
                case Model.FLEX3000:
                    if (FWCEEPROM.TRXRev >> 8 < 6) // before rev G
                    {
                        if (BandByFreq(freq, -1, true, current_region) == Band.B160M)
                            RX1PreampMode = PreampMode.LOW;
                        else RX1PreampMode = PreampMode.HIGH;
                    }
                    else // rev G+
                    {
                        switch (BandByFreq(freq, -1, true, current_region))
                        {
                            case Band.B160M:
                            case Band.B80M:
                            case Band.B60M:
                                RX1PreampMode = PreampMode.LOW;
                                break;
                            default:
                                RX1PreampMode = PreampMode.HIGH;
                                break;
                        }
                    }
                    break;
            }

            bool duplex = full_duplex;
            FullDuplex = true;

            bool rx2 = chkRX2.Checked;
            if (fwc_init && current_model == Model.FLEX5000 && FWCEEPROM.RX2OK)
                chkRX2.Checked = false;

            if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
            {
                VFOBFreq = freq;
                //Thread.Sleep(50);
                FWC.SetTest(true);
                //Thread.Sleep(50);
                FWC.SetGen(true);
                //Thread.Sleep(50);
                FWC.SetSig(true);
                //Thread.Sleep(50);
                FWC.SetQSE(false);
                //Thread.Sleep(50);
            }

            double vfo_freq = VFOAFreq;						// save current frequency
            VFOAFreq = freq + 2 * (float)if_freq;				// set frequency to passed value + 2*IF

            DisableAllFilters();
            DisableAllModes();
            VFOLock = true;
            comboPreamp.Enabled = false;
            comboDisplayMode.Enabled = false;

            //int retval = 0;
            progress.SetPercent(0.0f);

            float[] a = new float[Display.BUFFER_SIZE];
            float[] init_max = new float[4];

            Thread.Sleep(200);
            float sum = 0.0f;
            int peak_bin = -1;
            float max_signal = float.MinValue;

            for (int i = 0; i < 5; i++)
            {
                calibration_mutex.WaitOne();
                fixed (float* ptr = &a[0])
                    DttSP.GetSpectrum(0, ptr);// get the spectrum values
                calibration_mutex.ReleaseMutex();
                Thread.Sleep(50);
            }

            for (int i = 0; i < 5; i++)
            {
                calibration_mutex.WaitOne();
                fixed (float* ptr = &a[0])
                    DttSP.GetSpectrum(0, ptr);// get the spectrum values
                calibration_mutex.ReleaseMutex();

                for (int j = 0; i == 4 && j < Display.BUFFER_SIZE; j++)
                {
                    if (a[j] > max_signal)
                    {
                        max_signal = a[j];
                        peak_bin = j;
                    }
                }

                for (int j = 1948; j < 2148; j++) // TODO: Fix limits for 48/96kHz
                {
                    if (j < 2040 || j > 2055)
                        sum += a[j];
                }
                Thread.Sleep(50);
            }

            float noise_floor = (sum / 925.0f);
            float worst_image = max_signal;
            Debug.WriteLine("noise_floor: " + (noise_floor + Display.RX1DisplayCalOffset + Display.RX1PreampOffset).ToString("f6") + " peak_bin: " + peak_bin);

            if (max_signal < noise_floor + 25.0)
            {
                if (!suppress_errors)
                {
                    MessageBox.Show("Image not found (max signal < noise floor + 30dB).  Please try again.\n" +
                        DateTime.Now.ToShortTimeString(),
                        "Image Not Found",
                        MessageBoxButtons.OK, MessageBoxIcon.Stop);
                }
                calibration_running = false;
                DttSP.SetCorrectIQEnable(1); // turn on I/Q correction
                //progress.Text = "";
                goto end;
            }

            calibrating = true;
            DttSP.SetCorrectIQEnable(1); // turn on I/Q correction

            int count = 0;
            for (int i = 0; i < 15; i++)
            {
                if (i < 9) DttSP.SetCorrectIQMu(0, 0, 0.1 - i * 0.01);
                if (!progress.Visible) goto end;
                progress.SetPercent(count++ / 15.0f);
                Thread.Sleep(100);
            }

            // Finish the algorithm and reset the values
            ret_val = true;
        end:

            if (!progress.Visible) progress.Text = "";
            else
            {
                float real, imag;
                DttSP.SetCorrectIQMu(0, 0, 0);
                DttSP.GetCorrectRXIQw(0, 0, &real, &imag, 1);
                DttSP.SetCorrectRXIQw(0, 0, real, imag, 0);
                DttSP.SetCorrectRXIQw(0, 0, 0.0f, 0.0f, 1);
                Debug.WriteLine("RX Image Real: " + real.ToString("f6") + "  Imag: " + imag.ToString("f6"));
                rx1_image_gain_table[(int)rx1_band] = real;
                rx1_image_phase_table[(int)rx1_band] = imag;
            }
            progress.Hide();
            calibration_running = false;
            wbir_tuned = true;
            calibrating = false;

            rx_image_rejection[(int)rx1_band] = (float)(-24.0 - (noise_floor + Display.RX1DisplayCalOffset + Display.RX1PreampOffset));
            rx_image_from_floor[(int)rx1_band] = 0.0f;

            if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
            {
                VFOBFreq = vfo_freq;
                //Thread.Sleep(50);
                FWC.SetTest(false);
                //Thread.Sleep(50);
                FWC.SetGen(false);
                //Thread.Sleep(50);
                FWC.SetSig(false);
                //Thread.Sleep(50);
            }

            EnableAllFilters();
            EnableAllModes();
            VFOLock = false;
            FullDuplex = duplex;
            comboPreamp.Enabled = true;
            comboDisplayMode.Enabled = true;

            chkVFOSplit.Checked = split;
            // chkSR.Checked = spur_red;							// restore spur reduction setting
            RX1PreampMode = preamp;							// restore preamp mode
            comboDisplayMode.Text = display_mode;				// restore display mode
            //SetupForm.RXOnly = rx_only;						// restore RX Only setting
            RX1DSPMode = dsp_mode;							// restore dsp mode
            RX1Filter = filter;								// restore filter
            if (filter == Filter.VAR1 || filter == Filter.VAR2)
                UpdateRX1Filters(filt_low, filt_high);

            VFOAFreq = vfo_freq;								// restore frequency
            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            chkDisplayAVG.Checked = avg;						// restore average state
            SetupForm.DSPPhoneRXBuffer = dsp_buf_size;				// restore DSP Buffer Size
            SetupForm.Polyphase = polyphase;					// restore polyphase

            if (fwc_init && current_model == Model.FLEX5000 && FWCEEPROM.RX2OK)
                chkRX2.Checked = rx2;

            t1.Stop();
            //MessageBox.Show(t1.Duration.ToString());
            Debug.WriteLine("timer: " + t1.Duration);
            return ret_val;
        }

        public bool CalibrateRX2Image(float freq, Progress progress, bool suppress_errors)
        {
            if (!fwc_init || current_model != Model.FLEX5000 || !FWCEEPROM.RX2OK) return false;

            HiPerfTimer t1 = new HiPerfTimer();
            t1.Start();
            HiPerfTimer t2 = new HiPerfTimer();

            //float global_min_value = float.MaxValue;

            // Setup Rig for Image Null Cal
            bool ret_val = false;
            calibration_running = true;

            if (!chkPower.Checked)
            {
                if (!suppress_errors)
                {
                    MessageBox.Show("Power must be on in order to calibrate RX Image.", "Power Is Off",
                        MessageBoxButtons.OK, MessageBoxIcon.Stop);
                }
                calibration_running = false;
                progress.Text = "";
                return false;
            }

            double vfoa = VFOAFreq;
            double vfob = VFOBFreq;

            DttSP.SetCorrectIQEnable(0);					// turn off I/Q correction
            DttSP.SetCorrectRXIQw(2, 0, 0.0f, 0.0f, 0);
            DttSP.SetCorrectRXIQw(2, 0, 0.0f, 0.0f, 1);

            // bool spur_red = chkSR.Checked;					// save current spur reduction setting
            //  chkSR.Checked = false;							// turn spur reduction off
            //Thread.Sleep(50);

            bool rx2_sr = chkRX2SR.Checked;
            chkRX2SR.Checked = false;
            //Thread.Sleep(50);

            //bool rx_only = SetupForm.RXOnly;				// save RX Only Setting
            //SetupForm.RXOnly = true;

            bool split = chkVFOSplit.Checked;
            chkVFOSplit.Checked = false;

            bool polyphase = SetupForm.Polyphase;			// save current polyphase setting
            SetupForm.Polyphase = false;					// disable polyphase

            int dsp_buf_size = SetupForm.DSPPhoneRXBuffer;	// save current DSP buffer size
            SetupForm.DSPPhoneRXBuffer = 4096;				// set DSP Buffer Size to 4096

            bool rx2 = rx2_enabled;
            RX2Enabled = true;

            string display_mode = comboDisplayMode.Text;
            comboDisplayMode.Text = "Spectrum";

            bool avg = chkDisplayAVG.Checked;				// save current average state
            chkDisplayAVG.Checked = true;

            DSPMode dsp_mode = rx1_dsp_mode;				// save current dsp mode
            DSPMode dsp2_mode = rx2_dsp_mode;				// save current dsp mode

            RX1DSPMode = DSPMode.DSB;						// set dsp mode to DSB
            //Thread.Sleep(50);
            RX2DSPMode = DSPMode.DSB;						// set dsp mode to DSB

            int filt1_low = RX1FilterLow;
            int filt1_high = RX1FilterHigh;
            Filter filter1 = rx1_filter;					// save current filter

            int filt2_low = RX1FilterLow;
            int filt2_high = RX1FilterHigh;
            Filter filter2 = rx1_filter;					// save current filter

            PreampMode preamp = rx1_preamp_mode;			// save current preamp setting
            RX1PreampMode = PreampMode.HIGH;				// set preamp to high
            //bool preamp = fwc_rx2_preamp;
            FWC.SetRX2Preamp(true);
            //Thread.Sleep(50);

            bool duplex = full_duplex;
            FullDuplex = true;

            VFOAFreq = freq;
            //Thread.Sleep(50);
            FWC.SetTest(true);
            //Thread.Sleep(50);
            FWC.SetGen(true);
            //Thread.Sleep(50);
            FWC.SetSig(true);
            //Thread.Sleep(50);
            FWC.SetQSE(false);
            //Thread.Sleep(50);

            VFOBFreq = freq + 2 * (float)if_freq;				// set frequency to passed value + 2*IF
            //Thread.Sleep(100);

            UpdateRX1Filters(-5000, 5000);
            UpdateRX2Filters(-5000, 5000);

            FWCAnt rx2_antenna = RX2Ant;
            RX2Ant = FWCAnt.RX1TAP;
            //Thread.Sleep(50);

            DisableAllFilters();
            DisableAllModes();
            VFOLock = true;
            comboPreamp.Enabled = false;
            comboDisplayMode.Enabled = false;

            //int retval = 0;
            progress.SetPercent(0.0f);

            float[] a = new float[Display.BUFFER_SIZE];

            Thread.Sleep(200);
            float sum = 0.0f;
            int peak_bin = -1;
            float max_signal = float.MinValue;

            for (int i = 0; i < 5; i++)
            {
                calibration_mutex.WaitOne();
                fixed (float* ptr = &a[0])
                    DttSP.GetSpectrum(2, ptr);				// get the spectrum values
                calibration_mutex.ReleaseMutex();
                Thread.Sleep(50);
            }

            for (int i = 0; i < 5; i++)
            {
                calibration_mutex.WaitOne();
                fixed (float* ptr = &a[0])
                    DttSP.GetSpectrum(2, ptr);				// get the spectrum values
                calibration_mutex.ReleaseMutex();

                for (int j = 0; i == 4 && j < Display.BUFFER_SIZE; j++)
                {
                    if (a[j] > max_signal)
                    {
                        max_signal = a[j];
                        peak_bin = j;
                    }
                }
                max_signal = a[2048];
                peak_bin = 2048;

                for (int j = 1948; j < 2148; j++) // TODO: Fix limits for 48/96kHz
                {
                    if (j < 2040 || j > 2055)
                        sum += a[j];
                }
                Thread.Sleep(50);
            }

            float noise_floor = (sum / 925.0f);
            float worst_image = max_signal;
            Debug.WriteLine("noise_floor: " + noise_floor.ToString("f6") + " peak_bin: " + peak_bin);

            if (max_signal < noise_floor + 30.0)
            {
                if (!suppress_errors)
                {
                    MessageBox.Show("Image not found (max signal < noise floor + 30dB).  Please try again.\n" +
                        DateTime.Now.ToShortTimeString(),
                        "Image Not Found",
                        MessageBoxButtons.OK, MessageBoxIcon.Stop);
                }
                calibration_running = false;
                DttSP.SetCorrectIQEnable(1); // turn on I/Q correction
                //progress.Text = "";
                goto end;
            }

            calibrating = true;
            DttSP.SetCorrectIQEnable(1); // turn on I/Q correction

            int count = 0;
            for (int i = 0; i < 15; i++)
            {
                if (i < 9) DttSP.SetCorrectIQMu(2, 0, 0.1 - i * 0.01);
                if (!progress.Visible) goto end;
                progress.SetPercent(count++ / 15.0f);
                Thread.Sleep(100);
            }

            // Finish the algorithm and reset the values
            ret_val = true;
        end:
            if (!progress.Visible) progress.Text = "";
            else
            {
                float real, imag;
                DttSP.SetCorrectIQMu(2, 0, 0);
                DttSP.GetCorrectRXIQw(2, 0, &real, &imag, 1);
                DttSP.SetCorrectRXIQw(2, 0, real, imag, 0);
                DttSP.SetCorrectRXIQw(2, 0, 0.0f, 0.0f, 1);
                rx2_image_gain_table[(int)rx2_band] = real;
                rx2_image_phase_table[(int)rx2_band] = imag;
            }
            progress.Hide();
            calibration_running = false;
            wbir_tuned = true;
            calibrating = false;

            rx_image_rejection[(int)rx2_band] = (float)(-24.0 - (noise_floor + Display.RX2DisplayCalOffset + Display.RX2PreampOffset));
            rx_image_from_floor[(int)rx2_band] = 0.0f;

            FWC.SetTest(false);
            //Thread.Sleep(50);
            FWC.SetGen(false);
            //Thread.Sleep(50);
            FWC.SetSig(false);
            //Thread.Sleep(50);

            EnableAllFilters();
            EnableAllModes();
            VFOLock = false;
            FullDuplex = duplex;
            //FWC.SetRX2Preamp(preamp);
            //Thread.Sleep(50);
            comboDisplayMode.Enabled = true;

            chkVFOSplit.Checked = split;
            // chkSR.Checked = spur_red;							// restore spur reduction setting
            //Thread.Sleep(50);
            //  chkRX2SR.Checked = rx2_sr;
            //Thread.Sleep(50);
            //RX1PreampMode = preamp;							// restore preamp mode
            comboDisplayMode.Text = display_mode;				// restore display mode
            //SetupForm.RXOnly = rx_only;						// restore RX Only setting
            RX1DSPMode = dsp_mode;								// restore dsp mode
            //Thread.Sleep(50);
            RX2DSPMode = dsp2_mode;								// restore dsp mode
            RX1Filter = filter1;								// restore filter
            if (filter1 == Filter.VAR1 || filter1 == Filter.VAR2)
                UpdateRX1Filters(filt1_low, filt1_high);
            RX2Filter = filter2;
            if (filter2 == Filter.VAR1 || filter2 == Filter.VAR2)
                UpdateRX2Filters(filt2_low, filt2_high);

            VFOAFreq = vfoa;									// restore frequency
            //Thread.Sleep(100);
            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            //Thread.Sleep(100);
            VFOBFreq = vfob;
            //Thread.Sleep(100);
            RX2Enabled = rx2;
            RX2Ant = rx2_antenna;
            //Thread.Sleep(50);
            chkDisplayAVG.Checked = avg;						// restore average state
            SetupForm.DSPPhoneRXBuffer = dsp_buf_size;			// restore DSP Buffer Size
            SetupForm.Polyphase = polyphase;					// restore polyphase

            t1.Stop();
            //MessageBox.Show(t1.Duration.ToString());
            Debug.WriteLine("timer: " + t1.Duration);
            return ret_val;
        }

        public float[] tx_image_rejection = new float[(int)Band.LAST];
        public bool CalibrateTXImage(float freq, Progress progress, bool suppress_errors)
        {
            if (!fwc_init || (current_model != Model.FLEX5000 && current_model != Model.FLEX3000))
            {
                progress.Text = "";
                progress.Hide();
                return false;
            }

            if (!chkPower.Checked)
            {
                if (!suppress_errors)
                {
                    MessageBox.Show("Power must be on in order to calibrate TX Image.", "Power Is Off",
                        MessageBoxButtons.OK, MessageBoxIcon.Stop);
                }
                calibration_running = false;
                progress.Text = "";
                tx_image_rejection[(int)tx_band] = 0.0f;
                return false;
            }

            calibrating = true;

            float tol = 10.0f;
            float phase_step = 2;
            float gain_step = 2;
            float global_min_phase = 0;
            float global_min_gain = 0;
            float gain_index = 0.0f, phase_index = 0.0f;
            float global_min_value = float.MaxValue;
            bool progressing = true;
            int gain_dir = -1;
            int phase_dir = 1;
            int gain_count = 1, phase_count = 1;
            int wrong_direction_count;
            int switch_direction_count;
            string index_string;
            string val_string;
            string gain_string = "";
            string phase_string = "";
            float fundamental = -200.0f;

            switch (current_model)
            {
                case Model.FLEX3000:
                    phase_step = 4;
                    gain_step = 4;
                    break;
            }

            HiPerfTimer t1 = new HiPerfTimer();
            t1.Start();
            HiPerfTimer t2 = new HiPerfTimer();

            // Setup Rig for TX Image Null Cal
            bool ret_val = false;
            calibration_running = true;

            //int retval = 0;
            progress.SetPercent(0.0f);

            // bool spur_red = chkSR.Checked;					// save current spur reduction setting
            // chkSR.Checked = false;							// turn spur reduction off

            bool polyphase = SetupForm.Polyphase;			// save current polyphase setting
            SetupForm.Polyphase = false;					// disable polyphase

            int dsp_buf_size = SetupForm.DSPPhoneRXBuffer;		// save current DSP buffer size
            SetupForm.DSPPhoneRXBuffer = 4096;					// set DSP Buffer Size to 4096

            DSPMode dsp_mode = rx1_dsp_mode;			// save current dsp mode
            RX1DSPMode = DSPMode.USB;					// set dsp mode to USB

            // Setting filters for TX calibration (optmized for SSB) and we need to fix the VAR filter setting
            // consequence of this action

            string display_mode = comboDisplayMode.Text;
            comboDisplayMode.Text = "Spectrum";

            bool avg = chkDisplayAVG.Checked;				// save current average state
            chkDisplayAVG.Checked = true;

            Filter filter = rx1_filter;					// save current filter
            UpdateRX1Filters(300, 3000);						// set filter to -3k, -300 ... LSB for image

            int tx_filt_low = SetupForm.TXFilterLow;		// save tx filter low cut
            SetupForm.TXFilterLow = 300;					// set low cut to 300Hz

            int tx_filt_high = SetupForm.TXFilterHigh;		// save tx filter high cut
            SetupForm.TXFilterHigh = 3000;					// set high cut to 3kHz

            PreampMode preamp = rx1_preamp_mode;		// save current preamp setting
            switch (current_model)
            {
                case Model.FLEX5000:
                    RX1PreampMode = PreampMode.HIGH;			// set preamp to high
                    break;
                case Model.FLEX3000:
                    if (BandByFreq(freq, -1, true, current_region) == Band.B160M)
                        RX1PreampMode = PreampMode.LOW;
                    else RX1PreampMode = PreampMode.HIGH;
                    break;
            }


            bool duplex = full_duplex;
            FullDuplex = true;

            double vfo_freq = VFOAFreq;						// save current frequency
            VFOAFreq = freq;								// set frequency to passed value
            VFOBFreq = freq;

            Audio.TXInputSignal = Audio.SignalSource.SINE;
            double last_scale = Audio.SourceScale;			// saved audio scale
            Audio.SourceScale = 1.0;
            double tone_freq = Audio.SineFreq1;				// save tone freq
            Audio.SineFreq1 = 1500.0;						// set freq

            int pwr = ptbPWR.Value;
            ptbPWR.Value = 100;
            Audio.RadioVolume = 0.500; // changed from 0.200 4/8/09

            FWC.SetQSD(true);
            //Thread.Sleep(50);
            FWC.SetQSE(true);
            //Thread.Sleep(50);
            FWC.SetTR(true);
            //Thread.Sleep(50);
            FWC.SetSig(true);
            //Thread.Sleep(50);
            FWC.SetGen(false);
            //Thread.Sleep(50);
            FWC.SetTest(true);
            //Thread.Sleep(50);
            FWC.SetTXMon(false);
            //Thread.Sleep(50);
            FWC.SetPDrvMon(true);
            //Thread.Sleep(50);

            DisableAllFilters();
            DisableAllModes();
            VFOLock = true;
            comboPreamp.Enabled = false;
            comboDisplayMode.Enabled = false;

            SetupForm.ImageGainTX = -200.0f;
            SetupForm.ImagePhaseTX = -200.0f;

            float[] a = new float[Display.BUFFER_SIZE];
            for (int i = 0; i < 5; i++)
            {
                calibration_mutex.WaitOne();
                fixed (float* ptr = &a[0])
                    DttSP.GetSpectrum(0, ptr);// get the spectrum values
                calibration_mutex.ReleaseMutex();
                Thread.Sleep(50);
            }

            float max_signal = float.MinValue;
            int peak_bin = 2048 + (int)(1500.0 / sample_rate1 * 4096.0);

            Thread.Sleep(100);
            for (int i = 0; i < 20; i++)
            {
                calibration_mutex.WaitOne();
                fixed (float* ptr = &a[0])
                    DttSP.GetSpectrum(0, ptr);// get the spectrum values
                calibration_mutex.ReleaseMutex();
                for (int j = 0; i == 19 && j < Display.BUFFER_SIZE; j++)
                {
                    if (a[j] > max_signal)
                    {
                        max_signal = a[j];
                        peak_bin = j;
                    }
                }
                Thread.Sleep(100);
            }
            fundamental = max_signal;
            UpdateRX1Filters(-3000, -300);
            Thread.Sleep(100);

            peak_bin = 2048 + (int)(-1500.0 / sample_rate1 * 4096.0);
            max_signal = float.MinValue;
            float sum = 0.0f;
            int filt_low_bin = 2048 + (int)(-3000.0 / sample_rate1 * 4096.0);
            int filt_high_bin = 2048 + (int)(-300.0 / sample_rate1 * 4096.0);
            for (int i = 0; i < 20; i++)
            {
                calibration_mutex.WaitOne();
                fixed (float* ptr = &a[0])
                    DttSP.GetSpectrum(0, ptr);// get the spectrum values
                calibration_mutex.ReleaseMutex();
                for (int j = 0; i == 19 && j < Display.BUFFER_SIZE; j++)
                {
                    if (a[j] > max_signal)
                    {
                        max_signal = a[j];
                        peak_bin = j;
                    }
                }
                for (int j = filt_low_bin; j < filt_high_bin; j++)
                {
                    if (j < peak_bin - 8 || j > peak_bin + 8)
                        sum += a[j];
                }
                Thread.Sleep(100);
            }
            float noise_floor = (sum / (float)(((filt_high_bin - filt_low_bin) - 17) * 20));
            Debug.WriteLine("noise_floor: " + noise_floor.ToString("f6") + " peak_bin:" + peak_bin);
            //MessageBox.Show("Noise Floor: "+(noise_floor + Display.DisplayCalOffset + Display.PreampOffset).ToString("f1"));

            if (max_signal < noise_floor + 30.0)
            {
                if (!suppress_errors)
                {
                    MessageBox.Show("Image not found (max signal < noise floor + 30dB).  Please try again.\n" +
                        DateTime.Now.ToShortTimeString(),
                        "Image Not Found",
                        MessageBoxButtons.OK, MessageBoxIcon.Stop);
                }
                calibration_running = false;
                //progress.Text = "";
                goto end;
            }

            SetupForm.ImagePhaseTX = 0.0f;
            SetupForm.ImageGainTX = 0.0f;


            while (progressing)
            {
                // find minimum of the peak signal over 
                // the range of Gain settings

                float start = 0.0f;
                float min_signal = float.MaxValue;
                max_signal = float.MinValue;
                wrong_direction_count = switch_direction_count = 0;
                bool first_time = true;

                Debug.WriteLine("gain_dir:" + gain_dir + " gain_step: " + gain_step.ToString("f3"));
                t2.Start();
                index_string = "";
                val_string = "";
                gain_string += (gain_count + "," + gain_dir + "," + gain_step.ToString("f6") + "\n");
                for (float i = global_min_gain; i >= -500.0 && i <= 500.0; i += (gain_step * gain_dir))
                {
                    SetupForm.ImageGainTX = i;				//set gain slider
                    Thread.Sleep(200);

                    int num_avg = gain_count;
                    //if(gain_step <= 0.01) num_avg = 4;
                    sum = 0.0f;
                    for (int j = 0; j < num_avg; j++)
                    {
                        calibration_mutex.WaitOne();
                        fixed (float* ptr = &a[0])
                            DttSP.GetSpectrum(0, ptr);// get the spectrum values
                        sum += a[peak_bin];
                        calibration_mutex.ReleaseMutex();
                        if (j < num_avg - 1) Thread.Sleep(50);
                    }
                    sum /= num_avg;
                    a[peak_bin] = sum;

                    index_string += i.ToString("f4") + ",";
                    val_string += a[peak_bin].ToString("f4") + ",";

                    if (a[peak_bin] < min_signal)			// if image is less than minimum
                    {
                        min_signal = a[peak_bin];
                        gain_index = i;
                        if (min_signal < global_min_value)
                        {
                            global_min_value = min_signal;
                            global_min_gain = gain_index;
                        }
                    }

                    // cal complete condition
                    if (min_signal < noise_floor + 12.0f)
                    {
                        progressing = false;
                        break;
                    }

                    if (first_time)
                    {
                        first_time = false;
                        start = a[peak_bin];
                        max_signal = a[peak_bin];
                    }
                    else
                    {
                        if (a[peak_bin] > max_signal && a[peak_bin] > start + 1.0)
                        {
                            max_signal = a[peak_bin];
                            wrong_direction_count++; Debug.Write("W");
                            if (wrong_direction_count > 1)
                            {
                                wrong_direction_count = 0;
                                if (++switch_direction_count > 1)
                                {
                                    // handle switched direction twice
                                    if (gain_step >= 0.1) gain_step /= 2.0f;
                                    else gain_step /= 2.0f;
                                    gain_dir *= -1;
                                    Debug.WriteLine("gain exit dir - gain_step:" + gain_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                    break;
                                }

                                min_signal = start;
                                max_signal = start;
                                gain_dir *= -1;
                                i = global_min_gain;
                            }
                        }
                        else
                        {
                            if (min_signal > noise_floor + 20.0) tol = 3.0f;
                            else tol = 3.0f;
                            if (a[peak_bin] > min_signal + tol)
                            {
                                if (gain_step > 0.1) gain_step /= 2.0f;
                                else gain_step /= 2.0f;
                                gain_dir *= -1;
                                Debug.WriteLine("exit gain thresh - gain_step:" + gain_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                break;
                            }
                        }
                    }

                    if (!progress.Visible) goto end;
                    else
                    {
                        t1.Stop();
                        if (t1.Duration > 90.0)
                        {
                            /*MessageBox.Show("TX Image Reject Calibration Failed.  Values have been returned to previous settings.\n"+
                                DateTime.Now.ToShortTimeString(),
                                "TX Image Failed",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);*/
                            goto end;
                        }
                        else progress.SetPercent((float)(t1.Duration / 90.0));
                    }
                }

                t2.Stop();
                Debug.WriteLine("t2 gain(" + gain_count++ + "): " + t2.Duration);
                if (gain_count < 10)
                {
                    gain_string += (index_string + "\n");
                    gain_string += (val_string + "\n\n");
                }

                SetupForm.ImageGainTX = global_min_gain;			//set gain slider to min found

                if (!progressing) break;

                // find minimum of the peak signal over 
                // the range of Phase settings
                min_signal = float.MaxValue;
                max_signal = float.MinValue;
                wrong_direction_count = switch_direction_count = 0;
                first_time = true;

                t2.Start();
                index_string = "";
                val_string = "";
                phase_string += (phase_count + "," + phase_dir + "," + phase_step.ToString("f3") + "\n");
                for (float i = global_min_phase; i >= -400.0 && i <= 400.0; i += (phase_step * phase_dir))
                {
                    SetupForm.ImagePhaseTX = i;				// phase slider
                    Thread.Sleep(200);

                    sum = 0.0f;
                    int num_avg = phase_count;
                    //if(phase_step <= 0.01) num_avg = 4;
                    for (int j = 0; j < num_avg; j++)
                    {
                        calibration_mutex.WaitOne();
                        fixed (float* ptr = &a[0])
                            DttSP.GetSpectrum(0, ptr);// get the spectrum values
                        sum += a[peak_bin];
                        calibration_mutex.ReleaseMutex();
                        if (j < num_avg - 1) Thread.Sleep(50);
                    }
                    sum /= num_avg;
                    a[peak_bin] = sum;

                    index_string += i.ToString("f4") + ",";
                    val_string += a[peak_bin].ToString("f4") + ",";

                    if (a[peak_bin] < min_signal)			// if image is less than minimum
                    {
                        min_signal = a[peak_bin];
                        phase_index = i;
                        if (min_signal < global_min_value)
                        {
                            global_min_value = min_signal;
                            global_min_phase = phase_index;
                        }
                    }

                    // cal complete condition
                    if (min_signal < noise_floor + 12.0f)
                    {
                        progressing = false;
                        break;
                    }

                    if (first_time)
                    {
                        first_time = false;
                        start = a[peak_bin];
                        max_signal = a[peak_bin];
                    }
                    else
                    {
                        if (a[peak_bin] > max_signal && a[peak_bin] > start + 1.0)
                        {
                            max_signal = a[peak_bin];
                            wrong_direction_count++; Debug.Write("W");
                            if (wrong_direction_count > 1)
                            {
                                wrong_direction_count = 0;
                                if (++switch_direction_count > 1)
                                {
                                    // handle switched direction twice
                                    if (phase_step >= 0.1) phase_step /= 2.0f;
                                    else phase_step /= 2.0f;
                                    phase_dir *= -1;
                                    Debug.WriteLine("phase exit dir - phase_step:" + phase_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                    break;
                                }

                                min_signal = start;
                                max_signal = start;
                                phase_dir *= -1;
                                i = global_min_phase;
                            }
                        }
                        else
                        {
                            if (min_signal > noise_floor + 20.0) tol = 3.0f;
                            else tol = 3.0f;
                            if (a[peak_bin] > min_signal + tol)
                            {
                                if (phase_step >= 0.1) phase_step /= 2.0f;
                                else phase_step /= 2.0f;
                                phase_dir *= -1;
                                Debug.WriteLine("phase exit thresh - phase_step:" + phase_step.ToString("f4") + "  distance:" + (global_min_value - noise_floor).ToString("f1"));
                                break;
                            }
                        }
                    }

                    if (!progress.Visible) goto end;
                    else
                    {
                        t1.Stop();
                        if (t1.Duration > 90.0)
                        {
                            /*MessageBox.Show("TX Image Reject Calibration Failed.  Values have been returned to previous settings.\n"+
                                DateTime.Now.ToShortTimeString(),
                                "TX Image Failed",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);*/
                            goto end;
                        }
                        else progress.SetPercent((float)(t1.Duration / 90.0));
                    }
                }

                t2.Stop();
                Debug.WriteLine("t2 phase(" + phase_count++ + "): " + t2.Duration);

                SetupForm.ImagePhaseTX = global_min_phase;			//set phase slider to min found

                if (!progressing) break;
            }

            // Finish the algorithm and reset the values
            ret_val = true;
        end:
            if (!progress.Visible) progress.Text = "";
            else
            {
                tx_image_gain_table[(int)tx_band] = SetupForm.ImageGainTX;
                tx_image_phase_table[(int)tx_band] = SetupForm.ImagePhaseTX;
            }
            progress.Hide();
            calibration_running = false;

            tx_image_rejection[(int)tx_band] = global_min_value - fundamental;

            Audio.TXInputSignal = Audio.SignalSource.RADIO;
            Audio.SourceScale = last_scale;						// recall tone scale
            Audio.SineFreq1 = tone_freq;						// recall tone freq
            ptbPWR.Value = pwr;

            FullDuplex = duplex;
            //Thread.Sleep(50);
            FWC.SetQSD(true);
            //Thread.Sleep(50);
            FWC.SetQSE(false);
            //Thread.Sleep(50);
            FWC.SetTR(false);
            //Thread.Sleep(50);
            FWC.SetSig(false);
            //Thread.Sleep(50);
            FWC.SetGen(false);
            //Thread.Sleep(50);
            FWC.SetTest(false);
            //Thread.Sleep(50);
            FWC.SetTXMon(false);
            //Thread.Sleep(50);
            FWC.SetPDrvMon(false);
            //Thread.Sleep(50);

            if (current_model == Model.FLEX3000)
                FWC.SetFan(false);

            EnableAllFilters();
            EnableAllModes();
            VFOLock = false;
            comboPreamp.Enabled = true;
            comboDisplayMode.Enabled = true;

            SetupForm.TXFilterHigh = tx_filt_high;				// restore TX filter settings
            SetupForm.TXFilterLow = tx_filt_low;
            //  chkSR.Checked = spur_red;							// restore spur reduction setting
            RX1PreampMode = preamp;							// restore preamp mode
            comboDisplayMode.Text = display_mode;				// restore display mode
            //SetupForm.RXOnly = rx_only;							// restore RX Only setting
            RX1DSPMode = dsp_mode;							// restore dsp mode
            RX1Filter = filter;								// restore filter
            VFOAFreq = vfo_freq;								// restore frequency
            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            chkDisplayAVG.Checked = avg;						// restore average state
            SetupForm.DSPPhoneRXBuffer = dsp_buf_size;				// restore DSP Buffer Size
            SetupForm.Polyphase = polyphase;					// restore polyphase

            t1.Stop();
            //MessageBox.Show(t1.Duration.ToString());
            Debug.WriteLine("timer: " + t1.Duration);

            return ret_val;
        }



        public bool CalibratePAGain(Progress progress, bool[] run, int target_watts) // calibrate PA Gain values
        {
            //			HiPerfTimer t1 = new HiPerfTimer();
            //			t1.Start();

            bool ret_val = false;

            if (!chkPower.Checked)
            {
                MessageBox.Show("START must be active in order to calibrate PA Gain.", "START is not presently active",
                    MessageBoxButtons.OK, MessageBoxIcon.Stop);
                return false;
            }

            calibrating = true;

            DSPMode dsp_mode = rx1_dsp_mode;			// save current dsp mode
            RX1DSPMode = DSPMode.USB;					// set dsp mode to CWL

            double vfo_freq = VFOAFreq;						// save current frequency

            int pwr = ptbPWR.Value;						// save current pwr level

            bool tx_eq = chkTXEQ.Checked;
            chkTXEQ.Checked = false;

            bool dx = chkDX.Checked;
            chkDX.Checked = false;

            bool cpdr = chkCPDR.Checked;
            chkCPDR.Checked = false;

            DisableAllFilters();
            DisableAllModes();
            VFOLock = true;
            comboPreamp.Enabled = false;
            comboDisplayMode.Enabled = false;

            int on_time = 2500;
            int off_time = 2500;

            switch (current_soundcard)
            {
                case SoundCard.AUDIGY_2_ZS:
                    on_time = 3000;
                    off_time = 4000;
                    break;
                case SoundCard.DELTA_44:
                    on_time = 2000;
                    off_time = 2000;
                    break;
            }

            progress.SetPercent(0.0f);

            float[] band_freqs = { 1.85f, 3.75f, 5.3715f, 7.15f, 10.125f, 14.175f, 18.1f, 21.300f, 24.9f, 28.4f, 50.4f };

            int[] max_pwr = { 100, 100, 100, 100, 100, 100, 100, 100, 75, 75, 75 };

            if (run[0]) SetupForm.PAGain160 = 49.0f;
            if (run[1]) SetupForm.PAGain80 = 49.0f;
            if (run[2]) SetupForm.PAGain60 = 49.0f;
            if (run[3]) SetupForm.PAGain40 = 49.0f;
            if (run[4]) SetupForm.PAGain30 = 49.0f;
            if (run[5]) SetupForm.PAGain20 = 49.0f;
            if (run[6]) SetupForm.PAGain17 = 49.0f;
            if (run[7]) SetupForm.PAGain15 = 49.0f;
            if (run[8]) SetupForm.PAGain12 = 49.0f;
            if (run[9]) SetupForm.PAGain10 = 49.0f;
            if (run[10]) SetupForm.PAGain6 = 49.0f;

            for (int i = 0; i < band_freqs.Length; i++)
            {
                if (run[i])
                {
                    int error_count = 0;
                    VFOLock = false;
                    VFOAFreq = band_freqs[i];				// set frequency
                    VFOLock = true;
                    ptbPWR.Value = Math.Min(target_watts, max_pwr[i]);
                    int target = ptbPWR.Value;

                    bool good_result = false;
                    while (good_result == false)
                    {
                        /*Audio.SwitchCount = 4;
                        Audio.RampDown = true;
                        Audio.NextMox = true;*/
                        Audio.SourceScale = 1.0;
                        Audio.TXInputSignal = Audio.SignalSource.SINE;
                        //Audio.TXOutputSignal = Audio.SignalSource.SINE;
                        tuning = true;
                        chkMOX.Checked = true;

                        for (int j = 0; j < on_time / 100; j++)
                        {
                            Thread.Sleep(100);
                            if (!progress.Visible)
                                goto end;
                        }

                        double watts = 0;
                        //pa_power_mutex.WaitOne();
                        //watts = PAPower(pa_fwd_power);
                        watts = (double)JanusAudio.computeAlexFwdPower();       //HPSDR

                        //pa_power_mutex.ReleaseMutex();

                        chkMOX.Checked = false;
                        tuning = false;
                        /*Audio.RampDown = true;
                        Audio.NextMox = false;
                        Audio.SwitchCount = 4;*/
                        Audio.TXInputSignal = Audio.SignalSource.RADIO;
                        //Audio.TXOutputSignal = Audio.SignalSource.RADIO;

                        //Debug.WriteLine("watts: "+watts.ToString());

                        if (!progress.Visible)
                            goto end;

                        if (Math.Abs(watts - target) > 2)
                        {
                            // convert to dBm
                            float diff_dBm = (float)Math.Round((WattsTodBm(watts) - WattsTodBm((double)target)), 3);

                            switch (i)										// fix gain value
                            {
                                case 0:
                                    if (SetupForm.PAGain160 + diff_dBm < 38.8)
                                    {
                                        if (++error_count > 6)
                                            goto error;

                                        SetupForm.PAGain160 = (float)Math.Max(38.8, SetupForm.PAGain160 - 2.0);
                                    }
                                    else SetupForm.PAGain160 += diff_dBm;
                                    break;
                                case 1:
                                    if (SetupForm.PAGain80 + diff_dBm < 38.8)
                                    {
                                        if (++error_count > 6)
                                            goto error;

                                        SetupForm.PAGain80 = (float)Math.Max(38.8, SetupForm.PAGain80 - 2.0);
                                    }
                                    else SetupForm.PAGain80 += diff_dBm;
                                    break;
                                case 2:
                                    if (SetupForm.PAGain60 + diff_dBm < 38.8)
                                    {
                                        if (++error_count > 6)
                                            goto error;

                                        SetupForm.PAGain60 = (float)Math.Max(38.8, SetupForm.PAGain60 - 2.0);
                                    }
                                    else SetupForm.PAGain60 += diff_dBm;
                                    break;
                                case 3:
                                    if (SetupForm.PAGain40 + diff_dBm < 38.8)
                                    {
                                        if (++error_count > 6)
                                            goto error;

                                        SetupForm.PAGain40 = (float)Math.Max(38.8, SetupForm.PAGain40 - 2.0);
                                    }
                                    else SetupForm.PAGain40 += diff_dBm;
                                    break;
                                case 4:
                                    if (SetupForm.PAGain30 + diff_dBm < 38.8)
                                    {
                                        if (++error_count > 6)
                                            goto error;

                                        SetupForm.PAGain30 = (float)Math.Max(38.8, SetupForm.PAGain30 - 2.0);
                                    }
                                    else SetupForm.PAGain30 += diff_dBm;
                                    break;
                                case 5:
                                    if (SetupForm.PAGain20 + diff_dBm < 38.8)
                                    {
                                        if (++error_count > 6)
                                            goto error;

                                        SetupForm.PAGain20 = (float)Math.Max(38.8, SetupForm.PAGain20 - 2.0);
                                    }
                                    else SetupForm.PAGain20 += diff_dBm;
                                    break;
                                case 6:
                                    if (SetupForm.PAGain17 + diff_dBm < 38.8)
                                    {
                                        if (++error_count > 6)
                                            goto error;

                                        SetupForm.PAGain17 = (float)Math.Max(38.8, SetupForm.PAGain17 - 2.0);
                                    }
                                    else SetupForm.PAGain17 += diff_dBm;
                                    break;
                                case 7:
                                    if (SetupForm.PAGain15 + diff_dBm < 38.8)
                                    {
                                        if (++error_count > 6)
                                            goto error;

                                        SetupForm.PAGain15 = (float)Math.Max(38.8, SetupForm.PAGain15 - 2.0);
                                    }
                                    else SetupForm.PAGain15 += diff_dBm;
                                    break;
                                case 8:
                                    if (SetupForm.PAGain12 + diff_dBm < 38.8)
                                    {
                                        if (++error_count > 6)
                                            goto error;

                                        SetupForm.PAGain12 = (float)Math.Max(38.8, SetupForm.PAGain12 - 2.0);
                                    }
                                    else SetupForm.PAGain12 += diff_dBm;
                                    break;
                                case 9:
                                    if (SetupForm.PAGain10 + diff_dBm < 38.8)
                                    {
                                        if (++error_count > 6)
                                            goto error;

                                        SetupForm.PAGain10 = (float)Math.Max(38.8, SetupForm.PAGain10 - 2.0);
                                    }
                                    else SetupForm.PAGain10 += diff_dBm;
                                    break;
                                case 10:
                                    if (SetupForm.PAGain6 + diff_dBm < 38.8)
                                    {
                                        if (++error_count > 6)
                                            goto error;

                                        SetupForm.PAGain6 = (float)Math.Max(38.8, SetupForm.PAGain6 - 2.0);
                                    }
                                    else SetupForm.PAGain6 += diff_dBm;
                                    break;
                            }
                        }
                        else good_result = true;
                        for (int j = 0; j < off_time / 100; j++)
                        {
                            Thread.Sleep(100);
                            if (!progress.Visible)
                                goto end;
                        }
                    }
                }
                progress.SetPercent((float)((float)(i + 1) / 10));
            }

            ret_val = true;

        end:
            if (!progress.Visible) progress.Text = "";
            progress.Hide();

            EnableAllFilters();
            EnableAllModes();
            VFOLock = false;
            comboPreamp.Enabled = true;
            comboDisplayMode.Enabled = true;

            chkTXEQ.Checked = tx_eq;
            chkDX.Checked = dx;
            chkCPDR.Checked = cpdr;

            chkMOX.Checked = false;
            tuning = false;
            //Audio.SwitchCount = 4;
            Audio.TXInputSignal = Audio.SignalSource.RADIO;
            Audio.TXOutputSignal = Audio.SignalSource.RADIO;

            RX1DSPMode = dsp_mode;							// restore dsp mode
            VFOAFreq = vfo_freq;								// restore frequency
            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            PWR = pwr;									// restore pwr level

            calibrating = false;

            //t1.Stop();
            //MessageBox.Show(t1.Duration.ToString());
            return ret_val;

        error:
            MessageBox.Show("Calculated gain is invalid.  Please double check connections and try again.\n"/* +
                "If this problem persists, contact support@flex-radio.com for support."*/,
                "Invalid Gain Found",
                MessageBoxButtons.OK,
                MessageBoxIcon.Error);
            goto end;
        }

        public bool CalibratePAGain2(Progress progress, bool[] run, bool suppress_warnings)
        {
            bool ret_val = false;

            if (!chkPower.Checked)
            {
                MessageBox.Show("Power must be on in order to calibrate PA Gain 2.", "Power Is Off",
                    MessageBoxButtons.OK, MessageBoxIcon.Stop);
                return false;
            }

            progress.SetPercent(0.0f);
            int progress_count = 0;
            int progress_total = 0;
            for (int i = 0; i < 11; i++)
                if (run[i]) progress_total += 13;

            float[] band_freqs = { 1.85f, 3.75f, 5.3715f, 7.15f, 10.125f, 14.175f, 18.1f, 21.300f, 24.9f, 28.4f, 50.11f };
            int[] target_table = { 1, 2, 5, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100 };
            double tol = 2.0;
            bool fduplex = FullDuplex;
            if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
            {
                tol = 0.5;
                FullDuplex = false;
            }

            calibrating = true;

            DSPMode mode = rx1_dsp_mode; // save current dsp mode
            RX1DSPMode = DSPMode.USB;

            double vfoa = VFOAFreq;			// save VFO A frequency
            chkVFOSplit.Checked = false;
            comboMeterTXMode.Text = "Fwd Pwr";

            bool tx_eq = chkTXEQ.Checked;
            chkTXEQ.Checked = false;

            bool dx = chkDX.Checked;
            chkDX.Checked = false;

            bool cpdr = chkCPDR.Checked;
            chkCPDR.Checked = false;

            DisableAllFilters();
            DisableAllModes();
            VFOLock = true;
            comboPreamp.Enabled = false;
            comboDisplayMode.Enabled = false;

            int on_time = 2500;
            int off_time = 2500;

            switch (current_soundcard)
            {
                case SoundCard.AUDIGY_2_ZS:
                    on_time = 3000;
                    off_time = 4000;
                    break;
                case SoundCard.DELTA_44:
                    on_time = 2000;
                    off_time = 2000;
                    break;
            }

            switch (current_model)
            {
                case Model.FLEX5000:
                case Model.FLEX3000:
                    on_time = 1000;
                    off_time = 1000;
                    break;
            }

            for (int i = 0; i < band_freqs.Length; i++)
            {
                if (i == 10 && current_model == Model.SDR1000 || current_model == Model.HPSDR ||
                    current_model == Model.HERMES)
                {
                    // do nothing
                }
                else if (run[i])
                {
                    VFOLock = false;
                    VFOAFreq = band_freqs[i];
                    if (fwc_init)
                    {
                        switch (current_model)
                        {
                            case Model.FLEX5000:
                                FWC.SetTXAnt(1);
                                break;
                            case Model.FLEX3000:
                                FWC.SetAmpTX1(false);
                                FWC.SetRCATX1(false);
                                break;
                        }
                    }

                    VFOLock = true;
                    Audio.SourceScale = 0.04 / audio_volts1;
                    double last_watts = 0.0;
                    double last_volts = 0.0;
                    if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)) tol = 0.5;

                    for (int j = 0; j < power_table[i].Length; j++)
                    {
                        if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000) && j == 8) tol = 1.0;
                        if (j < 3 && current_model == Model.SDR1000 || current_model == Model.HPSDR ||
                    current_model == Model.HERMES)
                        {
                            // do nothing
                        }
                        else
                        {
                            bool found_power = false;
                            double target = target_table[j];
                            int count = 0;
                            while (!found_power && chkPower.Checked)
                            {
                                //								if(Audio.TXInputSignal != Audio.SignalSource.SINE)
                                //									Audio.TXInputSignal = Audio.SignalSource.SINE;
                                if (Audio.TXOutputSignal != Audio.SignalSource.SINE)
                                    Audio.TXOutputSignal = Audio.SignalSource.SINE;
                                //Audio.SourceScale = 1.0;
                                if (!chkMOX.Checked) chkMOX.Checked = true;
                                for (int k = 0; k < on_time / 100; k++)
                                {
                                    Thread.Sleep(100);
                                    if (!progress.Visible)
                                        goto end;
                                }

                                double watts = 0;
                                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                                    watts = FWCPAPower(pa_fwd_power);
                                else watts = PAPower(pa_fwd_power);

                                if (HighSWR)
                                {
                                    chkMOX.Checked = false;
                                    MessageBox.Show("PA Calibration Error: High SWR.  Please check\n" +
                                        "connections and try again.",
                                        "PA Power: High SWR",
                                        MessageBoxButtons.OK,
                                        MessageBoxIcon.Error);
                                    goto end;
                                }

                                Debug.WriteLine("watts: " + watts.ToString("f3"));
                                if (target > 50)
                                {
                                    Audio.TXInputSignal = Audio.SignalSource.RADIO;
                                    Audio.TXOutputSignal = Audio.SignalSource.RADIO;
                                    //Audio.SourceScale = 1.0;
                                    chkMOX.Checked = false;
                                    for (int k = 0; k < off_time / 100; k++)
                                    {
                                        Thread.Sleep(100);
                                        if (!progress.Visible)
                                            goto end;
                                    }
                                }
                                else Thread.Sleep(100);

                                double diff = target - watts;
                                if (Math.Abs(diff) < tol)
                                {
                                    found_power = true;
                                    power_table[i + 1][j] = (float)Math.Round(Audio.SourceScale * audio_volts1, 4);

                                    if (j + 1 == power_table[i].Length) break;
                                    // calculate line  in y = ax + b format
                                    double x2 = Math.Pow(power_table[i + 1][j], 2.0);
                                    double x1 = 0.0;
                                    if (j > 0) x1 = Math.Pow(power_table[i + 1][j - 1], 2.0);

                                    double y1 = target;
                                    double y2 = target_table[j + 1];

                                    double a = (y2 - y1) / (x2 - x1); // a = (y2-y1)/(x2-x1)
                                    double b = target - a * x2;

                                    double next_volts = Math.Sqrt((target_table[j + 1] - b) / a);  // solved y = ax + b to get x = (y - b)/a
                                    //double next_volts = current_volts * Math.Sqrt((target+10)/target);
                                    Audio.SourceScale = next_volts / audio_volts1;
                                }
                                else
                                {
                                    if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000) && target <= 10)
                                    {
                                        // calculate line  in y = ax + b format
                                        double x1 = Math.Pow(last_volts, 2.0);
                                        double x2 = Math.Pow(Audio.SourceScale, 2.0);
                                        double y1 = last_watts;
                                        double y2 = watts;

                                        double a = (y2 - y1) / (x2 - x1);
                                        double b = y2 - a * x2;

                                        Debug.WriteLine("a: " + a.ToString("f2") + " b: " + b.ToString("f2"));
                                        double next_volts = Math.Sqrt((target - b) / a);
                                        if (double.IsNaN(next_volts))
                                        {
                                            //count = 8; // error out -- two times through the cap will do this
                                            next_volts = power_table[i + 1][j - 1];
                                        }
                                        last_volts = Audio.SourceScale;
                                        Audio.SourceScale = next_volts / audio_volts1;
                                        //double v_ratio = Math.Sqrt(target) / Math.Sqrt(Math.Max(1, watts));
                                        //Audio.RadioVolume *= v_ratio;
                                        if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                                        {
                                            Audio.SourceScale = Math.Min(0.5, Audio.SourceScale); // 0.5 cap where 0.83 is max before overloading QSE
                                        }
                                    }
                                    else
                                    {
                                        Audio.SourceScale *= Math.Sqrt(target / watts);
                                    }
                                }

                                last_watts = watts;

                                // check for error conditions
                                if (count++ == 12) // poop out
                                {
                                    found_power = true;
                                    //if(double.IsNaN(Audio.RadioVolume)) Audio.RadioVolume = power_table[i+1][Math.Max(0, j-1)];
                                    //double final_value = Math.Min(power_table[i+1][Math.Max(0, j-1)], Audio.RadioVolume * 0.945); // 0.945 ~= down 0.5 dB
                                    double final_value = (j == 0 ? 0.0 : power_table[i + 1][j - 1]);
                                    for (int k = j; k < power_table[i].Length; k++)
                                        power_table[i + 1][k] = (float)Math.Round(final_value, 4);
                                    j = power_table.Length; // end loop for this band
                                    Audio.TXInputSignal = Audio.SignalSource.RADIO;
                                    Audio.TXOutputSignal = Audio.SignalSource.RADIO;
                                    chkMOX.Checked = false;
                                    //if(!suppress_warnings)
                                    {
                                        MessageBox.Show("Unable to calibrate PA Power on current band.",
                                            "PA Power Cal Error",
                                            MessageBoxButtons.OK,
                                            MessageBoxIcon.Error);
                                    }
                                }
                            }
                            progress.SetPercent((float)((float)(++progress_count) / progress_total));
                        }
                    }
                }
            }

            ret_val = true;

        end:
            if (!progress.Visible) progress.Text = "";
            progress.Hide();

            chkMOX.Checked = false;
            Audio.TXInputSignal = Audio.SignalSource.RADIO;
            Audio.TXOutputSignal = Audio.SignalSource.RADIO;

            if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                FullDuplex = false;

            if (current_model == Model.FLEX3000)
                FWC.SetAmpTX1(true);

            EnableAllFilters();
            EnableAllModes();
            VFOLock = false;
            comboPreamp.Enabled = true;
            comboDisplayMode.Enabled = true;

            chkTXEQ.Checked = tx_eq;
            chkDX.Checked = dx;
            chkCPDR.Checked = cpdr;

            for (int i = (int)Band.B2M; i < (int)Band.LAST; i++)
                for (int j = 0; j < 13; j++)
                    power_table[i][j] = (float)Math.Round(power_table[10][j], 4);

            RX1DSPMode = mode;							// restore dsp mode
            VFOAFreq = 0.590;
            VFOAFreq = vfoa;								// restore frequency

            try
            {
                StreamWriter writer = new StreamWriter(app_data_path + "\\power.csv");
                writer.WriteLine("Band, 1, 2, 5, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100");
                for (int i = 1; i <= (int)Band.B6M; i++)
                {
                    writer.Write(((Band)i).ToString() + ",");
                    for (int j = 0; j < 13; j++)
                        writer.Write(power_table[i][j].ToString("f4") + ",");
                    writer.WriteLine("");
                }
                writer.Close();
            }
            catch (Exception)
            {
                MessageBox.Show("Error writing power.csv file.  Please make sure this file is not open and try again.",
                    "Error writing power.csv",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
            }

            calibrating = false;
            return ret_val;
        }

        public bool LowPowerPASweep(Progress progress, int power) // calibrate PA Gain values
        {
            //			HiPerfTimer t1 = new HiPerfTimer();
            //			t1.Start();

            bool ret_val = false;

            if (!chkPower.Checked)
            {
                MessageBox.Show("Power must be on in order to run PA Sweep.", "Power Is Off",
                    MessageBoxButtons.OK, MessageBoxIcon.Stop);
                return false;
            }

            calibrating = true;

            DSPMode dsp_mode = RX1DSPMode;				// save current DSP Mode
            RX1DSPMode = DSPMode.USB;					// set DSP Mode to USB

            double vfo_freq = VFOAFreq;						// save current frequency

            int pwr = PWR;						// save current pwr level
            PWR = power;						// set pwr level to 100W

            progress.SetPercent(0.0f);

            float[] band_freqs = { 1.9f, 3.75f, 5.3715f, 7.15f, 10.125f, 14.175f, 18.1f, 21.225f, 24.9f, 28.85f };

            for (int i = 0; i < band_freqs.Length; i++)
            {
                VFOAFreq = band_freqs[i];				// set frequency
                Audio.TXInputSignal = Audio.SignalSource.SINE;
                Audio.SourceScale = 1.0;
                chkMOX.Checked = true;
                for (int j = 0; j < 30; j++)
                {
                    Thread.Sleep(100);
                    if (!progress.Visible)
                        goto end;
                }
                chkMOX.Checked = false;
                Audio.TXInputSignal = Audio.SignalSource.RADIO;

                if (!progress.Visible)
                    goto end;

                for (int j = 0; j < 40; j++)
                {
                    Thread.Sleep(100);
                    if (!progress.Visible)
                        goto end;
                }
                if (!progress.Visible)
                    goto end;

                progress.SetPercent((float)((float)(i + 1) / 10));
            }

            ret_val = true;

        end:
            progress.Hide();
            chkMOX.Checked = false;
            Audio.TXInputSignal = Audio.SignalSource.RADIO;
            RX1DSPMode = dsp_mode;							// restore dsp mode
            VFOAFreq = vfo_freq;								// restore frequency
            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            PWR = pwr;									// restore pwr level

            calibrating = false;

            //t1.Stop();
            //MessageBox.Show(t1.Duration.ToString());
            return ret_val;
        }

        public bool CalibrateSoundCard(Progress progress, int card)
        {
            if (!chkPower.Checked)
            {
                MessageBox.Show("Power must be on in order to calibrate Soundcard.", "Power Is Off",
                    MessageBoxButtons.OK, MessageBoxIcon.Stop);
                return false;
            }

            Audio.testing = true;
            progress.SetPercent(0.0f);

            double tx_volume = Audio.RadioVolume;	// save current TX volume
            double rx_volume = Audio.MonitorVolume;	// save current RX volume

            if (num_channels == 4 || num_channels == 6)
            {
                chkMOX.Checked = true;
                Thread.Sleep(200);
                Hdw.TransmitRelay = false;
                Audio.RadioVolume = 1.0;				// set volume to max
                Audio.MonitorVolume = 0.0;
            }
            else
            {
                Mixer.SetMainVolume(mixer_id1, 100);
                Mixer.SetWaveOutVolume(mixer_id1, 100);
                Audio.MonitorVolume = 1.0;
            }

            Audio.RX1OutputSignal = Audio.SignalSource.SINE;	// Start sending tone

            progress.Focus();

            while (progress.Visible == true)			// keep sending tone until abort is pressed
                Thread.Sleep(100);

            Audio.RX1OutputSignal = Audio.SignalSource.RADIO;		// stop sending tone

            if (num_channels > 2)
            {
                Thread.Sleep(200);
                chkMOX.Checked = false;
            }

            Audio.RadioVolume = tx_volume;			// restore TX volume
            Audio.MonitorVolume = rx_volume;		// restore RX volume
            Audio.testing = false;

            return true;
        }

        #endregion

        #region Properties
        // ======================================================
        // Properties
        // ======================================================

        private bool limit_slew = false;
        public bool LimitSlew
        {
            get { return limit_slew; }
            set { limit_slew = value; }
        }

        private List<TuneStep> tune_step_list;				// A list of available tuning steps
        public List<TuneStep> TuneStepList
        {
            get { return tune_step_list; }
        }

        private int tune_step_index;						// An index into the above array
        public int TuneStepIndex
        {
            get { return tune_step_index; }
            set
            {
                if (value < 0 || value > tune_step_list.Count - 1)
                    return;

                tune_step_index = value;
                txtWheelTune.Text = tune_step_list[tune_step_index].Name;
            }
        }

        public int TuneStepLookup(string s)
        {
            for (int i = 0; i < tune_step_list.Count; i++)
            {
                if (tune_step_list[i].Name == s)
                    return i;
            }

            return -1;
        }

        /// <summary>
        /// The transmit frequency in MHz
        /// </summary>
        public double TXFreq
        {
            get
            {
                double tx_freq = 0.0;

                if (!rx2_enabled)
                {
                    if (!chkVFOBTX.Checked)
                        tx_freq = VFOAFreq;
                    else
                        tx_freq = VFOBFreq;
                }
                else // if(rx2_enabled)
                {
                    if (chkVFOBTX.Checked)
                        tx_freq = VFOBFreq;
                    else if (chkVFOSplit.Checked)
                        tx_freq = VFOASubFreq;
                    else if (chkVFOATX.Checked)
                        tx_freq = VFOAFreq;
                }

                return tx_freq;
            }

            set
            {
                if (!rx2_enabled)
                {
                    if (!chkVFOBTX.Checked)
                        VFOAFreq = value;
                    else
                        VFOBFreq = value;
                }
                else // if(rx2_enabled)
                {
                    if (chkVFOBTX.Checked)
                        VFOBFreq = value;
                    else if (chkVFOSplit.Checked)
                        VFOASubFreq = value;
                    else if (chkVFOATX.Checked)
                        VFOAFreq = value;
                }
            }
        }

        private bool swap_vfo_ab_tx = false;
        public bool SwapVFOA_BTX
        {
            get { return swap_vfo_ab_tx; }
            set
            {
                if (value)
                {
                    //chkVFOATX.Checked = false;
                    chkVFOBTX.Checked = true;
                }
                else
                {
                    chkVFOATX.Checked = true;
                    //chkVFOBTX.Checked = false;
                }
                swap_vfo_ab_tx = value;
            }
        }


        public int RX0Gain
        {
            get
            {
                if (ptbRX0Gain != null) return ptbRX0Gain.Value;
                else return -1;
            }
            set
            {
                if (ptbRX0Gain != null) ptbRX0Gain.Value = value;
                ptbRX0Gain_Scroll(this, EventArgs.Empty);
            }
        }

        public int PanMainRX
        {
            get
            {
                if (ptbPanMainRX != null) return ptbPanMainRX.Value;
                else return -1;
            }
            set
            {
                if (ptbPanMainRX != null) ptbPanMainRX.Value = value;
                ptbPanMainRX_Scroll(this, EventArgs.Empty);
            }
        }


        public int RX1Gain
        {
            get
            {
                if (ptbRX1Gain != null) return ptbRX1Gain.Value;
                else return -1;
            }
            set
            {
                if (ptbRX1Gain != null) ptbRX1Gain.Value = value;
                ptbRX1Gain_Scroll(this, EventArgs.Empty);
            }
        }

        public int PanSubRX
        {
            get
            {
                if (ptbPanSubRX != null) return ptbPanSubRX.Value;
                else return -1;
            }
            set
            {
                if (ptbPanSubRX != null) ptbPanSubRX.Value = value;
                ptbPanSubRX_Scroll(this, EventArgs.Empty);
            }
        }

        public int RX2Gain
        {
            get
            {
                if (ptbRX2Gain != null) return ptbRX2Gain.Value;
                else return -1;
            }
            set
            {
                if (ptbRX2Gain != null) ptbRX2Gain.Value = value;
                ptbRX2Gain_Scroll(this, EventArgs.Empty);
            }
        }

        public int RX2Pan
        {
            get
            {
                if (ptbRX2Pan != null) return ptbRX2Pan.Value;
                else return -1;
            }
            set
            {
                if (ptbRX2Pan != null) ptbRX2Pan.Value = value;
                ptbRX2Pan_Scroll(this, EventArgs.Empty);
            }
        }


        public bool CATDiversityEnable
        {
            get
            {
                if (diversityForm != null)
                    return diversityForm.CATEnable;
                else
                    return false;
            }
            set
            {
                if (diversityForm != null)
                    if (value)
                        diversityForm.CATEnable = true;
                    else
                        diversityForm.CATEnable = false;
            }
        }

        public bool CATDiversityForm
        {
            get
            {
                if (diversityForm == null || diversityForm.IsDisposed)
                    return false;
                else
                    return true;
            }
            set
            {
                if (value)
                {
                    if (diversityForm == null || diversityForm.IsDisposed)
                        diversityForm = new DiversityForm(this);
                    diversityForm.Focus();
                    this.Invoke(new MethodInvoker(diversityForm.Show));
                }
                else
                    if (diversityForm != null)
                        this.Invoke(new MethodInvoker(diversityForm.Close));
            }
        }

        public bool CATCWXForm
        {
            get
            {
                if (CWXForm == null || CWXForm.IsDisposed)
                    return false;
                else
                    return true;
            }
            set
            {
                if (value)
                {
                    cWXToolStripMenuItem.PerformClick();
                }
                else
                    if (CWXForm != null)
                        this.Invoke(new MethodInvoker(CWXForm.Close));
            }
        }

        public bool VFOATX
        {
            get { return chkVFOATX.Checked; }
            set { chkVFOATX.Checked = value; }
        }

        public bool VFOBTX
        {
            get { return chkVFOBTX.Checked; }
            set { chkVFOBTX.Checked = value; }
        }

        private string db_file_name = "";
        public string DBFileName
        {
            get { return db_file_name; }
            set
            {
                if (initializing) // ignore changes here after init is complete per design
                {
                    db_file_name = value;
                    DB.FileName = value;
                }
            }
        }

        private string app_data_path = "";
        public string AppDataPath
        {
            get { return app_data_path; }
            set
            {
                app_data_path = value;
                //DB.AppDataPath = value;
                FWCEEPROM.AppDataPath = value;
                //HIDEEPROM.AppDataPath = value; 
                Skin.AppDataPath = value;
            }
        }

        private bool wheel_tunes_vfob = true;
        public bool WheelTunesVFOB
        {
            get { return wheel_tunes_vfob; }
            set { wheel_tunes_vfob = value; }
        }

        private bool disable_ui_mox_changes = true;
        public bool DisableUIMOXChanges
        {
            get { return disable_ui_mox_changes; }
            set { disable_ui_mox_changes = value; }
        }

        private HiPerfTimer mic_down_timer = new HiPerfTimer();
        private bool mic_down_running = false;
        private bool mic_down = false;
        public bool MicDown
        {
            get { return mic_down; }
            set
            {
                mic_down = value;
                Debug.WriteLine("mic_down: " + value.ToString());
                mic_down_timer.Start();
                if (mic_down)
                {
                    if (mic_down_running)
                        mic_down_running = false;
                    else if (mic_up_running)
                        mic_up_running = false;
                    else
                    {
                        if (mic_fast)
                            VFOAFreq -= 0.001000;
                        else VFOAFreq -= 0.000050;
                    }
                }
            }
        }

        private HiPerfTimer mic_up_timer = new HiPerfTimer();
        private bool mic_up_running = false;
        private bool mic_up = false;
        public bool MicUp
        {
            get { return mic_up; }
            set
            {
                mic_up = value;
                Debug.WriteLine("mic_up: " + value.ToString());
                mic_up_timer.Start();
                if (mic_up)
                {
                    if (mic_up_running)
                        mic_up_running = false;
                    else if (mic_down_running)
                        mic_down_running = false;
                    else
                    {
                        if (mic_fast)
                            VFOAFreq += 0.001000;
                        else VFOAFreq += 0.000050;
                    }
                }
            }
        }

        private HiPerfTimer mic_fast_timer = new HiPerfTimer();
        private bool mic_fast = false;
        public bool MicFast
        {
            get { return mic_fast; }
            set
            {
                mic_fast = value;
                Debug.WriteLine("mic_fast: " + value.ToString());
                mic_fast_timer.Start();
            }
        }

        private bool f3k_fan = false;
        private bool F3KFan
        {
            get { return f3k_fan; }
            set
            {
                f3k_fan = value;
                FWC.SetFan(value);
            }
        }

        private float f3k_temp_thresh = 70.0f;
        public float F3KTempThresh
        {
            get { return f3k_temp_thresh; }
            set
            {
                if (value < 30.0f) value = 30.0f;
                if (value > 70.0f) value = 70.0f;
                f3k_temp_thresh = value;
            }
        }

        private bool flex_wire_ucb = false;
        public bool FlexWireUCB
        {
            get { return flex_wire_ucb; }
            set { flex_wire_ucb = value; }
        }

        private float loop_gain = 0.0f;
        private float rx1_loop_offset = 0.0f;
        private float rx2_loop_offset = 0.0f;
        public float LoopGain
        {
            get { return loop_gain; }
            set
            {
                loop_gain = value;
                if (rx1_loop)
                {
                    rx1_loop_offset = loop_gain;
                    if (rx2_ant == FWCAnt.RX1TAP)
                        rx2_loop_offset = loop_gain;
                    UpdateDisplayOffsets();
                }
            }
        }

        private float rx1_xvtr_gain_offset;						// gain offset as entered on the xvtr form
        public float RX1XVTRGainOffset
        {
            get { return rx1_xvtr_gain_offset; }
            set
            {
                rx1_xvtr_gain_offset = value;
                UpdateDisplayOffsets();
            }
        }

        private float rx2_xvtr_gain_offset;						// gain offset as entered on the xvtr form
        public float RX2XVTRGainOffset
        {
            get { return rx2_xvtr_gain_offset; }
            set
            {
                rx2_xvtr_gain_offset = value;
                UpdateDisplayOffsets();
            }
        }

        private bool fwc_amp_tx1 = true;
        public bool FWCAmpTX1
        {
            get { return fwc_amp_tx1; }
            set
            {
                bool old = fwc_amp_tx1;
                fwc_amp_tx1 = value;
                if (old != value || initializing)
                    FWC.SetAmpTX1(value);
            }
        }

        private bool fwc_amp_tx2 = true;
        public bool FWCAmpTX2
        {
            get { return fwc_amp_tx2; }
            set
            {
                bool old = fwc_amp_tx2;
                fwc_amp_tx2 = value;
                if (old != value || initializing)
                    FWC.SetAmpTX2(value);
            }
        }

        private bool fwc_amp_tx3 = true;
        public bool FWCAmpTX3
        {
            get { return fwc_amp_tx3; }
            set
            {
                bool old = fwc_amp_tx3;
                fwc_amp_tx3 = value;
                if (old != value || initializing)
                    FWC.SetAmpTX3(value);
            }
        }

        private bool fwc_pa_bias = false;
        public bool FWCPABias
        {
            get { return fwc_pa_bias; }
            set
            {
                bool old = fwc_pa_bias;
                fwc_pa_bias = value;
                if (old != value)
                    FWC.SetPABias(value);
            }
        }

        private bool fwc_rx1_attn = false;
        public bool FWCRX1Attn
        {
            get { return fwc_rx1_attn; }
            set
            {
                bool old = fwc_rx1_attn;
                fwc_rx1_attn = value;
                if (old != value)
                    FWC.SetRXAttn(value);
            }
        }

        private bool fwc_rx1_preamp = false;
        public bool FWCRX1Preamp
        {
            get { return fwc_rx1_preamp; }
            set
            {
                bool old = fwc_rx1_preamp;
                fwc_rx1_preamp = value;
                if (old != value)
                    FWC.SetTRXPreamp(value);
            }
        }

        private bool fwc_rx2_preamp = false;
        public bool FWCRX2Preamp
        {
            get { return fwc_rx2_preamp; }
            set
            {
                bool old = fwc_rx2_preamp;
                fwc_rx2_preamp = value;
                if (old != value)
                    FWC.SetRX2Preamp(value);
            }
        }

        private bool enable_6m_preamp = false;
        public bool Enable6mPreamp
        {
            get { return enable_6m_preamp; }
            set
            {
                enable_6m_preamp = value;
                if (value)
                {
                    if (rx1_band == Band.B6M)
                        chkRX1Preamp.Enabled = true;
                    if (FWCEEPROM.RX2OK && rx2_band == Band.B6M)
                        chkRX2Preamp.Enabled = true;
                }
                else
                {
                    if (rx1_band == Band.B6M)
                    {
                        chkRX1Preamp.Enabled = false;
                        chkRX1Preamp.Checked = true;
                    }
                    if (FWCEEPROM.RX2OK && rx2_band == Band.B6M)
                    {
                        chkRX2Preamp.Enabled = false;
                        chkRX2Preamp.Checked = true;
                    }
                }
            }
        }

        private bool meter_detail = false;
        public bool MeterDetail
        {
            get { return meter_detail; }
            set { meter_detail = value; }
        }

        private MeterTXMode tune_meter_tx_mode = MeterTXMode.FORWARD_POWER;
        public MeterTXMode TuneTXMeterMode
        {
            get { return tune_meter_tx_mode; }
            set
            {
                tune_meter_tx_mode = value;
                if (chkTUN.Checked)
                {
                    CurrentMeterTXMode = value;
                    comboMeterTXMode_SelectedIndexChanged(this, EventArgs.Empty);
                }
            }
        }

        public bool NB
        {
            get { return chkNB.Checked; }
            set { chkNB.Checked = value; }
        }

        public bool NB2
        {
            get { return chkDSPNB2.Checked; }
            set { chkDSPNB2.Checked = value; }
        }

        public bool QuickPlay
        {
            get { return ckQuickPlay.Checked; }
            set { ckQuickPlay.Checked = value; }
        }

        public bool DX
        {
            get { return chkDX.Checked; }
            set { chkDX.Checked = value; }
        }

        public int DXLevel
        {
            get { return ptbDX.Value; }
            set
            {
                ptbDX.Value = value;
                ptbDX_Scroll(this, EventArgs.Empty);
            }
        }

        private bool peak_tx_meter = true; // as opposed to avg
        public bool PeakTXMeter
        {
            get { return peak_tx_meter; }
            set { peak_tx_meter = value; }
        }

        private bool allow_vac_bypass = true;
        public bool AllowVACBypass
        {
            get { return allow_vac_bypass; }
            set { allow_vac_bypass = value; }
        }

        public float NewMeterData
        {
            get { return new_meter_data; }
        }

        private bool all_mode_mic_ptt = true;
        public bool AllModeMicPTT
        {
            get { return all_mode_mic_ptt; }
            set { all_mode_mic_ptt = value; }
        }

        private int rx1_xvtr_index = -1;				// index of current xvtr in use
        public int RX1XVTRIndex
        {
            get { return rx1_xvtr_index; }
            set { rx1_xvtr_index = value; }
        }

        private int rx2_xvtr_index = -1;				// index of current xvtr in use
        public int RX2XVTRIndex
        {
            get { return rx2_xvtr_index; }
            set { rx2_xvtr_index = value; }
        }

        private int tx_xvtr_index = -1;				// index of current xvtr in use
        public int TXXVTRIndex
        {
            get { return tx_xvtr_index; }
            set { tx_xvtr_index = value; }
        }

        private int last_tx_xvtr_index = -1;		    // index of last xvtr in use
        public int LastTXXVTRIndex
        {
            get { return last_tx_xvtr_index; }
            set { last_tx_xvtr_index = value; }
        }

        private float rx1_path_offset = 0.0f;
        public float RX1PathOffset
        {
            get { return rx1_path_offset; }
        }

        private float rx2_path_offset = 0.0f;
        public float RX2PathOffset
        {
            get { return rx2_path_offset; }
        }

        private bool[] tx1_by_band;
        public void SetTX1(Band b, bool on)
        {
            switch (current_ant_mode)
            {
                case AntMode.Simple:
                    FWCAmpTX1 = on;
                    break;
                case AntMode.Expert:
                    tx1_by_band[(int)b] = on;
                    Band band = tx_band;
                    if (tx_xvtr_index >= 0)
                        band = (Band)((int)Band.VHF0 + tx_xvtr_index);
                    if (band == b) FWCAmpTX1 = on;
                    break;
            }
        }

        public bool GetTX1(Band b)
        {
            return tx1_by_band[(int)b];
        }

        private bool[] tx2_by_band;
        public void SetTX2(Band b, bool on)
        {
            switch (current_ant_mode)
            {
                case AntMode.Simple:
                    FWCAmpTX2 = on;
                    break;
                case AntMode.Expert:
                    tx2_by_band[(int)b] = on;
                    Band band = tx_band;
                    if (tx_xvtr_index >= 0)
                        band = (Band)((int)Band.VHF0 + tx_xvtr_index);
                    if (band == b) FWCAmpTX2 = on;
                    break;
            }
        }

        public bool GetTX2(Band b)
        {
            return tx2_by_band[(int)b];
        }

        private bool[] tx3_by_band;
        public void SetTX3(Band b, bool on)
        {
            switch (current_ant_mode)
            {
                case AntMode.Simple:
                    FWCAmpTX3 = on;
                    break;
                case AntMode.Expert:
                    tx3_by_band[(int)b] = on;
                    Band band = tx_band;
                    if (tx_xvtr_index >= 0)
                        band = (Band)((int)Band.VHF0 + tx_xvtr_index);
                    if (band == b) FWCAmpTX3 = on;
                    break;
            }
        }

        public bool GetTX3(Band b)
        {
            return tx3_by_band[(int)b];
        }

        private PreampMode[] rx1_preamp_by_band;
        public void SetRX1Preamp(Band b, PreampMode mode)
        {
            rx1_preamp_by_band[(int)b] = mode;
            //if(current_band == b) RX1PreampMode = mode;
        }

        public PreampMode GetPreamp(Band b)
        {
            return rx1_preamp_by_band[(int)b];
        }

        private PreampMode[] rx2_preamp_by_band;

        private double[] fm_tx_offset_by_band_mhz;

        private int[] power_by_band;
        public void SetPower(Band b, int pwr)
        {
            power_by_band[(int)b] = pwr;
            if (tx_band == b) PWR = pwr;
        }

        public int GetPower(Band b)
        {
            return power_by_band[(int)b];
        }

        private int[] rx1_agct_by_band;
        public void SetRFGain(Band b, int gain)
        {
            rx1_agct_by_band[(int)b] = gain;
            if (rx1_band == b) RF = gain;
        }

        public int GetRFGain(Band b)
        {
            return rx1_agct_by_band[(int)b];
        }

        private int[] rx2_agct_by_band;

        private AntMode current_ant_mode = AntMode.Simple;
        public AntMode CurrentAntMode
        {
            get { return current_ant_mode; }
            set
            {
                current_ant_mode = value;
                if (current_ant_mode == AntMode.Expert && !initializing)
                {
                    RX1Ant = GetRX1Ant(rx1_band);
                    if (FWCEEPROM.RX2OK) RX2Ant = GetRX2Ant(rx1_band);
                    TXAnt = GetTXAnt(rx1_band);
                }
            }
        }

        private FWCAnt[] rx1_ant_by_band;
        public void SetRX1Ant(Band b, FWCAnt ant)
        {
            switch (current_ant_mode)
            {
                case AntMode.Simple:
                    RX1Ant = ant;
                    break;
                case AntMode.Expert:
                    if (initializing) return;
                    rx1_ant_by_band[(int)b] = ant;
                    if (rx1_band == b) RX1Ant = ant;
                    break;
            }
        }

        public FWCAnt GetRX1Ant(Band b)
        {
            FWCAnt ret = FWCAnt.ANT1;
            switch (current_ant_mode)
            {
                case AntMode.Simple:
                    ret = rx1_ant;
                    break;
                case AntMode.Expert:
                    ret = rx1_ant_by_band[(int)b];
                    break;
            }
            return ret;
        }

        private FWCAnt[] rx2_ant_by_band;
        public void SetRX2Ant(Band b, FWCAnt ant)
        {
            switch (current_ant_mode)
            {
                case AntMode.Simple:
                    RX2Ant = ant;
                    break;
                case AntMode.Expert:
                    if (initializing) return;
                    rx2_ant_by_band[(int)b] = ant;
                    if (rx2_band == b) RX2Ant = ant;
                    break;
            }
        }

        public FWCAnt GetRX2Ant(Band b)
        {
            FWCAnt ret = FWCAnt.ANT1;
            switch (current_ant_mode)
            {
                case AntMode.Simple:
                    ret = rx2_ant;
                    break;
                case AntMode.Expert:
                    ret = rx2_ant_by_band[(int)b];
                    break;
            }
            return ret;
        }

        private FWCAnt[] tx_ant_by_band;
        public void SetTXAnt(Band b, FWCAnt ant)
        {
            switch (current_ant_mode)
            {
                case AntMode.Simple:
                    TXAnt = ant;
                    break;
                case AntMode.Expert:
                    if (initializing) return;
                    tx_ant_by_band[(int)b] = ant;
                    if (tx_band == b) TXAnt = ant;
                    break;
            }
        }

        public FWCAnt GetTXAnt(Band b)
        {
            FWCAnt ret = FWCAnt.ANT1;
            switch (current_ant_mode)
            {
                case AntMode.Simple:
                    ret = tx_ant;
                    break;
                case AntMode.Expert:
                    ret = tx_ant_by_band[(int)b];
                    break;
            }
            return ret;
        }

        private bool[] rx1_loop_by_band;
        public void SetRX1Loop(Band b, bool on)
        {
            switch (current_ant_mode)
            {
                case AntMode.Simple:
                    RX1Loop = on;
                    break;
                case AntMode.Expert:
                    if (initializing) return;
                    rx1_loop_by_band[(int)b] = on;
                    if (rx1_band == b && !mox) RX1Loop = on;
                    break;
            }
        }

        public bool GetRX1Loop(Band b)
        {
            bool ret = false;
            switch (current_ant_mode)
            {
                case AntMode.Simple:
                    ret = rx1_loop;
                    break;
                case AntMode.Expert:
                    ret = rx1_loop_by_band[(int)b];
                    break;
            }
            return ret;
        }

        private bool mouse_tune_step = false;
        public bool MouseTuneStep
        {
            get { return mouse_tune_step; }
            set { mouse_tune_step = value; }
        }

        private bool new_power_cal = false;
        public bool NewPowerCal
        {
            get { return new_power_cal; }
            set { new_power_cal = value; }
        }

        public bool ShowCWTXFreq
        {
            get { return chkShowTXCWFreq.Checked; }
            set { chkShowTXCWFreq.Checked = value; }
        }

        public bool ShowTXFilter
        {
            get { return chkShowTXFilter.Checked; }
            set { chkShowTXFilter.Checked = value; }
        }

        private bool rx1_loop = false;
        public bool RX1Loop
        {
            get { return rx1_loop; }
            set
            {
                bool old = rx1_loop;
                rx1_loop = value;
                if (old != value || initializing)
                {
                    FWC.SetRX1Loop(rx1_loop);

                    if (rx1_loop)
                        rx1_loop_offset = loop_gain;
                    else rx1_loop_offset = 0.0f;
                    if (rx2_ant == FWCAnt.RX1TAP)
                        rx2_loop_offset = rx1_loop_offset;
                    UpdateDisplayOffsets();
                }
            }
        }

        private FWCAnt rx1_ant = FWCAnt.ANT1;
        public FWCAnt RX1Ant
        {
            get { return rx1_ant; }
            set
            {
                if (!fwc_init || current_model != Model.FLEX5000) return;
                FWCAnt old = rx1_ant;
                rx1_ant = value;
                if (value != old || initializing)
                {
                    switch (rx1_ant)
                    {
                        case FWCAnt.NC:
                            lblAntRX1.Text = "RX1: N/C";
                            FWC.SetRX1Ant(0);
                            break;
                        case FWCAnt.ANT1:
                            lblAntRX1.Text = "RX1: ANT1";
                            FWC.SetRX1Ant(1);
                            rx1_path_offset = 0.5f;
                            break;
                        case FWCAnt.ANT2:
                            lblAntRX1.Text = "RX1: ANT2";
                            FWC.SetRX1Ant(2);
                            rx1_path_offset = 0.5f;
                            break;
                        case FWCAnt.ANT3:
                            lblAntRX1.Text = "RX1: ANT3";
                            FWC.SetRX1Ant(3);
                            rx1_path_offset = 0.5f;
                            break;
                        case FWCAnt.RX1IN:
                            lblAntRX1.Text = "RX1: RX1 IN";
                            FWC.SetRX1Ant(4);
                            rx1_path_offset = 0.0f;
                            break;
                        case FWCAnt.SIG_GEN:
                            lblAntRX1.Text = "RX1: Sig Gen";
                            rx1_path_offset = 0.0f;
                            break;
                    }

                    UpdateDisplayOffsets();
                    if (FWCEEPROM.RX2OK && rx2_ant == FWCAnt.RX1TAP)
                    {
                        RX2Ant = rx2_ant;
                    }
                }
            }
        }

        private FWCAnt rx2_ant = FWCAnt.RX2IN;
        public FWCAnt RX2Ant
        {
            get { return rx2_ant; }
            set
            {
                if (!fwc_init || current_model != Model.FLEX5000) return;
                FWCAnt old = rx2_ant;
                rx2_ant = value;
                if (old != value || initializing)
                {
                    switch (rx2_ant)
                    {
                        case FWCAnt.ANT1:
                            lblAntRX2.Text = "RX2: ANT1";
                            FWC.SetRX2Ant(1);
                            rx2_path_offset = -rx2_res_offset - 2.9f;
                            rx2_loop_offset = 0.0f;
                            break;
                        case FWCAnt.RX2IN:
                            lblAntRX2.Text = "RX2: RX2 IN";
                            FWC.SetRX2Ant(5);
                            rx2_path_offset = -rx2_res_offset - 2.8f;
                            rx2_loop_offset = 0.0f;
                            break;
                        case FWCAnt.RX1TAP:
                            lblAntRX2.Text = "RX2: RX1 Tap";
                            FWC.SetRX2Ant(6);
                            switch (rx1_ant)
                            {
                                case FWCAnt.ANT1:
                                case FWCAnt.ANT2:
                                case FWCAnt.ANT3:
                                    rx2_path_offset = 0.6f;
                                    break;
                                case FWCAnt.RX1IN:
                                case FWCAnt.SIG_GEN:
                                    rx2_path_offset = 0.0f;
                                    break;
                            }
                            rx2_loop_offset = rx1_loop_offset;
                            break;
                        case FWCAnt.NC:
                            lblAntRX2.Text = "RX2: N/C";
                            FWC.SetRX2Ant(0);
                            rx2_path_offset = -rx2_res_offset - 2.8f;
                            rx2_loop_offset = 0.0f;
                            break;
                        default:
                            FWC.SetRX2Ant(5);
                            lblAntRX2.Text = "RX2: RX2 IN";
                            rx2_path_offset = -2.0f;
                            rx2_loop_offset = 0.0f;
                            break;
                    }
                    UpdateDisplayOffsets();
                }
            }
        }

        bool tx_ant_6m_reset = false;
        private FWCAnt tx_ant = FWCAnt.ANT1;
        public FWCAnt TXAnt
        {
            get { return tx_ant; }
            set
            {
                if (!fwc_init || current_model != Model.FLEX5000) return;
                FWCAnt old = tx_ant;
                tx_ant = value;
                if (old != value || tx_ant_6m_reset || initializing)
                {
                    if (tx_ant_6m_reset) tx_ant_6m_reset = false;
                    switch (tx_ant)
                    {
                        case FWCAnt.ANT1:
                            lblAntTX.Text = "TX: ANT1";
                            FWC.SetTXAnt(1);
                            break;
                        case FWCAnt.ANT2:
                            lblAntTX.Text = "TX: ANT2";
                            FWC.SetTXAnt(2);
                            break;
                        case FWCAnt.ANT3:
                            lblAntTX.Text = "TX: ANT3";
                            FWC.SetTXAnt(3);
                            break;
                    }
                }
            }
        }

        private bool zero_beat_rit = false;
        public bool ZeroBeatRIT
        {
            get { return zero_beat_rit; }
            set { zero_beat_rit = value; }
        }

        private float fwc_preamp_offset = 13.0f;
        public float FWCPreampOffset
        {
            get { return fwc_preamp_offset; }
            set { fwc_preamp_offset = value; }
        }

        /*private bool fwc_att_on = false;
        public bool FWCATTOn
        {
            get { return fwc_att_on; }
            set
            {
                fwc_att_on = value;
                FWC.SetAttOn(fwc_index, fwc_att_on);
                UpdateDisplayOffset();
            }
        }*/

        /*private float[] fwc_att_offset = new float[32];
        private int fwc_att_val = 0;
        public int FWCATTVal
        {
            get { return fwc_att_val; }
            set
            {
                fwc_att_val = value;
                FWC.SetAttVal(fwc_index, fwc_att_val);
                UpdateDisplayOffset();
            }
        }*/

        private float meter_offset = 0.0f;
        private void UpdateDisplayOffsets()
        {
            Display.RX1PreampOffset = rx1_preamp_offset[(int)rx1_preamp_mode];
            //Display.RX2PreampOffset = rx2_preamp_offset[(int)rx2_preamp_mode];
            //Display.RX1DisplayCalOffset = rx1_level_table[(int)rx1_band][0]+rx1_path_offset+rx1_xvtr_gain_offset+rx1_loop_offset;
            Display.RX1DisplayCalOffset = rx1_display_cal_offset + rx1_path_offset + rx1_xvtr_gain_offset + rx1_loop_offset;
            //Display.RX2DisplayCalOffset = rx2_level_table[(int)rx2_band][0]+rx2_path_offset+rx2_xvtr_gain_offset+rx2_loop_offset;
            //Display.TXDisplayCalOffset = tx_display_cal_offset;
            // Display.AlexPreampOffset = alex_preamp_offset;
            //SetupForm.UpdateDisplayMeter();
        }

        private bool snap_to_click_tuning = true;
        public bool SnapToClickTuning
        {
            get { return snap_to_click_tuning; }
            set { snap_to_click_tuning = value; }
        }

        private bool click_tune_filter = true;
        public bool ClickTuneFilter
        {
            get { return click_tune_filter; }
            set { click_tune_filter = value; }
        }

        private bool xvtr_tune_power = false;
        public bool XVTRTunePower
        {
            get { return xvtr_tune_power; }
            set { xvtr_tune_power = value; }
        }

        public bool DisableToolTips
        {
            set
            {
                if (toolTip1 != null) toolTip1.Active = !value;
            }
        }

        public bool X2TR
        {
            get
            {
                if (chkX2TR != null) return chkX2TR.Checked;
                else return false;
            }
            set
            {
                if (chkX2TR != null) chkX2TR.Checked = value;
            }
        }

        public string TXProfile
        {
            get
            {
                if (comboTXProfile != null) return comboTXProfile.Text;
                else return "";
            }
            set
            {
                if (comboTXProfile != null) comboTXProfile.Text = value;
                if (comboDigTXProfile != null) comboDigTXProfile.Text = value;
            }
        }

        public string VACSampleRate
        {
            get
            {
                if (comboVACSampleRate != null) return comboVACSampleRate.Text;
                else return "";
            }
            set
            {
                if (comboVACSampleRate != null) comboVACSampleRate.Text = value;
            }
        }

        public bool VACStereo
        {
            get
            {
                if (chkVACStereo != null) return chkVACStereo.Checked;
                else return false;
            }
            set
            {
                if (chkVACStereo != null) chkVACStereo.Checked = value;
            }
        }

        public bool CWIambic
        {
            get
            {
                if (chkCWIambic != null) return chkCWIambic.Checked;
                else return false;
            }

            set
            {
                if (chkCWIambic != null) chkCWIambic.Checked = value;
            }
        }

        private MultiMeterDisplayMode current_meter_display_mode = MultiMeterDisplayMode.Edge;
        public MultiMeterDisplayMode CurrentMeterDisplayMode
        {
            get { return current_meter_display_mode; }
            set
            {
                switch (current_meter_display_mode)
                {
                    case MultiMeterDisplayMode.Edge:
                        switch (value)
                        {
                            case MultiMeterDisplayMode.Edge:
                                break;
                            default:
                                if (collapsedDisplay) return;
                                picMultiMeterDigital.Height -= lblMultiSMeter.ClientSize.Height;
                                picMultiMeterDigital.BackColor = meter_background_color;
                                picRX2Meter.Height -= lblRX2Meter.ClientSize.Height;
                                picRX2Meter.BackColor = meter_background_color;
                                lblMultiSMeter.Show();
                                break;
                        }
                        break;
                    default:
                        switch (value)
                        {
                            case MultiMeterDisplayMode.Edge:
                                picMultiMeterDigital.Height += lblMultiSMeter.ClientSize.Height;
                                picMultiMeterDigital.BackColor = edge_meter_background_color;
                                picRX2Meter.Height += lblRX2Meter.ClientSize.Height;
                                picRX2Meter.BackColor = edge_meter_background_color;
                                lblMultiSMeter.Hide();
                                break;
                        }
                        break;
                }
                current_meter_display_mode = value;
                picMultiMeterDigital.Invalidate();
            }
        }

        /*	private Color gen_background_color = SystemColors.Control;//k6jca 1/13/08
            public Color GenBackgroundColor							  //k6jca  1/13/08
            {
                get
                {
                    return gen_background_color;
                }
                set
                {
                    //gen_background_color = value;
                    //this.BackColor = value;
                    //grpVFOA.BackColor = value;
                    //grpVFOB.BackColor = value;
                }
            }*/

        public bool VFOSync
        {
            get { return chkVFOSync.Checked; }
            set { chkVFOSync.Checked = value; }
        }

        private Color vfo_background_color = Color.Black;
        public Color VFOBackgroundColor
        {
            get { return vfo_background_color; }
            set
            {
                vfo_background_color = value;
                txtVFOAFreq.BackColor = value;
                txtVFOAMSD.BackColor = value;
                txtVFOALSD.BackColor = value;
                txtVFOBFreq.BackColor = value;
                txtVFOBMSD.BackColor = value;
                txtVFOBLSD.BackColor = value;
                panelVFOAHover.BackColor = value;
                panelVFOBHover.BackColor = value;
                lblFilterLabel.BackColor = value;
                lblModeLabel.BackColor = value;
            }
        }

        private Color meter_digital_text_color = Color.Yellow;
        public Color MeterDigitalTextColor
        {
            get { return meter_digital_text_color; }
            set
            {
                meter_digital_text_color = value;
                txtMultiText.ForeColor = value;
                txtRX2Meter.ForeColor = value;
            }
        }

        private Color meter_digital_background_color = Color.Black;
        public Color MeterDigitalBackgroundColor
        {
            get { return meter_digital_background_color; }
            set
            {
                meter_digital_background_color = value;
                txtMultiText.BackColor = value;
                txtRX2Meter.BackColor = value;
            }
        }

        private Color band_background_color = Color.Black;
        public Color BandBackgroundColor
        {
            get { return band_background_color; }
            set
            {
                band_background_color = value;
                txtVFOABand.BackColor = value;
                txtVFOBBand.BackColor = value;
            }
        }

        private Color edge_meter_background_color = Color.Black;
        private Pen edge_meter_background_pen = new Pen(Color.Black);
        public Color EdgeMeterBackgroundColor
        {
            get { return edge_meter_background_color; }
            set
            {
                edge_meter_background_color = value;
                edge_meter_background_pen.Color = edge_meter_background_color;
                if (current_meter_display_mode == MultiMeterDisplayMode.Edge)
                {
                    picMultiMeterDigital.BackColor = value;
                    picMultiMeterDigital.Invalidate();
                    picRX2Meter.BackColor = value;
                    if (chkRX2.Checked)
                        picRX2Meter.Invalidate();
                }
            }
        }
        private SolidBrush low_brush = new SolidBrush(Color.White);
        private Color edge_low_color = Color.White;
        public Color EdgeLowColor
        {
            get { return edge_low_color; }
            set
            {
                edge_low_color = value;
                low_brush.Color = edge_low_color;
                if (current_meter_display_mode == MultiMeterDisplayMode.Edge)
                {
                    picMultiMeterDigital.Invalidate();
                    if (chkRX2.Checked)
                        picRX2Meter.Invalidate();
                }
            }
        }
        private SolidBrush high_brush = new SolidBrush(Color.Red);
        private Color edge_high_color = Color.Red;
        public Color EdgeHighColor
        {
            get { return edge_high_color; }
            set
            {
                edge_high_color = value;
                high_brush.Color = edge_high_color;
                if (current_meter_display_mode == MultiMeterDisplayMode.Edge)
                {
                    picMultiMeterDigital.Invalidate();
                    if (chkRX2.Checked)
                        picRX2Meter.Invalidate();
                }
            }
        }


        private Pen line_pen = new Pen(Color.Yellow);
        private Pen line_dark_pen = new Pen(Color.Yellow);
        private Color edge_avg_color = Color.Yellow;
        public Color EdgeAVGColor
        {
            get { return edge_avg_color; }
            set
            {
                edge_avg_color = value;
                line_pen.Color = edge_avg_color;
                if (current_meter_display_mode == MultiMeterDisplayMode.Edge)
                    picMultiMeterDigital.Invalidate();
            }
        }

        private Pen meter_background_pen = new Pen(Color.Black);
        private Color meter_background_color = Color.Black;
        public Color MeterBackgroundColor
        {
            get { return meter_background_color; }
            set
            {
                meter_background_color = value;
                meter_background_pen.Color = meter_background_color;
                if (current_meter_display_mode == MultiMeterDisplayMode.Original)
                {
                    picMultiMeterDigital.BackColor = value;
                    picMultiMeterDigital.Invalidate();
                }
            }
        }

        private Color peak_background_color = Color.Black;
        public Color PeakBackgroundColor
        {
            get { return peak_background_color; }
            set
            {
                peak_background_color = value;
                txtDisplayCursorOffset.BackColor = value;
                txtDisplayCursorPower.BackColor = value;
                txtDisplayCursorFreq.BackColor = value;
                txtDisplayPeakOffset.BackColor = value;
                txtDisplayPeakPower.BackColor = value;
                txtDisplayPeakFreq.BackColor = value;
                txtOverload.BackColor = value;
            }
        }

        private bool small_lsd = true;
        public bool SmallLSD
        {
            get { return small_lsd; }
            set
            {
                small_lsd = value;
                txtVFOALSD.Visible = value;
                txtVFOAMSD.Visible = value;
                txtVFOBLSD.Visible = value;
                txtVFOBMSD.Visible = value;
            }
        }

        private Color small_vfo_color = Color.OrangeRed;
        public Color SmallVFOColor
        {
            get { return small_vfo_color; }
            set
            {
                small_vfo_color = value;
                if (small_lsd && chkPower.Checked)
                {
                    txtVFOALSD.ForeColor = small_vfo_color;
                    if (chkVFOSplit.Checked)
                        txtVFOBLSD.ForeColor = small_vfo_color;
                }
            }
        }

        private Color info_buttons_color = Color.DarkOrange;
        public Color InfoButtonsColor
        {
            get { return info_buttons_color; }
            set
            {
                info_buttons_color = value;
                lblModeLabel.ForeColor = value;
                lblFilterLabel.ForeColor = value;
            }
        }

        private int default_low_cut = 150;
        public int DefaultLowCut
        {
            get { return default_low_cut; }
            set
            {
                for (DSPMode m = DSPMode.FIRST + 1; m < DSPMode.LAST; m++)
                {
                    for (Filter f = Filter.FIRST + 1; f < Filter.LAST; f++)
                    {
                        int low = rx1_filters[(int)m].GetLow(f);
                        int high = rx1_filters[(int)m].GetHigh(f);

                        switch (m)
                        {
                            case DSPMode.USB:
                                //case DSPMode.DIGU:
                                if (low == default_low_cut)
                                    rx1_filters[(int)m].SetLow(f, value);
                                break;
                            case DSPMode.LSB:
                                //case DSPMode.DIGL:
                                if (high == -default_low_cut)
                                    rx1_filters[(int)m].SetHigh(f, -value);
                                break;
                        }
                    }
                }
                default_low_cut = value;
                RX1Filter = rx1_filter;
            }
        }

        public int CPDRVal
        {
            get
            {
                if (ptbCPDR != null) return ptbCPDR.Value;
                else return -1;
            }
            set
            {
                if (ptbCPDR != null) ptbCPDR.Value = value;
                ptbCPDR_Scroll(this, EventArgs.Empty);
            }
        }

        public int NoiseGate
        {
            get
            {
                if (ptbNoiseGate != null) return ptbNoiseGate.Value;
                else return -1;
            }
            set
            {
                if (ptbNoiseGate != null)
                {
                    if (value > ptbNoiseGate.Maximum) value = ptbNoiseGate.Maximum;
                    ptbNoiseGate.Value = value;
                    ptbNoiseGate_Scroll(this, EventArgs.Empty);
                }
            }
        }

        public int VOXSens
        {
            get
            {
                if (ptbVOX != null) return ptbVOX.Value;
                else return -1;
            }
            set
            {
                if (ptbVOX != null)
                {
                    ptbVOX.Value = value;
                    ptbVOX_Scroll(this, EventArgs.Empty);
                }
            }
        }

        public bool NoiseGateEnabled
        {
            get
            {
                if (chkNoiseGate != null) return chkNoiseGate.Checked;
                else return false;
            }
            set
            {
                if (chkNoiseGate != null) chkNoiseGate.Checked = value;
            }
        }

        public int VACRXGain
        {
            get
            {
                if (ptbVACRXGain != null) return ptbVACRXGain.Value;
                else return -99;
            }
            set
            {
                if (ptbVACRXGain != null)
                {
                    ptbVACRXGain.Value = value;
                    ptbVACRXGain_Scroll(this, EventArgs.Empty);
                }
            }
        }

        public int VACTXGain
        {
            get
            {
                if (ptbVACTXGain != null) return ptbVACTXGain.Value;
                else return -99;
            }
            set
            {
                if (ptbVACTXGain != null)
                {
                    ptbVACTXGain.Value = value;
                    ptbVACTXGain_Scroll(this, EventArgs.Empty);
                }
            }
        }

        public bool BreakInEnabled
        {
            get
            {
                if (chkCWBreakInEnabled != null) return chkCWBreakInEnabled.Checked;
                else return false;
            }
            set
            {
                if (chkCWBreakInEnabled != null) chkCWBreakInEnabled.Checked = value;
            }
        }

        public bool VOXEnable
        {
            get
            {
                if (chkVOX != null) return chkVOX.Checked;
                else return false;
            }
            set
            {
                if (chkVOX != null) chkVOX.Checked = value;
            }
        }

        public int RF
        {
            get
            {
                if (ptbRF != null) return ptbRF.Value;
                else return -1;
            }
            set
            {
                if (ptbRF != null)
                {
                    ptbRF.Value = value;
                    ptbRF_Scroll(this, EventArgs.Empty);
                }
            }
        }

        public int RX2RF
        {
            get
            {
                if (ptbRX2RF != null) return ptbRX2RF.Value;
                else return -1;
            }
            set
            {
                if (ptbRX2RF != null)
                {
                    ptbRX2RF.Value = value;
                    ptbRX2RF_Scroll(this, EventArgs.Empty);
                }
            }
        }

        private bool enable_kb_shortcuts = true;
        public bool EnableKBShortcuts
        {
            get { return enable_kb_shortcuts; }
            set { enable_kb_shortcuts = value; }
        }

        private bool save_filter_changes = false;
        public bool SaveFilterChanges
        {
            get { return save_filter_changes; }
            set { save_filter_changes = value; }
        }

        private int max_filter_shift = 9999;
        public int MaxFilterShift
        {
            get { return max_filter_shift; }
            set
            {
                max_filter_shift = value;
                UpdateRX1Filters(radio.GetDSPRX(0, 0).RXFilterLow, radio.GetDSPRX(0, 0).RXFilterHigh);
            }
        }

        private int max_filter_width = 9999;
        public int MaxFilterWidth
        {
            get { return max_filter_width; }
            set
            {
                max_filter_width = value;
                UpdateRX1Filters(radio.GetDSPRX(0, 0).RXFilterLow, radio.GetDSPRX(0, 0).RXFilterHigh);
            }
        }

        private bool line_in = false;
        public bool LineIn
        {
            get { return line_in; }
            set
            {
                line_in = value;
                SetMicGain();
            }
        }

        private double line_in_boost = 0.0;
        public double LineInBoost
        {
            get { return line_in_boost; }
            set
            {
                line_in_boost = value;
                ptbMic_Scroll(this, EventArgs.Empty);
                SetMicGain();
            }
        }

        private bool mic_boost = false;
        public bool MicBoost
        {
            get { return mic_boost; }
            set
            {
                mic_boost = value;
                ptbMic_Scroll(this, EventArgs.Empty);
                SetMicGain();
            }
        }

        private bool always_on_top = false;
        public bool AlwaysOnTop
        {
            get { return always_on_top; }
            set
            {
                always_on_top = value;
                if (value)
                {
                    Win32.SetWindowPos(this.Handle.ToInt32(),
                        -1, this.Left, this.Top, this.Width, this.Height, 0);
                }
                else
                {
                    Win32.SetWindowPos(this.Handle.ToInt32(),
                        -2, this.Left, this.Top, this.Width, this.Height, 0);
                }
            }
        }

        private bool quick_qsy = true;
        public bool QuickQSY
        {
            get { return quick_qsy; }
            set { quick_qsy = value; }
        }

        public HW Hdw
        {
            set
            {
                hw = value;
                //Keyer.Hdw = value;
            }
            get { return hw; }
        }

        private ColorSheme color_palette = ColorSheme.enhanced;
        public ColorSheme color_sheme
        {
            get { return color_palette; }

            set
            {
                Display.ColorSheme = value;
                //#if DirectX
                //         Display_DirectX.ColorSheme = value;
                //#endif
                color_palette = value;
            }
        }

        public SIOListenerII Siolisten
        {
            get { return siolisten; }
            set
            {
                siolisten = value;
                //Keyer.Siolisten = value;
            }
        }
        public bool HideTuneStep
        {
            get { return txtWheelTune.Visible; }
            set
            {
                if (SetupForm != null)
                    txtWheelTune.Visible = value;
            }
        }

        public string DisplayModeText
        {
            get { return comboDisplayMode.Text; }
            set { comboDisplayMode.Text = value; }
        }

        private bool auto_mute = false;
        public bool AutoMute
        {
            get { return auto_mute; }
            set { auto_mute = value; }
        }

        private float multimeter_avg_mult_old = 1 - (float)1 / 10;
        private float multimeter_avg_mult_new = (float)1 / 10;
        private int multimeter_avg_num_blocks = 10;
        public int MultiMeterAvgBlocks
        {
            get { return multimeter_avg_num_blocks; }
            set
            {
                multimeter_avg_num_blocks = value;
                multimeter_avg_mult_old = 1 - (float)1 / multimeter_avg_num_blocks;
                multimeter_avg_mult_new = (float)1 / multimeter_avg_num_blocks;
            }
        }

        private bool vac_auto_enable = false;
        public bool VACAutoEnable
        {
            get { return vac_auto_enable; }
            set
            {
                vac_auto_enable = value;
                if (SetupForm == null) return;
                if (vac_auto_enable)
                {
                    switch (rx1_dsp_mode)
                    {
                        case DSPMode.DIGL:
                        case DSPMode.DIGU:
                            SetupForm.VACEnable = true;
                            break;
                        default:
                            SetupForm.VACEnable = false;
                            break;
                    }
                }
                else SetupForm.VACEnable = false;
            }
        }

        private float rx1_display_cal_offset;					// display calibration offset per volume setting in dB
        public float RX1DisplayCalOffset
        {
            get { return rx1_display_cal_offset; }
            set
            {
                rx1_display_cal_offset = value;
                //Display.RX1DisplayCalOffset = value;
                UpdateDisplayOffsets();
            }
        }

        private float rx2_display_cal_offset;					// display calibration offset per volume setting in dB
        public float RX2DisplayCalOffset
        {
            get { return rx2_display_cal_offset; }
            set
            {
                rx2_display_cal_offset = value;
                //Display.RX2DisplayCalOffset = value;
                UpdateDisplayOffsets();
            }
        }

        /*  private float tx_display_cal_offset;					// display calibration offset per volume setting in dB
          public float TXDisplayCalOffset
          {
              get { return tx_display_cal_offset; }
              set
              {
                  tx_display_cal_offset = value;
                  //Display.TXDisplayCalOffset = value;
                  UpdateDisplayOffsets();
              }
          } */

        private int display_cursor_x;						// x-coord of the cursor when over the display
        public int DisplayCursorX
        {
            get { return display_cursor_x; }
            set
            {
                display_cursor_x = value;
                Display.DisplayCursorX = value;
            }
        }

        private int display_cursor_y;						// y-coord of the cursor when over the display
        public int DisplayCursorY
        {
            get { return display_cursor_y; }
            set
            {
                display_cursor_y = value;
                Display.DisplayCursorY = value;
            }
        }

        //private bool long_crosshair;						// If true, the long yellow cursors are displayed
        //public bool LongCrosshair
        //{
        //	get { return long_crosshair; }
        //	set { long_crosshair = value; }
        //}

        private ClickTuneMode current_click_tune_mode = ClickTuneMode.Off;
        public ClickTuneMode CurrentClickTuneMode
        {
            get { return current_click_tune_mode; }
            set
            {
                current_click_tune_mode = value;
                Display.CurrentClickTuneMode = value;
            }
        }

        private double freq_center = 0.0;
        public double Freq_Center
        {
            get { return freq_center; }
            set { freq_center = value; }
        }

        private DisplayEngine current_display_engine = DisplayEngine.GDI_PLUS;
        public DisplayEngine CurrentDisplayEngine
        {
            get { return current_display_engine; }
            set
            {
                /*switch(value)
                {
                    case DisplayEngine.GDI_PLUS:
                        current_display_engine = value;
                        Display.DirectXRelease();
                        break;
                    case DisplayEngine.DIRECT_X:
                        Display.DirectXInit();
                        current_display_engine = value;
                        Display.PrepareDisplayVars(Display.CurrentDisplayMode);
                        Display.DrawBackground();
                        break;
                }*/
                Display.CurrentDisplayEngine = value;
            }
        }

        private int digu_click_tune_offset = 1500;
        public int DIGUClickTuneOffset
        {
            get { return digu_click_tune_offset; }
            set
            {
                digu_click_tune_offset = value;
                digu_click_tune_offset = value;
                Filter filter1 = RX1Filter;     // save RX1 filter
                Filter filter2 = RX2Filter;     // save RX2 filter
                //reset preset filter's center frequency - W4TME

                for (Filter f = Filter.F1; f < Filter.LAST; f++)
                {
                    int low = rx1_filters[(int)DSPMode.DIGU].GetLow(f);
                    int high = rx1_filters[(int)DSPMode.DIGU].GetHigh(f);
                    string name = rx1_filters[(int)DSPMode.DIGU].GetName(f);

                    int bw = high - low;
                    low = digu_click_tune_offset - bw / 2;
                    high = digu_click_tune_offset + bw / 2;
                    rx1_filters[(int)DSPMode.DIGU].SetFilter(f, low, high, name);
                    rx2_filters[(int)DSPMode.DIGU].SetFilter(f, low, high, name);
                }
                RX1Filter = filter1;            // restore RX1 filter
                RX2Filter = filter2;            // restore RX2 filter                     
            }
        }

        private int digl_click_tune_offset = 2210;
        public int DIGLClickTuneOffset
        {
            get { return digl_click_tune_offset; }
            set
            {
                digl_click_tune_offset = value;
                Filter filter1 = RX1Filter;     // save RX1 filter
                Filter filter2 = RX2Filter;     // save RX2 filter
                //reset preset filter's center frequency - W4TME

                for (Filter f = Filter.F1; f < Filter.LAST; f++)
                {
                    int low = rx1_filters[(int)DSPMode.DIGL].GetLow(f);
                    int high = rx1_filters[(int)DSPMode.DIGL].GetHigh(f);
                    string name = rx1_filters[(int)DSPMode.DIGL].GetName(f);

                    int bw = high - low;
                    low = -digl_click_tune_offset - bw / 2;
                    high = -digl_click_tune_offset + bw / 2;
                    rx1_filters[(int)DSPMode.DIGL].SetFilter(f, low, high, name);
                    rx2_filters[(int)DSPMode.DIGL].SetFilter(f, low, high, name);
                }
                RX1Filter = filter1;        // restore RX1 filter
                RX2Filter = filter2;        // restore RX2 filter          
            }
        }

        private double vox_hang_time = 250.0;
        public double VOXHangTime
        {
            get { return vox_hang_time; }
            set { vox_hang_time = value; }
        }

        private bool vox_active = false;
        public bool VOXActive
        {
            get { return vox_active; }
            set { vox_active = value; }
        }

        private SoundCard current_soundcard = SoundCard.UNSUPPORTED_CARD;
        public SoundCard CurrentSoundCard
        {
            get { return current_soundcard; }
            set
            {
                current_soundcard = value;
                Audio.CurSoundCard = value;
                if (SetupForm != null && SetupForm.CurrentSoundCard != current_soundcard)
                    SetupForm.CurrentSoundCard = current_soundcard;
            }
        }

        private Model current_model = Model.FLEX5000;
        public Model CurrentModel
        {
            get { return current_model; }
            set
            {
                Model saved_model = current_model;
                if (value == Model.SDR1000 && hw == null)
                {
                    hw = new HW(0x378);
                    hw.USBPresent = usb_present;
                }
                current_model = value;
                Display.CurrentModel = value;
                chkFullDuplex.Visible = false;
                switch (current_model)
                {
                    case Model.FLEX5000:
                        MinFreq = Math.Max(if_freq, 0.0000010);
                        MaxFreq = 65.0;
                        if (!fwc_init)
                        {
                            //fwc_init = FWCMidi.Open();
                            // fwc_init = Pal.Init();
                            if (fwc_init)
                            {
                                FWCEEPROM.Init();
                                FWC.SetPalCallback();
                            }
                        }
                        if (fwc_init)
                        {
                            /*string preamp = comboPreamp.Text;
                            comboPreamp.Items.Clear();
                            comboPreamp.Items.Add("Off");
                            comboPreamp.Items.Add("On");
                            if(preamp == "Off") comboPreamp.Text = "Off";
                            else comboPreamp.Text = "On";*/

                            comboPreamp.Visible = false;
                            //lblPreamp.Visible = false;
                            chkRX1Preamp.Visible = true;
                            chkRX1Preamp_CheckedChanged(this, EventArgs.Empty);

                            if (!comboMeterTXMode.Items.Contains("Ref Pwr"))
                                comboMeterTXMode.Items.Insert(1, "Ref Pwr");
                            if (!comboMeterTXMode.Items.Contains("SWR"))
                                comboMeterTXMode.Items.Insert(2, "SWR");

                            if (comboMeterTXMode.SelectedIndex < 0)
                                comboMeterTXMode.SelectedIndex = 0;

                            chkBCI.Visible = false;
                            chkBCI.Checked = false;

                            FWC.WriteCodecReg(0x1B, 0x02);
                            if (fwcMixForm == null) fwcMixForm = new FWCMixForm(this);
                            if (fwcAntForm == null) fwcAntForm = new FWCAntForm(this);

                            chkFWCATUBypass.Visible = true;
                            bool b;
                            FWC.GetATUOK(out b);
                            if (b)
                            {
                                // mnuATU.Visible = true;
                                if (fwcAtuForm == null) fwcAtuForm = new FWCATUForm(this);
                                chkFWCATU.Enabled = true;
                                chkFWCATU.Text = "ATU";
                                chkFWCATUBypass.Enabled = true;
                                chkFWCATUBypass.Text = "BYP";
                            }
                            else
                            {
                                chkX2TR.Text = "";
                                chkX2TR.Enabled = false;
                            }
                            if (flex5000DebugForm == null) flex5000DebugForm = new FLEX5000DebugForm(this);

                            //chkFullDuplex.Visible = true;
                            panelAntenna.Visible = true;
                        }
                        else
                        {
                            chkPower.Enabled = false;
                        }
                        break;
                    case Model.FLEX3000:
                        MinFreq = Math.Max(if_freq, 0.0000010);
                        MaxFreq = 65.0;
                        FWCDDSClockCorrection = fwc_dds_clock_correction;
                        if (!fwc_init)
                        {
                            //fwc_init = FWCMidi.Open();
                            // fwc_init = Pal.Init();
                            if (fwc_init)
                            {
                                FWCEEPROM.Init();
                                FWC.SetPalCallback();
                            }
                        }
                        if (fwc_init)
                        {
                            comboPreamp.Visible = true;
                            chkRX1Preamp.Visible = false;
                            lblPreamp.Text = "RX Gain";
                            string preamp = comboPreamp.Text;
                            comboPreamp.Items.Clear();
                            comboPreamp.Items.Add("Attn");
                            comboPreamp.Items.Add("Off");
                            comboPreamp.Items.Add("Pre1");
                            comboPreamp.Items.Add("Pre2");
                            comboPreamp.Text = preamp;
                            if (comboPreamp.SelectedIndex < 0)
                                comboPreamp.SelectedIndex = 1;
                            //comboPreamp_SelectedIndexChanged(this, EventArgs.Empty);

                            if (!comboMeterTXMode.Items.Contains("Ref Pwr"))
                                comboMeterTXMode.Items.Insert(1, "Ref Pwr");
                            if (!comboMeterTXMode.Items.Contains("SWR"))
                                comboMeterTXMode.Items.Insert(2, "SWR");

                            if (comboMeterTXMode.SelectedIndex < 0)
                                comboMeterTXMode.SelectedIndex = 0;

                            chkBCI.Visible = false;
                            chkBCI.Checked = false;

                            FWC.WriteCodecReg(0x1B, 0x02);
                            //if(fwcMixForm == null) fwcMixForm = new FWCMixForm(this);
                            if (flex3000MixerForm == null) flex3000MixerForm = new FLEX3000MixerForm(this);
                            //if(fwcAntForm == null) fwcAntForm = new FWCAntForm(this);

                            chkFWCATUBypass.Visible = true;

                            //  mnuATU.Visible = false;
                            if (flex3000ATUForm == null) flex3000ATUForm = new FLEX3000ATUForm(this);
                            chkFWCATU.Enabled = true;
                            chkFWCATU.Text = "ATU";
                            chkFWCATUBypass.Enabled = true;
                            chkFWCATUBypass.Text = "BYP";

                            chkX2TR.Text = "";
                            chkX2TR.Enabled = false;

                            if (flex5000DebugForm == null) flex5000DebugForm = new FLEX5000DebugForm(this);

                            //chkFullDuplex.Visible = true;
                            panelAntenna.Visible = false;

                            /*if(fwcTestForm == null || fwcTestForm.IsDisposed)
                                fwcTestForm = new FWCTestForm(this);
                            fwcTestForm.Show();*/
                        }
                        else
                        {
                            chkPower.Enabled = false;
                        }
                        break;
                    case Model.SDR1000:
                        MinFreq = Math.Max(if_freq, 0.0000010);
                        if (XVTRPresent)
                            MaxFreq = 146.0;
                        else MaxFreq = 65.0;
                        comboPreamp.Items.Clear();
                        comboPreamp.Items.Add("Off");
                        comboPreamp.Items.Add("Low");
                        comboPreamp.Items.Add("Med");
                        comboPreamp.Items.Add("High");
                        comboPreamp.Visible = true;
                        //lblPreamp.Visible = true;
                        chkRX1Preamp.Visible = false;
                        comboPreamp_SelectedIndexChanged(this, EventArgs.Empty);

                        chkBCI.Visible = false;
                        //mnuFWC.Visible = false;
                        panelAntenna.Visible = false;
                        chkFWCATU.Visible = false;
                        chkFWCATUBypass.Visible = false;
                        break;

                    case Model.HPSDR:
                    case Model.HERMES:
                        MinFreq = 0.000000;
                        MaxFreq = 61.0;
                        SetComboPreampForHPSDR();
                        comboPreamp.Text = "0dB";
                        chkBCI.Visible = false;
                        chkFWCATU.Visible = false;
                        chkFWCATUBypass.Visible = true;
                        panelAntenna.Visible = false;
                        chkX2TR.Visible = false;

                        int hermes_power_enable;
                        if (current_model == Model.HERMES || PennyLanePresent)
                        {
                            hermes_power_enable = 1;
                        }
                        else
                        {
                            hermes_power_enable = 0;
                        }
                        JanusAudio.EnableHermesPower(hermes_power_enable);
                        break;

                    case Model.SOFTROCK40:
                        if (si570_used) // modif F8CHK
                        {
                            MinFreq = Math.Max(if_freq, 0.0000010);
                            MaxFreq = 65.0;
                        }
                        else
                        {
                            MinFreq = soft_rock_center_freq - sample_rate1 / 2 * 0.0000010;
                            MaxFreq = soft_rock_center_freq + sample_rate1 / 2 * 0.0000010;
                        }
                        //mnuFWC.Visible = false;
                        panelAntenna.Visible = false;
                        chkFWCATU.Visible = false;
                        chkFWCATUBypass.Visible = false;
                        break;
                    case Model.DEMO:
                        MinFreq = Math.Max(if_freq, 0.000001);
                        if (XVTRPresent)
                            MaxFreq = 146.0;
                        else MaxFreq = 65.0;
                        //mnuFWC.Visible = false;
                        panelAntenna.Visible = false;
                        chkFWCATU.Visible = false;
                        chkFWCATUBypass.Visible = false;
                        break;
                }
                if (SetupForm != null && saved_model != current_model)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private DateTimeMode current_datetime_mode = DateTimeMode.LOCAL;
        public DateTimeMode CurrentDateTimeMode
        {
            get { return current_datetime_mode; }
            set
            {
                current_datetime_mode = value;
                if (current_datetime_mode == DateTimeMode.OFF)
                {
                    panelDateTime.Text = "Date/Time - Off";
                    timer_clock.Enabled = false;
                    txtDate.Text = "";
                    txtTime.Text = "";
                }
                else
                {
                    if (panelDateTime.Text != "Date/Time")
                        panelDateTime.Text = "Date/Time";
                    if (!timer_clock.Enabled)
                        timer_clock.Enabled = true;
                }
            }
        }

        private double soft_rock_center_freq = 7.056;
        public double SoftRockCenterFreq
        {
            get { return soft_rock_center_freq; }
            set
            {
                soft_rock_center_freq = value;
                if (current_model == Model.SOFTROCK40 && !si570_used)  // modif F8CHK
                {
                    MinFreq = soft_rock_center_freq - sample_rate1 / 2 * 0.0000010;
                    MaxFreq = soft_rock_center_freq + sample_rate1 / 2 * 0.0000010;
                    if (SetupForm != null)
                        txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                }
            }
        }

        private int alex_preamp_offset = 0;
        public int AlexPreampOffset
        {
            get { return alex_preamp_offset; }
            set
            {
                alex_preamp_offset = value;
                Display.AlexPreampOffset = alex_preamp_offset;
            }
        }


        private double saved_vfoa_freq = 7.0;
        /*		public float SavedVFOAFreq
                {
                    get { return saved_vfoa_freq; }
                    set { saved_vfoa_freq = value; }
                }
        */

        private double saved_vfoa_sub_freq = 7.0;

        private double saved_vfob_freq = 7.0;
        /*		public float SavedVFOBFreq
                {
                    get { return saved_vfob_freq; }
                    set { saved_vfob_freq = value; }
                }
        */

        private bool ext_ctrl_enabled = false;
        public bool ExtCtrlEnabled
        {
            get { return ext_ctrl_enabled; }
            set { ext_ctrl_enabled = value; }
        }

        private bool penny_ext_ctrl_enabled = false;
        public bool PennyExtCtrlEnabled
        {
            get { return penny_ext_ctrl_enabled; }
            set
            {
                Band lo_band = Band.FIRST;
                penny_ext_ctrl_enabled = value;

                if (rx1_xvtr_index >= 0)
                {
                    //lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), -1, false, current_region);
                    // Fix Penny O/C VHF control Vk4xv
                    lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), rx1_xvtr_index, false, current_region);

                    // if (penny_ext_ctrl_enabled)
                    // Penny.getPenny().UpdateExtCtrl(lo_band, mox);
                    Penny.getPenny().ExtCtrlEnable(value, lo_band, mox);
                    // if (alex_ant_ctrl_enabled)
                    //  Alex.getAlex().UpdateAlexAntSelection(lo_band, mox);
                }
                else
                {
                    //  if (penny_ext_ctrl_enabled)
                    //  Penny.getPenny().UpdateExtCtrl(RX1Band, mox);
                    Penny.getPenny().ExtCtrlEnable(value, RX1Band, mox);
                    // if (alex_ant_ctrl_enabled)
                    //Alex.getAlex().UpdateAlexAntSelection(RX1Band, mox);
                }

                //  Penny.getPenny().ExtCtrlEnable(value, RX1Band, mox);
            }
        }

        private bool alex_ant_ctrl_enabled = false;
        public bool AlexAntCtrlEnabled
        {
            get { return alex_ant_ctrl_enabled; }
            set
            {
                Band lo_band = Band.FIRST;
                alex_ant_ctrl_enabled = value;

                if (rx1_xvtr_index >= 0)
                {
                    // Fix Penny O/C VHF control Vk4xv
                    lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), rx1_xvtr_index, false, current_region);
                    //lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), -1, false, current_region);

                    // if (penny_ext_ctrl_enabled)
                    //   Penny.getPenny().UpdateExtCtrl(lo_band, mox);

                    // if (alex_ant_ctrl_enabled)
                    Alex.getAlex().UpdateAlexAntSelection(lo_band, mox, alex_ant_ctrl_enabled);
                }
                else
                {
                    // if (penny_ext_ctrl_enabled)
                    //   Penny.getPenny().UpdateExtCtrl(RX1Band, mox);

                    //  if (alex_ant_ctrl_enabled)
                    Alex.getAlex().UpdateAlexAntSelection(RX1Band, mox, alex_ant_ctrl_enabled);
                }
            }
        }

        private bool cw_semi_break_in_enabled = true;
        public bool CWSemiBreakInEnabled
        {
            get { return cw_semi_break_in_enabled; }
            set { cw_semi_break_in_enabled = value; }
        }

        private bool cw_sidetone = true;
        public bool CWSidetone
        {
            get { return cw_sidetone; }
            set
            {
                cw_sidetone = value;
                if (chkCWSidetone != null) chkCWSidetone.Checked = value;

                DSPMode tx_mode = rx1_dsp_mode;
                if (chkVFOBTX.Checked && chkRX2.Checked) tx_mode = rx2_dsp_mode;

                if (tx_mode == DSPMode.CWL || tx_mode == DSPMode.CWU)
                    chkMON.Checked = value;
            }
        }

        public float RX1FilterSizeCalOffset
        {
            get { return rx1_filter_size_cal_offset; }
            set { rx1_filter_size_cal_offset = value; }
        }

        public float RX2FilterSizeCalOffset
        {
            get { return rx2_filter_size_cal_offset; }
            set { rx2_filter_size_cal_offset = value; }
        }

        private PTTMode current_ptt_mode = PTTMode.NONE;
        public PTTMode CurrentPTTMode
        {
            get { return current_ptt_mode; }
            set { current_ptt_mode = value; }
        }

        #region X2 Properties

        private byte x2_160_rx = 0;
        public byte X2160RX
        {
            get { return x2_160_rx; }
            set
            {
                x2_160_rx = value;
                if (tx_band == Band.B160M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_160_tx = 0;
        public byte X2160TX
        {
            get { return x2_160_tx; }
            set
            {
                x2_160_tx = value;
                if (tx_band == Band.B160M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_80_rx = 0;
        public byte X280RX
        {
            get { return x2_80_rx; }
            set
            {
                x2_80_rx = value;
                if (tx_band == Band.B80M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_80_tx = 0;
        public byte X280TX
        {
            get { return x2_80_tx; }
            set
            {
                x2_80_tx = value;
                if (tx_band == Band.B80M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_60_rx = 0;
        public byte X260RX
        {
            get { return x2_60_rx; }
            set
            {
                x2_60_rx = value;
                if (tx_band == Band.B60M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_60_tx = 0;
        public byte X260TX
        {
            get { return x2_60_tx; }
            set
            {
                x2_60_tx = value;
                if (tx_band == Band.B60M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_40_rx = 0;
        public byte X240RX
        {
            get { return x2_40_rx; }
            set
            {
                x2_40_rx = value;
                if (tx_band == Band.B40M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_40_tx = 0;
        public byte X240TX
        {
            get { return x2_40_tx; }
            set
            {
                x2_40_tx = value;
                if (tx_band == Band.B40M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_30_rx = 0;
        public byte X230RX
        {
            get { return x2_30_rx; }
            set
            {
                x2_30_rx = value;
                if (tx_band == Band.B30M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_30_tx = 0;
        public byte X230TX
        {
            get { return x2_30_tx; }
            set
            {
                x2_30_tx = value;
                if (tx_band == Band.B30M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_20_rx = 0;
        public byte X220RX
        {
            get { return x2_20_rx; }
            set
            {
                x2_20_rx = value;
                if (tx_band == Band.B20M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_20_tx = 0;
        public byte X220TX
        {
            get { return x2_20_tx; }
            set
            {
                x2_20_tx = value;
                if (tx_band == Band.B20M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_17_rx = 0;
        public byte X217RX
        {
            get { return x2_17_rx; }
            set
            {
                x2_17_rx = value;
                if (tx_band == Band.B17M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_17_tx = 0;
        public byte X217TX
        {
            get { return x2_17_tx; }
            set
            {
                x2_17_tx = value;
                if (tx_band == Band.B17M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_15_rx = 0;
        public byte X215RX
        {
            get { return x2_15_rx; }
            set
            {
                x2_15_rx = value;
                if (tx_band == Band.B15M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_15_tx = 0;
        public byte X215TX
        {
            get { return x2_15_tx; }
            set
            {
                x2_15_tx = value;
                if (tx_band == Band.B15M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_12_rx = 0;
        public byte X212RX
        {
            get { return x2_12_rx; }
            set
            {
                x2_12_rx = value;
                if (tx_band == Band.B12M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_12_tx = 0;
        public byte X212TX
        {
            get { return x2_12_tx; }
            set
            {
                x2_12_tx = value;
                if (tx_band == Band.B12M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_10_rx = 0;
        public byte X210RX
        {
            get { return x2_10_rx; }
            set
            {
                x2_10_rx = value;
                if (tx_band == Band.B10M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_10_tx = 0;
        public byte X210TX
        {
            get { return x2_10_tx; }
            set
            {
                x2_10_tx = value;
                if (tx_band == Band.B10M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_6_rx = 0;
        public byte X26RX
        {
            get { return x2_6_rx; }
            set
            {
                x2_6_rx = value;
                if (tx_band == Band.B6M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_6_tx = 0;
        public byte X26TX
        {
            get { return x2_6_tx; }
            set
            {
                x2_6_tx = value;
                if (tx_band == Band.B6M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_2_rx = 0;
        public byte X22RX
        {
            get { return x2_2_rx; }
            set
            {
                x2_2_rx = value;
                if (tx_band == Band.B2M && !mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private byte x2_2_tx = 0;
        public byte X22TX
        {
            get { return x2_2_tx; }
            set
            {
                x2_2_tx = value;
                if (tx_band == Band.B2M && mox)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        #endregion

        private bool vfo_lock = false;
        public bool VFOLock
        {
            get { return vfo_lock; }
            set
            {
                vfo_lock = value;
                bool enabled = !value;
                txtVFOAFreq.Enabled = enabled;
                radBand160.Enabled = enabled;
                radBand80.Enabled = enabled;
                radBand60.Enabled = enabled;
                radBand40.Enabled = enabled;
                radBand30.Enabled = enabled;
                radBand20.Enabled = enabled;
                radBand17.Enabled = enabled;
                radBand15.Enabled = enabled;
                radBand12.Enabled = enabled;
                radBand10.Enabled = enabled;
                radBand6.Enabled = enabled;
                radBand2.Enabled = enabled;
                radBandWWV.Enabled = enabled;
                radBandGEN.Enabled = enabled;

                btnBandVHF.Enabled = enabled;
                radBandVHF0.Enabled = enabled;
                radBandVHF1.Enabled = enabled;
                radBandVHF2.Enabled = enabled;
                radBandVHF3.Enabled = enabled;
                radBandVHF4.Enabled = enabled;
                radBandVHF5.Enabled = enabled;
                radBandVHF6.Enabled = enabled;
                radBandVHF7.Enabled = enabled;
                radBandVHF8.Enabled = enabled;
                radBandVHF5.Enabled = enabled;
                radBandVHF9.Enabled = enabled;
                radBandVHF10.Enabled = enabled;
                radBandVHF11.Enabled = enabled;
                radBandVHF12.Enabled = enabled;
                radBandVHF13.Enabled = enabled;

                radModeLSB.Enabled = enabled;
                radModeUSB.Enabled = enabled;
                radModeDSB.Enabled = enabled;
                radModeCWL.Enabled = enabled;
                radModeCWU.Enabled = enabled;
                radModeFMN.Enabled = enabled;
                radModeAM.Enabled = enabled;
                radModeSAM.Enabled = enabled;
                radModeSPEC.Enabled = enabled;
                radModeDIGL.Enabled = enabled;
                radModeDIGU.Enabled = enabled;
                radModeDRM.Enabled = enabled;

                btnVFOBtoA.Enabled = enabled;
                btnVFOSwap.Enabled = enabled;

                btnMemoryQuickRestore.Enabled = enabled;
            }
        }

        private double wave_freq = 0.0;
        private bool wave_playback = false;
        public bool WavePlayback
        {
            get { return wave_playback; }
            set
            {
                wave_playback = value;
                if (wave_playback)
                {
                    wave_freq = (VFOAFreq * 1000000.0) % sample_rate1;
                }
                else
                {
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                }
            }
        }

        private bool rx_only = false;
        public bool RXOnly
        {
            get { return rx_only; }
            set
            {
                rx_only = value;
                if (rx1_dsp_mode != DSPMode.SPEC &&
                    rx1_dsp_mode != DSPMode.DRM &&
                    chkPower.Checked)
                    chkMOX.Enabled = !rx_only;
                chkTUN.Enabled = !rx_only;
                chkVOX.Enabled = !rx_only;
                if (rx_only && chkMOX.Checked)
                    chkMOX.Checked = false;
            }
        }

        private XVTRTRMode current_xvtr_tr_mode = XVTRTRMode.NEGATIVE;
        public XVTRTRMode CurrentXVTRTRMode
        {
            get { return current_xvtr_tr_mode; }
            set
            {
                //if (current_model != Model.SDR1000) return;//w5wc
                current_xvtr_tr_mode = value;
                switch (current_xvtr_tr_mode)
                {
                    case XVTRTRMode.NEGATIVE:
                        Hdw.XVTR_TR = true;			// Set to receive
                        break;
                    case XVTRTRMode.POSITIVE:
                        Hdw.XVTR_TR = false;			// Set to receive
                        break;
                    case XVTRTRMode.NONE:
                        Hdw.XVTR_TR = false;
                        break;
                }
            }
        }

        private double dds_step_size = 200.0 / 0xFFFFFFFFFFFF;
        private double corrected_dds_clock = 200.0;
        private double dds_clock_correction = 0.0;
        public double DDSClockCorrection
        {
            get { return dds_clock_correction; }
            set
            {
                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                {
                    FWCDDSClockCorrection = value;
                }
                else
                {
                    dds_clock_correction = value;
                    if (ModelIsHPSDRorHermes())
                    {
                        corrected_dds_clock = 122.88;
                    }
                    else
                    {
                        corrected_dds_clock = 200.0 + dds_clock_correction;
                    }
                    dds_step_size = corrected_dds_clock / 0xFFFFFFFFFFFF;
                    DDSFreq = dds_freq;
                }
            }
        }

        private double fwc_dds_step_size = 500.0 / 0xFFFFFFFF;
        private double fwc_corrected_dds_clock = 500.0;
        private double fwc_dds_clock_correction = 0.0;
        public double FWCDDSClockCorrection
        {
            get { return fwc_dds_clock_correction; }
            set
            {
                double clock = 500.0;
                switch (current_model)
                {
                    case Model.FLEX3000:
                        clock = 499.201;
                        break;
                    case Model.FLEX5000:
                        clock = 500.0;
                        break;
                }

                fwc_dds_clock_correction = value;
                fwc_corrected_dds_clock = clock + fwc_dds_clock_correction;
                fwc_dds_step_size = fwc_corrected_dds_clock / 0xFFFFFFFF;
                if (SetupForm != null)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        /*private double rx2_dds_step_size = 500.0 / 0xFFFFFFFF;
        private double rx2_corrected_dds_clock = 500.0;
        private double rx2_dds_clock_correction = 0.0;
        public double RX2DDSClockCorrection
        {
            get	{ return rx2_dds_clock_correction; }
            set
            {
                rx2_dds_clock_correction = value;
                rx2_corrected_dds_clock = 500.0 + rx2_dds_clock_correction;
                rx2_dds_step_size = rx2_corrected_dds_clock / 0xFFFFFFFF;
                RX2DDSFreq = rx2_dds_freq;
            }
        }*/

        private FRSRegion current_region;// = FRSRegion.US; //w5wc
          public FRSRegion CurrentRegion
        {
            get { return current_region; }
            set { current_region = value; }
        }

        private bool spur_reduction = true;
        public bool SpurReduction
        {
            get { return spur_reduction; }
            set
            {
                spur_reduction = value;
                // if (SetupForm != null) txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                // chkSR.Checked = value;
            }
        }

        private bool rx2_spur_reduction = true;
        public bool RX2SpurReduction
        {
            get { return rx2_spur_reduction; }
            set
            {
                rx2_spur_reduction = value;
                if (SetupForm != null && rx2_enabled)
                    txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                chkRX2SR.Checked = value;
                //  if (!rx2_spur_reduction) rx2_last_tw = 0;
            }
        }

        private long Freq2TW(double freq)
        {
            long tw = 0;
            switch (current_model)
            {
                case Model.HPSDR:
                case Model.HERMES:
                case Model.SDR1000:
                    tw = (long)(0xFFFFFFFFFFFF * freq / corrected_dds_clock);
                    break;
                case Model.FLEX3000:
                case Model.FLEX5000:
                    tw = (long)(0xFFFFFFFF * freq / fwc_corrected_dds_clock);
                    break;
            }
            return tw;
        }

        public double TW2Freq(long tw)
        {
            double freq = 0.0;
            switch (current_model)
            {
                case Model.HPSDR:
                case Model.HERMES:
                case Model.SDR1000:
                    freq = tw * corrected_dds_clock / 0xFFFFFFFFFFFF;
                    break;
                case Model.FLEX3000:
                case Model.FLEX5000:
                    freq = tw * fwc_corrected_dds_clock / 0xFFFFFFFF;
                    break;


            }
            return freq;
        }

        bool rx1_dds_freq_updated = false;
        // uint rx1_dds_freq_tw;
        double rx1_dds_freq_mhz;
        private void UpdateRX1DDSFreq()
        {
            // while (chkPower.Checked)
            // {
            // if (rx1_dds_freq_updated)
            {
                rx1_dds_freq_updated = false;
                JanusAudio.SetVFOfreq(rx1_dds_freq_mhz);
                if (chkPower.Checked)
                {
                    // if (SetupForm.radAlexManualCntl.Checked)
                    // SetHWFilters(fwc_dds_freq);
                    SetAlexRXFilters(fwc_dds_freq);

                    /*  if (alexpresent && (rx1_dds_freq_mhz >= 50.0) ||
                          (SetupForm.rad6BPFled.Checked))
                          AlexPreampOffset = 23;
                      else
                          AlexPreampOffset = 0; */
                }

            }
        }

        bool rx2_dds_freq_updated = false;
        uint rx2_dds_freq_tw;
        float rx2_dds_freq_mhz;
        private void UpdateRX2DDSFreq()
        {
            while (chkPower.Checked)
            {
                if (rx2_dds_freq_updated)
                {
                    rx2_dds_freq_updated = false;
                    FWC.SetRX2FreqTW(rx2_dds_freq_tw, rx2_dds_freq_mhz);
                }
                else Thread.Sleep(100);
            }
        }

        bool tx_dds_freq_updated = false;
        // uint tx_dds_freq_tw;
        double tx_dds_freq_mhz = 7.1;
        private void UpdateTXDDSFreq()
        {

            if (chkPower.Checked) // && tx_dds_freq_updated)
            {
                if ((chkVFOSplit.Checked || chkVFOBTX.Checked) && !mox) SetAlexTXFilters(rx1_dds_freq_mhz);
                else SetAlexTXFilters(tx_dds_freq_mhz);

                JanusAudio.SetVFOfreqTX(tx_dds_freq_mhz);
                tx_dds_freq_updated = false;

                //System.Console.WriteLine("CUpdatetxvfo: " + tx_dds_freq_mhz);
            }
        }

        private uint last_tw = 0;
        private double fwc_dds_freq = 7.1;
        public double FWCDDSFreq
        {
            get { return fwc_dds_freq; }
            set
            {
                fwc_dds_freq = value;

                double f = fwc_dds_freq + vfo_offset;
                rx1_dds_freq_mhz = f;
                rx1_dds_freq_updated = true;
                // radio.GetDSPRX(0, 0).RXOsc = 0.0;
                UpdateRX1DDSFreq();
                // System.Console.WriteLine("rx1dds: " + rx1_dds_freq_mhz);
            }
        }

        private double rx2_dds_freq = 7.1;
        public double RX2DDSFreq
        {
            get { return rx2_dds_freq; }
            set
            {
                rx2_dds_freq = value;

                if (rx2_spur_reduction)
                {
                    double f = rx2_dds_freq + rx2_vfo_offset;
                    if (rx2_if_shift) f -= rx2_if_freq;
                    uint tw = (uint)Freq2TW(f); //Debug.WriteLine("tw: "+tw.ToString("X"));
                    uint sr_tw = tw & 0xFFFF0000;
                    double dsp_osc_freq = (double)(1000000.0 * ((tw - sr_tw) * fwc_dds_step_size));
                    if (rx2_if_shift) radio.GetDSPRX(1, 0).RXOsc = -dsp_osc_freq - rx2_if_freq * 1000000.0 + rx2_vfo_offset;
                    else radio.GetDSPRX(1, 0).RXOsc = -dsp_osc_freq + rx2_vfo_offset;

                }
                else
                {
                    if (fwc_init)
                    {
                        switch (current_model)
                        {
                            /*case Model.SDRX:
                                FWC.SetDDSFreq(fwc_index, (float)fwc_dds_freq-(float)if_freq);
                                break;*/
                            case Model.FLEX5000:
                                double f = rx2_dds_freq + rx2_vfo_offset;
                                if (rx2_if_shift) f -= rx2_if_freq;
                                uint tw = (uint)Freq2TW(f);
                                //FWC.SetRX2FreqTW(tw, (float)f);
                                rx2_dds_freq_tw = tw;
                                rx2_dds_freq_mhz = (float)f;
                                rx2_dds_freq_updated = true;
                                break;
                        }
                        wbir_rx2_tuned = true;
                    }

                    if (rx2_if_shift)
                        radio.GetDSPRX(1, 0).RXOsc = -rx2_if_freq * 1000000.0;
                    else
                        radio.GetDSPRX(1, 0).RXOsc = 0.0;
                    last_tw = 0;
                    //Debug.WriteLine("dds: "+fwc_dds_freq.ToString("f6")+" osc: "+(-if_freq*1000000).ToString("f6")+" total: "+(fwc_dds_freq+if_freq).ToString("f6"));
                }
            }
        }

        private double dds_freq = 7.1;
        public double DDSFreq
        {
            get { return dds_freq; }
            set
            {
                dds_freq = value;
                //Debug.WriteLine("dds_freq: "+dds_freq.ToString("f6"));

                double vfoFreq = value, f = value;
                double dsp_osc_freq = 0.0;

                //calculate DDS Tuning Word
                if (xvtr_present && f >= 144 && f <= 146)		// If transverter enabled compute 28MHz IF frequency
                    f -= 116;									// Subtract 116MHz (144-28) from VFO display frequency

                //if(if_shift) 
                //{
                //	f -= if_freq;								// adjust for IF shift
                //	dsp_osc_freq = -if_freq * 1000000.0;
                //}

                f += vfo_offset;								// adjust for vfo offset
                /*if(mox && current_dsp_mode == DSPMode.DRM)
                    f -= 0.008;*/
                //long tuning_word = (long)(f / corrected_dds_clock * Math.Pow(2, 48));
                // long tuning_word = (long)(0xFFFFFFFFFFFF * f / corrected_dds_clock);

                //  if (spur_reduction)
                //    {
                //  long sr_tuning_word = tuning_word &		// start with current tuning word
                //   ~(0x8000ffffffff);	// clear first bit, low 32 bits

                //   double software_offset = (sr_tuning_word - tuning_word) * dds_step_size;
                //    dsp_osc_freq += 1000000.0 * software_offset;

                //   tuning_word = sr_tuning_word;
                //  }

                /* if (!mox && current_click_tune_mode == ClickTuneMode.VFOA)
                 {
                     //dsp_osc_freq = (int)(((vfoFreq * 1000000.0) - freq_center));
                     dsp_osc_freq = (int)((freq_center - (vfoFreq * 1000000.0)));
                 }*/

                // if (!mox)
                //  radio.GetDSPRX(0, 0).RXOsc = dsp_osc_freq;

                // if (current_click_tune_mode != ClickTuneMode.VFOA)
                // {
                /*  if (PowerOn && ModelIsHPSDRorHermes())
                  {
                        JanusAudio.SetVFOfreq(f);
                        if (mox) JanusAudio.SetVFOfreqTX(f);
                        if (SetupForm.radAlexManualCntl.Checked)
                            SetHWFilters(f);

                        if (alexpresent && SetupForm.radAlexAutoCntl.Checked && (f >= 50.0) ||
                            (SetupForm.rad6BPFled.Checked))
                            AlexPreampOffset = 23;
                        else
                            AlexPreampOffset = 0; 
                  }
                  else
                  {
                      Hdw.DDSTuningWord = tuning_word;
                      SetHWFilters(dds_freq);
                  }*/
                //  }
                //if(PowerOn)
                // SetupForm.textBoxTS5.Text = freq_center.ToString();
                /*   if (!mox && current_click_tune_mode == ClickTuneMode.VFOA)
                   {
                       //dsp_osc_freq = (int)(((vfoFreq * 1000000.0) - freq_center));
                       dsp_osc_freq = (int)((freq_center - (vfoFreq * 1000000.0)));
                   }
                
                   if (!mox) 
                       radio.GetDSPRX(0, 0).RXOsc = dsp_osc_freq;*/

                // if (PowerOn)
                //  {
                //SetupForm.textBoxTS10.Text = dsp_osc_freq.ToString();
                //SetupForm.textBoxTS1.Text = freq_center.ToString();
                //SetupForm.textBoxTS2.Text = vfoFreq.ToString();
                // SetupForm.textBoxTS9.Text = dsp_osc_freq.ToString();
                // }
            }
        }

        public double TuningWordToFreq(long word)
        {
            return word * corrected_dds_clock / Math.Pow(2, 48);
        }

        private double min_freq = 0.0;
        public double MinFreq
        {
            get { return min_freq; }
            set
            {
                min_freq = value;
                if (VFOAFreq < min_freq)
                    VFOAFreq = min_freq;
            }
        }

        private double max_freq = 61.44;
        public double MaxFreq
        {
            get { return max_freq; }
            set
            {
                max_freq = value;

                if (SetupForm == null) return;
                if (VFOAFreq > max_freq && rx1_xvtr_index < 0)
                    VFOAFreq = max_freq;
            }
        }

        private double vfo_offset = 0.0;
        public double VFOOffset
        {
            get { return vfo_offset; }
            set { vfo_offset = value; }
        }

        private double rx2_vfo_offset = 0.0;
        public double RX2VFOOffset
        {
            get { return rx2_vfo_offset; }
            set { rx2_vfo_offset = value; }
        }

        private double if_freq = 0.0;
        //private double if_freq = 0.000001;
        public double IFFreq
        {
            get { return if_freq; }
            set
            {
                if_freq = value;
                if (SetupForm != null)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                ptbDisplayPan_Scroll(this, EventArgs.Empty);
            }
        }

        private double rx2_if_freq = 0.009000;
        public double RX2IFFreq
        {
            get { return rx2_if_freq; }
            set
            {
                rx2_if_freq = value;
                if (SetupForm != null && rx2_enabled)
                    txtVFOBFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private bool if_shift = false;
        public bool IFShift
        {
            get { return if_shift; }
            set { if_shift = value; }
        }

        private bool rx2_if_shift = true;
        public bool RX2IFShift
        {
            get { return rx2_if_shift; }
            set { rx2_if_shift = value; }
        }

        private bool extended = false;
        public bool Extended
        {
            get { return extended; }
            set { extended = value; }
        }

        private bool enable_LPF0 = false;
        public bool EnableLPF0
        {
            get { return enable_LPF0; }
            set { enable_LPF0 = value; }
        }

        private int latch_delay = 0;
        public int LatchDelay
        {
            get { return latch_delay; }
            set { latch_delay = value; }
        }

        private bool x2_enabled = false;
        public bool X2Enabled
        {
            get { return x2_enabled; }
            set
            {
                x2_enabled = value;
                X2TR = value;
                //if (current_model == Model.SDR1000) //w5wc
                {
                    if (value && mox)
                        Hdw.X2 |= 0x40;
                    else Hdw.X2 &= 0xBF;
                }
            }
        }

        private int x2_delay = 500;
        public int X2Delay
        {
            get { return x2_delay; }
            set { x2_delay = value; }
        }

        public bool CPDR
        {
            get { return chkCPDR.Checked; }
            set
            {
                if (SetupForm == null)
                    return;

                chkCPDR.Checked = value;
            }
        }

        public int CPDRLevel
        {
            get { return ptbCPDR.Value; }
            set
            {
                if (SetupForm == null) return;
                ptbCPDR.Value = value;
                ptbCPDR_Scroll(this, EventArgs.Empty);
            }
        }

        public int Mic
        {
            get { return ptbMic.Value; }
            set
            {
                if (SetupForm == null)
                    return;

                ptbMic.Value = value;
                ptbMic_Scroll(this, EventArgs.Empty);
            }
        }

        #region CAT Properties

        // props for cat control 

        public double CATVFOA
        {
            get { return saved_vfoa_freq; }
        }

        public double CATVFOB
        {
            get { return saved_vfob_freq; }
        }

        public int CATTXProfileCount
        {
            get
            {
                return comboTXProfile.Items.Count;
            }
        }

        public int CATTXProfile
        {
            get
            {
                return comboTXProfile.SelectedIndex;
            }
            set
            {
                comboTXProfile.SelectedIndex = value;
            }
        }

        public string CATPanSwap
        {
            get
            {
                if (chkPanSwap.Checked)
                    return "1";
                else
                    return "0";
            }
            set
            {
                if (value == "1")
                    chkPanSwap.Checked = true;
                else
                    chkPanSwap.Checked = false;
            }
        }

        public string CATPhoneDX
        {
            get
            {
                if (chkDX.Checked)
                    return "1";
                else
                    return "0";
            }
            set
            {
                if (value == "1")
                    chkDX.Checked = true;
                else
                    chkDX.Checked = false;
            }
        }

        public string CATMultRX
        {
            get
            {
                if (chkEnableMultiRX.Checked)
                    return "1";
                else
                    return "0";
            }
            set
            {
                if (value == "1")
                    chkEnableMultiRX.Checked = true;
                else
                    chkEnableMultiRX.Checked = false;
            }

        }

        public string CATRXEQ
        {
            get
            {
                if (chkRXEQ.Checked)
                    return "1";
                else
                    return "0";
            }
            set
            {
                if (value == "1")
                    chkRXEQ.Checked = true;
                else
                    chkRXEQ.Checked = false;
            }
        }

        public string CATTXEQ
        {
            get
            {
                if (chkTXEQ.Checked)
                    return "1";
                else
                    return "0";
            }
            set
            {
                if (value == "1")
                    chkTXEQ.Checked = true;
                else
                    chkTXEQ.Checked = false;
            }
        }

        public string CATDispPeak
        {
            get
            {
                if (chkDisplayPeak.Checked)
                    return "1";
                else
                    return "0";
            }
            set
            {
                if (value == "1")
                    chkDisplayPeak.Checked = true;
                else
                    chkDisplayPeak.Checked = false;
            }

        }

        public string CATDispCenter
        {
            set
            {
                btnDisplayPanCenter.PerformClick();
            }
        }

        public string CATDispZoom
        {
            set
            {
                switch (value)
                {
                    case "0":
                        radDisplayZoom05.PerformClick();
                        break;
                    case "1":
                        radDisplayZoom1x.PerformClick();
                        break;
                    case "2":
                        radDisplayZoom2x.PerformClick();
                        break;
                    case "3":
                        radDisplayZoom4x.PerformClick();
                        break;
                    default:
                        radDisplayZoom1x.PerformClick();
                        break;
                }
            }

            get
            {
                if (radDisplayZoom05.Checked)
                    return "0";
                else if (radDisplayZoom1x.Checked)
                    return "1";
                else if (radDisplayZoom2x.Checked)
                    return "2";
                else if (radDisplayZoom4x.Checked)
                    return "3";
                else
                    return "4";
            }
        }

        public string CATZB
        {
            set
            {
                btnZeroBeat.PerformClick();
            }
        }

        public void CATTuneStepUp()
        {
            ChangeTuneStepUp();
        }

        public void CATTuneStepDown()
        {
            ChangeTuneStepDown();
        }


        //Added 03/18/07 BT BCI Reject
        private int cat_bci_reject = 0;
        public int CATBCIReject
        {
            get
            {
                if (chkBCI.Checked)
                    cat_bci_reject = 1;
                else
                    cat_bci_reject = 0;
                return cat_bci_reject;
            }
            set
            {
                if (value == 1)
                    chkBCI.Checked = true;
                else
                    chkBCI.Checked = false;
            }
        }
        // Added 06/20/05 BT for CAT commands
        private int cat_nr_status = 0;
        public int CATNR
        {
            get { return cat_nr_status; }
            set
            {
                if (value == 0)
                    chkNR.Checked = false;
                else if (value == 1)
                    chkNR.Checked = true;
            }
        }

        // Added 06/20/05 BT for CAT commands
        private int cat_anf_status = 0;
        public int CATANF
        {
            get { return cat_anf_status; }
            set
            {
                if (value == 0)
                    chkANF.Checked = false;
                else if (value == 1)
                    chkANF.Checked = true;
            }
        }

        // Added 06/21/05 BT for CAT Commands
        private int cat_nb1_status = 0;
        public int CATNB1
        {
            get { return cat_nb1_status; }
            set
            {
                if (value == 0)
                    chkNB.Checked = false;
                else if (value == 1)
                    chkNB.Checked = true;
            }
        }

        // Added 06/21/05 BT for CAT commands
        private int cat_nb2_status = 0;
        public int CATNB2
        {
            get { return cat_nb2_status; }
            set
            {
                if (value == 0)
                    chkDSPNB2.Checked = false;
                else if (value == 1)
                    chkDSPNB2.Checked = true;
            }
        }

        // Added 06/22/05 BT for CAT commands
        private int cat_cmpd_status = 0;
        public int CATCmpd
        {
            get { return cat_cmpd_status; }
            set
            {
                if (value == 0)
                    chkCPDR.Checked = false;
                else if (value == 1)
                    chkCPDR.Checked = true;
            }
        }

        // Added 06/22/05 BT for CAT commands
        private int cat_mic_status = 0;
        public int CATMIC
        {
            get
            {
                cat_mic_status = ptbMic.Value;
                return cat_mic_status;
            }
            set
            {
                value = Math.Max(0, value);
                value = Math.Min(100, value);
                ptbMic.Value = value;
                ptbMic_Scroll(this, EventArgs.Empty);
            }
        }

        // Added 06/22/05 BT for CAT commands
        // modified 07/22/05 to fix display problem
        private int cat_filter_width = 0;
        public int CATFilterWidth
        {
            get
            {
                cat_filter_width = ptbFilterWidth.Value;
                return cat_filter_width;
            }
            set
            {
                value = Math.Max(1, value);
                value = Math.Min(10000, value);
                ptbFilterWidth.Value = value;
                ptbFilterWidth_Scroll(this.ptbFilterWidth, EventArgs.Empty);	// added
            }
        }

        // Added 07/22/05 for cat commands
        public int CATFilterShift
        {
            get
            {
                return ptbFilterShift.Value;
            }
            set
            {
                value = Math.Max(-1000, value);
                value = Math.Min(1000, value);
                ptbFilterShift.Value = value;
                ptbFilterShift_Scroll(this.ptbFilterShift, EventArgs.Empty);
            }
        }

        // Added 07/22/05 for CAT commands
        public int CATFilterShiftReset
        {
            set
            {
                if (value == 1)
                    btnFilterShiftReset.PerformClick();
            }
        }

        // Added 06/22/05 BT for CAT commands
        private int cat_bin_status = 0;
        public int CATBIN
        {
            get
            {
                if (chkBIN.Checked)
                    cat_bin_status = 1;
                else
                    cat_bin_status = 0;

                return cat_bin_status;
            }
            set
            {
                if (value == 1)
                    chkBIN.Checked = true;
                else if (value == 0)
                    chkBIN.Checked = false;
            }
        }

        // Added/repaired 7/10/05 BT for cat commands
        public int CATPreamp
        {
            set { comboPreamp.SelectedIndex = value; }
            get { return comboPreamp.SelectedIndex; }
        }

        // Added 06/30/05 BT for CAT commands
        public int CATCWSpeed
        {
            get
            {
                return ptbCWSpeed.Value;
            }
            set
            {
                value = Math.Max(1, value);
                value = Math.Min(60, value);
                ptbCWSpeed.Value = value;
                ptbCWSpeed_Scroll(this, EventArgs.Empty);
            }
        }

        // Added 06/30/05 BT for CAT commands
        private int cat_display_avg_status = 0;
        public int CATDisplayAvg
        {
            get
            {
                if (chkDisplayAVG.Checked)
                    cat_display_avg_status = 1;
                else
                    cat_display_avg_status = 0;

                return cat_display_avg_status;
            }
            set
            {
                if (value == 1)
                    chkDisplayAVG.Checked = true;
                else
                    chkDisplayAVG.Checked = false;
            }
        }

        // Added 06/30/05 BT for CAT commands
        private int cat_squelch_status = 0;
        public int CATSquelch
        {
            get
            {
                if (chkSquelch.Checked)
                    cat_squelch_status = 1;
                else
                    cat_squelch_status = 0;

                return cat_squelch_status;
            }
            set
            {
                if (value == 1)
                    chkSquelch.Checked = true;
                else
                    chkSquelch.Checked = false;
            }
        }

        // Added 7/9/05 BT for cat commands
        public string CATQMSValue
        {
            get { return this.txtMemoryQuick.Text; }
        }

        private Parity cat_parity;
        public Parity CATParity
        {
            set { cat_parity = value; }
            get { return cat_parity; }
        }


        private StopBits cat_stop_bits;
        public StopBits CATStopBits
        {
            set { cat_stop_bits = value; }
            get { return cat_stop_bits; }
        }

        private int cat_data_bits;
        public int CATDataBits
        {
            set { cat_data_bits = value; }
            get { return cat_data_bits; }
        }

        private int cat_baud_rate;
        public int CATBaudRate
        {
            set { cat_baud_rate = value; }
            get { return cat_baud_rate; }
        }

        private bool cat_enabled;
        public bool CATEnabled
        {
            set
            {
                try
                {
                    cat_enabled = value;
                    // Keyer.CATEnabled = value;
                    if (siolisten != null)  // if we've got a listener tell them about state change 
                    {
                        if (cat_enabled)
                        {
                            Siolisten.enableCAT();
                        }
                        else
                        {
                            Siolisten.disableCAT();
                        }
                    }
                }
                catch (Exception)
                {
                    MessageBox.Show("Error enabling CAT on COM" + cat_port + ".\n" +
                        "Please check CAT settings and try again.",
                        "CAT Error",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    if (SetupForm != null) SetupForm.CATEnabled = false;
                }
            }
            get { return cat_enabled; }
        }

        private int cat_rig_type;
        public int CATRigType
        {
            get { return cat_rig_type; }
            set { cat_rig_type = value; }
        }

        private int cat_port;
        public int CATPort
        {
            get { return cat_port; }
            set { cat_port = value; }
        }

        private bool cat_ptt_rts = false;
        public bool CATPTTRTS
        {
            get { return cat_ptt_rts; }
            set { cat_ptt_rts = value; }
        }

        private bool cat_ptt_dtr;
        public bool CATPTTDTR
        {
            get { return cat_ptt_dtr; }
            set { cat_ptt_dtr = value; }
        }

        public SerialPortPTT serialPTT = null;
        private bool ptt_bit_bang_enabled;
        public bool PTTBitBangEnabled
        {
            get { return ptt_bit_bang_enabled; }
            set
            {
                ptt_bit_bang_enabled = value;
                if (serialPTT != null)  // kill current serial PTT if we have one 
                {
                    serialPTT.Destroy();
                    serialPTT = null;
                }
                if (ptt_bit_bang_enabled)
                {
                    // wjt -- don't really like popping a msg box in here ...   nasty when we do a remoted 
                    // setup ... will let that wait for the great console refactoring 
                    try
                    {
                        serialPTT = new SerialPortPTT(cat_ptt_bit_bang_port, cat_ptt_rts, cat_ptt_dtr);
                        serialPTT.Init();
                    }
                    catch (Exception ex)
                    {
                        ptt_bit_bang_enabled = false;
                        if (SetupForm != null)
                        {
                            SetupForm.copyCATPropsToDialogVars(); // need to make sure the props on the setup page get reset 
                        }
                        MessageBox.Show("Could not initialize PTT Bit Bang control.  Exception was:\n\n " + ex.Message +
                            "\n\nPTT Bit Bang control has been disabled.", "Error Initializing PTT control",
                            MessageBoxButtons.OK, MessageBoxIcon.Error);

                    }
                }
            }
        }

        private int cat_ptt_bit_bang_port;
        public int CATPTTBitBangPort
        {
            get { return cat_ptt_bit_bang_port; }
            set { cat_ptt_bit_bang_port = value; }
        }


        #endregion

        private bool notify_on_beta = true;
        public bool NotifyOnBeta
        {
            get { return notify_on_beta; }
            set { notify_on_beta = value; }
        }

        private bool notify_on_release = true;
        public bool NotifyOnRelease
        {
            get { return notify_on_release; }
            set { notify_on_release = value; }
        }

        private int tune_power;								// power setting to use when TUN button is pressed
        public int TunePower
        {
            get { return tune_power; }
            set
            {
                tune_power = value;
                if (SetupForm != null)
                    SetupForm.TunePower = tune_power;

                if (chkTUN.Checked)
                {
                    if (atu_present)
                    {
                        if ((ATUTuneMode)comboTuneMode.SelectedIndex == ATUTuneMode.BYPASS)
                            PWR = tune_power;
                    }
                    else PWR = tune_power;
                }
            }
        }

        private bool disable_swr_protection = false;
        public bool DisableSWRProtection
        {
            get { return disable_swr_protection; }
            set { disable_swr_protection = value; }
        }

        private int previous_pwr = 50;
        public int PreviousPWR
        {
            get { return previous_pwr; }
            set { previous_pwr = value; }
        }

        private bool no_hardware_offset = false;
        public bool NoHardwareOffset
        {
            get { return no_hardware_offset; }
            set
            {
                no_hardware_offset = value;
                comboPreamp_SelectedIndexChanged(this, EventArgs.Empty);
            }
        }

        #region CAT Properties

        private Band rx1_band;
        public Band RX1Band
        {
            get { return rx1_band; }
            set
            {
                Band old_band = rx1_band;
                rx1_band = value;

                Band lo_band = Band.FIRST;
                if (rx1_xvtr_index >= 0)
                // Fix Penny O/C VHF control Vk4xv
                lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), rx1_xvtr_index, false, current_region);
                //lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), -1, false, current_region);

                if (rx1_band != old_band && flex_wire_ucb)
                {
                    if (UCBForm != null && !UCBForm.IsDisposed)
                    {
                        if (rx1_xvtr_index >= 0)
                        {
                            uint val = UCBForm.GetLine(rx1_xvtr_index);
                            byte b1 = (byte)val;
                            byte b2 = (byte)(val >> 8);
                            FWC.FlexWire_Write2Value(0x4C, 0x06, 0x00);
                            FWC.FlexWire_Write2Value(0x4C, 0x02, b1);
                            //FWC.FlexWire_Write2Value(0x4C, 0x03, b2);
                        }
                        else
                        {
                            FWC.FlexWire_Write2Value(0x4C, 0x06, 0x00);
                            FWC.FlexWire_Write2Value(0x4C, 0x02, 0);
                        }
                    }
                }

                if (rx1_preamp_mode > PreampMode.FIRST)
                    rx1_preamp_by_band[(int)old_band] = rx1_preamp_mode;

                if (fwc_init)
                {
                    switch (current_model)
                    {
                        case Model.FLEX5000:
                            double freq = VFOAFreq;
                            if (freq < 2.0)
                            {
                                if (chkRX1Preamp.Enabled) chkRX1Preamp.Enabled = false;
                                if (chkRX1Preamp.Checked) chkRX1Preamp.Checked = false;
                            }
                            else if (freq >= 28.0 && rx1_xvtr_index < 0 && !enable_6m_preamp)
                            {
                                if (chkRX1Preamp.Enabled) chkRX1Preamp.Enabled = false;
                                if (!chkRX1Preamp.Checked) chkRX1Preamp.Checked = true;
                            }
                            else if (!chkRX1Preamp.Enabled) chkRX1Preamp.Enabled = true;
                            break;
                        case Model.FLEX3000:
                            freq = VFOAFreq;
                            if (FWCEEPROM.TRXRev >> 8 < 6) // before rev G
                            {
                                if (freq < 2.0)
                                {
                                    if (!comboPreamp.Items.Contains("Attn"))
                                        comboPreamp.Items.Insert(0, "Attn");
                                    if (!comboPreamp.Items.Contains("Off"))
                                        comboPreamp.Items.Insert(1, "Off");
                                    if (comboPreamp.Items.Contains("Pre1"))
                                        comboPreamp.Items.Remove("Pre1");
                                    if (comboPreamp.Items.Contains("Pre2"))
                                        comboPreamp.Items.Remove("Pre2");

                                    if (comboPreamp.SelectedIndex < 0)
                                        comboPreamp.Text = "Off";
                                }
                                else
                                {
                                    if (!comboPreamp.Items.Contains("Attn"))
                                        comboPreamp.Items.Insert(0, "Attn");
                                    if (!comboPreamp.Items.Contains("Off"))
                                        comboPreamp.Items.Insert(1, "Off");
                                    if (!comboPreamp.Items.Contains("Pre1"))
                                        comboPreamp.Items.Insert(2, "Pre1");
                                    if (!comboPreamp.Items.Contains("Pre2"))
                                        comboPreamp.Items.Insert(3, "Pre2");

                                    if (comboPreamp.SelectedIndex < 0)
                                        comboPreamp.Text = "Pre2";
                                }
                            }
                            else // revs G+
                            {
                                if (freq < 7.0)
                                {
                                    if (!comboPreamp.Items.Contains("Attn"))
                                        comboPreamp.Items.Insert(0, "Attn");
                                    if (!comboPreamp.Items.Contains("Off"))
                                        comboPreamp.Items.Insert(1, "Off");
                                    if (comboPreamp.Items.Contains("Pre1"))
                                        comboPreamp.Items.Remove("Pre1");
                                    if (comboPreamp.Items.Contains("Pre2"))
                                        comboPreamp.Items.Remove("Pre2");

                                    if (comboPreamp.SelectedIndex < 0)
                                        comboPreamp.Text = "Off";
                                }
                                else if (freq < 13.0)
                                {
                                    if (!comboPreamp.Items.Contains("Attn"))
                                        comboPreamp.Items.Insert(0, "Attn");
                                    if (!comboPreamp.Items.Contains("Off"))
                                        comboPreamp.Items.Insert(1, "Off");
                                    if (!comboPreamp.Items.Contains("Pre1"))
                                        comboPreamp.Items.Insert(2, "Pre1");
                                    if (comboPreamp.Items.Contains("Pre2"))
                                        comboPreamp.Items.Remove("Pre2");

                                    if (comboPreamp.SelectedIndex < 0)
                                        comboPreamp.Text = "Off";
                                }
                                else
                                {
                                    if (!comboPreamp.Items.Contains("Attn"))
                                        comboPreamp.Items.Insert(0, "Attn");
                                    if (!comboPreamp.Items.Contains("Off"))
                                        comboPreamp.Items.Insert(1, "Off");
                                    if (!comboPreamp.Items.Contains("Pre1"))
                                        comboPreamp.Items.Insert(2, "Pre1");
                                    if (!comboPreamp.Items.Contains("Pre2"))
                                        comboPreamp.Items.Insert(3, "Pre2");

                                    if (comboPreamp.SelectedIndex < 0)
                                        comboPreamp.Text = "Off";
                                }
                            }
                            break;
                    }
                }

                if (rx1_band != old_band || initializing)
                {
                    // save values for old band
                    rx1_agct_by_band[(int)old_band] = ptbRF.Value;

                    RX1PreampMode = rx1_preamp_by_band[(int)value];
                    RF = rx1_agct_by_band[(int)value];
                    ptbRF_Scroll(this, EventArgs.Empty);

                    if (fwc_init)
                    {
                        switch (current_model)
                        {
                            case Model.FLEX5000:
                                // set saved values for new band
                                if (current_ant_mode == AntMode.Expert)
                                {
                                    int band = (int)value;
                                    if (rx1_xvtr_index >= 0)
                                        band = (int)Band.VHF0 + rx1_xvtr_index;

                                    if (rx1_ant != FWCAnt.SIG_GEN)
                                        RX1Ant = rx1_ant_by_band[band];
                                    if (rx1_ant != FWCAnt.RX1IN)
                                        RX1Loop = rx1_loop_by_band[band];
                                }

                                var b = rx1_band;
                                if (rx1_xvtr_index >= 0) b = lo_band;
                                RX1DisplayCalOffset = rx1_level_table[(int)b][0];
                                rx1_preamp_offset[(int)PreampMode.OFF] = 0.0f;
                                rx1_preamp_offset[(int)PreampMode.HIGH] = rx1_level_table[(int)b][1];
                                rx1_meter_cal_offset = rx1_level_table[(int)b][2];
                                UpdateDisplayOffsets();

                                if (FWCEEPROM.RX1ImageVer == 4)
                                {
                                    radio.GetDSPRX(0, 0).SetRXCorrectIQW(rx1_image_gain_table[(int)b], rx1_image_phase_table[(int)b]);
                                    radio.GetDSPRX(0, 1).SetRXCorrectIQW(rx1_image_gain_table[(int)b], rx1_image_phase_table[(int)b]);
                                }

                                Audio.IQGain = 1.0f + 0.001f * rx1_image_gain_table[(int)b];
                                Audio.IQPhase = 0.001f * rx1_image_phase_table[(int)b];

                                if (fwcAntForm != null && !fwcAntForm.IsDisposed)
                                    fwcAntForm.SetBand(value);
                                break;
                            case Model.FLEX3000:
                                b = rx1_band;
                                if (rx1_xvtr_index >= 0) b = lo_band;
                                RX1DisplayCalOffset = rx1_level_table[(int)b][0];
                                rx1_preamp_offset[(int)PreampMode.OFF] = rx1_level_table[(int)b][1];
                                rx1_preamp_offset[(int)PreampMode.LOW] = 0.0f;
                                rx1_preamp_offset[(int)PreampMode.MED] = rx1_level_table[(int)b][1] + rx1_level_table[(int)b][2];
                                rx1_preamp_offset[(int)PreampMode.HIGH] = rx1_level_table[(int)b][2];
                                rx1_meter_cal_offset = rx1_level_table[(int)b][0] + 27.2f;
                                UpdateDisplayOffsets();

                                if (FWCEEPROM.RX1ImageVer == 4)
                                {
                                    radio.GetDSPRX(0, 0).SetRXCorrectIQW(rx1_image_gain_table[(int)b], rx1_image_phase_table[(int)b]);
                                    radio.GetDSPRX(0, 1).SetRXCorrectIQW(rx1_image_gain_table[(int)b], rx1_image_phase_table[(int)b]);
                                }

                                Audio.IQGain = 1.0f + 0.001f * rx1_image_gain_table[(int)b];
                                Audio.IQPhase = 0.001f * rx1_image_phase_table[(int)b];
                                break;
                        }
                    }
                }
            }
        }

        private Band rx2_band;
        public Band RX2Band
        {
            get { return rx2_band; }
            set
            {
                Band old_band = rx2_band;
                rx2_band = value;

                comboRX2Band.SelectedIndex = Math.Min(Math.Max(0, (int)value), comboRX2Band.Items.Count - 1);

                Band lo_band = Band.FIRST;
                if (rx2_xvtr_index >= 0)
                    lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOBFreq), -1, false, current_region);

                rx2_preamp_by_band[(int)old_band] = rx2_preamp_mode;

                if (fwc_init && current_model == Model.FLEX5000)
                {
                    double freq = VFOBFreq;
                    if (freq < 2.0)
                    {
                        if (chkRX2Preamp.Enabled) chkRX2Preamp.Enabled = false;
                        if (chkRX2Preamp.Checked) chkRX2Preamp.Checked = false;
                    }
                    else if (freq >= 28.0 && rx2_xvtr_index < 0 && !enable_6m_preamp)
                    {
                        if (chkRX2Preamp.Enabled) chkRX2Preamp.Enabled = false;
                        if (!chkRX2Preamp.Checked) chkRX2Preamp.Checked = true;
                    }
                    else if (!chkRX2Preamp.Enabled) chkRX2Preamp.Enabled = true;
                }

                if (rx2_band != old_band || initializing)
                {
                    // save values for old band
                    rx2_agct_by_band[(int)old_band] = ptbRX2RF.Value;

                    RX2PreampMode = rx2_preamp_by_band[(int)value];
                    RX2RF = rx2_agct_by_band[(int)value];
                    ptbRX2RF_Scroll(this, EventArgs.Empty);

                    if (fwc_init && current_model == Model.FLEX5000)
                    {
                        if (current_ant_mode == AntMode.Expert)
                        {
                            int band = (int)value;
                            if (rx2_xvtr_index >= 0)
                                band = (int)Band.VHF0 + rx2_xvtr_index;

                            RX2Ant = rx2_ant_by_band[band];
                        }

                        Band b = rx2_band;
                        if (rx2_xvtr_index >= 0) b = lo_band;
                        RX2DisplayCalOffset = rx2_level_table[(int)b][0];
                        rx2_preamp_offset[(int)PreampMode.OFF] = 0.0f;
                        rx2_preamp_offset[(int)PreampMode.HIGH] = rx2_level_table[(int)b][1];
                        rx2_meter_cal_offset = rx2_level_table[(int)b][2];
                        UpdateDisplayOffsets();

                        if (FWCEEPROM.RX2ImageVer == 4)
                        {
                            radio.GetDSPRX(1, 0).SetRXCorrectIQW(rx2_image_gain_table[(int)b], rx2_image_phase_table[(int)b]);
                            radio.GetDSPRX(1, 1).SetRXCorrectIQW(rx2_image_gain_table[(int)b], rx2_image_phase_table[(int)b]);
                        }

                        if (fwcAntForm != null && !fwcAntForm.IsDisposed)
                            fwcAntForm.SetBand(value);
                    }
                }
            }
        }

        private Band tx_band;
        public Band TXBand
        {
            get { return tx_band; }
            set
            {
                Band old_band = tx_band;
                tx_band = value;

                Band lo_band = Band.FIRST;
                if (tx_xvtr_index >= 0)
                    // Fix Penny O/C VHF control Vk4xv
                    lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), rx1_xvtr_index, false, current_region);
                   //lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), -1, true, current_region);

                if (tx_band != old_band || initializing)
                {
                    // save values for old band
                    int old_pwr = ptbPWR.Value;
                    //if(rx1_dsp_mode == DSPMode.FM) old_pwr = (int)(old_pwr*2.5);
                    power_by_band[(int)old_band] = old_pwr;

                    //if(tx_xvtr_index < 0)
                    PWR = power_by_band[(int)value];

                    ptbPWR_Scroll(this, EventArgs.Empty);

                    // save FM TX Offset
                    fm_tx_offset_by_band_mhz[(int)old_band] = fm_tx_offset_mhz;
                    udFMOffset.Value = (decimal)(fm_tx_offset_by_band_mhz[(int)value]);

                    if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                    {
                        if (value == Band.B6M && (byte)FWCEEPROM.RFIORev < 34 && current_model == Model.FLEX5000)
                        {
                            FWC.SetTXAnt(3);
                            tx_ant_by_band[(int)value] = FWCAnt.ANT3;
                        }

                        if (old_band == Band.B6M && (byte)FWCEEPROM.RFIORev < 34 && current_ant_mode == AntMode.Simple)
                            tx_ant_6m_reset = true;

                        if (current_ant_mode == AntMode.Expert)
                        {
                            int band = (int)value;
                            if (tx_xvtr_index >= 0)
                                band = (int)Band.VHF0 + tx_xvtr_index;

                            TXAnt = tx_ant_by_band[band];
                            FWCAmpTX1 = tx1_by_band[band];
                            FWCAmpTX2 = tx2_by_band[band];
                            FWCAmpTX3 = tx3_by_band[band];
                        }
                        else if (value != Band.B6M)
                            TXAnt = tx_ant;

                        Band b = tx_band;
                        if (tx_xvtr_index >= 0) b = lo_band;

                        if (SetupForm != null && !SetupForm.IsDisposed)
                        {
                            SetupForm.ImageGainTX = tx_image_gain_table[(int)b];
                            SetupForm.ImagePhaseTX = tx_image_phase_table[(int)b];
                        }

                        if (flex5000DebugForm != null && !flex5000DebugForm.IsDisposed)
                        {
                            flex5000DebugForm.SetTRXPot(0, (byte)tx_carrier_table[(int)b][0]);
                            flex5000DebugForm.SetTRXPot(1, (byte)tx_carrier_table[(int)b][1]);
                            flex5000DebugForm.SetTRXPot(2, (byte)tx_carrier_table[(int)b][2]);
                            flex5000DebugForm.SetTRXPot(3, (byte)tx_carrier_table[(int)b][3]);
                        }

                        uint temp = 0;
                        for (int i = 0; i < 4; i++)
                            temp += (uint)((byte)tx_carrier_table[(int)b][i] << (8 * (3 - i)));
                        FWC.SetTRXPot(temp);

                        if (fwcAntForm != null && !fwcAntForm.IsDisposed)
                            fwcAntForm.SetBand(value);

                        if (current_model == Model.FLEX5000)
                        {
                            if (fwcAtuForm != null && !fwcAtuForm.IsDisposed)
                            {
                                switch (fwcAtuForm.CurrentTuneMode)
                                {
                                    case FWCATUMode.SemiAutomatic:
                                        fwcAtuForm.CurrentTuneMode = FWCATUMode.Bypass;
                                        break;
                                }
                                FWCATUBypass();
                            }
                        }
                        else if (current_model == Model.FLEX3000)
                        {
                            if (flex3000ATUForm != null && !flex3000ATUForm.IsDisposed)
                            {
                                flex3000ATUForm.DoBypass();
                                FWCATUBypass();
                            }
                        }
                    }
                }


                if (old_band != Band.B60M && !initializing)
                {
                    SetupForm.TXFilterHighSave = tx_filter_high;
                    SetupForm.TXFilterLowSave = tx_filter_low;
                }

                if (tx_band == Band.B60M)
                {
                    if (tx_filter_high > 2900)
                        SetupForm.TXFilterHigh = 2900;
                    if (tx_filter_low < 100)
                        SetupForm.TXFilterLow = 100;
                }

                if (tx_band != old_band || initializing)
                {
                    if (old_band == Band.B60M)
                    {
                        if (tx_filter_high != SetupForm.TXFilterHighSave)
                            SetupForm.TXFilterHigh = SetupForm.TXFilterHighSave;
                        if (tx_filter_low != SetupForm.TXFilterLowSave)
                            SetupForm.TXFilterLow = SetupForm.TXFilterLowSave;
                    }
                }
            }
        }

        // Added 06/24/05 BT for CAT commands
        public bool CATVFOLock
        {
            get { return chkVFOLock.Checked; }
            set { chkVFOLock.Checked = value; }
        }

        public string CATGetVersion()
        {
            Assembly assembly = Assembly.GetExecutingAssembly();
            FileVersionInfo fvi = FileVersionInfo.GetVersionInfo(assembly.Location);
            //			int current_version = VersionTextToInt(fvi.FileVersion);
            return fvi.FileVersion;
        }

        // Added 07/30/05 BT for cat commands next 8 functions

        public string CATReadSigStrength()
        {
            float num = 0f;
            num = DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
            num = num +
                rx1_meter_cal_offset +
                rx1_preamp_offset[(int)rx1_preamp_mode] +
                rx1_filter_size_cal_offset +
                rx1_path_offset +
                rx1_xvtr_gain_offset;
            return num.ToString("f1") + " dBm";
        }

        public string CATReadAvgStrength()
        {
            float num = 0f;
            num = DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.AVG_SIGNAL_STRENGTH);
            num = num +
                rx1_meter_cal_offset +
                rx1_preamp_offset[(int)rx1_preamp_mode] +
                rx1_filter_size_cal_offset +
                rx1_path_offset +
                rx1_xvtr_gain_offset;
            return num.ToString("f1") + " dBm";
        }

        public string CATReadADC_L()
        {
            float num = 0f;
            num = DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.ADC_REAL);
            return num.ToString("f1") + " dBFS";
        }

        public string CATReadADC_R()
        {
            float num = 0f;
            num = DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.ADC_IMAG);
            return num.ToString("f1") + " dBFS";
        }

        public string CATReadALC()
        {
            float num = 0f;

            if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP)
            {
                num = (float)Math.Max(-20.0, -DttSP.CalculateTXMeter(0, DttSP.MeterType.ALC));
                return num.ToString("f1") + " dB";
            }
            else return "0" + separator + "0 dB";
        }

        public string CATReadFwdPwr()
        {
            double power = 0.0;
            float num = 0f;

            if (pa_present && VFOAFreq < 30.0)
            {
                //pa_power_mutex.WaitOne();
                power = PAPower(pa_fwd_power);
                //pa_power_mutex.ReleaseMutex();

                return power.ToString("f0") + " W";
            }
            else
            {
                if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP)
                {
                    num = (float)Math.Max(0.0, DttSP.CalculateTXMeter(0, DttSP.MeterType.PWR));
                    num *= (float)((double)ptbPWR.Value * 0.01);
                    return num.ToString("f2") + " W";
                }
                else return "0" + separator + "00 W";
            }
        }

        public string CATReadPeakPwr()
        {
            float num = 0f;
            if (pa_present && VFOAFreq < 30.0)
            {
                if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP)
                {
                    num = (float)Math.Max(0.0, DttSP.CalculateTXMeter(0, DttSP.MeterType.ALC));
                    num *= (float)ptbPWR.Value;

                    meter_text_history[meter_text_history_index] = num;
                    meter_text_history_index = (meter_text_history_index + 1) % multimeter_text_peak_samples;
                    float max = float.MinValue;
                    for (int i = 0; i < multimeter_text_peak_samples; i++)
                    {
                        if (meter_text_history[i] > max)
                            max = meter_text_history[i];
                    }
                    num = max;

                    return num.ToString("f0") + " W";
                }
                else return "0 W";
            }
            else
            {
                if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP)
                {
                    num = (float)Math.Max(0.0, DttSP.CalculateTXMeter(0, DttSP.MeterType.ALC));
                    num *= (float)((float)ptbPWR.Value * 0.01);
                    return num.ToString("f2") + " W";
                }
                else return "0" + separator + "00 W";
            }
        }

        public string CATReadRevPwr()
        {
            double power = 0.0;
            //pa_power_mutex.WaitOne();
            power = PAPower(pa_rev_power);
            //pa_power_mutex.ReleaseMutex();
            return power.ToString("f0") + " W";
        }

        public string CATReadSWR()
        {
            double swr = 0.0;
            //pa_power_mutex.WaitOne();
            swr = SWR(pa_fwd_power, pa_rev_power);
            //pa_power_mutex.ReleaseMutex();
            return swr.ToString("f1") + " : 1";
        }

        //*************end of 8 functions.

        private bool kw_auto_information = false;
        public bool KWAutoInformation
        {
            get { return kw_auto_information; }
            set { kw_auto_information = value; }
        }

        #endregion

        private static bool hpsdr_duplex_enabled;
        public static bool HPSDRDuplexEnabled
        {
            get { return hpsdr_duplex_enabled; }
            set { hpsdr_duplex_enabled = value; }
        }

        private DSPMode rx1_dsp_mode = DSPMode.FIRST;
        public DSPMode RX1DSPMode
        {
            get { return rx1_dsp_mode; }
            set
            {
                RadioButtonTS r = null;
                switch (value)
                {
                    case DSPMode.LSB:
                        r = radModeLSB;
                        break;
                    case DSPMode.USB:
                        r = radModeUSB;
                        break;
                    case DSPMode.DSB:
                        r = radModeDSB;
                        break;
                    case DSPMode.CWL:
                        r = radModeCWL;
                        break;
                    case DSPMode.CWU:
                        r = radModeCWU;
                        break;
                    case DSPMode.FM:
                        r = radModeFMN;
                        break;
                    case DSPMode.AM:
                        r = radModeAM;
                        break;
                    case DSPMode.SAM:
                        r = radModeSAM;
                        break;
                    case DSPMode.SPEC:
                        r = radModeSPEC;
                        break;
                    case DSPMode.DIGL:
                        r = radModeDIGL;
                        break;
                    case DSPMode.DIGU:
                        r = radModeDIGU;
                        break;
                    case DSPMode.DRM:
                        r = radModeDRM;
                        break;
                }

                r.Checked = true;
            }
        }

        private DSPMode rx2_dsp_mode = DSPMode.FIRST;
        public DSPMode RX2DSPMode
        {
            get { return rx2_dsp_mode; }
            set
            {
                RadioButtonTS r = null;
                switch (value)
                {
                    case DSPMode.LSB:
                        r = radRX2ModeLSB;
                        break;
                    case DSPMode.USB:
                        r = radRX2ModeUSB;
                        break;
                    case DSPMode.DSB:
                        r = radRX2ModeDSB;
                        break;
                    case DSPMode.CWL:
                        r = radRX2ModeCWL;
                        break;
                    case DSPMode.CWU:
                        r = radRX2ModeCWU;
                        break;
                    case DSPMode.FM:
                        r = radRX2ModeFMN;
                        break;
                    case DSPMode.AM:
                        r = radRX2ModeAM;
                        break;
                    case DSPMode.SAM:
                        r = radRX2ModeSAM;
                        break;
                    case DSPMode.DIGL:
                        r = radRX2ModeDIGL;
                        break;
                    case DSPMode.DIGU:
                        r = radRX2ModeDIGU;
                        break;
                    case DSPMode.DRM:
                        r = radRX2ModeDRM;
                        break;
                }

                r.Checked = true;
            }
        }

        private Filter rx1_filter = Filter.FIRST;
        public Filter RX1Filter
        {
            get { return rx1_filter; }
            set
            {
                RadioButtonTS r = null;
                switch (value)
                {
                    case Filter.F1:
                        r = radFilter1;
                        break;
                    case Filter.F2:
                        r = radFilter2;
                        break;
                    case Filter.F3:
                        r = radFilter3;
                        break;
                    case Filter.F4:
                        r = radFilter4;
                        break;
                    case Filter.F5:
                        r = radFilter5;
                        break;
                    case Filter.F6:
                        r = radFilter6;
                        break;
                    case Filter.F7:
                        r = radFilter7;
                        break;
                    case Filter.F8:
                        r = radFilter8;
                        break;
                    case Filter.F9:
                        r = radFilter9;
                        break;
                    case Filter.F10:
                        r = radFilter10;
                        break;
                    case Filter.VAR1:
                        r = radFilterVar1;
                        break;
                    case Filter.VAR2:
                        r = radFilterVar2;
                        break;
                    case Filter.NONE:
                        SetRX1Filter(Filter.NONE);
                        break;
                }

                if (r != null)
                {
                    if (r.Checked)
                    {
                        r.Checked = false;
                    }

                    r.Checked = true;
                }

                //SetFilter(value);  // kd5tfd added for cat zzsf support 
                // commented as changed order in CATCommands.cs should no longer require this
            }
        }

        private Filter rx2_filter = Filter.FIRST;
        public Filter RX2Filter
        {
            get { return rx2_filter; }
            set
            {
                //comboRX2Filter.SelectedIndex = (int)value;
                RadioButtonTS r = null;
                switch (value)
                {
                    case Filter.F1:
                        r = radRX2Filter1;
                        break;
                    case Filter.F2:
                        r = radRX2Filter2;
                        break;
                    case Filter.F3:
                        r = radRX2Filter3;
                        break;
                    case Filter.F4:
                        r = radRX2Filter4;
                        break;
                    case Filter.F5:
                        r = radRX2Filter5;
                        break;
                    case Filter.F6:
                        r = radRX2Filter6;
                        break;
                    case Filter.F7:
                        r = radRX2Filter7;
                        break;
                    case Filter.VAR1:
                        r = radRX2FilterVar1;
                        break;
                    case Filter.VAR2:
                        r = radRX2FilterVar2;
                        break;
                    case Filter.NONE:
                        SetRX2Filter(Filter.NONE);
                        break;
                }

                if (r != null)
                {
                    if (r.Checked)
                    {
                        r.Checked = false;
                    }

                    r.Checked = true;
                }

                //SetFilter(value);  // kd5tfd added for cat zzsf support 
                // commented as changed order in CATCommands.cs should no longer require this
            }
        }

        private MeterRXMode current_meter_rx_mode = MeterRXMode.SIGNAL_STRENGTH;
        public MeterRXMode CurrentMeterRXMode
        {
            get { return current_meter_rx_mode; }
            set
            {
                string text = "";
                switch (value)
                {
                    case MeterRXMode.SIGNAL_STRENGTH:
                        text = "Signal";
                        break;
                    case MeterRXMode.SIGNAL_AVERAGE:
                        text = "Sig Avg";
                        break;
                    case MeterRXMode.ADC_L:
                        text = "ADC L";
                        break;
                    case MeterRXMode.ADC_R:
                        text = "ADC R";
                        break;
                    case MeterRXMode.ADC2_L:
                        text = "ADC2 L";
                        break;
                    case MeterRXMode.ADC2_R:
                        text = "ADC2 R";
                        break;
                    case MeterRXMode.OFF:	// BT Added 7/24/05 for CAT commands
                        text = "Off";
                        break;
                }

                if (text == "") return;

                comboMeterRXMode.Text = text;
            }
        }

        private MeterRXMode rx2_meter_mode = MeterRXMode.SIGNAL_STRENGTH;
        public MeterRXMode RX2MeterMode
        {
            get { return rx2_meter_mode; }
            set
            {
                string text = "";
                switch (value)
                {
                    case MeterRXMode.SIGNAL_STRENGTH:
                        text = "Signal";
                        break;
                    case MeterRXMode.SIGNAL_AVERAGE:
                        text = "Sig Avg";
                        break;
                    case MeterRXMode.ADC_L:
                        text = "ADC L";
                        break;
                    case MeterRXMode.ADC_R:
                        text = "ADC R";
                        break;
                    case MeterRXMode.ADC2_L:
                        text = "ADC2 L";
                        break;
                    case MeterRXMode.ADC2_R:
                        text = "ADC2 R";
                        break;
                    case MeterRXMode.OFF:	// BT Added 7/24/05 for CAT commands
                        text = "Off";
                        break;
                }

                if (text == "") return;

                comboRX2MeterMode.Text = text;
            }
        }

        private MeterTXMode current_meter_tx_mode = MeterTXMode.FIRST;
        public MeterTXMode CurrentMeterTXMode
        {
            get { return current_meter_tx_mode; }
            set
            {
                string text = "";
                switch (value)
                {
                    case MeterTXMode.FORWARD_POWER:
                        text = "Fwd Pwr";
                        break;
                    case MeterTXMode.REVERSE_POWER:
                        text = "Ref Pwr";
                        break;
                    case MeterTXMode.MIC:
                        text = "Mic";
                        break;
                    case MeterTXMode.EQ:
                        text = "EQ";
                        break;
                    case MeterTXMode.LEVELER:
                        text = "Leveler";
                        break;
                    case MeterTXMode.LVL_G:
                        text = "Lvl Gain";
                        break;
                    case MeterTXMode.CPDR:
                        text = "CPDR";
                        break;
                    case MeterTXMode.ALC:
                        text = "ALC";
                        break;
                    case MeterTXMode.ALC_G:
                        text = "ALC Comp";
                        break;
                    case MeterTXMode.SWR:
                        text = "SWR";
                        break;
                    case MeterTXMode.OFF:		// BT Added 07/24/05 for CAT commands
                        text = "Off";
                        break;
                }
                if (text == "") return;

                comboMeterTXMode.Text = text;
            }
        }

        private int cw_pitch = 600;
        public int CWPitch
        {
            get { return cw_pitch; }
            set
            {
                int diff = cw_pitch - value;
                cw_pitch = value;

                switch (radio.GetDSPTX(0).CurrentDSPMode)
                {
                    case DSPMode.CWL:
                        CWSynth.Pitch = cw_pitch;
                        break;
                    case DSPMode.CWU:
                        CWSynth.Pitch = -cw_pitch;
                        break;
                }

                Audio.SineFreq1 = cw_pitch;
                udCWPitch.Value = cw_pitch;
                Display.CWPitch = cw_pitch;
                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                    FWC.SetCWPitch((uint)cw_pitch);

                for (Filter f = Filter.F1; f < Filter.LAST; f++)
                {
                    int low = rx1_filters[(int)DSPMode.CWL].GetLow(f);
                    int high = rx1_filters[(int)DSPMode.CWL].GetHigh(f);
                    string name = rx1_filters[(int)DSPMode.CWL].GetName(f);

                    int bw = high - low;
                    low = -cw_pitch - bw / 2;
                    high = -cw_pitch + bw / 2;
                    rx1_filters[(int)DSPMode.CWL].SetFilter(f, low, high, name);
                    rx2_filters[(int)DSPMode.CWL].SetFilter(f, low, high, name); // n6vl

                    low = rx1_filters[(int)DSPMode.CWU].GetLow(f);
                    high = rx1_filters[(int)DSPMode.CWU].GetHigh(f);
                    name = rx1_filters[(int)DSPMode.CWU].GetName(f);

                    bw = high - low;
                    low = cw_pitch - bw / 2;
                    high = cw_pitch + bw / 2;
                    rx1_filters[(int)DSPMode.CWU].SetFilter(f, low, high, name);
                    rx2_filters[(int)DSPMode.CWU].SetFilter(f, low, high, name); // n6vl
                }

                switch (rx1_dsp_mode)
                {
                    case DSPMode.CWL:
                        diff = -diff;
                        if (mox)
                        {
                            VFOAFreq += (double)diff / 1e6;
                            if (chkVFOSplit.Checked) VFOBFreq += (double)diff / 1e6;
                        }
                        else
                        {
                            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                            txtVFOBFreq_LostFocus(this, EventArgs.Empty); // n6vl
                        }
                        RX1Filter = rx1_filter;
                        RX2Filter = rx2_filter; // n6vl
                        break;
                    case DSPMode.CWU:
                        if (mox)
                        {
                            VFOAFreq += (double)diff / 1e6;
                            if (chkVFOSplit.Checked) VFOBFreq += (double)diff / 1e6;
                        }
                        else
                        {
                            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                            txtVFOBFreq_LostFocus(this, EventArgs.Empty); // n6vl
                        }
                        RX1Filter = rx1_filter;
                        RX2Filter = rx2_filter; // n6vl
                        break;
                }
            }
        }

        private int histogram_hang_time = 100;
        public int HistogramHangTime
        {
            get { return histogram_hang_time; }
            set { histogram_hang_time = value; }
        }

        public double VFOAFreq
        {
            get
            {
                try
                {
                    return double.Parse(txtVFOAFreq.Text);
                }
                catch (Exception)
                {
                    return 0;
                }
            }
            set
            {
                if (vfo_lock || SetupForm == null) return;
                if (!this.InvokeRequired)
                {
                    txtVFOAFreq.Text = value.ToString("f6");
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                }
                else
                {
                    VFOUpdateDel del = new VFOUpdateDel(VFOAUpdate);
                    Invoke(del, new object[] { value });
                }
            }
        }

        private delegate void VFOUpdateDel(double freq);
        private void VFOAUpdate(double freq)
        {
            txtVFOAFreq.Text = freq.ToString("f6");
            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
        }

        public double VFOASubFreq //rx2
        {
            get
            {
                if (!rx2_enabled || (!chkEnableMultiRX.Checked && !chkVFOSplit.Checked)) return -999.999;
                try
                {
                    return double.Parse(txtVFOABand.Text);
                }
                catch (Exception)
                {
                    return -999.999;
                }
            }

            set
            {
                if (vfo_lock || SetupForm == null) return;
                txtVFOABand.Text = value.ToString("f6");
                txtVFOABand_LostFocus(this, EventArgs.Empty);
            }
        }

        public double VFOBFreq
        {
            get
            {
                try
                {
                    return double.Parse(txtVFOBFreq.Text);
                }
                catch (Exception)
                {
                    return 0;
                }
            }
            set
            {
                value = Math.Max(0, value);
                txtVFOBFreq.Text = value.ToString("f6");
                txtVFOBFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        public int PWR
        {
            get { return ptbPWR.Value; }
            set
            {
                value = Math.Max(0, value);			// lower bound
                value = Math.Min(100, value);		// upper bound

                ptbPWR.Value = value;
                ptbPWR_Scroll(this, EventArgs.Empty);
            }
        }

        public int AF
        {
            get { return ptbAF.Value; }
            set
            {
                value = Math.Max(0, value);			// lower bound
                value = Math.Min(100, value);		// upper bound

                ptbAF.Value = value;
                ptbAF_Scroll(this, EventArgs.Empty);
            }
        }

        private int rxaf = 50;
        public int RXAF
        {
            get { return rxaf; }
            set { rxaf = value; }
        }

        private int txaf = 50;
        public int TXAF
        {
            get { return txaf; }
            set
            {
                txaf = value;
                if (SetupForm != null)
                {
                    SetupForm.TXAF = txaf;
                    if (MOX) ptbAF.Value = txaf;
                }
            }
        }

        public bool DisplayAVG
        {
            get { return chkDisplayAVG.Checked; }
            set { chkDisplayAVG.Checked = value; }
        }

        private double break_in_delay = 300;
        public double BreakInDelay
        {
            get { return break_in_delay; }
            set
            {
                break_in_delay = value;
                udCWBreakInDelay.Value = (int)value;
            }
        }

        private bool cat_ptt = false;
        public bool CATPTT
        {
            get { return cat_ptt; }
            set { cat_ptt = value; }
        }

        private bool cw_auto_mode_switch = false;
        public bool CWAutoModeSwitch
        {
            get { return cw_auto_mode_switch; }
            set { cw_auto_mode_switch = value; }
        }

        private DSPMode saved_cw_auto_switch_dsp_mode = DSPMode.FIRST;
        private void SetConsoleMox(bool b)
        {
            if (disable_ptt && b) return;
            DSPMode tx_mode = radio.GetDSPTX(0).CurrentDSPMode;

            if (cw_auto_mode_switch)
            {
                CWAutoSwitchMode(b, tx_mode);
            }
            else
            {
                switch (tx_mode)
                {
                    case DSPMode.CWL:
                    case DSPMode.CWU:
                        MOX = b;
                        break;
                }
            }
        }

        private bool reverse_paddles = false;
        public bool ReversePaddles
        {
            get { return reverse_paddles; }
            set { reverse_paddles = value; }
        }

        private void CWAutoSwitchMode(bool b, DSPMode tx_mode)
        {
            if (b)
            {
                if (saved_cw_auto_switch_dsp_mode != tx_mode)
                    saved_cw_auto_switch_dsp_mode = tx_mode;

                switch (tx_mode)
                {
                    case DSPMode.CWL:
                    case DSPMode.CWU:
                        break; // do nothing
                    case DSPMode.LSB:
                    case DSPMode.DIGL:
                        if (current_model == Model.FLEX5000 && FWCEEPROM.RX2OK && rx2_enabled && chkVFOBTX.Checked)
                            Invoke(new MethodInvoker(radRX2ModeCWL.Select)); // switch RX2 to CWL mode
                        else Invoke(new MethodInvoker(radModeCWL.Select)); // switch RX1 to CWL mode
                        break;
                    case DSPMode.USB:
                    case DSPMode.DIGU:
                    case DSPMode.AM:
                    case DSPMode.SAM:
                    case DSPMode.FM:
                    case DSPMode.DSB:
                    case DSPMode.DRM:
                        if (current_model == Model.FLEX5000 && FWCEEPROM.RX2OK && rx2_enabled && chkVFOBTX.Checked)
                            Invoke(new MethodInvoker(radRX2ModeCWU.Select)); // switch RX2 to CWU mode    
                        else Invoke(new MethodInvoker(radModeCWU.Select)); // switch RX1 to CWU mode
                        break;
                }

                MOX = true;
            }
            else
            {
                MOX = false;
                switch (saved_cw_auto_switch_dsp_mode)
                {
                    case DSPMode.CWL:
                    case DSPMode.CWU:
                        break; // do nothing
                    default:
                        RadioButtonTS rad = null;
                        bool rx2 = (current_model == Model.FLEX5000 && FWCEEPROM.RX2OK && rx2_enabled && chkVFOBTX.Checked);
                        switch (saved_cw_auto_switch_dsp_mode)
                        {
                            case DSPMode.LSB:
                                if (rx2) rad = radRX2ModeLSB;
                                else rad = radModeLSB;
                                break;
                            case DSPMode.USB:
                                if (rx2) rad = radRX2ModeUSB;
                                else rad = radModeUSB;
                                break;
                            case DSPMode.DSB:
                                if (rx2) rad = radRX2ModeDSB;
                                else rad = radModeDSB;
                                break;
                            case DSPMode.FM:
                                if (rx2) rad = radRX2ModeFMN;
                                else rad = radModeFMN;
                                break;
                            case DSPMode.AM:
                                if (rx2) rad = radRX2ModeAM;
                                else rad = radModeAM;
                                break;
                            case DSPMode.SAM:
                                if (rx2) rad = radRX2ModeSAM;
                                else rad = radModeSAM;
                                break;
                            case DSPMode.DIGL:
                                if (rx2) rad = radRX2ModeDIGL;
                                else rad = radModeDIGL;
                                break;
                            case DSPMode.DIGU:
                                if (rx2) rad = radRX2ModeDIGU;
                                else rad = radModeDIGU;
                                break;
                            case DSPMode.DRM:
                                if (rx2) rad = radRX2ModeDRM;
                                else rad = radModeDRM;
                                break;
                        }

                        if (rad != null)
                            Invoke(new MethodInvoker(rad.Select));
                        break;
                }
            }
        }

        private void SetTRMute(bool b)
        {
            if (!b) // RX
            {
                switch (radio.GetDSPTX(0).CurrentDSPMode)
                {
                    case DSPMode.CWL:
                    case DSPMode.CWU:
                        Audio.MuteOutput = false;
                        break;
                    default:
                        //USBHID.WriteI2C2Value(0x30, 0x25, 0xC0);
                        break;
                }
            }
            else // TX
            {
                //USBHID.WriteI2C2Value(0x30, 0x25, 0xC0);
            }
        }

        public bool MOX
        {
            get { return chkMOX.Checked; }
            set { chkMOX.Checked = value; }
        }

        public bool MOXEnabled
        {
            get { return chkMOX.Enabled; }
            set { chkMOX.Enabled = value; }
        }

        public bool MON
        {
            get { return chkMON.Checked; }
            set { chkMON.Checked = value; }
        }

        public bool MUT
        {
            get { return chkMUT.Checked; }
            set { chkMUT.Checked = value; }
        }

        public bool TUN
        {
            get { return chkTUN.Checked; }
            set
            {
                chkTUN.Checked = value;
                // Hdw.TUNControl = true;
            }
        }

        public bool TUNEnabled
        {
            get { return chkTUN.Enabled; }
            set { chkTUN.Enabled = value; }
        }

        public int RX1FilterLow
        {
            get { return (int)udFilterLow.Value; }
            set { udFilterLow.Value = value; }
        }

        public int RX1FilterHigh
        {
            get { return (int)udFilterHigh.Value; }
            set { udFilterHigh.Value = value; }
        }

        public int RX2FilterLow
        {
            get { return (int)udRX2FilterLow.Value; }
            set { udRX2FilterLow.Value = value; }
        }

        public int RX2FilterHigh
        {
            get { return (int)udRX2FilterHigh.Value; }
            set { udRX2FilterHigh.Value = value; }
        }

        public int FilterShiftValue
        {
            get { return ptbFilterShift.Value; }
            set { ptbFilterShift.Value = value; }
        }

        private static List<Channel> channels_60m;
        public static List<Channel> Channels60m
        {
            get { return channels_60m; }
        }

        private bool pennylanepresent = false;
        public bool PennyLanePresent
        {
            get { return pennylanepresent; }
            set { pennylanepresent = value; }
        }

        //public bool PennyLanePresent = false; 
        public bool PennyPresent = false;
        //public bool AlexPresent = false; 
        public bool MercuryPresent = false;
        public bool JanusPresent = false;
        public bool HPSDRisMetis = false;

        private bool alex_hpf_bypass = false;
        public bool AlexHPFBypass
        {
            get { return alex_hpf_bypass; }
            set
            {
                alex_hpf_bypass = value;
                if (chkPower.Checked)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    SetAlexRXFilters(freq);
                }
            }
        }

        private bool alex1_5bphpf_bypass = false;
        public bool Alex1_5BPHPFBypass
        {
            get { return alex1_5bphpf_bypass; }
            set
            {
                alex1_5bphpf_bypass = value;
                if (chkPower.Checked)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    SetAlexRXFilters(freq);
                }
            }
        }

        private bool alex6_5bphpf_bypass = false;
        public bool Alex6_5BPHPFBypass
        {
            get { return alex6_5bphpf_bypass; }
            set
            {
                alex6_5bphpf_bypass = value;
                if (chkPower.Checked)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    SetAlexRXFilters(freq);
                }
            }
        }

        private bool alex9_5bphpf_bypass = false;
        public bool Alex9_5BPHPFBypass
        {
            get { return alex9_5bphpf_bypass; }
            set
            {
                alex9_5bphpf_bypass = value;
                if (chkPower.Checked)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    SetAlexRXFilters(freq);
                }
            }
        }

        private bool alex13bphpf_bypass = false;
        public bool Alex13BPHPFBypass
        {
            get { return alex13bphpf_bypass; }
            set
            {
                alex13bphpf_bypass = value;
                if (chkPower.Checked)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    SetAlexRXFilters(freq);
                }
            }
        }

        private bool alex20bphpf_bypass = false;
        public bool Alex20BPHPFBypass
        {
            get { return alex20bphpf_bypass; }
            set
            {
                alex20bphpf_bypass = value;
                if (chkPower.Checked)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    SetAlexRXFilters(freq);
                }
            }
        }

        private bool alex6bphpf_bypass = false;
        public bool Alex6BPHPFBypass
        {
            get { return alex6bphpf_bypass; }
            set
            {
                alex6bphpf_bypass = value;
                if (chkPower.Checked)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    SetAlexRXFilters(freq);
                }
            }
        }

        private bool swrprotection = true;
        public bool SWRProtection
        {
            get { return swrprotection; }
            set
            {
                swrprotection = value;
            }
        }

        private bool attontx = false;
        public bool ATTOnTX
        {
            get { return attontx; }
            set
            {
                attontx = value;
            }
        }

        private bool alexpresent = false;
        public bool AlexPresent
        {
            get { return alexpresent; }
            set
            {
                alexpresent = value;
                int alex_enabled = 0;
                if (alexpresent)
                {
                    if (!comboMeterTXMode.Items.Contains("Ref Pwr"))
                        comboMeterTXMode.Items.Insert(1, "Ref Pwr");
                    // if (!comboMeterTXMode.Items.Contains("SWR"))
                    //    comboMeterTXMode.Items.Insert(2, "SWR");

                    if (comboMeterTXMode.SelectedIndex < 0)
                        comboMeterTXMode.SelectedIndex = 0;
                    if (chkPower.Checked)
                    {

                        //  UpdateRX1DDSFreq();
                        //  UpdateTXDDSFreq();
                        SetAlexRXFilters(fwc_dds_freq);
                        SetAlexTXFilters(tx_dds_freq_mhz);
                    }

                    alex_enabled = 1;
                }
                else
                {
                    string cur_txt = comboMeterTXMode.Text;
                    {
                        if (comboMeterTXMode.Items.Contains("Ref Pwr"))
                            comboMeterTXMode.Items.Remove("Ref Pwr");

                        //                        if (comboMeterTXMode.Items.Contains("SWR"))
                        //                           comboMeterTXMode.Items.Remove("SWR");
                    }
                    comboMeterTXMode.Text = cur_txt;
                    if (comboMeterTXMode.SelectedIndex < 0 &&
                        comboMeterTXMode.Items.Count > 0)
                        comboMeterTXMode.SelectedIndex = 0;
                    alex_enabled = 0;
                }
                JanusAudio.SetAlexEnabled(alex_enabled);
            }
        }

        private string metis_network_ip_addr;
        public string MetisNetworkIPAddr
        {
            get { return metis_network_ip_addr; }
            set
            {
                bool changed = false;
                if (metis_network_ip_addr != null && !metis_network_ip_addr.Equals(value))
                {
                    changed = true;
                }
                metis_network_ip_addr = value;
                if (changed)
                {
                    JanusAudio.DeInitMetisSockets();
                    JanusAudio.initMetis();
                }
            }
        }

        private int mic_gain_min = -40;
        public int MicGainMin
        {
            get { return mic_gain_min; }
            set
            {
                mic_gain_min = value;
                ptbMic_Scroll(this, EventArgs.Empty);
            }
        }

        private int mic_gain_max = 10;
        public int MicGainMax
        {
            get { return mic_gain_max; }
            set
            {
                mic_gain_max = value;
                ptbMic_Scroll(this, EventArgs.Empty);
            }
        }

        private PreampMode rx1_preamp_mode = PreampMode.HIGH;
        public PreampMode RX1PreampMode
        {
            get { return rx1_preamp_mode; }
            set
            {
                rx1_preamp_mode = value;
                if (ModelIsHPSDRorHermes())
                {
                    // make sure value being set makes sense base on installed hardware - morph it if not 
                    if (rx1_preamp_mode == PreampMode.OFF ||
                        rx1_preamp_mode == PreampMode.MED ||
                        rx1_preamp_mode == PreampMode.LOW ||
                        rx1_preamp_mode == PreampMode.HIGH)
                    {
                        rx1_preamp_mode = PreampMode.HPSDR_OFF;
                    }
                    else if (!alexpresent &&
                                ((rx1_preamp_mode == PreampMode.HPSDR_MINUS10) ||
                                    (rx1_preamp_mode == PreampMode.HPSDR_MINUS20) ||
                                    (rx1_preamp_mode == PreampMode.HPSDR_MINUS30) ||
                                    (rx1_preamp_mode == PreampMode.HPSDR_MINUS40) ||
                                    (rx1_preamp_mode == PreampMode.HPSDR_MINUS50)
                                )
                            )
                    {
                        rx1_preamp_mode = PreampMode.HPSDR_OFF;
                    }
                }
                else
                {
                    if (rx1_preamp_mode == PreampMode.HPSDR_ON ||
                        rx1_preamp_mode == PreampMode.HPSDR_OFF ||
                        rx1_preamp_mode == PreampMode.HPSDR_MINUS10 ||
                        rx1_preamp_mode == PreampMode.HPSDR_MINUS20 ||
                        rx1_preamp_mode == PreampMode.HPSDR_MINUS30 ||
                        rx1_preamp_mode == PreampMode.HPSDR_MINUS40 ||
                        rx1_preamp_mode == PreampMode.HPSDR_MINUS50)
                    {
                        rx1_preamp_mode = PreampMode.OFF;
                    }
                }
                if (fwc_init && current_model == Model.FLEX5000)
                {
                    switch (rx1_preamp_mode)
                    {
                        case PreampMode.OFF:
                            //FWC.SetPreamp(false);
                            break;
                        case PreampMode.HIGH:
                            //FWC.SetPreamp(true);
                            break;
                    }
                }
                else if (ModelIsHPSDRorHermes())
                {
                    int alex_atten = 0;
                    int merc_preamp = 0;
                    switch (rx1_preamp_mode)
                    {
                        case PreampMode.HPSDR_ON:  //0dB
                            merc_preamp = 1;
                            alex_atten = 0;
                            break;
                        case PreampMode.HPSDR_OFF: //-20dB
                            merc_preamp = 0;
                            alex_atten = 0;
                            break;
                        case PreampMode.HPSDR_MINUS10:
                            merc_preamp = 1;
                            alex_atten = 1;
                            break;
                        case PreampMode.HPSDR_MINUS20:
                            merc_preamp = 1;
                            alex_atten = 2;
                            break;
                        case PreampMode.HPSDR_MINUS30:
                            merc_preamp = 1;
                            alex_atten = 3;
                            break;
                        case PreampMode.HPSDR_MINUS40:
                            merc_preamp = 0;
                            alex_atten = 2;
                            break;
                        case PreampMode.HPSDR_MINUS50:
                            merc_preamp = 0;
                            alex_atten = 3;
                            break;
                    }
                    JanusAudio.SetMercPreamp(merc_preamp);
                    JanusAudio.SetAlexAtten(alex_atten);

                }
                else
                {
                    switch (rx1_preamp_mode)
                    {
                        case PreampMode.OFF:
                            Hdw.Attn = true;
                            Hdw.GainRelay = true;	// 0dB
                            break;
                        case PreampMode.LOW:
                            Hdw.Attn = false;
                            Hdw.GainRelay = true;	// 0dB
                            break;
                        case PreampMode.MED:
                            Hdw.Attn = true;
                            Hdw.GainRelay = false;	// 26dB
                            break;
                        case PreampMode.HIGH:
                            Hdw.Attn = false;
                            Hdw.GainRelay = false;
                            break;
                    }
                }

                switch (rx1_preamp_mode)
                {
                    case PreampMode.OFF:
                        comboPreamp.Text = "Off";
                        break;
                    case PreampMode.LOW:
                        comboPreamp.Text = "Low";
                        break;
                    case PreampMode.MED:
                        comboPreamp.Text = "Med";
                        break;
                    case PreampMode.HIGH:
                        switch (current_model)
                        {
                            case Model.FLEX5000:
                                comboPreamp.Text = "On";
                                break;
                            default:
                                comboPreamp.Text = "High";
                                break;
                        }
                        break;

                    case PreampMode.HPSDR_ON:
                        comboPreamp.Text = "0dB";
                        break;

                    case PreampMode.HPSDR_OFF:
                        comboPreamp.Text = "-20dB";
                        break;

                    case PreampMode.HPSDR_MINUS10:
                        comboPreamp.Text = "-10db";
                        break;

                    case PreampMode.HPSDR_MINUS20:
                        comboPreamp.Text = "-20db";
                        break;

                    case PreampMode.HPSDR_MINUS30:
                        comboPreamp.Text = "-30db";
                        break;

                    case PreampMode.HPSDR_MINUS40:
                        comboPreamp.Text = "-40dB";
                        break;

                    case PreampMode.HPSDR_MINUS50:
                        comboPreamp.Text = "-50dB";
                        break;
                }
                Display.RX1PreampOffset = rx1_preamp_offset[(int)rx1_preamp_mode];

                if (chkSquelch.Checked)
                    ptbSquelch_Scroll(this, EventArgs.Empty);

            }
        }
        private PreampMode rx2_preamp_mode = PreampMode.HIGH;
        public PreampMode RX2PreampMode
        {
            get { return rx2_preamp_mode; }
            set
            {
                if (!fwc_init || current_model != Model.FLEX5000) return;
                rx2_preamp_mode = value;
                if (initializing) return;
                switch (rx2_preamp_mode)
                {
                    case PreampMode.OFF:
                        FWCRX2Preamp = false;
                        chkRX2Preamp.Checked = false;
                        break;
                    case PreampMode.HIGH:
                        FWCRX2Preamp = true;
                        chkRX2Preamp.Checked = true;
                        break;
                }
                Display.RX2PreampOffset = rx2_preamp_offset[(int)rx2_preamp_mode];
                if (chkRX2Squelch.Checked)
                    ptbRX2Squelch_Scroll(this, EventArgs.Empty);
            }
        }

        public int Squelch
        {
            get { return ptbSquelch.Value; }
            set
            {
                ptbSquelch.Value = value;
                if (chkSquelch.Checked)
                    ptbSquelch_Scroll(this, EventArgs.Empty);
            }
        }

        public int Zoom
        {
            get { return ptbDisplayZoom.Value; }
            set
            {
                ptbDisplayZoom.Value = value;
                ptbDisplayZoom_Scroll(this, EventArgs.Empty);
            }
        }

        public int Pan
        {
            get { return ptbDisplayPan.Value; }
            set
            {
                ptbDisplayPan.Value = value;
                ptbDisplayPan_Scroll(this, EventArgs.Empty);
            }
        }

        public AGCMode RX1AGCMode
        {
            get { return (AGCMode)comboAGC.SelectedIndex; }
            set { comboAGC.SelectedIndex = (int)value; }
        }

        public AGCMode RX2AGCMode
        {
            get
            {
                if (!fwc_init || current_model != Model.FLEX5000) return AGCMode.FIRST;
                return (AGCMode)comboRX2AGC.SelectedIndex;
            }
            set
            {
                if (!fwc_init || current_model != Model.FLEX5000) return;
                comboRX2AGC.SelectedIndex = (int)value;
            }
        }

        public bool VFOSplit
        {
            get { return chkVFOSplit.Checked; }
            set { chkVFOSplit.Checked = value; }
        }

        public bool RIT
        {
            get { return chkRIT.Checked; }
            set { chkRIT.Checked = value; }
        }

        public bool RITOn
        {
            get { return chkRIT.Checked; }
            set { chkRIT.Checked = value; }
        }

        public int RITValue
        {
            get { return (int)udRIT.Value; }
            set { udRIT.Value = value; }
        }

        public bool XITOn
        {
            get { return chkXIT.Checked; }
            set { chkXIT.Checked = value; }
        }

        public int XITValue
        {
            get { return (int)udXIT.Value; }
            set { udXIT.Value = value; }
        }

        private int fm_tx_bw = 6000;
        public int FMtxBW
        {
            get { return fm_tx_bw; }
            set { fm_tx_bw = value; }
        }

        private int mox_delay = 10;
        public int MoxDelay
        {
            get { return mox_delay; }
            set { mox_delay = value; }
        }
        private int rf_delay = 30;
        public int RFDelay
        {
            get { return rf_delay; }
            set { rf_delay = value; }
        }

        private int tx_filter_high = 3100;
        public int TXFilterHigh
        {
            get { return tx_filter_high; }
            set
            {
                tx_filter_high = value;
                SetTXFilters(rx1_dsp_mode, tx_filter_low, tx_filter_high);
                if (Display.DrawTXFilter && !chkPower.Checked)
                {
                    switch (Display.CurrentDisplayMode)
                    {
                        case DisplayMode.PANADAPTER:
                        case DisplayMode.SPECTRUM:
                        case DisplayMode.HISTOGRAM:
                        case DisplayMode.WATERFALL:
                        case DisplayMode.PANAFALL:
                        case DisplayMode.PANASCOPE:
                        case DisplayMode.SPECTRASCOPE:
                            Display.DrawBackground();
                            break;
                    }
                }
            }
        }

        private int tx_filter_low = 200;
        public int TXFilterLow
        {
            get { return tx_filter_low; }
            set
            {
                tx_filter_low = value;
                SetTXFilters(rx1_dsp_mode, tx_filter_low, tx_filter_high);
                if (Display.DrawTXFilter && !chkPower.Checked)
                {
                    switch (Display.CurrentDisplayMode)
                    {
                        case DisplayMode.PANADAPTER:
                        case DisplayMode.SPECTRUM:
                        case DisplayMode.HISTOGRAM:
                        case DisplayMode.WATERFALL:
                        case DisplayMode.PANAFALL:
                        case DisplayMode.PANASCOPE:
                        case DisplayMode.SPECTRASCOPE:
                            Display.DrawBackground();
                            break;
                    }
                }
            }
        }

        private delegate void SetTimerDel(System.Windows.Forms.Timer t, bool enable);
        private void SetTimer(System.Windows.Forms.Timer t, bool enable)
        {
            t.Enabled = enable;
        }

        private bool high_swr = false;
        public bool HighSWR
        {
            get { return high_swr; }
            set
            {
                high_swr = value;
                Display.HighSWR = value;
                //Display.DrawBackground();
            }
        }

        private bool disable_ptt = false;
        public bool DisablePTT
        {
            get { return disable_ptt; }
            set { disable_ptt = value; }
        }

        public bool PowerOn
        {
            get { return chkPower.Checked; }
            set { chkPower.Checked = value; }
        }

        public bool PowerEnabled
        {
            get { return chkPower.Enabled; }
            set { chkPower.Enabled = value; }
        }

        private bool second_sound_card_stereo = false;
        public bool SecondSoundCardStereo
        {
            get { return second_sound_card_stereo; }
            set
            {
                second_sound_card_stereo = value;
                Audio.VACStereo = value;
            }
        }

        private bool vac_enabled = false;
        public bool VACEnabled
        {
            get { return vac_enabled; }
            set
            {
                vac_enabled = value;
                Audio.VACEnabled = value;
                if (chkVACEnabled != null) chkVACEnabled.Checked = value;
                if (chkCWVAC != null) chkCWVAC.Checked = value;
                if (chkPhoneVAC != null) chkPhoneVAC.Checked = value;
                if (chkFMVAC != null) chkFMVAC.Checked = value;
            }
        }

        private bool vaciq_enabled = false;
        public bool VACIQEnabled
        {
            get { return vaciq_enabled; }
            set
            {
                vaciq_enabled = value;
                Audio.VACOutputIQ = value;
                if (chkVACIQEnabled != null) chkVACIQEnabled.Checked = value;
                if (chkCWVAC != null) chkCWVACIQ.Checked = value;
                // if (chkPhoneVAC != null) chkPhoneVAC.Checked = value;
                // if (chkFMVAC != null) chkFMVAC.Checked = value;
            }
        }

        private int audio_driver_index1 = 0;
        public int AudioDriverIndex1
        {
            get { return audio_driver_index1; }
            set { audio_driver_index1 = value; }
        }

        private int audio_driver_index2 = 0;
        public int AudioDriverIndex2
        {
            get { return audio_driver_index2; }
            set { audio_driver_index2 = value; }
        }

        private int audio_input_index1 = 0;
        public int AudioInputIndex1
        {
            get { return audio_input_index1; }
            set { audio_input_index1 = value; }
        }

        private int audio_input_index2 = 0;
        public int AudioInputIndex2
        {
            get { return audio_input_index2; }
            set { audio_input_index2 = value; }
        }

        private int audio_output_index1 = 0;
        public int AudioOutputIndex1
        {
            get { return audio_output_index1; }
            set { audio_output_index1 = value; }
        }

        private int audio_output_index2 = 0;
        public int AudioOutputIndex2
        {
            get { return audio_output_index2; }
            set { audio_output_index2 = value; }
        }

        private double audio_volts1 = 2.23;
        public double AudioVolts1
        {
            get { return audio_volts1; }
            set
            {
                audio_volts1 = value;
                Audio.AudioVolts1 = audio_volts1;
                ptbPWR_Scroll(this, EventArgs.Empty);
            }
        }

        private int mixer_id1 = 0;
        public int MixerID1
        {
            get { return mixer_id1; }
            set { mixer_id1 = value; }
        }

        private int mixer_id2 = 0;
        public int MixerID2
        {
            get { return mixer_id2; }
            set { mixer_id2 = value; }
        }

        private int mixer_rx_mux_id1 = 0;
        public int MixerRXMuxID1
        {
            get { return mixer_rx_mux_id1; }
            set { mixer_rx_mux_id1 = value; }
        }

        private int mixer_tx_mux_id1 = 0;
        public int MixerTXMuxID1
        {
            get { return mixer_tx_mux_id1; }
            set { mixer_tx_mux_id1 = value; }
        }

        private int mixer_rx_mux_id2 = 0;
        public int MixerRXMuxID2
        {
            get { return mixer_rx_mux_id2; }
            set { mixer_rx_mux_id2 = value; }
        }

        private int mixer_tx_mux_id2 = 0;
        public int MixerTXMuxID2
        {
            get { return mixer_tx_mux_id2; }
            set { mixer_tx_mux_id2 = value; }
        }

        private int sample_rate1 = 48000;
        public int SampleRate1
        {
            get { return sample_rate1; }
            set
            {
                sample_rate1 = value;
                RadioDSP.SampleRate = value;
                Audio.SampleRate1 = value;
                Display.SampleRate = value;
                CWSynth.SampleRate = value;
                switch (rx1_dsp_mode)
                {
                    case DSPMode.CWL:
                        RadioDSP.KeyerFreq = (float)cw_pitch;
                        break;
                    case DSPMode.CWU:
                        RadioDSP.KeyerFreq = (float)-cw_pitch;
                        break;
                    case DSPMode.SPEC:
                        SetRX1Mode(DSPMode.SPEC);
                        break;
                }

                switch (Display.CurrentDisplayMode)
                {
                    case DisplayMode.PANADAPTER:
                    case DisplayMode.WATERFALL:
                    case DisplayMode.PANAFALL:
                    case DisplayMode.PANASCOPE:
                        CalcDisplayFreq();
                        btnDisplayPanCenter.PerformClick();
                        break;
                }
            }
        }

        private int sample_rate2 = 48000;
        public int SampleRate2
        {
            get { return sample_rate2; }
            set
            {
                sample_rate2 = value;
                Audio.SampleRate2 = value;
            }
        }

        private int num_channels = 2;
        public int NumChannels
        {
            get { return num_channels; }
            set { num_channels = value; }
        }

        private int block_size1;
        public int BlockSize1
        {
            get { return block_size1; }
            set
            {
                block_size1 = value;
                Audio.BlockSize = value;
                radio.GetDSPRX(0, 0).AudioSize = value;
            }
        }

        private int block_size2;
        public int BlockSize2
        {
            get { return block_size2; }
            set
            {
                block_size2 = value;
                Audio.BlockSizeVAC = value;
            }
        }

        private bool cw_key_mode = false;
        public bool CWKeyMode
        {
            get { return cw_key_mode; }
            set { cw_key_mode = value; }
        }

        private int peak_text_delay = 500;
        public int PeakTextDelay
        {
            get { return peak_text_delay; }
            set
            {
                peak_text_delay = value;
                timer_peak_text.Interval = value;
            }
        }

        private int meter_delay = 100;
        public int MeterDelay
        {
            get { return meter_delay; }
            set
            {
                meter_delay = value;
                MultimeterPeakHoldTime = MultimeterPeakHoldTime;
            }
        }

        private int meter_dig_delay = 500;
        public int MeterDigDelay
        {
            get { return meter_dig_delay; }
            set { meter_dig_delay = value; }
        }

        private int cpu_meter_delay = 1000;
        public int CPUMeterDelay
        {
            get { return cpu_meter_delay; }
            set
            {
                cpu_meter_delay = value;
                timer_cpu_meter.Interval = value;
            }
        }

        private int display_grid_x = 0;
        public int DisplayGridX
        {
            get { return display_grid_x; }
            set
            {
                display_grid_x = value;
            }
        }

        private int display_grid_w = 0;
        public int DisplayGridW
        {
            get { return display_grid_w; }
            set
            {
                display_grid_w = value;
            }
        }

        private int display_fps = 15;
        private int display_delay = 1000 / 15;
        public int DisplayFPS
        {
            get { return display_fps; }
            set
            {
                display_fps = value;
                display_delay = 1000 / display_fps;
            }
        }

        private int multimeter_peak_hold_time = 1000;
        private int multimeter_peak_hold_samples = 10;
        public int MultimeterPeakHoldTime
        {
            get { return multimeter_peak_hold_time; }
            set
            {
                multimeter_peak_hold_time = value;
                multimeter_peak_hold_samples = value / meter_delay;
            }
        }

        private int multimeter_text_peak_time = 500;
        private int multimeter_text_peak_samples = 5;
        public int MultimeterTextPeakTime
        {
            get { return multimeter_text_peak_time; }
            set
            {
                multimeter_text_peak_time = value;
                multimeter_text_peak_samples = value / meter_delay;
                if (multimeter_text_peak_samples > meter_text_history.Length)
                {
                    float[] temp = new float[multimeter_text_peak_samples];
                    for (int i = 0; i < meter_text_history.Length; i++)
                        temp[i] = meter_text_history[i];
                    meter_text_history = temp;
                }
            }
        }

        private Pen txtvfoafreq_forecolor_pen = new Pen(Color.Yellow, 2.0f);
        private Color vfo_text_light_color = Color.Yellow;
        public Color VFOTextLightColor
        {
            get { return vfo_text_light_color; }
            set
            {
                if (chkPower.Checked)
                {
                    txtVFOAFreq.ForeColor = value;
                    txtVFOAMSD.ForeColor = value;
                    txtvfoafreq_forecolor_pen.Color = vfo_text_light_color;
                }

                vfo_text_light_color = value;
            }
        }

        private Color vfo_text_dark_color = Color.Olive;
        public Color VFOTextDarkColor
        {
            get { return vfo_text_dark_color; }
            set
            {
                if (!chkPower.Checked)
                {
                    txtVFOAFreq.ForeColor = value;
                    txtVFOAMSD.ForeColor = value;
                    txtVFOALSD.ForeColor = value;
                    txtvfoafreq_forecolor_pen.Color = vfo_text_dark_color;
                }
                if (!chkVFOSplit.Checked)
                {
                    txtVFOBFreq.ForeColor = value;
                    txtVFOBMSD.ForeColor = value;
                    txtVFOBLSD.ForeColor = value;
                }

                vfo_text_dark_color = value;
            }
        }

        private Color band_text_light_color = Color.Lime;
        public Color BandTextLightColor
        {
            get { return band_text_light_color; }
            set
            {
                if (chkPower.Checked)
                    txtVFOABand.ForeColor = value;
                if (chkVFOSplit.Checked)
                    txtVFOBBand.ForeColor = value;

                band_text_light_color = value;
            }
        }

        private Color band_text_dark_color = Color.Green;
        public Color BandTextDarkColor
        {
            get { return band_text_dark_color; }
            set
            {
                if (!chkPower.Checked)
                    txtVFOABand.ForeColor = value;
                if (!chkVFOSplit.Checked)
                    txtVFOBBand.ForeColor = value;

                band_text_dark_color = value;
            }
        }

        private Color peak_text_color = Color.DodgerBlue;
        public Color PeakTextColor
        {
            get { return peak_text_color; }
            set
            {
                peak_text_color = value;
                txtDisplayCursorOffset.ForeColor = value;
                txtDisplayCursorPower.ForeColor = value;
                txtDisplayCursorFreq.ForeColor = value;
                txtDisplayPeakOffset.ForeColor = value;
                txtDisplayPeakPower.ForeColor = value;
                txtDisplayPeakFreq.ForeColor = value;
            }
        }

        private Color out_of_band_color = Color.DimGray;
        public Color OutOfBandColor
        {
            get { return out_of_band_color; }
            set
            {
                out_of_band_color = value;
                if (SetupForm != null)
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private Color button_selected_color = Color.Yellow;
        public Color ButtonSelectedColor
        {
            get { return button_selected_color; }
            set
            {
                button_selected_color = value;
                if (!fwc_init || current_model != Model.FLEX5000 || !FWCEEPROM.RX2OK)
                    rx1_band_color = button_selected_color;
                CheckSelectedButtonColor();
            }
        }

        private Color meter_left_color = Color.Green;
        public Color MeterLeftColor
        {
            get { return meter_left_color; }
            set
            {
                meter_left_color = value;
                picMultiMeterDigital.Invalidate();
            }
        }

        private Color meter_right_color = Color.Lime;
        public Color MeterRightColor
        {
            get { return meter_right_color; }
            set
            {
                meter_right_color = value;
                picMultiMeterDigital.Invalidate();
            }
        }

        private Color rx1_band_color = Color.Yellow;
        public Color RX1BandColor
        {
            get { return rx1_band_color; }
            set
            {
                rx1_band_color = value;
            }
        }

        private Color rx2_band_color = Color.Green;
        public Color RX2BandColor
        {
            get { return rx2_band_color; }
            set
            {
                rx2_band_color = value;
            }
        }

        private Color tx_band_color = Color.Red;
        public Color TXBandColor
        {
            get { return tx_band_color; }
            set
            {
                tx_band_color = value;
            }
        }

        private Keys key_tune_up_1 = Keys.Q;
        public Keys KeyTuneUp1
        {
            get { return key_tune_up_1; }
            set { key_tune_up_1 = value; }
        }

        private Keys key_tune_down_1 = Keys.A;
        public Keys KeyTuneDown1
        {
            get { return key_tune_down_1; }
            set { key_tune_down_1 = value; }
        }

        private Keys key_tune_up_2 = Keys.W;
        public Keys KeyTuneUp2
        {
            get { return key_tune_up_2; }
            set { key_tune_up_2 = value; }
        }

        private Keys key_tune_down_2 = Keys.S;
        public Keys KeyTuneDown2
        {
            get { return key_tune_down_2; }
            set { key_tune_down_2 = value; }
        }

        private Keys key_tune_up_3 = Keys.E;
        public Keys KeyTuneUp3
        {
            get { return key_tune_up_3; }
            set { key_tune_up_3 = value; }
        }

        private Keys key_tune_down_3 = Keys.D;
        public Keys KeyTuneDown3
        {
            get { return key_tune_down_3; }
            set { key_tune_down_3 = value; }
        }

        private Keys key_tune_up_4 = Keys.R;
        public Keys KeyTuneUp4
        {
            get { return key_tune_up_4; }
            set { key_tune_up_4 = value; }
        }

        private Keys key_tune_down_4 = Keys.F;
        public Keys KeyTuneDown4
        {
            get { return key_tune_down_4; }
            set { key_tune_down_4 = value; }
        }

        private Keys key_tune_up_5 = Keys.T;
        public Keys KeyTuneUp5
        {
            get { return key_tune_up_5; }
            set { key_tune_up_5 = value; }
        }

        private Keys key_tune_down_5 = Keys.G;
        public Keys KeyTuneDown5
        {
            get { return key_tune_down_5; }
            set { key_tune_down_5 = value; }
        }

        private Keys key_tune_up_6 = Keys.Y;
        public Keys KeyTuneUp6
        {
            get { return key_tune_up_6; }
            set { key_tune_up_6 = value; }
        }

        private Keys key_tune_down_6 = Keys.H;
        public Keys KeyTuneDown6
        {
            get { return key_tune_down_6; }
            set { key_tune_down_6 = value; }
        }

        private Keys key_tune_up_7 = Keys.U;
        public Keys KeyTuneUp7
        {
            get { return key_tune_up_7; }
            set { key_tune_up_7 = value; }
        }

        private Keys key_tune_down_7 = Keys.J;
        public Keys KeyTuneDown7
        {
            get { return key_tune_down_7; }
            set { key_tune_down_7 = value; }
        }

        private Keys key_rit_up = Keys.O;
        public Keys KeyRITUp
        {
            get { return key_rit_up; }
            set { key_rit_up = value; }
        }

        private Keys key_rit_down = Keys.I;
        public Keys KeyRITDown
        {
            get { return key_rit_down; }
            set { key_rit_down = value; }
        }

        private int rit_step_rate = 50;
        public int RITStepRate
        {
            get { return rit_step_rate; }
            set { rit_step_rate = value; }
        }

        private Keys key_xit_up = Keys.OemOpenBrackets;
        public Keys KeyXITUp
        {
            get { return key_xit_up; }
            set { key_xit_up = value; }
        }

        private Keys key_xit_down = Keys.P;
        public Keys KeyXITDown
        {
            get { return key_xit_down; }
            set { key_xit_down = value; }
        }

        private int xit_step_rate = 50;
        public int XITStepRate
        {
            get { return xit_step_rate; }
            set { xit_step_rate = value; }
        }

        private Keys key_band_up = Keys.M;
        public Keys KeyBandUp
        {
            get { return key_band_up; }
            set { key_band_up = value; }
        }

        private Keys key_band_down = Keys.N;
        public Keys KeyBandDown
        {
            get { return key_band_down; }
            set { key_band_down = value; }
        }

        private Keys key_filter_up = Keys.B;
        public Keys KeyFilterUp
        {
            get { return key_filter_up; }
            set { key_filter_up = value; }
        }

        private Keys key_filter_down = Keys.V;
        public Keys KeyFilterDown
        {
            get { return key_filter_down; }
            set { key_filter_down = value; }
        }

        private Keys key_mode_up = Keys.X;
        public Keys KeyModeUp
        {
            get { return key_mode_up; }
            set { key_mode_up = value; }
        }

        private Keys key_mode_down = Keys.Z;
        public Keys KeyModeDown
        {
            get { return key_mode_down; }
            set { key_mode_down = value; }
        }

        private Keys key_cw_dot = Keys.OemPeriod;
        public Keys KeyCWDot
        {
            get { return key_cw_dot; }
            set { key_cw_dot = value; }
        }

        private Keys key_cw_dash = Keys.OemQuestion;
        public Keys KeyCWDash
        {
            get { return key_cw_dash; }
            set { key_cw_dash = value; }
        }

        private bool rfe_pa_tr_enable = false;
        public bool RFE_PA_TR_enable
        {
            get { return rfe_pa_tr_enable; }
            set
            {
                rfe_pa_tr_enable = value;
                if (SetupForm != null)
                    SetupForm.RFE_PA_TR = value;
            }
        }

        private Keys key_space_ptt = Keys.Space;
        public Keys KeySpacePTT
        {
            get { return key_space_ptt; }
            set { key_space_ptt = value; }
        }



        private bool xvtr_present = false;
        public bool XVTRPresent
        {
            get { return xvtr_present; }
            set
            {
                xvtr_present = value;
                radBand2.Enabled = value;
                Hdw.XVTRPresent = value;
                if (value)
                    MaxFreq = 146.0;
                else
                    MaxFreq = 65.0;
            }
        }

        private bool pa_present = false;
        public bool PAPresent
        {
            get { return pa_present; }
            set
            {
                pa_present = value;
                if (current_model == Model.SDR1000)
                    Hdw.PAPresent = value;
                if (pa_present || alexpresent)
                {
                    if (!comboMeterTXMode.Items.Contains("Ref Pwr"))
                        comboMeterTXMode.Items.Insert(1, "Ref Pwr");
                    if (pa_present) //remove for alex swr
                    {
                        if (!comboMeterTXMode.Items.Contains("SWR"))
                            comboMeterTXMode.Items.Insert(2, "SWR");
                    }
                    if (alexpresent)
                    {
                        //                       if (comboMeterTXMode.Items.Contains("SWR"))
                        //                           comboMeterTXMode.Items.Remove("SWR");
                    }
                    if (comboMeterTXMode.SelectedIndex < 0)
                        comboMeterTXMode.SelectedIndex = 0;
                }
                else
                {
                    string cur_txt = comboMeterTXMode.Text;
                    if (comboMeterTXMode.Items.Contains("Ref Pwr"))
                        comboMeterTXMode.Items.Remove("Ref Pwr");
                    //                   if (comboMeterTXMode.Items.Contains("SWR"))
                    //                      comboMeterTXMode.Items.Remove("SWR");

                    comboMeterTXMode.Text = cur_txt;
                    if (comboMeterTXMode.SelectedIndex < 0 &&
                        comboMeterTXMode.Items.Count > 0)
                        comboMeterTXMode.SelectedIndex = 0;
                }
                ptbPWR_Scroll(this, EventArgs.Empty);
            }
        }

        private bool atu_present = false;
        public bool ATUPresent
        {
            get { return atu_present; }
            set
            {
                atu_present = value;
                comboTuneMode.Visible = atu_present;
                comboTuneMode.SelectedIndex = 0;
            }
        }

        private bool usb_present = false;
        public bool USBPresent
        {
            get { return usb_present; }
            set
            {
                usb_present = value;
                if (current_model == Model.SDR1000)
                    Hdw.USBPresent = value;
                if (SetupForm != null)
                    SetupForm.USBPresent = value;
            }
        }

        private bool ozy_control = false;
        public bool OzyControl
        {
            get { return ozy_control; }
            set
            {
                ozy_control = value;
                Hdw.OzyControl = value;
                if (SetupForm != null)
                    SetupForm.OzyControl = value;
            }
        }

        public PerformanceCounter cpu_usage = null;
        private void CpuUsage()
        //{
        // get
        {
            try
            {
                cpu_usage = new PerformanceCounter
                   ("Processor", "% Processor Time", "_Total", machineName);
                //return cpu_usage.NextValue();
            }
            catch (Exception)
            {
                timer_cpu_meter.Enabled = false;
                //lblCPUMeter.Visible = false;
                txtCPUMeter.Visible = false;
                //return 0.0f;
            }
        }
        // }

        /*	private PerformanceCounter cpu_usage;
            public float CpuUsage
            {
                get
                {
                    try
                    {
                        if (cpu_usage == null)
                        {
                            cpu_usage = new PerformanceCounter(
                                "Processor Information", "% Processor Time", "_Total", true);
                        }
                        return cpu_usage.NextValue(); 
                    }
                    catch(Exception)
                    {
                        timer_cpu_meter.Enabled = false;
                        lblCPUMeter.Visible = false;
                        return 0.0f;
                    }
                }
            } */

        private int scope_time = 50;
        public int ScopeTime
        {
            get { return scope_time; }
            set
            {
                scope_time = value;
                Display.ScopeTime = value;
            }
        }

        // Added 6/11/05 BT to support CAT
        public float MultiMeterCalOffset
        {
            get { return rx1_meter_cal_offset; }
        }

        private bool s_meter = false;
        public bool SMeter
        {
            get { return s_meter; }
            set { s_meter = value; }
        }

        private bool spacebar_last_btn = false;
        public bool SpaceBarLastBtn
        {
            get { return spacebar_last_btn; }
            set { spacebar_last_btn = value; }
        }

        private bool spacebar_ptt = true;
        public bool SpaceBarPTT
        {
            get { return spacebar_ptt; }
            set { spacebar_ptt = value; }
        }

        private bool spacebar_vox = false;
        public bool SpaceBarVOX
        {
            get { return spacebar_vox; }
            set { spacebar_vox = value; }
        }

        private bool spacebar_mic_mute = false;
        public bool SpaceBarMicMute
        {
            get { return spacebar_mic_mute; }
            set { spacebar_mic_mute = value; }
        }

        public float PreampOffset
        {
            get { return rx1_preamp_offset[(int)rx1_preamp_mode]; }
        }

        public bool RXEQ
        {
            get
            {
                if (chkRXEQ != null) return chkRXEQ.Checked;
                else return false;
            }
            set
            {
                if (chkRXEQ != null) chkRXEQ.Checked = value;
            }
        }

        public bool TXEQ
        {
            get
            {
                if (chkTXEQ != null) return chkTXEQ.Checked;
                else return false;
            }
            set
            {
                if (chkTXEQ != null) chkTXEQ.Checked = value;
            }
        }

        private bool disable_split_on_bandchange = false;
        public bool DisableSplitOnBandchange
        {
            get { return disable_split_on_bandchange; }
            set { disable_split_on_bandchange = value; }
        }

        private bool spacenav_controlvfos = true;
        public bool SpaceNavControlVFOs
        {
            get { return spacenav_controlvfos; }
            set { spacenav_controlvfos = value; }
        }

        private bool spacenav_flypanadapter = false;
        public bool SpaceNavFlyPanadapter
        {
            get { return spacenav_flypanadapter; }
            set { spacenav_flypanadapter = value; }
        }

        private bool rxonly_hf_enabled = false;
        public bool RXOnly_HF_Enabled
        {
            get { return rxonly_hf_enabled; }
            set { rxonly_hf_enabled = value; }
        }

        private bool enable_vu_power_curve = true;
        public bool Enable_VU_Power_Curve
        {
            get { return enable_vu_power_curve; }
            set { enable_vu_power_curve = value; }
        }

        private string current_skin = "Default";
        public string CurrentSkin
        {
            get { return current_skin; }
            set
            {
                current_skin = value;
            }
        }

        private bool radar_color_update = false;
        public bool RadarColorUpdate
        {
            get { return radar_color_update; }
            set
            {
                radar_color_update = value;
            }
        }

        private double fm_tx_offset_mhz = 0;
        public double FMTXOffsetMHz
        {
            get { return fm_tx_offset_mhz; }
            set
            {
                fm_tx_offset_mhz = value;
                if (udFMOffset.Value != (decimal)fm_tx_offset_mhz)
                    udFMOffset.Value = (decimal)fm_tx_offset_mhz;
            }
        }

        private FMTXMode current_fm_tx_mode = FMTXMode.Simplex;
        public FMTXMode CurrentFMTXMode
        {
            get { return current_fm_tx_mode; }
            set
            {
                current_fm_tx_mode = value;
                switch (current_fm_tx_mode)
                {
                    case FMTXMode.High:
                        if (!chkFMTXHigh.Checked)
                            chkFMTXHigh.Checked = true;
                        break;
                    case FMTXMode.Simplex:
                        if (!chkFMTXSimplex.Checked)
                            chkFMTXSimplex.Checked = true;
                        break;
                    case FMTXMode.Low:
                        if (!chkFMTXLow.Checked)
                            chkFMTXLow.Checked = true;
                        break;
                }
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
        }

        private int fm_deviation_hz = 5000;
        public int FMDeviation_Hz
        {
            get { return fm_deviation_hz; }
            set
            {
                fm_deviation_hz = value;
                if (fm_deviation_hz == 5000)
                {
                    radFMDeviation2kHz.Checked = false;
                    radFMDeviation5kHz.Checked = true;
                }
                else if (fm_deviation_hz == 2500)
                {
                    radFMDeviation5kHz.Checked = false;
                    radFMDeviation2kHz.Checked = true;
                }
            }
        }

        private double si570_fxtal = 114281770; // modif F8CHK
        public double SI570FXtal
        {
            get { return si570_fxtal; }
            set
            {
                si570_fxtal = value;
                SI570_update();
            }
        }

        private bool display_agc_gain_line = true;
        public bool DisplayAGCGainLine
        {
            get { return display_agc_gain_line; }
            set
            {
                display_agc_gain_line = value;
                Display.DisplayAGCGainLine = value;
            }
        }

        private bool display_agc_hang_line = true;
        public bool DisplayAGCHangLine
        {
            get { return display_agc_hang_line; }
            set
            {
                display_agc_hang_line = value;
                Display.DisplayAGCHangLine = value;
            }
        }

        #endregion

        #region Display Routines

        private void UpdateDisplay()
        {
            switch (current_display_engine)
            {
                case DisplayEngine.GDI_PLUS:
                    picDisplay.Invalidate();
                    break;
                /*case DisplayEngine.DIRECT_X:
                    Display.RenderDirectX();
                    break;
                    */
            }
        }
        private int change_overload_color_count = 0;
        private void UpdatePeakText()
        {
            // if mercury update the adc overload indicator 
            if ((current_model == Model.HPSDR && MercuryPresent) ||
                 (current_model == Model.HERMES))
            {
                /*  int rc = JanusAudio.getHaveSync();
                  if (rc == 1)
                  {
                      txtOverload.ForeColor = Color.Green;
                      txtOverload.Text = "Sync";
                  }
                  else
                  {
                      txtOverload.ForeColor = Color.Red;
                      txtOverload.Text = "NoSync";
                  } */

                int oload = JanusAudio.getAndResetADC_Overload();
                if (oload != 0)// && !chkMOX.Checked)
                {
                    txtOverload.Text = "ADC Overload!";
                    ++change_overload_color_count;
                    if (change_overload_color_count >= 2)
                    {
                        change_overload_color_count = 0;
                        if (txtOverload.ForeColor == Color.Red)
                        {
                            txtOverload.ForeColor = Color.Yellow;
                        }
                        else
                        {
                            txtOverload.ForeColor = Color.Red;
                        }
                    }
                }
                else
                {
                    txtOverload.Text = "";
                    change_overload_color_count = 0;
                }
            }

            if (txtVFOAFreq.Text == "" ||
                txtVFOAFreq.Text == "." ||
                txtVFOAFreq.Text == ",")
                return;

            // update peak value
            float x = PixelToHz(Display.MaxX);
            float y = PixelToDb(Display.MaxY);
            y = Display.MaxY;

            double freq = double.Parse(txtVFOAFreq.Text) + (double)x * 0.0000010;

            if (rx1_dsp_mode == DSPMode.CWL)
                freq += (double)cw_pitch * 0.0000010;
            else if (rx1_dsp_mode == DSPMode.CWU)
                freq -= (double)cw_pitch * 0.0000010;

            Display.MaxY = picDisplay.Height;
            txtDisplayPeakOffset.Text = x.ToString("f1") + "Hz";
            txtDisplayPeakPower.Text = y.ToString("f1") + "dBm";

            string temp_text = freq.ToString("f6") + " MHz";
            int jper = temp_text.IndexOf(separator) + 4;
            txtDisplayPeakFreq.Text = String.Copy(temp_text.Insert(jper, " "));
        }

        private float PixelToHz(float x)
        {
            int low, high;
            if (!mox)
            {
                low = Display.RXDisplayLow;
                high = Display.RXDisplayHigh;
            }
            else
            {
                low = Display.TXDisplayLow;
                high = Display.TXDisplayHigh;
            }

            if (!chkMOX.Checked)
            {
                if (chkRIT.Checked)
                {
                    int offset = (int)udRIT.Value;
                    low += offset;
                    high += offset;
                }
            }
            else
            {
                if (chkXIT.Checked)
                {
                    int offset = (int)udXIT.Value;
                    low += offset;
                    high += offset;
                }
            }

            int width = high - low;
            return (float)(low + (double)x / (double)picDisplay.Width * (double)width);
            //return (float)(low + ((double)x*(high - low)/picDisplay.Width));
        }

        private int HzToPixel(float freq)
        {
            int low, high;
            if (!mox)
            {
                low = Display.RXDisplayLow;
                high = Display.RXDisplayHigh;
            }
            else
            {
                low = Display.TXDisplayLow;
                high = Display.TXDisplayHigh;
            }

            int width = high - low;
            return (int)((double)(freq - low) / (double)width * (double)picDisplay.Width);
            //return picDisplay.Width/2+(int)(freq/(high-low)*picDisplay.Width);
        }

        private float PixelToDb(float y)
        {
            if (chkSplitDisplay.Checked || Display.CurrentDisplayMode == DisplayMode.PANAFALL ||
                Display.CurrentDisplayMode == DisplayMode.PANASCOPE)
            {
                if (y <= picDisplay.Height / 2) y *= 2.0f;
                else y = (y - picDisplay.Height / 2) * 2.0f;
            }
            return (float)(Display.SpectrumGridMax - y * (double)(Display.SpectrumGridMax - Display.SpectrumGridMin) / picDisplay.Height);
        }

        private float WaterfallPixelToTime(float y)
        {
            if (chkSplitDisplay.Checked || Display.CurrentDisplayMode == DisplayMode.PANAFALL)
            {
                if (y <= picDisplay.Height / 2) y *= 2.0f;
                else y = (y - picDisplay.Height / 2) * 2.0f;
            }
            if (y < 16) return 0f;
            int i;
            for (i = 1; i * display_delay < Display.WaterfallUpdatePeriod; i++)
            {

            }
            return (y - 16) * i * display_delay;
        }



        #endregion

        #region Paint Event Handlers
        // ======================================================
        // Paint Event Handlers
        // ======================================================

        private void picDisplay_Paint(object sender, PaintEventArgs e)
        {
            switch (current_display_engine)
            {
                case DisplayEngine.GDI_PLUS:
                    Display.RenderGDIPlus(ref e);
                    break;
                case DisplayEngine.DIRECT_X:
                    /*Thread t = new Thread(new ThreadStart(Display.RenderDirectX));
                        t.Name = "DirectX Background Update";
                        t.IsBackground = true;
                        t.Priority = ThreadPriority.Normal;
                        t.Start();*/
                    break;
            }
        }

        private Font font7 = new Font("Arial", 7.0f, FontStyle.Bold);
        private double avg_num = -130.0;
        private void picMultiMeterDigital_Paint(object sender, System.Windows.Forms.PaintEventArgs e)
        {
            int H = picMultiMeterDigital.ClientSize.Height;
            int W = picMultiMeterDigital.ClientSize.Width;
            Graphics g = e.Graphics;
            double num;
            int pixel_x = 0;
            string output = "";

            switch (current_meter_display_mode)
            {
                case MultiMeterDisplayMode.Original:
                    #region Original

                    if (meter_data_ready)
                    {
                        current_meter_data = new_meter_data;
                        meter_data_ready = false;
                    }

                    if (!mox)
                    {
                        num = current_meter_data;

                        switch (current_meter_rx_mode)
                        {
                            case MeterRXMode.SIGNAL_STRENGTH:
                            case MeterRXMode.SIGNAL_AVERAGE:
                                switch ((int)g.DpiX)
                                {
                                    case 96:
                                        double s = (num + 127) / 6;
                                        if (s <= 9.0F)
                                            pixel_x = (int)((s * 7.5) + 2);
                                        else
                                        {
                                            double over_s9 = num + 73;
                                            pixel_x = 69 + (int)(over_s9 * 1.05);
                                        }
                                        break;
                                    case 120:
                                        if (num <= -97.0f)
                                            pixel_x = (int)(0 + (num + 100.0) / 3.0 * 10);
                                        else if (num <= -91.0f)
                                            pixel_x = (int)(10 + (num + 97.0) / 6.0 * 17);
                                        else if (num <= -85.0f)
                                            pixel_x = (int)(27 + (num + 91.0) / 6.0 * 16);
                                        else if (num <= -79.0f)
                                            pixel_x = (int)(43 + (num + 85.0) / 6.0 * 17);
                                        else if (num <= -73.0f)
                                            pixel_x = (int)(60 + (num + 79.0) / 6.0 * 16);
                                        else if (num <= -53.0f)
                                            pixel_x = (int)(76 + (num + 73.0) / 20.0 * 24);
                                        else if (num <= -33.0f)
                                            pixel_x = (int)(100 + (num + 53.0) / 20.0 * 24);
                                        else if (num <= -13.0f)
                                            pixel_x = (int)(124 + (num + 33.0) / 20.0 * 24);
                                        else
                                            pixel_x = (int)(148 + (num + 13.0) / 20.0 * 19);
                                        break;
                                }
                                break;
                            case MeterRXMode.ADC_L:
                            case MeterRXMode.ADC_R:
                                switch ((int)g.DpiX)
                                {
                                    case 96:
                                        pixel_x = (int)(((num + 100) * 1.2) + 12);
                                        break;
                                    case 120:
                                        if (num <= -100.0f)
                                            pixel_x = (int)(0 + (num + 110.0) / 10.0 * 14);
                                        else if (num <= -80.0f)
                                            pixel_x = (int)(14 + (num + 100.0) / 20.0 * 27);
                                        else if (num <= -60.0f)
                                            pixel_x = (int)(41 + (num + 80.0) / 20.0 * 28);
                                        else if (num <= -40.0f)
                                            pixel_x = (int)(69 + (num + 60.0) / 20.0 * 28);
                                        else if (num <= -20.0f)
                                            pixel_x = (int)(97 + (num + 40.0) / 20.0 * 27);
                                        else if (num <= 0.0f)
                                            pixel_x = (int)(124 + (num + 20.0) / 20.0 * 24);
                                        else
                                            pixel_x = (int)(148 + (num - 0.0) / 10.0 * 19);
                                        break;
                                }
                                break;
                            case MeterRXMode.OFF:
                                break;
                        }
                    }
                    else
                    {
                        num = current_meter_data;

                        MeterTXMode mode = current_meter_tx_mode;
                        if (chkTUN.Checked) mode = tune_meter_tx_mode;
                        switch (mode)
                        {
                            case MeterTXMode.MIC:
                            case MeterTXMode.EQ:
                            case MeterTXMode.LEVELER:
                            case MeterTXMode.CPDR:
                            case MeterTXMode.ALC:
                                //num += 3.0;  // number no longer has fudge factor added in the dsp, must be remove
                                switch ((int)g.DpiX)
                                {
                                    case 96:
                                        if (num <= -20.0f)
                                            pixel_x = (int)(0 + (num + 25.0) / 5.0 * 9);
                                        else if (num <= -10.0f)
                                            pixel_x = (int)(9 + (num + 20.0) / 10.0 * 27);
                                        else if (num <= -5.0f)
                                            pixel_x = (int)(36 + (num + 10.0) / 5.0 * 27);
                                        else if (num <= 0.0f)
                                            pixel_x = (int)(63 + (num + 5.0) / 5.0 * 24);
                                        else if (num <= 1.0f)
                                            pixel_x = (int)(87 + (num - 0.0) / 1.0 * 15);
                                        else if (num <= 2.0f)
                                            pixel_x = (int)(102 + (num - 1.0) / 1.0 * 15);
                                        else if (num <= 3.0f)
                                            pixel_x = (int)(117 + (num - 2.0) / 1.0 * 15);
                                        else
                                            pixel_x = (int)(132 + (num - 3.0) / 0.5 * 8);
                                        break;
                                    case 120:
                                        if (num <= -20.0f)
                                            pixel_x = (int)(0 + (num + 25.0) / 5.0 * 10);
                                        else if (num <= -10.0f)
                                            pixel_x = (int)(10 + (num + 20.0) / 10.0 * 30);
                                        else if (num <= -5.0f)
                                            pixel_x = (int)(40 + (num + 10.0) / 5.0 * 30);
                                        else if (num <= 0.0f)
                                            pixel_x = (int)(70 + (num + 5.0) / 5.0 * 27);
                                        else if (num <= 1.0f)
                                            pixel_x = (int)(97 + (num - 0.0) / 1.0 * 17);
                                        else if (num <= 2.0f)
                                            pixel_x = (int)(114 + (num - 1.0) / 1.0 * 17);
                                        else if (num <= 3.0f)
                                            pixel_x = (int)(131 + (num - 2.0) / 1.0 * 17);
                                        else
                                            pixel_x = (int)(148 + (num - 3.0) / 0.5 * 23);
                                        break;
                                }
                                break;
                            case MeterTXMode.FORWARD_POWER:
                            case MeterTXMode.REVERSE_POWER:
                                if (!alexpresent)
                                    num = (num * 100);

                                switch ((int)g.DpiX)
                                {
                                    case 96:
                                        if (num <= 1.0f)
                                            pixel_x = (int)(0 + num * 2);
                                        else if (num <= 5.0f)
                                            pixel_x = (int)(2 + (num - 1) / 4 * 24);
                                        else if (num <= 10.0f)
                                            pixel_x = (int)(26 + (num - 5) / 5 * 24);
                                        else if (num <= 50.0f)
                                            pixel_x = (int)(50 + (num - 10) / 40 * 24);
                                        else if (num <= 100.0f)
                                            pixel_x = (int)(74 + (num - 50) / 50 * 24);
                                        else if (num <= 120.0f)
                                            pixel_x = (int)(98 + (num - 100) / 20 * 24);
                                        else
                                            pixel_x = (int)(122 + (num - 120) / 20 * 16);
                                        break;
                                    case 120:
                                        if (num <= 1.0f)
                                            pixel_x = (int)(0 + num * 3);
                                        else if (num <= 5.0f)
                                            pixel_x = (int)(3 + (num - 1) / 4 * 26);
                                        else if (num <= 10.0f)
                                            pixel_x = (int)(29 + (num - 5) / 5 * 26);
                                        else if (num <= 50.0f)
                                            pixel_x = (int)(55 + (num - 10) / 40 * 27);
                                        else if (num <= 100.0f)
                                            pixel_x = (int)(82 + (num - 50) / 50 * 28);
                                        else if (num <= 120.0f)
                                            pixel_x = (int)(110 + (num - 100) / 20 * 27);
                                        else
                                            pixel_x = (int)(137 + (num - 120) / 20 * 30);
                                        break;
                                }
                                break;
                            case MeterTXMode.SWR:
                                switch ((int)g.DpiX)
                                {
                                    case 96:
                                        if (double.IsInfinity(num))
                                            pixel_x = 200;
                                        else if (num <= 1.0f)
                                            pixel_x = (int)(0 + num * 3);
                                        else if (num <= 1.5f)
                                            pixel_x = (int)(3 + (num - 1.0) / 0.5 * 27);
                                        else if (num <= 2.0f)
                                            pixel_x = (int)(30 + (num - 1.5) / 0.5 * 20);
                                        else if (num <= 3.0f)
                                            pixel_x = (int)(50 + (num - 2.0) / 1.0 * 21);
                                        else if (num <= 5.0f)
                                            pixel_x = (int)(71 + (num - 3.0) / 2.0 * 21);
                                        else if (num <= 10.0f)
                                            pixel_x = (int)(92 + (num - 5.0) / 5.0 * 21);
                                        else
                                            pixel_x = (int)(113 + (num - 10.0) / 15.0 * 26);
                                        break;
                                    case 120:
                                        if (double.IsInfinity(num))
                                            pixel_x = 200;
                                        else if (num <= 1.0f)
                                            pixel_x = (int)(0 + num * 3);
                                        else if (num <= 1.5f)
                                            pixel_x = (int)(3 + (num - 1.0) / 0.5 * 31);
                                        else if (num <= 2.0f)
                                            pixel_x = (int)(34 + (num - 1.5) / 0.5 * 22);
                                        else if (num <= 3.0f)
                                            pixel_x = (int)(56 + (num - 2.0) / 1.0 * 22);
                                        else if (num <= 5.0f)
                                            pixel_x = (int)(78 + (num - 3.0) / 2.0 * 23);
                                        else if (num <= 10.0f)
                                            pixel_x = (int)(101 + (num - 5.0) / 5.0 * 23);
                                        else
                                            pixel_x = (int)(124 + (num - 10.0) / 15.0 * 43);
                                        break;
                                }
                                break;
                            case MeterTXMode.ALC_G:
                            case MeterTXMode.LVL_G:
                                switch ((int)g.DpiX)
                                {
                                    case 96:
                                        if (num <= 0.0f)
                                            pixel_x = 3;
                                        else if (num <= 5.0f)
                                            pixel_x = (int)(3 + (num - 0.0) / 5.0 * 28);
                                        else if (num <= 10.0f)
                                            pixel_x = (int)(31 + (num - 5.0) / 5.0 * 29);
                                        else if (num <= 15.0f)
                                            pixel_x = (int)(60 + (num - 10.0) / 5.0 * 30);
                                        else if (num <= 20.0f)
                                            pixel_x = (int)(90 + (num - 15.0) / 5.0 * 31);
                                        else
                                            pixel_x = (int)(121 + (num - 20.0) / 5.0 * 29);
                                        break;
                                    case 120:
                                        if (num <= 0.0f)
                                            pixel_x = 3;
                                        else if (num <= 5.0f)
                                            pixel_x = (int)(3 + (num - 0.0) / 5.0 * 31);
                                        else if (num <= 10.0f)
                                            pixel_x = (int)(34 + (num - 5.0) / 5.0 * 33);
                                        else if (num <= 15.0f)
                                            pixel_x = (int)(77 + (num - 10.0) / 5.0 * 33);
                                        else if (num <= 20.0f)
                                            pixel_x = (int)(110 + (num - 15.0) / 5.0 * 35);
                                        else
                                            pixel_x = (int)(145 + (num - 20.0) / 5.0 * 32);
                                        break;
                                }
                                break;
                            case MeterTXMode.OFF:
                                break;
                        }
                    }

                    switch ((int)g.DpiX)
                    {
                        case 96:
                            if (pixel_x > 139) pixel_x = 139;
                            break;
                        case 120:
                            if (pixel_x > 167) pixel_x = 167;
                            break;
                    }

                    if ((!mox && current_meter_rx_mode != MeterRXMode.OFF) ||
                        (mox && current_meter_tx_mode != MeterTXMode.OFF))
                    {
                        if (pixel_x <= 0) pixel_x = 1;

                        using (LinearGradientBrush brush = new LinearGradientBrush(new Rectangle(0, 0, pixel_x, H),
                            meter_left_color, meter_right_color, LinearGradientMode.Horizontal))

                            g.FillRectangle(brush, 0, 0, pixel_x, H);

                        for (int i = 0; i < 21; i++)
                            g.DrawLine(meter_background_pen, 6 + i * 8, 0, 6 + i * 8, H);

                        g.DrawLine(Pens.Red, pixel_x, 0, pixel_x, H);
                        g.FillRectangle(meter_background_pen.Brush, pixel_x + 1, 0, W - pixel_x, H);

                        if (pixel_x >= meter_peak_value)
                        {
                            meter_peak_count = 0;
                            meter_peak_value = pixel_x;
                        }
                        else
                        {
                            if (meter_peak_count++ >= multimeter_peak_hold_samples)
                            {
                                meter_peak_count = 0;
                                meter_peak_value = pixel_x;
                            }
                            else
                            {
                                g.DrawLine(Pens.Red, meter_peak_value, 0, meter_peak_value, H);
                                g.DrawLine(Pens.Red, meter_peak_value - 1, 0, meter_peak_value - 1, H);
                            }
                        }
                    }

                    meter_timer.Stop();

                    string format = "f0";
                    if (meter_detail) format = "f1";

                    if (meter_timer.DurationMsec >= meter_dig_delay)
                    {
                        if (!mox)
                        {
                            switch (current_meter_rx_mode)
                            {
                                case MeterRXMode.SIGNAL_STRENGTH:
                                case MeterRXMode.SIGNAL_AVERAGE:
                                    if (s_meter)      // modif F8CHK
                                    {
                                        if (num <= -124.0f) output = "    S 0";
                                        else if (num > -124.0f & num <= -118.0f) output = "    S 1";
                                        else if (num > -118.0f & num <= -112.0f) output = "    S 2";
                                        else if (num > -112.0f & num <= -106.0f) output = "    S 3";
                                        else if (num > -106.0f & num <= -100.0f) output = "    S 4";
                                        else if (num > -100.0f & num <= -94.0f) output = "    S 5";
                                        else if (num > -94.0f & num <= -88.0f) output = "    S 6";
                                        else if (num > -88.0f & num <= -82.0f) output = "    S 7";
                                        else if (num > -82.0f & num <= -76.0f) output = "    S 8";
                                        else if (num > -76.0f & num <= -70.0f) output = "    S 9";
                                        else if (num > -70.0f & num <= -66.0f) output = "    S 9 + 5";
                                        else if (num > -66.0f & num <= -60.0f) output = "    S 9 + 10";
                                        else if (num > -60.0f & num <= -56.0f) output = "    S 9 + 15";
                                        else if (num > -56.0f & num <= -46.0f) output = "    S 9 + 20";
                                        else if (num > -46.0f & num <= -36.0f) output = "    S 9 + 30";
                                        else if (num > -36.0f & num <= -26.0f) output = "    S 9 + 40";
                                        else if (num > -26.0f & num <= -16.0f) output = "    S 9 + 50";
                                        else if (num > -16.0f) output = "    S 9 + 60";
                                    }
                                    else output = num.ToString(format) + " dBm";
                                    break;
                                case MeterRXMode.ADC_L:
                                case MeterRXMode.ADC_R:
                                    output = num.ToString("f1") + " dBFS";
                                    break;
                                case MeterRXMode.OFF:
                                    output = "";
                                    break;
                            }
                        }
                        else
                        {
                            MeterTXMode mode = current_meter_tx_mode;
                            if (chkTUN.Checked) mode = tune_meter_tx_mode;
                            switch (mode)
                            {
                                case MeterTXMode.MIC:
                                case MeterTXMode.LEVELER:
                                case MeterTXMode.LVL_G:
                                case MeterTXMode.EQ:
                                case MeterTXMode.CPDR:
                                case MeterTXMode.ALC:
                                case MeterTXMode.ALC_G:
                                    output = num.ToString(format) + " dB";
                                    break;
                                case MeterTXMode.FORWARD_POWER:
                                case MeterTXMode.REVERSE_POWER:
                                    if ((alexpresent || fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)) ||
                                        (pa_present && VFOAFreq < 30.0))
                                        output = num.ToString("f0") + " W";
                                    else output = (num * 10).ToString("f0") + " mW";
                                    break;
                                case MeterTXMode.SWR:
                                    output = num.ToString("f1") + " : 1";
                                    break;
                                case MeterTXMode.OFF:
                                    output = "";
                                    break;
                            }
                        }
                        txtMultiText.Text = output;
                        meter_timer.Start();
                    }

                    if (meter_data_ready)
                    {
                        meter_data_ready = false;  //We do NOT want to do this before we have consumed it!!!! so do it here.
                    }
                    break;
                    #endregion
                case MultiMeterDisplayMode.Edge:
                    #region Edge
                    if (meter_data_ready)
                    {
                        current_meter_data = new_meter_data;
                        meter_data_ready = false;
                    }

                    if (avg_num == Display.CLEAR_FLAG) // reset average -- just use new value
                    {
                        num = avg_num = current_meter_data;
                    }
                    else
                    {
                        if (current_meter_data > avg_num)
                            num = avg_num = current_meter_data * 0.8 + avg_num * 0.2; // fast rise
                        else
                            num = avg_num = current_meter_data * 0.2 + avg_num * 0.8; // slow decay
                    }

                    g.DrawRectangle(edge_meter_background_pen, 0, 0, W, H);

                    //using (Font f = new Font("Arial", 7.0f, FontStyle.Bold))

                    if (!mox)
                    {
                        switch (current_meter_rx_mode)
                        {
                            case MeterRXMode.SIGNAL_STRENGTH:
                            case MeterRXMode.SIGNAL_AVERAGE:
                                g.FillRectangle(low_brush, 0, H - 4, (int)(W * 0.5), 2);
                                g.FillRectangle(high_brush, (int)(W * 0.5), H - 4, (int)(W * 0.5) - 4, 2);
                                double spacing = (W * 0.5 - 2.0) / 5.0;
                                double string_height = 0;
                                for (int i = 1; i < 6; i++)
                                {
                                    g.FillRectangle(low_brush, (int)(i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                    g.FillRectangle(low_brush, (int)(i * spacing), H - 4 - 6, 2, 6);

                                    //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                    SizeF size = g.MeasureString((-1 + i * 2).ToString(), font7, 1, StringFormat.GenericTypographic);
                                    double string_width = size.Width - 2.0;
                                    string_height = size.Height - 2.0;

                                    //g.TextRenderingHint = TextRenderingHint.AntiAlias;
                                    //g.SmoothingMode = SmoothingMode.AntiAlias;
                                    g.DrawString((-1 + i * 2).ToString(), font7, low_brush, (int)(i * spacing - string_width + (int)(i / 5)), (int)(H - 4 - 8 - string_height));
                                    //g.SmoothingMode = SmoothingMode.None;
                                }
                                spacing = ((double)W * 0.5 - 2.0 - 4.0) / 3.0;
                                for (int i = 1; i < 4; i++)
                                {
                                    g.FillRectangle(high_brush, (int)((double)W * 0.5 + i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                    g.FillRectangle(high_brush, (int)((double)W * 0.5 + i * spacing), H - 4 - 6, 2, 6);

                                    //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                    SizeF size = g.MeasureString("+" + (i * 20).ToString(), font7, 3, StringFormat.GenericTypographic);
                                    double string_width = size.Width - 2.0;

                                    //g.TextRenderingHint = TextRenderingHint.SystemDefault;
                                    g.DrawString("+" + (i * 20).ToString(), font7, high_brush, (int)(W * 0.5 + i * spacing - (int)string_width * 3 - i / 3 * 2), (int)(H - 4 - 8 - string_height));
                                }

                                if (num > -73.0) // high area
                                {
                                    pixel_x = (int)(W * 0.5 + (73.0 + num) / 63.0 * (W * 0.5 - 3));
                                }
                                else
                                {
                                    pixel_x = (int)((num + 133.0) / 60.0 * (W * 0.5));
                                }
                                break;
                            case MeterRXMode.ADC_L:
                            case MeterRXMode.ADC_R:
                            case MeterRXMode.ADC2_L:
                            case MeterRXMode.ADC2_R:
                                spacing = ((double)W - 5.0) / 6.0;
                                g.FillRectangle(low_brush, 0, H - 4, (int)(W - 3.0 - spacing), 2);
                                g.FillRectangle(high_brush, (int)(W - 3.0 - spacing), H - 4, (int)spacing, 2);
                                for (int i = 1; i < 7; i++)
                                {
                                    SolidBrush b = low_brush;
                                    if (i == 6) b = high_brush;
                                    g.FillRectangle(b, (int)(i * spacing - spacing / 2), H - 4 - 3, 1, 5);
                                    g.FillRectangle(b, (int)(i * spacing), H - 4 - 6, 2, 8);

                                    //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                    string s = (-120 + i * 20).ToString();
                                    SizeF size = g.MeasureString(s, font7, 1, StringFormat.GenericTypographic);
                                    double string_width = size.Width - 2.0;
                                    size = g.MeasureString("0", font7, 1, StringFormat.GenericTypographic);
                                    string_height = size.Height - 2.0;

                                    g.DrawString(s, font7, b, (int)(i * spacing - (int)string_width * (s.Length)), (int)(H - 4 - 8 - string_height));
                                }

                                pixel_x = (int)((num + 120.0) / 120.0 * (W - 5.0));
                                break;
                            case MeterRXMode.OFF:
                                break;
                        }
                    }
                    else
                    {
                        MeterTXMode mode = current_meter_tx_mode;
                        if (chkTUN.Checked) mode = tune_meter_tx_mode;
                        switch (mode)
                        {
                            case MeterTXMode.MIC:
                            case MeterTXMode.EQ:
                            case MeterTXMode.LEVELER:
                            case MeterTXMode.CPDR:
                            case MeterTXMode.ALC:
                                g.FillRectangle(low_brush, 0, H - 4, (int)(W * 0.665), 2);
                                g.FillRectangle(high_brush, (int)(W * 0.665), H - 4, (int)(W * 0.335) - 2, 2);
                                double spacing = (W * 0.665 - 2.0) / 3.0;
                                double string_height = 0;
                                for (int i = 1; i < 4; i++)
                                {
                                    g.FillRectangle(low_brush, (int)(i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                    g.FillRectangle(low_brush, (int)(i * spacing), H - 4 - 6, 2, 6);

                                    string s = (-30 + i * 10).ToString();
                                    //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                    SizeF size = g.MeasureString("0", font7, 1, StringFormat.GenericTypographic);
                                    double string_width = size.Width - 2.0;
                                    string_height = size.Height - 2.0;

                                    //g.TextRenderingHint = TextRenderingHint.AntiAlias;
                                    //g.SmoothingMode = SmoothingMode.AntiAlias;
                                    g.DrawString(s, font7, low_brush, (int)(i * spacing - string_width * s.Length + 1.0 - (int)(i / 2) + (int)(i / 3)), (int)(H - 4 - 8 - string_height));
                                    //g.SmoothingMode = SmoothingMode.None;
                                }
                                spacing = (W * 0.335 - 2.0 - 3.0) / 3.0;
                                for (int i = 1; i < 4; i++)
                                {
                                    g.FillRectangle(high_brush, (int)((double)W * 0.665 + i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                    g.FillRectangle(high_brush, (int)((double)W * 0.665 + i * spacing), H - 4 - 6, 2, 6);

                                    //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                    SizeF size = g.MeasureString(i.ToString(), font7, 3, StringFormat.GenericTypographic);
                                    double string_width = size.Width - 2.0;

                                    g.TextRenderingHint = TextRenderingHint.SystemDefault;
                                    g.DrawString(i.ToString(), font7, high_brush, (int)(W * 0.665 + i * spacing - (int)string_width), (int)(H - 4 - 8 - string_height));
                                }

                                if (num > 0.0) // high area
                                {
                                    pixel_x = (int)(W * 0.665 + num / 3.0 * (W * 0.335 - 4));
                                }
                                else
                                {
                                    pixel_x = (int)((num + 30.0) / 30.0 * (W * 0.665 - 1.0));
                                }
                                break;
                            case MeterTXMode.FORWARD_POWER:
                            case MeterTXMode.REVERSE_POWER:
                                if (alexpresent || pa_present || (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)))
                                {
                                    g.FillRectangle(low_brush, 0, H - 4, (int)(W * 0.75), 2);
                                    g.FillRectangle(high_brush, (int)(W * 0.75), H - 4, (int)(W * 0.25) - 10, 2);
                                    spacing = (W * 0.75 - 2.0) / 4.0;
                                    string_height = 0;
                                    string[] list = { "5", "10", "50", "100" };
                                    for (int i = 1; i < 5; i++)
                                    {
                                        g.FillRectangle(low_brush, (int)(i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                        g.FillRectangle(low_brush, (int)(i * spacing), H - 4 - 6, 2, 6);

                                        string s = list[i - 1];
                                        //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                        SizeF size = g.MeasureString("0", font7, 1, StringFormat.GenericTypographic);
                                        double string_width = size.Width - 2.0;
                                        string_height = size.Height - 2.0;

                                        //g.TextRenderingHint = TextRenderingHint.AntiAlias;
                                        //g.SmoothingMode = SmoothingMode.AntiAlias;
                                        g.DrawString(s, font7, low_brush, (int)(i * spacing - string_width * s.Length + (int)(i / 3) + (int)(i / 4)), (int)(H - 4 - 8 - string_height));
                                        //g.SmoothingMode = SmoothingMode.None;
                                    }
                                    spacing = (W * 0.25 - 2.0 - 10.0) / 1.0;
                                    for (int i = 1; i < 2; i++)
                                    {
                                        g.FillRectangle(high_brush, (int)((double)W * 0.75 + i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                        g.FillRectangle(high_brush, (int)((double)W * 0.75 + i * spacing), H - 4 - 6, 2, 6);

                                        //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                        SizeF size = g.MeasureString("0", font7, 3, StringFormat.GenericTypographic);
                                        double string_width = size.Width - 2.0;

                                        g.TextRenderingHint = TextRenderingHint.SystemDefault;
                                        g.DrawString("120+", font7, high_brush, (int)(W * 0.75 + i * spacing - (int)3.5 * string_width), (int)(H - 4 - 8 - string_height));
                                    }

                                    if (num <= 100.0) // low area
                                    {
                                        spacing = (W * 0.75 - 2.0) / 4.0;
                                        if (num <= 5.0)
                                            pixel_x = (int)(num / 5.0 * (int)spacing);
                                        else if (num <= 10.0)
                                            pixel_x = (int)(spacing + (num - 5.0) / 5.0 * spacing);
                                        else if (num <= 50.0)
                                            pixel_x = (int)(2 * spacing + (num - 10.0) / 40.0 * spacing);
                                        else
                                            pixel_x = (int)(3 * spacing + (num - 50.0) / 50.0 * spacing);
                                    }
                                    else
                                    {
                                        spacing = (W * 0.25 - 2.0 - 10.0) / 1.0;
                                        if (num <= 120.0)
                                            pixel_x = (int)(W * 0.75 + (num - 100.0) / 20.0 * spacing);
                                        else
                                            pixel_x = (int)(W * 0.75 + spacing + (num - 120.0) / 60.0 * spacing);
                                    }
                                }
                                else // 1W version
                                {
                                    g.FillRectangle(low_brush, 0, H - 4, (int)(W * 0.75), 2);
                                    g.FillRectangle(high_brush, (int)(W * 0.75), H - 4, (int)(W * 0.25) - 9, 2);
                                    spacing = (W * 0.75 - 2.0) / 4.0;
                                    string_height = 0;
                                    string[] list = { "100", "250", "500", "800", "1000" };
                                    for (int i = 1; i < 5; i++)
                                    {
                                        g.FillRectangle(low_brush, (int)(i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                        g.FillRectangle(low_brush, (int)(i * spacing), H - 4 - 6, 2, 6);

                                        string s = list[i - 1];
                                        //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                        SizeF size = g.MeasureString("0", font7, 1, StringFormat.GenericTypographic);
                                        double string_width = size.Width - 2.0;
                                        string_height = size.Height - 2.0;

                                        //g.TextRenderingHint = TextRenderingHint.AntiAlias;
                                        //g.SmoothingMode = SmoothingMode.AntiAlias;
                                        g.DrawString(s, font7, low_brush, (int)(i * spacing - string_width * s.Length + 1.0 + (int)(i / 2) - (int)(i / 4)), (int)(H - 4 - 8 - string_height));
                                        //g.SmoothingMode = SmoothingMode.None;
                                    }
                                    spacing = (W * 0.25 - 2.0 - 9.0) / 1.0;
                                    for (int i = 1; i < 2; i++)
                                    {
                                        g.FillRectangle(high_brush, (int)((double)W * 0.75 + i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                        g.FillRectangle(high_brush, (int)((double)W * 0.75 + i * spacing), H - 4 - 6, 2, 6);

                                        //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                        SizeF size = g.MeasureString("0", font7, 3, StringFormat.GenericTypographic);
                                        double string_width = size.Width - 2.0;

                                        //g.TextRenderingHint = TextRenderingHint.SystemDefault;
                                        g.DrawString("1000", font7, high_brush, (int)(W * 0.75 + 2 + i * spacing - (int)4.0 * string_width), (int)(H - 4 - 8 - string_height));
                                    }

                                    num *= 1000;
                                    if (num < 801.0) // low area
                                    {
                                        spacing = (W * 0.75 - 2.0) / 4.0;
                                        if (num <= 100.0)
                                            pixel_x = (int)(num / 100.0 * spacing);
                                        else if (num <= 250.0)
                                            pixel_x = (int)(spacing + (num - 100.0) / 150.0 * spacing);
                                        else if (num <= 500.0)
                                            pixel_x = (int)(2 * spacing + (num - 250.0) / 250.0 * spacing);
                                        else
                                            pixel_x = (int)(3 * spacing + (num - 500.0) / 300.0 * spacing);
                                    }
                                    else
                                    {
                                        spacing = (W * 0.25 - 2.0 - 9.0) / 1.0;
                                        pixel_x = (int)(W * 0.75 + (num - 800.0) / 200.0 * spacing);
                                    }
                                }
                                break;
                            case MeterTXMode.SWR:
                                g.FillRectangle(low_brush, 0, H - 4, (int)(W * 0.75), 2);
                                g.FillRectangle(high_brush, (int)(W * 0.75), H - 4, (int)(W * 0.25) - 9, 2);
                                spacing = (W * 0.75 - 2.0) / 4.0;
                                string_height = 0;
                                string[] swr_list = { "1.5", "2", "5", "10", "20" };
                                for (int i = 1; i < 5; i++)
                                {
                                    g.FillRectangle(low_brush, (int)(i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                    g.FillRectangle(low_brush, (int)(i * spacing), H - 4 - 6, 2, 6);

                                    string s = swr_list[i - 1];
                                    //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                    SizeF size = g.MeasureString("0", font7, 1, StringFormat.GenericTypographic);
                                    double string_width = size.Width - 2.0;
                                    string_height = size.Height - 2.0;

                                    //g.TextRenderingHint = TextRenderingHint.AntiAlias;
                                    //g.SmoothingMode = SmoothingMode.AntiAlias;
                                    g.DrawString(s, font7, low_brush, (int)(i * spacing - string_width * s.Length + 2.0 - 2 * (int)(i / 2) + 3 * (int)(i / 4)), (int)(H - 4 - 8 - string_height));
                                    //g.SmoothingMode = SmoothingMode.None;
                                }
                                spacing = (W * 0.25 - 2.0 - 9.0) / 1.0;
                                for (int i = 1; i < 2; i++)
                                {
                                    g.FillRectangle(high_brush, (int)((double)W * 0.75 + i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                    g.FillRectangle(high_brush, (int)((double)W * 0.75 + i * spacing), H - 4 - 6, 2, 6);

                                    //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                    SizeF size = g.MeasureString("0", font7, 3, StringFormat.GenericTypographic);
                                    double string_width = size.Width - 2.0;

                                    //g.TextRenderingHint = TextRenderingHint.SystemDefault;
                                    g.DrawString("20+", font7, high_brush, (int)(W * 0.75 + i * spacing - (int)2.5 * string_width), (int)(H - 4 - 8 - string_height));
                                }

                                if (num < 10.0) // low area
                                {
                                    spacing = (W * 0.75 - 2.0) / 4.0;
                                    if (num <= 1.5)
                                        pixel_x = (int)((num - 1.0) / 0.5 * spacing);
                                    else if (num <= 2.0)
                                        pixel_x = (int)(spacing + (num - 1.5) / 0.5 * spacing);
                                    else if (num <= 5.0)
                                        pixel_x = (int)(2 * spacing + (num - 2.0) / 3.0 * spacing);
                                    else
                                        pixel_x = (int)(3 * spacing + (num - 5.0) / 5.0 * spacing);
                                }
                                else
                                {
                                    spacing = (W * 0.25 - 2.0 - 9.0) / 1.0;
                                    pixel_x = (int)(W * 0.75 + (num - 10.0) / 10.0 * spacing);
                                }
                                if (double.IsInfinity(num)) pixel_x = W - 2;
                                break;
                            case MeterTXMode.ALC_G:
                            case MeterTXMode.LVL_G:
                                g.FillRectangle(low_brush, 0, H - 4, (int)(W * 0.75), 2);
                                g.FillRectangle(high_brush, (int)(W * 0.75), H - 4, (int)(W * 0.25) - 9, 2);
                                spacing = (W * 0.75 - 2.0) / 4.0;
                                string_height = 0;
                                string[] gain_list = { "5", "10", "15", "20", "25" };
                                for (int i = 1; i < 5; i++)
                                {
                                    g.FillRectangle(low_brush, (int)(i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                    g.FillRectangle(low_brush, (int)(i * spacing), H - 4 - 6, 2, 6);

                                    string s = gain_list[i - 1];
                                    //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                    SizeF size = g.MeasureString("0", font7, 1, StringFormat.GenericTypographic);
                                    double string_width = size.Width - 2.0;
                                    string_height = size.Height - 2.0;

                                    //g.TextRenderingHint = TextRenderingHint.AntiAlias;
                                    //g.SmoothingMode = SmoothingMode.AntiAlias;
                                    g.DrawString(s, font7, low_brush, (int)(i * spacing - string_width * s.Length + (int)(i / 3)), (int)(H - 4 - 8 - string_height));
                                    //g.SmoothingMode = SmoothingMode.None;
                                }
                                spacing = (W * 0.25 - 2.0 - 9.0) / 1.0;
                                for (int i = 1; i < 2; i++)
                                {
                                    g.FillRectangle(high_brush, (int)((double)W * 0.75 + i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                    g.FillRectangle(high_brush, (int)((double)W * 0.75 + i * spacing), H - 4 - 6, 2, 6);

                                    //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                    SizeF size = g.MeasureString("0", font7, 3, StringFormat.GenericTypographic);
                                    double string_width = size.Width - 2.0;

                                    //g.TextRenderingHint = TextRenderingHint.SystemDefault;
                                    g.DrawString("25+", font7, high_brush, (int)(W * 0.75 + i * spacing - (int)2.5 * string_width), (int)(H - 4 - 8 - string_height));
                                }


                                spacing = (W * 0.75 - 2.0) / 4.0;
                                pixel_x = (int)(num / 5.0 * spacing);
                                break;
                            case MeterTXMode.OFF:
                                break;
                        }
                    }

                    if ((!mox && current_meter_rx_mode != MeterRXMode.OFF) ||
                        (mox && current_meter_tx_mode != MeterTXMode.OFF))
                    {
                        pixel_x = Math.Max(0, pixel_x);
                        pixel_x = Math.Min(W - 3, pixel_x);


                        line_dark_pen.Color =
                            Color.FromArgb((edge_avg_color.R + edge_meter_background_color.R) / 2,
                            (edge_avg_color.G + edge_meter_background_color.G) / 2,
                            (edge_avg_color.B + edge_meter_background_color.B) / 2);

                        g.InterpolationMode = InterpolationMode.HighQualityBicubic;
                        g.SmoothingMode = SmoothingMode.HighQuality;
                        g.DrawLine(line_dark_pen, pixel_x - 1, 0, pixel_x - 1, H);
                        g.DrawLine(line_pen, pixel_x, 0, pixel_x, H);
                        g.DrawLine(line_dark_pen, pixel_x + 1, 0, pixel_x + 1, H);
                        g.InterpolationMode = InterpolationMode.Default;
                        g.SmoothingMode = SmoothingMode.Default;

                    }

                    meter_timer.Stop();

                    format = "f0";
                    if (meter_detail) format = "f1";

                    if (meter_timer.DurationMsec >= meter_dig_delay)
                    {
                        if (!mox)
                        {
                            switch (current_meter_rx_mode)
                            {
                                case MeterRXMode.SIGNAL_STRENGTH:
                                case MeterRXMode.SIGNAL_AVERAGE:
                                    if (s_meter)      // modif F8CHK
                                    {
                                        if (num <= -124.0f) output = "    S 0";
                                        else if (num > -124.0f & num <= -118.0f) output = "    S 1";
                                        else if (num > -118.0f & num <= -112.0f) output = "    S 2";
                                        else if (num > -112.0f & num <= -106.0f) output = "    S 3";
                                        else if (num > -106.0f & num <= -100.0f) output = "    S 4";
                                        else if (num > -100.0f & num <= -94.0f) output = "    S 5";
                                        else if (num > -94.0f & num <= -88.0f) output = "    S 6";
                                        else if (num > -88.0f & num <= -82.0f) output = "    S 7";
                                        else if (num > -82.0f & num <= -76.0f) output = "    S 8";
                                        else if (num > -76.0f & num <= -70.0f) output = "    S 9";
                                        else if (num > -70.0f & num <= -66.0f) output = "    S 9 + 5";
                                        else if (num > -66.0f & num <= -60.0f) output = "    S 9 + 10";
                                        else if (num > -60.0f & num <= -56.0f) output = "    S 9 + 15";
                                        else if (num > -56.0f & num <= -46.0f) output = "    S 9 + 20";
                                        else if (num > -46.0f & num <= -36.0f) output = "    S 9 + 30";
                                        else if (num > -36.0f & num <= -26.0f) output = "    S 9 + 40";
                                        else if (num > -26.0f & num <= -16.0f) output = "    S 9 + 50";
                                        else if (num > -16.0f) output = "    S 9 + 60";
                                    }
                                    else output = num.ToString(format) + " dBm";
                                    break;
                                case MeterRXMode.ADC_L:
                                case MeterRXMode.ADC_R:
                                case MeterRXMode.ADC2_L:
                                case MeterRXMode.ADC2_R:
                                    output = num.ToString("f1") + " dBFS";
                                    break;
                                case MeterRXMode.OFF:
                                    output = "";
                                    break;
                            }
                        }
                        else
                        {
                            MeterTXMode mode = current_meter_tx_mode;
                            if (chkTUN.Checked) mode = tune_meter_tx_mode;
                            switch (mode)
                            {
                                case MeterTXMode.MIC:
                                case MeterTXMode.LEVELER:
                                case MeterTXMode.LVL_G:
                                case MeterTXMode.EQ:
                                case MeterTXMode.CPDR:
                                case MeterTXMode.ALC:
                                case MeterTXMode.ALC_G:
                                    output = num.ToString(format) + " dB";
                                    break;
                                case MeterTXMode.FORWARD_POWER:
                                case MeterTXMode.REVERSE_POWER:
                                    if ((alexpresent || fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)) ||
                                        (pa_present && VFOAFreq < 30.0))
                                        output = num.ToString("f0") + " W";
                                    else output = num.ToString("f0") + " mW";
                                    break;
                                case MeterTXMode.SWR:
                                    output = num.ToString("f1") + " : 1";
                                    break;
                                case MeterTXMode.OFF:
                                    output = "";
                                    break;
                            }
                        }
                        txtMultiText.Text = output;
                        meter_timer.Start();
                    }

                    if (meter_data_ready)
                    {
                        meter_data_ready = false;  //We do NOT want to do this before we have consumed it!!!! so do it here.
                    }

                    break;
                    #endregion
                case MultiMeterDisplayMode.Analog:
                    #region Analog

                    #endregion
                    break;
            }
        }

        private double rx2_avg_num = -130.0;
        private void picRX2Meter_Paint(object sender, System.Windows.Forms.PaintEventArgs e)
        {
            int H = picRX2Meter.ClientSize.Height;
            int W = picRX2Meter.ClientSize.Width;
            Graphics g = e.Graphics;
            double num;
            int pixel_x = 0;
            string output = "";

            switch (current_meter_display_mode)
            {
                case MultiMeterDisplayMode.Original:
                    #region Original

                    if (rx2_meter_data_ready)
                    {
                        rx2_meter_current_data = rx2_meter_new_data;
                        rx2_meter_data_ready = false;
                    }

                    num = rx2_meter_current_data;

                    switch (rx2_meter_mode)
                    {
                        case MeterRXMode.SIGNAL_STRENGTH:
                        case MeterRXMode.SIGNAL_AVERAGE:
                            switch ((int)g.DpiX)
                            {
                                case 96:
                                    double s = (num + 127) / 6;
                                    if (s <= 9.0F)
                                        pixel_x = (int)((s * 7.5) + 2);
                                    else
                                    {
                                        double over_s9 = num + 73;
                                        pixel_x = 69 + (int)(over_s9 * 1.05);
                                    }
                                    break;
                                case 120:
                                    if (num <= -97.0f)
                                        pixel_x = (int)(0 + (num + 100.0) / 3.0 * 10);
                                    else if (num <= -91.0f)
                                        pixel_x = (int)(10 + (num + 97.0) / 6.0 * 17);
                                    else if (num <= -85.0f)
                                        pixel_x = (int)(27 + (num + 91.0) / 6.0 * 16);
                                    else if (num <= -79.0f)
                                        pixel_x = (int)(43 + (num + 85.0) / 6.0 * 17);
                                    else if (num <= -73.0f)
                                        pixel_x = (int)(60 + (num + 79.0) / 6.0 * 16);
                                    else if (num <= -53.0f)
                                        pixel_x = (int)(76 + (num + 73.0) / 20.0 * 24);
                                    else if (num <= -33.0f)
                                        pixel_x = (int)(100 + (num + 53.0) / 20.0 * 24);
                                    else if (num <= -13.0f)
                                        pixel_x = (int)(124 + (num + 33.0) / 20.0 * 24);
                                    else
                                        pixel_x = (int)(148 + (num + 13.0) / 20.0 * 19);
                                    break;
                            }
                            break;
                        case MeterRXMode.ADC_L:
                        case MeterRXMode.ADC_R:
                            switch ((int)g.DpiX)
                            {
                                case 96:
                                    pixel_x = (int)(((num + 100) * 1.2) + 12);
                                    break;
                                case 120:
                                    if (num <= -100.0f)
                                        pixel_x = (int)(0 + (num + 110.0) / 10.0 * 14);
                                    else if (num <= -80.0f)
                                        pixel_x = (int)(14 + (num + 100.0) / 20.0 * 27);
                                    else if (num <= -60.0f)
                                        pixel_x = (int)(41 + (num + 80.0) / 20.0 * 28);
                                    else if (num <= -40.0f)
                                        pixel_x = (int)(69 + (num + 60.0) / 20.0 * 28);
                                    else if (num <= -20.0f)
                                        pixel_x = (int)(97 + (num + 40.0) / 20.0 * 27);
                                    else if (num <= 0.0f)
                                        pixel_x = (int)(124 + (num + 20.0) / 20.0 * 24);
                                    else
                                        pixel_x = (int)(148 + (num - 0.0) / 10.0 * 19);
                                    break;
                            }
                            break;
                        case MeterRXMode.OFF:
                            break;
                    }

                    switch ((int)g.DpiX)
                    {
                        case 96:
                            if (pixel_x > 139) pixel_x = 139;
                            break;
                        case 120:
                            if (pixel_x > 167) pixel_x = 167;
                            break;
                    }

                    if (rx2_meter_mode != MeterRXMode.OFF)
                    {
                        if (pixel_x <= 0) pixel_x = 1;

                        using (LinearGradientBrush brush = new LinearGradientBrush(new Rectangle(0, 0, pixel_x, H),
                            meter_left_color, meter_right_color, LinearGradientMode.Horizontal))
                            g.FillRectangle(brush, 0, 0, pixel_x, H);
                        //using (Pen meter_background_pen = new Pen(new SolidBrush(meter_background_color))) 
                        //{
                        for (int i = 0; i < 21; i++)
                            g.DrawLine(meter_background_pen, 6 + i * 8, 0, 6 + i * 8, H);

                        g.DrawLine(Pens.Red, pixel_x, 0, pixel_x, H);
                        g.FillRectangle(meter_background_pen.Brush, pixel_x + 1, 0, W - pixel_x, H);
                        //}

                        if (pixel_x >= rx2_meter_peak_value)
                        {
                            rx2_meter_peak_count = 0;
                            rx2_meter_peak_value = pixel_x;
                        }
                        else
                        {
                            if (rx2_meter_peak_count++ >= multimeter_peak_hold_samples)
                            {
                                rx2_meter_peak_count = 0;
                                rx2_meter_peak_value = pixel_x;
                            }
                            else
                            {
                                g.DrawLine(Pens.Red, rx2_meter_peak_value, 0, rx2_meter_peak_value, H);
                                g.DrawLine(Pens.Red, rx2_meter_peak_value - 1, 0, rx2_meter_peak_value - 1, H);
                            }
                        }
                    }

                    rx2_meter_timer.Stop();

                    string format = "f0";
                    if (meter_detail) format = "f1";

                    if (rx2_meter_timer.DurationMsec >= meter_dig_delay)
                    {
                        switch (rx2_meter_mode)
                        {
                            case MeterRXMode.SIGNAL_STRENGTH:
                            case MeterRXMode.SIGNAL_AVERAGE:
                                output = num.ToString(format) + " dBm";
                                break;
                            case MeterRXMode.ADC_L:
                            case MeterRXMode.ADC_R:
                                output = num.ToString("f1") + " dBFS";
                                break;
                            case MeterRXMode.OFF:
                                output = "";
                                break;
                        }
                        txtRX2Meter.Text = output;
                        rx2_meter_timer.Start();
                    }

                    if (rx2_meter_data_ready)
                    {
                        rx2_meter_data_ready = false;  //We do NOT want to do this before we have consumed it!!!! so do it here.
                    }
                    break;
                    #endregion
                case MultiMeterDisplayMode.Edge:
                    #region Edge
                    if (rx2_meter_data_ready)
                    {
                        rx2_meter_current_data = rx2_meter_new_data;
                        rx2_meter_data_ready = false;
                    }

                    if (rx2_avg_num == Display.CLEAR_FLAG) // reset average -- just use new value
                    {
                        num = rx2_avg_num = rx2_meter_current_data;
                    }
                    else
                    {
                        if (rx2_meter_current_data > rx2_avg_num)
                            num = rx2_avg_num = rx2_meter_current_data * 0.8 + rx2_avg_num * 0.2; // fast rise
                        else
                            num = rx2_avg_num = rx2_meter_current_data * 0.2 + rx2_avg_num * 0.8; // slow decay
                    }
                    //using (Pen p = new Pen(edge_meter_background_color))
                    g.DrawRectangle(edge_meter_background_pen, 0, 0, W, H);

                    //using (SolidBrush low_brush = new SolidBrush(edge_low_color),
                    // high_brush = new SolidBrush(edge_high_color))
                    //using (Font f = new Font("Arial", 7.0f, FontStyle.Bold))

                    switch (rx2_meter_mode)
                    {
                        case MeterRXMode.SIGNAL_STRENGTH:
                        case MeterRXMode.SIGNAL_AVERAGE:
                            g.FillRectangle(low_brush, 0, H - 4, (int)(W * 0.5), 2);
                            g.FillRectangle(high_brush, (int)(W * 0.5), H - 4, (int)(W * 0.5) - 4, 2);
                            double spacing = (W * 0.5 - 2.0) / 5.0;
                            double string_height = 0;
                            for (int i = 1; i < 6; i++)
                            {
                                g.FillRectangle(low_brush, (int)(i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                g.FillRectangle(low_brush, (int)(i * spacing), H - 4 - 6, 2, 6);

                                //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                SizeF size = g.MeasureString((-1 + i * 2).ToString(), font7, 1, StringFormat.GenericTypographic);
                                double string_width = size.Width - 2.0;
                                string_height = size.Height - 2.0;

                                //g.TextRenderingHint = TextRenderingHint.AntiAlias;
                                //g.SmoothingMode = SmoothingMode.AntiAlias;
                                g.DrawString((-1 + i * 2).ToString(), font7, low_brush, (int)(i * spacing - string_width + (int)(i / 5)), (int)(H - 4 - 8 - string_height));
                                //g.SmoothingMode = SmoothingMode.None;
                            }
                            spacing = ((double)W * 0.5 - 2.0 - 4.0) / 3.0;
                            for (int i = 1; i < 4; i++)
                            {
                                g.FillRectangle(high_brush, (int)((double)W * 0.5 + i * spacing - spacing * 0.5), H - 4 - 3, 1, 3);
                                g.FillRectangle(high_brush, (int)((double)W * 0.5 + i * spacing), H - 4 - 6, 2, 6);

                                //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                SizeF size = g.MeasureString("+" + (i * 20).ToString(), font7, 3, StringFormat.GenericTypographic);
                                double string_width = size.Width - 2.0;

                                //g.TextRenderingHint = TextRenderingHint.SystemDefault;
                                g.DrawString("+" + (i * 20).ToString(), font7, high_brush, (int)(W * 0.5 + i * spacing - (int)string_width * 3 - i / 3 * 2), (int)(H - 4 - 8 - string_height));
                            }

                            if (num > -73.0) // high area
                            {
                                pixel_x = (int)(W * 0.5 + (73.0 + num) / 63.0 * (W * 0.5 - 3));
                            }
                            else
                            {
                                pixel_x = (int)((num + 133.0) / 60.0 * (W * 0.5));
                            }
                            break;
                        case MeterRXMode.ADC_L:
                        case MeterRXMode.ADC_R:
                        case MeterRXMode.ADC2_L:
                        case MeterRXMode.ADC2_R:
                            spacing = ((double)W - 5.0) / 6.0;
                            g.FillRectangle(low_brush, 0, H - 4, (int)(W - 3.0 - spacing), 2);
                            g.FillRectangle(high_brush, (int)(W - 3.0 - spacing), H - 4, (int)spacing, 2);
                            for (int i = 1; i < 7; i++)
                            {
                                SolidBrush b = low_brush;
                                if (i == 6) b = high_brush;
                                g.FillRectangle(b, (int)(i * spacing - spacing / 2), H - 4 - 3, 1, 5);
                                g.FillRectangle(b, (int)(i * spacing), H - 4 - 6, 2, 8);

                                //Font f = new Font("Arial", 7.0f, FontStyle.Bold);
                                string s = (-120 + i * 20).ToString();
                                SizeF size = g.MeasureString(s, font7, 1, StringFormat.GenericTypographic);
                                double string_width = size.Width - 2.0;
                                size = g.MeasureString("0", font7, 1, StringFormat.GenericTypographic);
                                string_height = size.Height - 2.0;

                                g.DrawString(s, font7, b, (int)(i * spacing - (int)string_width * (s.Length)), (int)(H - 4 - 8 - string_height));
                            }

                            pixel_x = (int)((num + 120.0) / 120.0 * (W - 5.0));
                            break;
                        case MeterRXMode.OFF:
                            break;
                    }

                    if ((!mox && current_meter_rx_mode != MeterRXMode.OFF) ||
                        (mox && current_meter_tx_mode != MeterTXMode.OFF))
                    {
                        pixel_x = Math.Max(0, pixel_x);
                        pixel_x = Math.Min(W - 3, pixel_x);

                        line_dark_pen.Color =
                            Color.FromArgb((edge_avg_color.R + edge_meter_background_color.R) / 2,
                            (edge_avg_color.G + edge_meter_background_color.G) / 2,
                            (edge_avg_color.B + edge_meter_background_color.B) / 2);

                        g.InterpolationMode = InterpolationMode.HighQualityBicubic;
                        g.SmoothingMode = SmoothingMode.HighQuality;
                        g.DrawLine(line_dark_pen, pixel_x - 1, 0, pixel_x - 1, H);
                        g.DrawLine(line_pen, pixel_x, 0, pixel_x, H);
                        g.DrawLine(line_dark_pen, pixel_x + 1, 0, pixel_x + 1, H);
                        g.InterpolationMode = InterpolationMode.Default;
                        g.SmoothingMode = SmoothingMode.Default;

                    }

                    rx2_meter_timer.Stop();

                    format = "f0";
                    if (meter_detail) format = "f1";

                    if (rx2_meter_timer.DurationMsec >= meter_dig_delay)
                    {
                        switch (rx2_meter_mode)
                        {
                            case MeterRXMode.SIGNAL_STRENGTH:
                            case MeterRXMode.SIGNAL_AVERAGE:
                                output = num.ToString(format) + " dBm";
                                break;
                            case MeterRXMode.ADC_L:
                            case MeterRXMode.ADC_R:
                            case MeterRXMode.ADC2_L:
                            case MeterRXMode.ADC2_R:
                                output = num.ToString("f1") + " dBFS";
                                break;
                            case MeterRXMode.OFF:
                                output = "";
                                break;
                        }

                        txtRX2Meter.Text = output;
                        rx2_meter_timer.Start();
                    }

                    if (rx2_meter_data_ready)
                    {
                        rx2_meter_data_ready = false;  //We do NOT want to do this before we have consumed it!!!! so do it here.
                    }

                    break;
                    #endregion
                case MultiMeterDisplayMode.Analog:
                    #region Analog

                    #endregion
                    break;
            }
        }

        private void ResetMultiMeterPeak()
        {
            meter_peak_count = multimeter_peak_hold_samples;
            avg_num = Display.CLEAR_FLAG;
        }

        private void ResetRX2MeterPeak()
        {
            rx2_meter_peak_count = multimeter_peak_hold_samples;
            rx2_meter_avg = Display.CLEAR_FLAG;
        }

        private void panelVFOAHover_Paint(object sender, System.Windows.Forms.PaintEventArgs e)
        {
            if (vfoa_hover_digit < 0)
                return;

            int x = 0;
            int width = 0;

            if (small_lsd && txtVFOALSD.Visible)
            {
                x += (vfo_char_width + vfo_char_space) * vfoa_hover_digit;
                if (vfoa_hover_digit > 3)
                    x += (vfo_decimal_space - vfo_char_space);

                if (vfoa_hover_digit > 6)
                {
                    x += vfo_small_char_width;
                    x += (vfo_small_char_width + vfo_small_char_space - vfo_char_width - vfo_char_space) * (vfoa_hover_digit - 6);
                    width = x + vfo_small_char_width;
                }
                else width = x + vfo_char_width;
            }
            else
            {
                x += (vfo_char_width + vfo_char_space) * vfoa_hover_digit;
                if (vfoa_hover_digit > 3)
                    x += (vfo_decimal_space - vfo_char_space);
                width = x + vfo_char_width;
            }
            //using (Pen p = new Pen(txtVFOAFreq.ForeColor, 2.0f))
            e.Graphics.DrawLine(txtvfoafreq_forecolor_pen, x, 1, width, 1);
        }

        private void panelVFOBHover_Paint(object sender, System.Windows.Forms.PaintEventArgs e)
        {
            if (vfob_hover_digit < 0)
                return;

            int x = 0;
            int width = 0;

            if (small_lsd && txtVFOBLSD.Visible)
            {
                x += (vfo_char_width + vfo_char_space) * vfob_hover_digit;
                if (vfob_hover_digit > 3)
                    x += (vfo_decimal_space - vfo_char_space);

                if (vfob_hover_digit > 6)
                {
                    x += vfo_small_char_width;
                    x += (vfo_small_char_width + vfo_small_char_space - vfo_char_width - vfo_char_space) * (vfob_hover_digit - 6);
                    width = x + vfo_small_char_width;
                }
                else width = x + vfo_char_width;
            }
            else
            {
                x += (vfo_char_width + vfo_char_space) * vfob_hover_digit;
                if (vfob_hover_digit > 3)
                    x += (vfo_decimal_space - vfo_char_space);
                width = x + vfo_char_width;
            }
            using (Pen p = new Pen(txtVFOBFreq.ForeColor, 2.0f))
                e.Graphics.DrawLine(p, x, 1, width, 1);
        }

        public void UpdateRX1DisplayAverage(float[] buffer, float[] new_data)
        {
            double dttsp_osc = radio.GetDSPRX(0, 0).RXOsc;
            // Debug.WriteLine("last vfo: " + avg_last_ddsfreq + " vfo: " + DDSFreq); 
            if (buffer[0] == Display.CLEAR_FLAG)
            {
                //Debug.WriteLine("Clearing average buf"); 
                for (int i = 0; i < Display.BUFFER_SIZE; i++)
                    buffer[i] = new_data[i];
            }
            else
            {
                // wjt added -- stop hosing the avg display when scrolling the vfo 
                if (rx1_avg_last_ddsfreq != 0 && rx1_avg_last_ddsfreq != FWCDDSFreq)  // vfo has changed, need to shift things around 
                {
                    //Debug.WriteLine("dttsp_osc: " + dttsp_osc); 
                    double delta_vfo;
                   
                        delta_vfo = FWCDDSFreq - rx1_avg_last_ddsfreq;
                        delta_vfo *= 1000000.0; // vfo in mhz moron!
                   
                    double hz_per_bin = sample_rate1 / Display.BUFFER_SIZE;

                    int bucket_shift = (int)(delta_vfo / hz_per_bin);
                    double leftover = delta_vfo - ((double)bucket_shift * hz_per_bin);
                    leftover = leftover / hz_per_bin; // conver to fractions of bucket 
                    double total_leftover = leftover + rx1_last_bin_shift_leftover;
                    if (total_leftover < -0.5)
                    {
                        bucket_shift -= 1;
                        total_leftover += 1;
                        //Debug.WriteLine("bump down"); 
                    }
                    else if (total_leftover > 0.5)
                    {
                        bucket_shift += 1;
                        total_leftover -= 1;
                        //Debug.WriteLine("bump up"); 
                    }
                    rx1_last_bin_shift_leftover = total_leftover;
                    //Debug.WriteLine("leftover: " + leftover + " total_leftover: " + total_leftover); 

                    // bucket_shift = bucket_shift/2; 						
                    // indexed_value pre_max = findMax(average_buffer, display_buffer_size); 
                    // Debug.WriteLine("\nPre max: " + pre_max.val + " " + pre_max.idx); 
                    // Debug.WriteLine("bshift: " + bucket_shift + " delta_vfo: " + delta_vfo); 
                    if (bucket_shift > 0) // vfo increased, need to shift avgs to the left 
                    {
                        if (bucket_shift >= Display.BUFFER_SIZE)
                        {
                            buffer[0] = Display.CLEAR_FLAG;
                        }
                        else
                        {
                            for (int j = 0; j < Display.BUFFER_SIZE - bucket_shift; j++)
                                buffer[j] = buffer[j + bucket_shift];  // wjt fix use memmove 

                            // fill avg with last good data on the end
                            for (int j = Display.BUFFER_SIZE - bucket_shift; j < Display.BUFFER_SIZE; j++)
                                buffer[j] = buffer[Display.BUFFER_SIZE - bucket_shift - 1];
                        }
                    }
                    else if (bucket_shift < 0) // vfo decreased, move samples up 
                    {
                        if (-bucket_shift >= Display.BUFFER_SIZE)
                        {
                            buffer[0] = Display.CLEAR_FLAG;
                        }
                        else
                        {
                            for (int j = Display.BUFFER_SIZE - 1; j > -bucket_shift; j--)
                                buffer[j] = buffer[j + bucket_shift];

                            for (int j = 0; j < -bucket_shift; j++)
                                buffer[j] = buffer[-bucket_shift];
                        }
                    }
                    //					indexed_value post_max = findMax(average_buffer, display_buffer_size); 
                    //					Debug.WriteLine("Post max: " + post_max.val + " " + post_max.idx); 
                    //					indexed_value disp_max = findMax(display_data, display_buffer_size); 		
                    //					Debug.WriteLine("Disp max: " + disp_max.val + " " + disp_max.idx); 
                }
                else
                {
                    rx1_last_bin_shift_leftover = 0; // reset, this vfo = last vfo 
                }

                float new_mult = 0.0f;
                float old_mult = 0.0f;

                switch (Display.CurrentDisplayMode)
                {
                    case DisplayMode.WATERFALL:
                        new_mult = Display.waterfall_avg_mult_new;
                        old_mult = Display.waterfall_avg_mult_old;
                        break;
                    default:
                        new_mult = Display.display_avg_mult_new;
                        old_mult = Display.display_avg_mult_old;
                        break;
                }

                for (int i = 0; i < Display.BUFFER_SIZE; i++)
                    buffer[i] = new_data[i] =
                        (float)(new_data[i] * new_mult +
                        buffer[i] * old_mult);
            }

            if (buffer[0] == Display.CLEAR_FLAG)
            {
                rx1_avg_last_ddsfreq = 0;
                rx1_avg_last_dttsp_osc = 0;
            }
            else
            {
                rx1_avg_last_ddsfreq = FWCDDSFreq;
                rx1_avg_last_dttsp_osc = dttsp_osc;
            }
        }

        public void UpdateRX2DisplayAverage(float[] buffer, float[] new_data)
        {
           // double dttsp_osc = radio.GetDSPRX(1, 0).RXOsc;
            // Debug.WriteLine("last vfo: " + avg_last_ddsfreq + " vfo: " + DDSFreq); 
            if (buffer[0] == Display.CLEAR_FLAG)
            {
                //Debug.WriteLine("Clearing average buf"); 
                for (int i = 0; i < Display.BUFFER_SIZE; i++)
                    buffer[i] = new_data[i];
            }
            else
            {
                // wjt added -- stop hosing the avg display when scrolling the vfo 
                if (rx2_avg_last_ddsfreq != 0 && rx2_avg_last_ddsfreq != RX2DDSFreq) // vfo has changed, need to shift things around 
                {
                    //Debug.WriteLine("dttsp_osc: " + dttsp_osc); 
                    double delta_vfo;
                   
                        delta_vfo = RX2DDSFreq - rx2_avg_last_ddsfreq;
                        delta_vfo *= 1000000.0; // vfo in mhz moron!
                    
                   
                    double hz_per_bin = sample_rate1 / Display.BUFFER_SIZE;

                    int bucket_shift = (int)(delta_vfo / hz_per_bin);
                    double leftover = delta_vfo - ((double)bucket_shift * hz_per_bin);
                    leftover = leftover / hz_per_bin; // conver to fractions of bucket 
                    double total_leftover = leftover + rx2_last_bin_shift_leftover;
                    if (total_leftover < -0.5)
                    {
                        bucket_shift -= 1;
                        total_leftover += 1;
                        //Debug.WriteLine("bump down"); 
                    }
                    else if (total_leftover > 0.5)
                    {
                        bucket_shift += 1;
                        total_leftover -= 1;
                        //Debug.WriteLine("bump up"); 
                    }
                    rx2_last_bin_shift_leftover = total_leftover;
                    //Debug.WriteLine("leftover: " + leftover + " total_leftover: " + total_leftover); 

                    // bucket_shift = bucket_shift/2; 						
                    // indexed_value pre_max = findMax(average_buffer, display_buffer_size); 
                    // Debug.WriteLine("\nPre max: " + pre_max.val + " " + pre_max.idx); 
                    // Debug.WriteLine("bshift: " + bucket_shift + " delta_vfo: " + delta_vfo); 
                    if (bucket_shift > 0) // vfo increased, need to shift avgs to the left 
                    {
                        if (bucket_shift >= Display.BUFFER_SIZE)
                        {
                            buffer[0] = Display.CLEAR_FLAG;
                        }
                        else
                        {
                            for (int j = 0; j < Display.BUFFER_SIZE - bucket_shift; j++)
                                buffer[j] = buffer[j + bucket_shift];  // wjt fix use memmove 

                            // fill avg with last good data on the end
                            for (int j = Display.BUFFER_SIZE - bucket_shift; j < Display.BUFFER_SIZE; j++)
                                buffer[j] = buffer[Display.BUFFER_SIZE - bucket_shift - 1];
                        }
                    }
                    else if (bucket_shift < 0) // vfo decreased, move samples up 
                    {
                        if (-bucket_shift >= Display.BUFFER_SIZE)
                        {
                            buffer[0] = Display.CLEAR_FLAG;
                        }
                        else
                        {
                            for (int j = Display.BUFFER_SIZE - 1; j > -bucket_shift; j--)
                                buffer[j] = buffer[j + bucket_shift];

                            for (int j = 0; j < -bucket_shift; j++)
                                buffer[j] = buffer[-bucket_shift];
                        }
                    }
                    //					indexed_value post_max = findMax(average_buffer, display_buffer_size); 
                    //					Debug.WriteLine("Post max: " + post_max.val + " " + post_max.idx); 
                    //					indexed_value disp_max = findMax(display_data, display_buffer_size); 		
                    //					Debug.WriteLine("Disp max: " + disp_max.val + " " + disp_max.idx); 
                }
                else
                {
                    rx2_last_bin_shift_leftover = 0; // reset, this vfo = last vfo 
                }

                float new_mult = 0.0f;
                float old_mult = 0.0f;

                switch (Display.CurrentDisplayModeBottom)
                {
                    case DisplayMode.WATERFALL:
                        new_mult = Display.waterfall_avg_mult_new;
                        old_mult = Display.waterfall_avg_mult_old;
                        break;
                    default:
                        new_mult = Display.display_avg_mult_new;
                        old_mult = Display.display_avg_mult_old;
                        break;
                }

                for (int i = 0; i < Display.BUFFER_SIZE; i++)
                    buffer[i] = new_data[i] =
                        (float)(new_data[i] * new_mult +
                        buffer[i] * old_mult);
            }

            if (buffer[0] == Display.CLEAR_FLAG)
            {
                rx2_avg_last_ddsfreq = 0;
            }
            else
            {
                rx2_avg_last_ddsfreq = RX2DDSFreq;
            }
        }

        #endregion

        #region Thread and Timer Routines
        // ======================================================
        // Thread Routines
        // ======================================================

        private void RunDisplay()
        {
            //uint thread = 0;
            //			display_running = true;
            while (chkPower.Checked && Display.CurrentDisplayMode != DisplayMode.OFF)
            {
                //if(mox) thread = 1;
                //else thread = 0;
                uint top_thread = 0;
                uint bottom_thread = 2;

                if (mox && !hpsdr_duplex_enabled)
                {
                    if (chkVFOATX.Checked || !chkRX2.Checked) top_thread = 1;
                    else if (chkVFOBTX.Checked && chkRX2.Checked) bottom_thread = 1;
                }

                if (!Display.DataReady || (chkSplitDisplay.Checked && !Display.DataReadyBottom))
                {
                    if (calibration_running)
                    {
                        calibration_mutex.WaitOne();
                        displaydidit = true;
                    }
                    //if(!chkSplitDisplay.Checked)
                    if (!Display.DataReady && Display.CurrentDisplayMode != DisplayMode.OFF)
                    {
                        switch (Display.CurrentDisplayMode)
                        {
                            case DisplayMode.SPECTRUM:
                            case DisplayMode.HISTOGRAM:
                            case DisplayMode.SPECTRASCOPE:
                                fixed (float* ptr = &Display.new_display_data[0])
                                    DttSP.GetSpectrum(top_thread, ptr);
                                break;
                            case DisplayMode.WATERFALL:
                            case DisplayMode.PANADAPTER:
                            case DisplayMode.PANAFALL:
                            case DisplayMode.PANASCOPE:
                                fixed (float* ptr = &Display.new_display_data[0])
                                    DttSP.GetPanadapter(top_thread, ptr);
                                break;
                            case DisplayMode.SCOPE:
                            case DisplayMode.SCOPE2:
                                fixed (float* ptr = &Display.new_display_data[0])
                                    DttSP.GetScope(top_thread, ptr, (int)(scope_time * 48));
                                break;
                            case DisplayMode.PHASE:
                                fixed (float* ptr = &Display.new_display_data[0])
                                    DttSP.GetPhase(top_thread, ptr, Display.PhaseNumPts);
                                break;
                            case DisplayMode.PHASE2:
                                //Audio.phase_mutex.WaitOne();
                                for (int i = 0; i < Display.PhaseNumPts; i++)
                                {
                                    Display.new_display_data[i * 2] = Audio.phase_buf_l[i];
                                    Display.new_display_data[i * 2 + 1] = Audio.phase_buf_r[i];
                                }
                                //Audio.phase_mutex.ReleaseMutex();
                                break;
                        }
                        Display.DataReady = true;
                    }

                    if (chkSplitDisplay.Checked && !Display.DataReadyBottom && Display.CurrentDisplayModeBottom != DisplayMode.OFF)
                    {
                        switch (Display.CurrentDisplayModeBottom)
                        {
                            case DisplayMode.SPECTRUM:
                            case DisplayMode.HISTOGRAM:
                                fixed (float* ptr = &Display.new_display_data_bottom[0])
                                    DttSP.GetSpectrum(bottom_thread, ptr);
                                break;
                            case DisplayMode.WATERFALL:
                            case DisplayMode.PANADAPTER:
                                fixed (float* ptr = &Display.new_display_data_bottom[0])
                                    DttSP.GetPanadapter(bottom_thread, ptr);
                                break;
                            case DisplayMode.SCOPE:
                            case DisplayMode.SCOPE2:
                                fixed (float* ptr = &Display.new_display_data_bottom[0])
                                    DttSP.GetScope(bottom_thread, ptr, (int)(scope_time * 48));
                                break;
                            case DisplayMode.PHASE:
                                fixed (float* ptr = &Display.new_display_data_bottom[0])
                                    DttSP.GetPhase(bottom_thread, ptr, Display.PhaseNumPts);
                                break;
                            case DisplayMode.PHASE2:
                                //Audio.phase_mutex.WaitOne();
                                for (int i = 0; i < Display.PhaseNumPts; i++)
                                {
                                    Display.new_display_data_bottom[i * 2] = Audio.phase_buf_l[i];
                                    Display.new_display_data_bottom[i * 2 + 1] = Audio.phase_buf_r[i];
                                }
                                //Audio.phase_mutex.ReleaseMutex();
                                break;
                        }
                        Display.DataReadyBottom = true;
                    }
                    if (displaydidit)
                    {
                        displaydidit = false;
                        calibration_mutex.ReleaseMutex();
                    }
                }

                UpdateDisplay();

                if (chkPower.Checked)
                    Thread.Sleep(display_delay);
            }
            //			display_running = false;
        }

        private HiPerfTimer meter_timer = new HiPerfTimer();
        private float multimeter_avg = Display.CLEAR_FLAG;
        private void UpdateMultimeter()
        {
            meter_timer.Start();
            while (chkPower.Checked)
            {
                if (!meter_data_ready)
                {
                    if (!mox)
                    {
                        /*if(Audio.CurrentAudioState1 != Audio.AudioState.DTTSP)
                            goto end;*/

                        MeterRXMode mode = CurrentMeterRXMode;
                        float num = 0f;
                        switch (mode)
                        {
                            case MeterRXMode.SIGNAL_STRENGTH:
                                num = DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);

                                switch (current_model)
                                {
                                    case Model.HPSDR:
                                    case Model.HERMES:
                                        num = num +
                                            rx1_meter_cal_offset +
                                            rx1_preamp_offset[(int)rx1_preamp_mode] +
                                            rx1_filter_size_cal_offset +
                                            (-alex_preamp_offset) +
                                            rx1_xvtr_gain_offset;
                                        break;
                                    case Model.SDRX:
                                        num = num +
                                            rx1_meter_cal_offset +
                                            meter_offset +
                                            rx1_filter_size_cal_offset +
                                            rx1_xvtr_gain_offset;
                                        break;
                                    case Model.FLEX5000:
                                    case Model.FLEX3000:
                                        num = num +
                                            rx1_meter_cal_offset +
                                            rx1_preamp_offset[(int)rx1_preamp_mode] +
                                            rx1_filter_size_cal_offset +
                                            rx1_path_offset +
                                            rx1_xvtr_gain_offset +
                                            rx1_loop_offset;
                                        break;
                                    default:
                                        num = num +
                                            rx1_meter_cal_offset +
                                            rx1_preamp_offset[(int)rx1_preamp_mode] +
                                            rx1_filter_size_cal_offset +
                                            rx1_xvtr_gain_offset;
                                        break;
                                }
                                //output = num.ToString("f1")+" dBm";
                                new_meter_data = num;
                                break;
                            case MeterRXMode.SIGNAL_AVERAGE:
                                num = DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                                if (multimeter_avg == Display.CLEAR_FLAG) multimeter_avg = num;
                                num = multimeter_avg_mult_old * multimeter_avg + multimeter_avg_mult_new * num;
                                multimeter_avg = num;

                                switch (current_model)
                                {
                                    case Model.HPSDR:
                                    case Model.HERMES:
                                        num = num +
                                            rx1_meter_cal_offset +
                                            rx1_preamp_offset[(int)rx1_preamp_mode] +
                                            rx1_filter_size_cal_offset +
                                            (-alex_preamp_offset) +
                                            rx1_xvtr_gain_offset;
                                        break;
                                    case Model.SDRX:
                                        num = num +
                                            rx1_meter_cal_offset +
                                            meter_offset +
                                            rx1_filter_size_cal_offset +
                                            rx1_xvtr_gain_offset;
                                        break;
                                    case Model.FLEX5000:
                                    case Model.FLEX3000:
                                        num = num +
                                            rx1_meter_cal_offset +
                                            rx1_preamp_offset[(int)rx1_preamp_mode] +
                                            rx1_filter_size_cal_offset +
                                            rx1_path_offset +
                                            rx1_xvtr_gain_offset +
                                            rx1_loop_offset;
                                        break;
                                    default:
                                        num = num +
                                            rx1_meter_cal_offset +
                                            rx1_preamp_offset[(int)rx1_preamp_mode] +
                                            rx1_filter_size_cal_offset +
                                            rx1_xvtr_gain_offset;
                                        break;
                                }
                                //output = num.ToString("f1")+" dBm";
                                new_meter_data = num;
                                break;
                            case MeterRXMode.ADC_L:
                                num = DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.ADC_REAL);
                                //output = num.ToString("f1")+" dBFS";
                                new_meter_data = num;
                                break;
                            case MeterRXMode.ADC_R:
                                num = DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.ADC_IMAG);
                                //output = num.ToString("f1")+" dBFS";
                                new_meter_data = num;
                                break;
                            case MeterRXMode.ADC2_L:
                                num = DttSP.CalculateRXMeter(2, 0, DttSP.MeterType.ADC_REAL);
                                //output = num.ToString("f1")+" dBFS";
                                new_meter_data = num;
                                break;
                            case MeterRXMode.ADC2_R:
                                num = DttSP.CalculateRXMeter(2, 0, DttSP.MeterType.ADC_IMAG);
                                //output = num.ToString("f1")+" dBFS";
                                new_meter_data = num;
                                break;
                            case MeterRXMode.OFF:
                                //output = "";
                                new_meter_data = -200.0f;
                                break;
                        }
                    }
                    else
                    {
                        MeterTXMode mode = CurrentMeterTXMode;
                        float num = 0f;
                        double power = 0.0;

                        double alex_fwd = (double)JanusAudio.computeAlexFwdPower();
                        double alex_rev = (double)JanusAudio.computeRefPower();
                        float alex_swr = (float)ALEXSWR(alex_fwd, alex_rev);

                        switch (mode)
                        {
                            case MeterTXMode.MIC:
                                if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP)
                                {
                                    if (peak_tx_meter)
                                    {
                                        num = (float)Math.Max(-195.0f, -DttSP.CalculateTXMeter(1, DttSP.MeterType.MIC_PK));
                                    }
                                    else
                                    {
                                        num = (float)Math.Max(-195.0f, -DttSP.CalculateTXMeter(1, DttSP.MeterType.MIC) + 3.0f);
                                    }
                                    //output = num.ToString("f1")+" dB";
                                    new_meter_data = num;
                                }
                                else
                                {
                                    //output = "-30"+separator+"0 dB";
                                    new_meter_data = -195.0f;
                                }
                                break;
                            case MeterTXMode.EQ:
                                if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP)
                                {
                                    if (peak_tx_meter) num = (float)Math.Max(-30.0f, -DttSP.CalculateTXMeter(1, DttSP.MeterType.EQ_PK));
                                    else num = (float)Math.Max(-30.0f, -DttSP.CalculateTXMeter(1, DttSP.MeterType.EQ) + 3.0f);
                                    //output = num.ToString("f1")+" dB";
                                    new_meter_data = num;
                                }
                                else
                                {
                                    //output = "-30"+separator+"0 dB";
                                    new_meter_data = -30.0f;
                                }
                                break;
                            case MeterTXMode.LEVELER:
                                if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP)
                                {
                                    if (peak_tx_meter) num = (float)Math.Max(-30.0f, -DttSP.CalculateTXMeter(1, DttSP.MeterType.LEVELER_PK));
                                    else num = (float)Math.Max(-30.0f, -DttSP.CalculateTXMeter(1, DttSP.MeterType.LEVELER) + 3.0f);
                                    //output = num.ToString("f1")+" dB";
                                    new_meter_data = num;
                                }
                                else
                                {
                                    //output = "-30"+separator+"0 dB";
                                    new_meter_data = -30.0f;
                                }
                                break;
                            case MeterTXMode.LVL_G:
                                if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP)
                                {
                                    num = (float)Math.Max(0, DttSP.CalculateTXMeter(1, DttSP.MeterType.LVL_G));
                                    //output = num.ToString("f1")+" dB";
                                    new_meter_data = num;
                                }
                                else
                                {
                                    //output = "0"+separator+"0 dB";
                                    new_meter_data = 0.0f;
                                }
                                break;
                            case MeterTXMode.CPDR:
                                if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP)
                                {
                                    if (peak_tx_meter) num = (float)Math.Max(-30.0f, -DttSP.CalculateTXMeter(1, DttSP.MeterType.CPDR_PK));
                                    else num = (float)Math.Max(-30.0f, -DttSP.CalculateTXMeter(1, DttSP.MeterType.CPDR) + 3.0f);
                                    //output = num.ToString("f1")+" dB";
                                    new_meter_data = num;
                                }
                                else
                                {
                                    //output = "-30"+separator+"0 dB";
                                    new_meter_data = -30.0f;
                                }
                                break;
                            case MeterTXMode.ALC:
                                if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP)
                                {
                                    if (peak_tx_meter) num = (float)Math.Max(-30.0f, -DttSP.CalculateTXMeter(1, DttSP.MeterType.ALC_PK));
                                    else num = (float)Math.Max(-30.0f, -DttSP.CalculateTXMeter(1, DttSP.MeterType.ALC) + 3.0f);
                                    //output = num.ToString("f1")+" dB";
                                    new_meter_data = num;
                                }
                                else
                                {
                                    //output = "-30"+separator+"0 dB";
                                    new_meter_data = -30.0f;
                                }
                                break;
                            case MeterTXMode.ALC_G:
                                if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP)
                                {
                                    num = (float)Math.Max(0, -DttSP.CalculateTXMeter(1, DttSP.MeterType.ALC_G));
                                    //output = num.ToString("f1")+" dB";
                                    new_meter_data = num;
                                }
                                else
                                {
                                    //output = "0"+separator+"0 dB";
                                    new_meter_data = 0.0f;
                                }
                                break;
                            case MeterTXMode.FORWARD_POWER:
                                switch (current_model)
                                {
                                    case Model.HPSDR:
                                    case Model.HERMES:
                                        if (alexpresent)
                                            new_meter_data = JanusAudio.computeAlexFwdPower();
                                        else
                                            new_meter_data = JanusAudio.computeFwdPower();
                                        break;
                                    case Model.FLEX5000:
                                    case Model.FLEX3000:
                                        //output = ((double)pa_fwd_power/4096*2.5).ToString("f3")+" V";
                                        power = FWCPAPower(pa_fwd_power);
                                        //power = (double)pm.Watts;
                                        //output = power.ToString("f0")+" W";
                                        new_meter_data = (float)power;
                                        break;
                                    default:
                                        if (pa_present && VFOAFreq < 30.0)
                                        {
                                            power = PAPower(pa_fwd_power);
                                            //output = power.ToString("f0")+" W";
                                            new_meter_data = (float)power;
                                        }
                                        else
                                        {
                                            if (Audio.CurrentAudioState1 == Audio.AudioState.DTTSP &&
                                                rx1_dsp_mode != DSPMode.CWL &&
                                                rx1_dsp_mode != DSPMode.CWU)
                                            {
                                                num = (float)Math.Max(0.0, DttSP.CalculateTXMeter(1, DttSP.MeterType.PWR));
                                                num *= (float)((double)ptbPWR.Value * 0.01);
                                                //output = (num*1000).ToString("f0")+" mW";
                                                new_meter_data = num;
                                            }
                                            else
                                            {
                                                new_meter_data = 0.0f;
                                            }
                                        }
                                        break;
                                }
                                break;
                            case MeterTXMode.REVERSE_POWER:
                                switch (current_model)
                                {
                                    case Model.HPSDR:
                                    case Model.HERMES:
                                        if (alexpresent)
                                        {
                                            new_meter_data = JanusAudio.computeRefPower();
                                        }
                                        break;
                                    case Model.FLEX5000:
                                    case Model.FLEX3000:
                                        //output = ((double)pa_rev_power/4096*2.5).ToString("f3")+" V";
                                        power = FWCPAPower(pa_rev_power) * swr_table[(int)tx_band];
                                        //output = power.ToString("f0")+" W";
                                        new_meter_data = (float)power;
                                        break;
                                    default:
                                        power = PAPower(pa_rev_power);
                                        //output = power.ToString("f0")+" W";
                                        new_meter_data = (float)power;
                                        break;
                                }
                                break;
                            case MeterTXMode.SWR:
                                double swr = 0.0;
                                if (chkTUN.Checked)
                                {
                                    switch (current_model)
                                    {
                                        case Model.FLEX5000:
                                        case Model.FLEX3000:
                                            swr = FWCSWR(pa_fwd_power, pa_rev_power);
                                            //output = swr.ToString("f1")+" : 1";	
                                            break;
                                        case Model.SDR1000:
                                            swr = SWR(pa_fwd_power, pa_rev_power);
                                            //output = swr.ToString("f1")+" : 1";
                                            break;
                                    }
                                }
                                else
                                {
                                    //output = "in TUN only ";
                                }
                                new_meter_data = alex_swr;
                                break;
                            case MeterTXMode.OFF:
                                //output = "";
                                new_meter_data = -200.0f;
                                break;
                        }
                    }
                    meter_data_ready = true;
                    picMultiMeterDigital.Invalidate();
                }

                //end:
                if (chkPower.Checked)
                    Thread.Sleep(Math.Min(meter_delay, meter_dig_delay));
            }
        }

        private HiPerfTimer rx2_meter_timer = new HiPerfTimer();
        private float rx2_meter_avg = Display.CLEAR_FLAG;
        private void UpdateRX2MeterData()
        {
            rx2_meter_timer.Start();
            while (chkPower.Checked && rx2_enabled && fwc_init && current_model == Model.FLEX5000)
            {
                if (!rx2_meter_data_ready)
                {
                    /*if(Audio.CurrentAudioState1 != Audio.AudioState.DTTSP)
                        goto end;*/

                    MeterRXMode mode = RX2MeterMode;
                    float num = 0f;
                    switch (mode)
                    {
                        case MeterRXMode.SIGNAL_STRENGTH:
                            num = DttSP.CalculateRXMeter(2, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                            num = num +
                                rx2_meter_cal_offset +
                                rx2_preamp_offset[(int)rx2_preamp_mode] +
                                rx2_filter_size_cal_offset +
                                rx2_path_offset +
                                rx2_xvtr_gain_offset +
                                rx2_loop_offset;

                            //output = num.ToString("f1")+" dBm";
                            rx2_meter_new_data = num;
                            break;
                        case MeterRXMode.SIGNAL_AVERAGE:
                            num = DttSP.CalculateRXMeter(2, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                            if (rx2_meter_avg == Display.CLEAR_FLAG) rx2_meter_avg = num;
                            num = multimeter_avg_mult_old * rx2_meter_avg + multimeter_avg_mult_new * num;
                            rx2_meter_avg = num;
                            num = num +
                                rx2_meter_cal_offset +
                                rx2_preamp_offset[(int)rx2_preamp_mode] +
                                rx2_filter_size_cal_offset +
                                rx2_path_offset +
                                rx2_xvtr_gain_offset +
                                rx2_loop_offset;

                            //output = num.ToString("f1")+" dBm";
                            rx2_meter_new_data = num;
                            break;
                        case MeterRXMode.ADC_L:
                            num = DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.ADC_REAL);
                            //output = num.ToString("f1")+" dBFS";
                            rx2_meter_new_data = num;
                            break;
                        case MeterRXMode.ADC_R:
                            num = DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.ADC_IMAG);
                            //output = num.ToString("f1")+" dBFS";
                            rx2_meter_new_data = num;
                            break;
                        case MeterRXMode.ADC2_L:
                            num = DttSP.CalculateRXMeter(2, 0, DttSP.MeterType.ADC_REAL);
                            //output = num.ToString("f1")+" dBFS";
                            rx2_meter_new_data = num;
                            break;
                        case MeterRXMode.ADC2_R:
                            num = DttSP.CalculateRXMeter(2, 0, DttSP.MeterType.ADC_IMAG);
                            //output = num.ToString("f1")+" dBFS";
                            rx2_meter_new_data = num;
                            break;
                        case MeterRXMode.OFF:
                            //output = "";
                            rx2_meter_new_data = -200.0f;
                            break;
                    }
                    rx2_meter_data_ready = true;
                    picRX2Meter.Invalidate();
                }

                //end:
                if (chkPower.Checked)
                    Thread.Sleep(Math.Min(meter_delay, meter_dig_delay));
            }
        }

        private float sql_data = -200.0f;
        private void UpdateSQL()
        {
            while (chkPower.Checked)
            {
                if (!mox)
                {
                    float num = DttSP.CalculateRXMeter(0, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                    if (fwc_init)
                    {
                        switch (current_model)
                        {
                            /*case Model.SDRX:					
                                num = num +
                                    rx1_meter_cal_offset +
                                    meter_offset +
                                    filter_size_cal_offset;
                                break;*/
                            case Model.FLEX5000:
                            case Model.FLEX3000:
                                num = num +
                                    rx1_meter_cal_offset +
                                    rx1_preamp_offset[(int)rx1_preamp_mode] +
                                    rx1_filter_size_cal_offset +
                                    rx1_path_offset;
                                break;
                        }
                    }
                    else
                    {
                        num = num +
                            rx1_meter_cal_offset +
                            rx1_preamp_offset[(int)rx1_preamp_mode] +
                            rx1_filter_size_cal_offset;
                    }

                    sql_data = num;
                    picSquelch.Invalidate();
                }

                if (chkPower.Checked) Thread.Sleep(100);
            }
        }

        private float rx2_sql_data = -200.0f;
        private void UpdateRX2SQL()
        {
            while (chkPower.Checked && rx2_enabled)
            {
                float num = DttSP.CalculateRXMeter(2, 0, DttSP.MeterType.SIGNAL_STRENGTH);
                //Debug.WriteLine("SQL Read: "+num.ToString("f1"));

                num = num +
                    rx2_meter_cal_offset +
                    rx2_preamp_offset[(int)rx2_preamp_mode] +
                    rx2_filter_size_cal_offset +
                    rx2_path_offset;

                rx2_sql_data = num;
                picRX2Squelch.Invalidate();

                if (chkPower.Checked && rx2_enabled) Thread.Sleep(100);
            }
        }

        private float noise_gate_data = -200.0f;
        private void UpdateNoiseGate()
        {
            while (chkPower.Checked)
            {
                if (mox)
                {
                    float num = -DttSP.CalculateTXMeter(1, DttSP.MeterType.MIC);

                    noise_gate_data = num + 3.0f;
                    picNoiseGate.Invalidate();
                }

                if (chkPower.Checked) Thread.Sleep(100);
            }
        }

        private void UpdateVOX()
        {
            while (chkPower.Checked)
            {
                switch (rx1_dsp_mode)
                {
                    case DSPMode.LSB:
                    case DSPMode.USB:
                    case DSPMode.DSB:
                    case DSPMode.AM:
                    case DSPMode.SAM:
                    case DSPMode.FM:
                        picVOX.Invalidate();
                        break;
                }

                if (chkPower.Checked) Thread.Sleep(100);
            }
        }

        private PreampMode preamp;
        private bool update_preamp = true;
        private bool update_preamp_mode = false;
        private bool mon_recall = false;
        private static HiPerfTimer vox_timer = new HiPerfTimer();
        //  private bool kptt = false;
        //  private bool kmptt = false;
        //  private bool kpptt = false;

        private void PollPTT()
        {
            //  HiPerfTimer cwpolltimer = new HiPerfTimer();
            // cwpolltimer.Start();


            while (chkPower.Checked)
            {
                DSPMode tx_mode = rx1_dsp_mode;
                if (chkVFOBTX.Checked && chkRX2.Checked) tx_mode = rx2_dsp_mode;
                // reset the CW ring buffers every 5000ms when not in use
                /*   if (current_ptt_mode != PTTMode.NONE)
                {
                    switch (tx_mode)
                    {
                        case DSPMode.CWL:
                        case DSPMode.CWU:
                            cwpolltimer.Start(); // start over since key is in use
                            break;
                    }
                }
                else
                {
                    switch (tx_mode)
                    {
                        case DSPMode.CWL:
                        case DSPMode.CWU:
                            cwpolltimer.Stop(); // check how long since last reset
                            if (cwpolltimer.DurationMsec > 5000 + break_in_delay && !mox)
                            {
                                // if more than 5 sec + break in delay, reset timer and ring buffer
                                cwpolltimer.Start();
                                DttSP.CWRingRestart();
                            }
                            break;
                    }
                   } */

                if (!manual_mox && !disable_ptt && !rx_only)
                {
                    //bool mic_ptt = false, 
                    bool x2_ptt = false, cw_ptt = false, cat_ptt_local = false, vox_ptt = false;
                    // bool keyer_playing = DttSP.KeyerPlaying();
                    if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                    {
                        // cw_ptt = (cw_semi_break_in_enabled && keyer_playing);// || Keyer.KeyerPTT || Keyer.MemoryPTT;
                        // mic_ptt = fwc_mic_ptt;
                        x2_ptt = fwc_rca_ptt;
                        vox_ptt = Audio.VOXActive;
                        cat_ptt_local = (ptt_bit_bang_enabled && serialPTT != null && serialPTT.isPTT()) | cat_ptt;
                    }
                    else
                    {
                        //byte b = 0; 
                        //if(current_model == Model.SDR1000)
                        byte b = Hdw.StatusPort(); //w5wc
                        // kptt = Keyer.KeyerPTT;
                        // kmptt = Keyer.MemoryPTT;
                        // kpptt = (cw_semi_break_in_enabled && keyer_playing);
                        // cw_ptt = kpptt || kptt || kmptt;

                        //cw_ptt = (cw_semi_break_in_enabled && keyer_playing) || Keyer.KeyerPTT || Keyer.MemoryPTT; //w5wc

                        mic_ptt = (b & (byte)StatusPin.Dot) != 0;
                        if (!mic_ptt)  // check aux sources for ptt if not already set 
                        {
                            if ((JanusAudio.GetDotDashPTT() & 0x1) == 1)
                            {
                                mic_ptt = true;
                            }
                            // if we're not in cw mode take either of the serial port keyer lines as ptt - mostly for soft rock support.
                            /*  if (tx_mode != DSPMode.CWL && tx_mode != DSPMode.CWU)
                            {
                                if (Keyer.PrimaryConnPort != "SDR" && Keyer.PrimaryConnPort != "Ozy/Hermes")
                                {
                                    if (Keyer.sp.CtsHolding) mic_ptt = true;
                                    else if (Keyer.sp.DsrHolding) mic_ptt = true;
                                }
                              } */
                        }

                        int tmp = JanusAudio.GetDotDashPTT();
                        //  bool temp = 
                        if ((tmp & 0x04) != 0) // dot
                        // if (temp != Keyer.FWCDot)
                        {
                            //  Keyer.FWCDot = temp;
                            CWSensorItem.InputType type = CWSensorItem.InputType.Dot;
                            if (reverse_paddles) type = CWSensorItem.InputType.Dash;

                            CWSensorItem item = new CWSensorItem(type, true);
                            CWKeyer.SensorEnqueue(item);
                        }
                        else
                        {
                            CWSensorItem.InputType type = CWSensorItem.InputType.Dot;
                            if (reverse_paddles) type = CWSensorItem.InputType.Dash;

                            CWSensorItem item = new CWSensorItem(type, false);
                            CWKeyer.SensorEnqueue(item);
                        }

                        tmp = JanusAudio.GetDotDashPTT();
                        // temp =
                        if ((tmp & 0x02) != 0) // dash
                        // if (temp != Keyer.FWCDash)
                        {
                            //  Keyer.FWCDash = temp;
                            CWSensorItem.InputType type = CWSensorItem.InputType.Dash;
                            if (reverse_paddles) type = CWSensorItem.InputType.Dot;

                            CWSensorItem item = new CWSensorItem(type, true);
                            CWKeyer.SensorEnqueue(item);
                        }
                        else
                        {
                            CWSensorItem.InputType type = CWSensorItem.InputType.Dash;
                            if (reverse_paddles) type = CWSensorItem.InputType.Dot;

                            CWSensorItem item = new CWSensorItem(type, false);
                            CWKeyer.SensorEnqueue(item);
                        }

                        x2_ptt = (b & (byte)StatusPin.PIN_11) != 0;
                        if (usb_present) x2_ptt = !x2_ptt;
                        vox_ptt = Audio.VOXActive;
                        cat_ptt_local = (ptt_bit_bang_enabled && serialPTT != null && serialPTT.isPTT()) | cat_ptt;

                        if (auto_mute)
                        {
                            bool mute = !((b & (byte)StatusPin.PIN_12) != 0);
                            if (chkMUT.Checked != mute) chkMUT.Checked = mute;
                        }
                    }

                    /*Debug.WriteLine(cw_ptt.ToString().PadRight(6, ' ')+
                        mic_ptt.ToString().PadRight(6, ' ')+
                        x2_ptt.ToString().PadRight(6, ' ')+
                        vox_ptt.ToString().PadRight(6, ' ')+
                        cat_ptt_local.ToString().PadRight(6, ' ')+
                        current_ptt_mode.ToString());*/

                    // if (cw_ptt) break_in_timer.Start();

                    if (!mox)
                    {
                        if (x2_ptt)
                        {
                            current_ptt_mode = PTTMode.X2;
                            switch (tx_mode)
                            {
                                case DSPMode.LSB:
                                case DSPMode.USB:
                                case DSPMode.DSB:
                                case DSPMode.AM:
                                case DSPMode.SAM:
                                case DSPMode.FM:
                                case DSPMode.DIGL:
                                case DSPMode.DIGU:
                                    if (chkPhoneVAC.Checked && allow_vac_bypass)
                                        Audio.VACBypass = true;
                                    break;
                            }

                            chkMOX.Checked = true;
                            if (!mox)
                            {
                                chkPower.Checked = false;
                                return;
                            }
                        }

                        if (cat_ptt_local)
                        {
                            current_ptt_mode = PTTMode.CAT;

                            chkMOX.Checked = true;
                            if (!mox)
                            {
                                chkPower.Checked = false;
                                return;
                            }
                        }

                        if ((tx_mode == DSPMode.LSB ||
                            tx_mode == DSPMode.USB ||
                            tx_mode == DSPMode.DSB ||
                            tx_mode == DSPMode.AM ||
                            tx_mode == DSPMode.SAM ||
                            tx_mode == DSPMode.DIGU ||
                            tx_mode == DSPMode.DIGL ||
                            tx_mode == DSPMode.FM ||
                            all_mode_mic_ptt) &&
                            mic_ptt)
                        {
                            current_ptt_mode = PTTMode.MIC;

                            if (chkPhoneVAC.Checked && allow_vac_bypass)
                                Audio.VACBypass = true;

                            chkMOX.Checked = true;
                            if (!mox)
                            {
                                chkPower.Checked = false;
                                return;
                            }
                        }

                        if ((tx_mode == DSPMode.LSB ||
                            tx_mode == DSPMode.USB ||
                            tx_mode == DSPMode.DSB ||
                            tx_mode == DSPMode.AM ||
                            tx_mode == DSPMode.SAM ||
                            tx_mode == DSPMode.DIGU ||
                            tx_mode == DSPMode.DIGL ||
                            tx_mode == DSPMode.FM) &&
                            vox_ptt)
                        {
                            current_ptt_mode = PTTMode.VOX;
                            vox_timer.Start();
                            chkMOX.Checked = true;
                            /*if(!mox)
                            {
                                chkPower.Checked = false;
                                return;
                            }*/
                        }

                        /*   if (Keyer.AutoSwitchMode && mic_ptt)
                        {
                            switch (tx_mode)
                            {
                                case DSPMode.CWL:
                                    break_in_timer.Stop();
                                    chkMOX.Checked = false;
                                    this.RX1DSPMode = DSPMode.LSB;
                                    //radModeLSB.Checked = true;
                                    break;
                                case DSPMode.CWU:
                                    break_in_timer.Stop();
                                    chkMOX.Checked = false;
                                    this.RX1DSPMode = DSPMode.USB;
                                    //radModeUSB.Checked = true;
                                    break;
                            }
                           } */

                        if (attontx)
                        {
                            if (update_preamp_mode)
                            {
                                RX1PreampMode = preamp;
                                update_preamp_mode = false;
                            }

                            if (update_preamp)
                            {
                                preamp = RX1PreampMode;				// save current preamp mode
                                update_preamp = false;
                            }
                        }
                    }
                    else // else if(mox)
                    {
                        switch (current_ptt_mode)
                        {
                            case PTTMode.X2:
                                if (!x2_ptt)
                                {
                                    chkMOX.Checked = false;
                                    switch (tx_mode)
                                    {
                                        case DSPMode.LSB:
                                        case DSPMode.USB:
                                        case DSPMode.DSB:
                                        case DSPMode.AM:
                                        case DSPMode.SAM:
                                        case DSPMode.FM:
                                        case DSPMode.DIGL:
                                        case DSPMode.DIGU:
                                            if (chkPhoneVAC.Checked && Audio.VACBypass)
                                                Audio.VACBypass = false;
                                            break;
                                    }
                                }
                                break;
                            case PTTMode.CAT:
                                if (!cat_ptt_local)
                                {
                                    chkMOX.Checked = false;
                                }
                                break;
                            case PTTMode.MIC:
                                if (!mic_ptt)
                                {
                                    chkMOX.Checked = false;
                                    if (chkPhoneVAC.Checked && Audio.VACBypass)
                                        Audio.VACBypass = false;
                                }
                                break;
                            case PTTMode.VOX:
                                if (!vox_ptt)
                                {
                                    vox_timer.Stop();
                                    if (vox_timer.DurationMsec > vox_hang_time)
                                        chkMOX.Checked = false;
                                }
                                else vox_timer.Start();
                                break;
                        }
                    }
                }
                Thread.Sleep(2);
                /*				polltimer.Stop();
                                msecs += polltimer.DurationMsec;
                                if (++pollcount == 1000) 
                                {
                                    msecs *= 0.001;
                                    Debug.WriteLine("timer average = " +msecs.ToString());	
                                    pollcount = 0;
                                }*/
            }
            //			poll_ptt_running = false;
        }

        private void PollFWCPAPWR()
        {
            if (!fwc_init || current_model == Model.SDR1000 || !FWCEEPROM.PAOK) return;
            //int count = 0;
            int high_swr_count = 0;
            int fwd = 0, rev = 0/*, temp, volts*/;
            //float old_temp = 0.0f, old_supply = 0.0f;
            while (chkPower.Checked)
            {
                if (mox)
                {
                    if (!atu_tuning)
                    {
                        switch (current_model)
                        {
                            case Model.FLEX5000:
                                FWC.ReadPAADC(7, out fwd); // FLEX-5000
                                FWC.ReadPAADC(6, out rev); // FLEX-5000
                                break;
                            case Model.FLEX3000:
                                FWC.ReadPAADC(5, out fwd); // FLEX-3000
                                FWC.ReadPAADC(4, out rev); // FLEX-3000
                                break;
                        }
                    }

                    pa_fwd_power = fwd;
                    pa_rev_power = rev;

                    double swr_scale = SWRScale(FWCPAPower(rev) * swr_table[(int)tx_band]);
                    if (swr_scale < Audio.HighSWRScale)
                    {
                        high_swr_count++;
                        if (high_swr_count >= 3)
                        {
                            high_swr_count = 0;
                            HighSWR = true;
                            Audio.HighSWRScale = swr_scale;
                            UpdateDisplay();
                        }
                    }
                    else
                    {
                        high_swr_count = 0;
                        Audio.HighSWRScale = Math.Min(1.0, Audio.HighSWRScale + 0.01);
                        if (Audio.HighSWRScale == 1.0 && HighSWR)
                            HighSWR = false;
                    }

                    /*if(++count%25 == 24) // check temp every ~5s
                    {
                        Thread.Sleep(40);
                        FWC.ReadPAADC(4, out temp);
                        float c = 301-((float)temp/4096*2.5f)*1000/2.2f;
                        if(old_temp == 0.0f) old_temp = c;
                        else old_temp = (c * 0.1f) + (old_temp * 0.9f);
					
                        if(old_temp >= 70)
                        {
                            if(Audio.TempScale != 0.5)
                            {
                                Audio.TempScale = 0.5;
                                Invoke(new MethodInvoker(TempWarn));
                            }
                        }
                        else Audio.TempScale = 1.0;
                        //Debug.WriteLine("old_temp: "+old_temp.ToString("f1"));
                    }

                    if(count%300 == 299) // check voltage every ~60s
                    {
                        Thread.Sleep(40);
                        FWC.ReadPAADC(2, out volts);
                        float new_supply = (float)volts/4096*2.5f*11;
                        if(old_supply == 0.0f) old_supply = new_supply;
                        else old_supply = (0.1f * new_supply) + (0.9f * old_supply);
                        if(old_supply > 15.0 || old_supply < 13.0)
                            Invoke(new MethodInvoker(VoltsWarn));
                    }*/
                }

                Thread.Sleep(100);
            }

            pa_fwd_power = 0;
            pa_rev_power = 0;
            HighSWR = false;
        }

        /*private void TempWarn()
        {
            MessageBox.Show("The drive has been scaled back to 25% due to high temperature warnings",
                "High Temp Warning: Power Cut to 25%",
                MessageBoxButtons.OK,
                MessageBoxIcon.Warning);
        }

        private void VoltsWarn()
        {
            MessageBox.Show("The voltage output is outside of ideal operating range.",
                "Voltage Warning",
                MessageBoxButtons.OK,
                MessageBoxIcon.Warning);
        }*/

        private void PollPAPWR()
        {
            int first_time_count = 0;
            int high_swr_count = 0;

            while (chkPower.Checked && pa_present)
            {
                if (mox)
                {
                    if (!atu_tuning)
                    {
                        first_time_count++;
                        if ((!x2_enabled && first_time_count >= 2) || first_time_count >= x2_delay / 130)
                        {
                            int temp = (int)Hdw.PA_GetADC(0);
                            if (temp >= 0) pa_fwd_power = temp;
                            if (mox)	// in case state changes already
                            {
                                temp = (int)Hdw.PA_GetADC(1);
                                if (temp >= 0) pa_rev_power = temp;
                            }

                            double fwd_power = PAPower(pa_fwd_power);
                            double rev_power = PAPower(pa_rev_power);

                            /*if(rev_power >= 11)
                            {
                                high_swr_count++;
                                if((high_swr_count >= 3 && !chkTUN.Checked) ||
                                    (high_swr_count >= 75 && chkTUN.Checked))
                                {
                                    HighSWR = true;
                                    UpdateDisplay();
                                }
                            }
                            else
                                high_swr_count = 0;							

                            if(high_swr && !disable_swr_protection)
                            {
                                if(Audio.HighSWRScale != 0.1)
                                    Audio.HighSWRScale = 0.1;
                            }*/

                            double swr_scale = SWRScale(rev_power);
                            if (swr_scale < Audio.HighSWRScale)
                            {
                                high_swr_count++;
                                if (high_swr_count >= 3)
                                {
                                    high_swr_count = 0;
                                    HighSWR = true;
                                    Audio.HighSWRScale = swr_scale;
                                    UpdateDisplay();
                                }
                            }
                            else
                            {
                                if (HighSWR)
                                {
                                    high_swr_count = 0;
                                    Audio.HighSWRScale = Math.Min(1.0, Audio.HighSWRScale + 0.01);
                                    if (Audio.HighSWRScale == 1.0)
                                        HighSWR = false;
                                }
                            }

                            //Debug.WriteLine("SWRScale: "+Audio.HighSWRScale.ToString("f3"));
                        }
                    }
                }

                Thread.Sleep(100);
                // roughly 132ms loop
            }

            pa_fwd_power = 0;
            pa_rev_power = 0;
            HighSWR = false;
        }

        private double SWRScale(double ref_pow)
        {
            if (ref_pow < 19) return 1.0;
            else return Math.Max((ref_pow * -0.01774) + 1.137097, 0.25); // mx+b found using 80% at 19, 25% at 50
        }

        private void timer_cpu_meter_Tick(object sender, System.EventArgs e)
        {
            //lblCPUMeter.Text = "CPU %: " +CpuUsage.ToString("f1");
            // txtCPUMeter.Text = "CPU %: " + CpuUsage.ToString("f1");
            if (PowerOn)
                txtCPUMeter.Text = String.Format("CPU%  {0:##0}", cpu_usage.NextValue());
        }

        private void timer_peak_text_Tick(object sender, System.EventArgs e)
        {
            switch (Display.CurrentDisplayMode)
            {
                case DisplayMode.HISTOGRAM:
                case DisplayMode.PANADAPTER:
                case DisplayMode.SPECTRUM:
                case DisplayMode.WATERFALL:
                case DisplayMode.PANAFALL:
                case DisplayMode.PANASCOPE:
                case DisplayMode.SPECTRASCOPE:
                    UpdatePeakText();
                    break;
                default:
                    txtDisplayPeakOffset.Text = "";
                    txtDisplayPeakPower.Text = "";
                    txtDisplayPeakFreq.Text = "";
                    break;
            }
        }

        private int last_sec;		// for time of day clock
        private DateTime last_date;	// for date
        private void timer_clock_Tick(object sender, System.EventArgs e)
        {

            switch (current_datetime_mode)
            {
                case DateTimeMode.LOCAL:
                    DateTime date = DateTime.Now.Date;
                    if (date != last_date || txtDate.Text == "")
                    {
                        last_date = date;
                        txtDate.Text = DateTime.Now.ToShortDateString();
                    }

                    int sec = DateTime.Now.Second;
                    if (sec != last_sec)
                    {
                        last_sec = sec;
                        txtTime.Text = "LOC " + DateTime.Now.ToString("HH:mm:ss");
                    }
                    break;
                case DateTimeMode.UTC:
                    date = DateTime.UtcNow.Date;
                    if (date != last_date || txtDate.Text == "")
                    {
                        last_date = date;
                        txtDate.Text = DateTime.UtcNow.ToShortDateString();
                    }

                    sec = DateTime.UtcNow.Second;
                    if (sec != last_sec)
                    {
                        last_sec = sec;
                        txtTime.Text = "UTC " + DateTime.UtcNow.ToString("HH:mm:ss");
                    }
                    break;
                case DateTimeMode.OFF:
                    txtDate.Text = "";
                    txtTime.Text = "";
                    break;
            }
        }

        private void Tune()
        {
            switch ((ATUTuneMode)comboTuneMode.SelectedIndex)
            {
                case ATUTuneMode.MEMORY:
                    PWR = 15;
                    atu_tuning = true;
                    if (!Hdw.PA_ATUTune(ATUTuneMode.MEMORY))
                        goto atu_error;
                    atu_tuning = false;
                    tuned_band = tx_band;
                    break;
                case ATUTuneMode.FULL:
                    PWR = 15;
                    atu_tuning = true;
                    if (!Hdw.PA_ATUTune(ATUTuneMode.FULL))
                        goto atu_error;
                    atu_tuning = false;
                    tuned_band = tx_band;
                    break;
            }

            chkTUN.Checked = false;
            chkTUN.Enabled = true;
            comboTuneMode.Enabled = true;
            chkTUN.BackColor = button_selected_color;
            return;

        atu_error:
            chkTUN.Checked = false;
            chkTUN.Enabled = true;
            comboTuneMode.Enabled = true;
            MessageBox.Show("Error communicating with the ATU",
                "ATU Error",
                MessageBoxButtons.OK,
                MessageBoxIcon.Error);
        }

        private void DelayedDisplayReset()
        {
            Thread.Sleep((int)((double)block_size1 / (double)sample_rate1 * 1000.0));
            Display.ResetRX1DisplayAverage();
            Display.ResetRX1DisplayPeak();
        }

        private bool tx_cal = false;
        public bool TXCal
        {
            get { return tx_cal; }
            set { tx_cal = value; }
        }

        private int last_3k_fan_on = 0;
        private int last_3k_fan_off = 25;
        private void F3KReadTemp()
        {
            while (chkPower.Checked)
            {
                //if(!mox)
                {
                    int val;
                    FWC.ReadPAADC(3, out val);
                    float volts = (float)val / 4096 * 2.5f;
                    double temp_c = 301 - volts * 1000 / 2.2;

                    if (temp_c < 150.0 && temp_c > -30.0) // filter unreasonable temps
                    {
                        int MAX = 15;
                        int fan_on = MAX;
                        int fan_off = MAX;
                        double speed;

                        if (mox || tx_cal)
                        {
                            speed = (temp_c - 40.0) / (70.0 - 40.0);
                            if (speed > 1.0) speed = 1.0;
                            if (speed < 0.0) speed = 0.0;

                            if (speed < 0.5)
                            {
                                fan_on = (int)(MAX * speed * 2);
                                fan_off = MAX;
                            }
                            else
                            {
                                fan_on = MAX;
                                fan_off = (int)(MAX * (1.0 - speed) * 2);
                            }
                        }
                        else
                        {
                            speed = ((float)temp_c - f3k_temp_thresh) / (100.0 - f3k_temp_thresh);
                            if (speed > 1.0) speed = 1.0;
                            if (speed < 0.0) speed = 0.0;
                            if (speed < 0.5)
                            {
                                fan_on = (int)(MAX * speed * 2);
                                fan_off = MAX;
                            }
                            else
                            {
                                fan_on = MAX;
                                fan_off = (int)(MAX * (1.0 - speed) * 2);
                            }
                        }

                        if (fan_on != last_3k_fan_on || fan_off != last_3k_fan_off)
                        {
                            FWC.SetFanPWM(fan_on, fan_off);
                            Debug.WriteLine("Fan Speed: " + speed.ToString("f2") + "  on: " + fan_on + "  off: " + fan_off);
                            last_3k_fan_on = fan_on;
                            last_3k_fan_off = fan_off;
                        }
                    }

                    /*if(temp_c >= f3k_temp_thresh && !f3k_fan)
                        F3KFan = true;
                    else if(temp_c < f3k_temp_thresh && f3k_fan)
                        F3KFan = false;*/

                }
                Thread.Sleep(2500);
            }
        }

        private void F3KMicFunctions()
        {
            double running_thresh_ms = 600;
            while (chkPower.Checked)
            {
                mic_down_timer.Stop();
                mic_up_timer.Stop();
                mic_fast_timer.Stop();

                if (mic_up)
                {
                    if (!mic_up_running)
                    {
                        if (mic_up_timer.DurationMsec > running_thresh_ms)
                        {
                            mic_down_running = false;
                            mic_up_running = true;
                        }
                    }
                }
                else if (mic_down)
                {
                    if (!mic_down_running)
                    {
                        if (mic_down_timer.DurationMsec > running_thresh_ms)
                        {
                            mic_up_running = false;
                            mic_down_running = true;
                        }
                    }
                }

                if (mic_up_running)
                {
                    double increment = 0.000100;
                    if (mic_fast) increment = 0.000500;
                    VFOAFreq += increment;
                }
                else if (mic_down_running)
                {
                    double decrement = 0.000100;
                    if (mic_fast) decrement = 0.000500;
                    VFOAFreq -= decrement;
                }

                Thread.Sleep(50);
            }
        }

        private enum WBIR_State
        {
            FastAdapt,
            SlowAdapt,
        }
        private bool wbir_tuned = true;
        private void WBIR()
        {
            WBIR_State state = WBIR_State.FastAdapt;
            int fast_count = 0;
            int countdown = 10000;

            while (chkPower.Checked)
            {
                switch (state)
                {
                    case WBIR_State.FastAdapt:
                        if (wbir_tuned)
                        {
                            wbir_tuned = false;
                            fast_count = 0;
                        }
                        DttSP.SetCorrectIQMu(0, 0, 0.05 - (fast_count * 0.005));
                        //Debug.WriteLine(" WBIR Fast, Mu: " + (0.05 - (fast_count * 0.005)).ToString("f6"));
                        fast_count++;
                        if (fast_count == 10)
                        {
                            fast_count = 0;
                            state = WBIR_State.SlowAdapt;
                        }
                        break;
                    case WBIR_State.SlowAdapt:
                        countdown -= 100;
                        //Debug.WriteLine("WBIR Slow, countdown: "+countdown);
                        if (!calibrating && (countdown <= 0 || wbir_tuned))
                        {
                            wbir_tuned = false;
                            countdown = 10000;
                            state = WBIR_State.FastAdapt;
                        }
                        break;
                }

                Thread.Sleep(100);

                /*if(!calibrating && (wbir_tuned || (wbcountdown <= 0)))
                {
                    wbir_tuned = false;
                    double setit=0.1;
					
                    for(int i=0;i<9 && !wbir_tuned;i++)
                    {
                        DttSP.SetCorrectIQMu(0, 0, setit);
                        setit -= 0.01;
                        Thread.Sleep(100);
                        //Debug.WriteLine("WBIR Slower, Mu: "+setit.ToString("f6"));
                    }
                    //Debug.WriteLine("WBIR Slow, Mu: "+setit.ToString("f6"));
                    wbcountdown = 10000;
                } 
                else 
                {
                    Thread.Sleep(100);
                    wbcountdown -= 100;
                }*/
            }
        }

        private bool wbir_rx2_tuned = true;
        private void WBIR_RX2()
        {
            WBIR_State state = WBIR_State.FastAdapt;
            int fast_count = 0;
            int countdown = 10000;

            while (chkPower.Checked)
            {
                switch (state)
                {
                    case WBIR_State.FastAdapt:
                        if (wbir_rx2_tuned)
                        {
                            wbir_rx2_tuned = false;
                            fast_count = 0;
                        }
                        DttSP.SetCorrectIQMu(2, 0, 0.05 - (fast_count * 0.005));
                        //Debug.WriteLine("WBIR2 Fast, Mu: " + (0.05 - (fast_count * 0.005)).ToString("f6"));
                        fast_count++;
                        if (fast_count == 10)
                        {
                            fast_count = 0;
                            state = WBIR_State.SlowAdapt;
                        }
                        break;
                    case WBIR_State.SlowAdapt:
                        countdown -= 100;
                        //Debug.WriteLine("WBIR2 Slow, wbcountdown2: "+countdown);
                        if (!calibrating && (countdown <= 0 || wbir_rx2_tuned))
                        {
                            wbir_rx2_tuned = false;
                            countdown = 10000;
                            state = WBIR_State.FastAdapt;
                        }
                        break;
                }

                Thread.Sleep(100);

                /*if(!calibrating && (wbir_rx2_tuned || (wbcountdown2 <= 0)))
                {
                    wbir_rx2_tuned = false;
                    //Debug.WriteLine("WBIR RX2 Fast");
                    double setit=0.1;
                    for(int i=0;i<9 && !wbir_rx2_tuned;i++)
                    {
                        DttSP.SetCorrectIQMu(2, 0, setit);
                        setit -= 0.01;
                        Thread.Sleep(100);
                        //Debug.WriteLine("WBIR RX2 Slower");
                    }
                    //Debug.WriteLine("WBIR RX2 Slow");
                    wbcountdown2 = 10000;
                } 
                else 				
                {
                    Thread.Sleep(100);
                    wbcountdown2 -= 100;
                }*/
            }
        }

        private void AudioStart()
        {
            Audio.Start();
        }

        private void DigitalWatchdog()
        {
            int limit = (sample_rate1 / Audio.BlockSize) / 60;
            //int count = 0;
            HiPerfTimer t = new HiPerfTimer();
            t.Start();

            while (chkPower.Checked)
            {
                if (Audio.EmptyBuffers > limit) // 1 second dropout
                    // {
                    buffiszero = true;
                else
                    buffiszero = false;

                // Audio.TestMute = false;
                //count++;
                //  Audio.StopAudio1();
                //  if (vac_enabled)
                //    Audio.StopAudioVAC();
                // Thread.Sleep(500);
                // this.Invoke(new MethodInvoker(AudioStart));
                // }
                // Thread.Sleep(3000);
            }
        }


        #endregion

        #region Event Handlers
        // ======================================================
        // Event Handlers
        // ======================================================

        // Console Events

        private void Console_KeyPress(object sender, System.Windows.Forms.KeyPressEventArgs e)
        {
            if (e.KeyChar == (char)Keys.Enter)
                btnHidden.Focus();
        }

        private void Console_KeyUp(object sender, System.Windows.Forms.KeyEventArgs e)
        {
            if (e.Shift == false && shift_down)
                shift_down = false;
        }

        private void Console_KeyDown(object sender, System.Windows.Forms.KeyEventArgs e)
        {
            if (e.Shift == true && !shift_down)
                shift_down = true;

            if (e.Control == true && e.Shift == true)
            {
                switch (e.KeyCode)
                {
                    case Keys.A:
                        if (fwc_init && (current_model == Model.FLEX3000))
                        {
                            if (flex3000ATUForm == null || flex3000ATUForm.IsDisposed)
                                flex3000ATUForm = new FLEX3000ATUForm(this);
                            flex3000ATUForm.Show();
                            flex3000ATUForm.Focus();
                        }
                        break;
                    case Keys.C:
                        if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                        {
                            fwcCalForm = new FWCCalForm(this);
                            fwcCalForm.Show();
                            fwcCalForm.Focus();
                        }
                        break;
                    case Keys.D:
                        if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                        {
                            if (flex5000DebugForm == null || flex5000DebugForm.IsDisposed)
                                flex5000DebugForm = new FLEX5000DebugForm(this);
                            flex5000DebugForm.Show();
                            flex5000DebugForm.Focus();
                        }
                        break;
                    case Keys.F:
                        if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                        {
                            flex5000FinalTestForm = new FLEX5000FinalTestForm(this);
                            flex5000FinalTestForm.Show();
                            flex5000FinalTestForm.Focus();
                        }
                        break;
                    case Keys.I:
                        if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                        {
                            if (fwcTestForm == null || fwcTestForm.IsDisposed)
                                fwcTestForm = new FWCTestForm(this);
                            fwcTestForm.Show();
                            fwcTestForm.Focus();
                        }
                        break;
                    case Keys.O:
                        //mnuRelays.Visible = true;
                        break;
                    case Keys.P:
                        switch (current_model)
                        {
                            case Model.FLEX5000:
                            case Model.FLEX3000:
                                if (fwc_init)
                                {
                                    flex5000ProdTestForm = new FLEX5000ProdTestForm(this);
                                    flex5000ProdTestForm.Show();
                                    flex5000ProdTestForm.Focus();
                                }
                                break;
                        }
                        break;
                    case Keys.R:
                        if (fwc_init && current_model == Model.FLEX5000 && FWCEEPROM.RX2OK)
                        {
                            if (flex5000RX2CalForm == null || flex5000RX2CalForm.IsDisposed)
                                flex5000RX2CalForm = new FLEX5000RX2CalForm(this);
                            flex5000RX2CalForm.Show();
                            flex5000RX2CalForm.Focus();
                        }
                        break;
                    case Keys.S:
                        if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                        {
                            if (preSelForm == null || preSelForm.IsDisposed)
                                preSelForm = new PreSelForm(this);
                            preSelForm.Show();
                            preSelForm.Focus();
                        }
                        break;
                    case Keys.T:
                        if (pa_present && current_model == Model.SDR1000)
                        {
                            if (PAQualForm == null || PAQualForm.IsDisposed)
                                PAQualForm = new PAQualify(this);
                            PAQualForm.Show();
                            PAQualForm.Focus();
                        }
                        break;
                    /*  case Keys.V:
                          if (fwc_init && current_model == Model.FLEX5000 && FWCEEPROM.VUOK)
                          {
                              if (flex5000VUCalForm == null || flex5000VUCalForm.IsDisposed)
                                  flex5000VUCalForm = new FLEX5000VUCalForm(this);
                              flex5000VUCalForm.Show();
                              flex5000VUCalForm.Focus();
                          }
                          break;*/
                }
                shift_down = false;
            }
            else if (e.Control == true && e.Alt == true)
            {
                switch (e.KeyCode)
                {
                    case Keys.D4:
                        if (fwc_init && current_model == Model.FLEX5000)
                        {
                            if (flex5000LPFForm == null || flex5000LPFForm.IsDisposed)
                                flex5000LPFForm = new FLEX5000LPFForm();
                            flex5000LPFForm.Show();
                            flex5000LPFForm.Focus();
                        }
                        break;
                    case Keys.D:
                        if (dspTestForm == null || dspTestForm.IsDisposed)
                            dspTestForm = new DSPTestForm(this);
                        dspTestForm.Show();
                        dspTestForm.Focus();
                        break;
                    /*  case Keys.G:
                          CallCal1500TXImageComb();
                          break;*/
                    case Keys.R:
                        if (FWCEEPROM.RX2OK)
                        {
                            DiversityForm diversityForm = new DiversityForm(this);
                            diversityForm.Focus();
                            diversityForm.Show();
                        }
                        break;
                    case Keys.U:
                        mnuUCB_Click(this, EventArgs.Empty);
                        break;
                    case Keys.F:
                        chkFullDuplex.Visible = true;
                        break;
                }
            }
            else if (!enable_kb_shortcuts)
            {
                return;
            }
            else if (e.Control && !e.Alt)		// control key is pressed
            {
                switch (e.KeyCode)
                {
                    case Keys.Add:
                        if (ptbRF.Value != ptbRF.Maximum)
                        {
                            ptbRF.Value++;
                            ptbRF_Scroll(this, EventArgs.Empty);
                        }
                        break;
                    case Keys.Subtract:
                        if (ptbRF.Value != ptbRF.Minimum)
                        {
                            ptbRF.Value--;
                            ptbRF_Scroll(this, EventArgs.Empty);
                        }
                        break;
                    case Keys.Left:
                        ChangeTuneStepUp();
                        e.Handled = true;
                        break;
                    case Keys.Right:
                        ChangeTuneStepDown();
                        e.Handled = true;
                        break;
                    case Keys.Up:
                        Console_MouseWheel(this, new MouseEventArgs(MouseButtons.None, 0, 0, 0, 120));
                        e.Handled = true;
                        break;
                    case Keys.Down:
                        Console_MouseWheel(this, new MouseEventArgs(MouseButtons.None, 0, 0, 0, -120));
                        e.Handled = true;
                        break;
                    case Keys.A:
                        if (RX1AGCMode == AGCMode.FAST)
                            RX1AGCMode = AGCMode.FIXD;
                        else RX1AGCMode++;
                        break;
                    case Keys.B:
                        chkNR.Checked = !chkNR.Checked;
                        break;
                    case Keys.C:
                        btnMemoryQuickSave_Click(this, EventArgs.Empty);
                        break;
                    case Keys.D:
                        switch (Display.CurrentDisplayMode)
                        {
                            case DisplayMode.PANADAPTER:
                                comboDisplayMode.Text = "Spectrum";
                                break;
                            case DisplayMode.SPECTRUM:
                                comboDisplayMode.Text = "Panadapter";
                                break;
                            default:
                                comboDisplayMode.Text = "Panadapter";
                                break;
                        }
                        break;
                    case Keys.E:
                        if (ptbRF.Value != ptbRF.Minimum)
                        {
                            ptbRF.Value--;
                            ptbRF_Scroll(this, EventArgs.Empty);
                        }
                        break;
                    case Keys.F:
                        int low = (int)udFilterLow.Value;
                        int high = (int)udFilterHigh.Value;
                        if (high - low > 10)
                        {
                            switch (rx1_dsp_mode)
                            {
                                case DSPMode.AM:
                                case DSPMode.SAM:
                                case DSPMode.DSB:
                                case DSPMode.FM:
                                case DSPMode.CWU:
                                case DSPMode.CWL:
                                    UpdateRX1Filters(low + 5, high - 5);
                                    break;
                                case DSPMode.USB:
                                case DSPMode.DIGU:
                                    UpdateRX1Filters(low, high - 10);
                                    break;
                                case DSPMode.LSB:
                                case DSPMode.DIGL:
                                    UpdateRX1Filters(low + 10, high);
                                    break;
                            }
                        }
                        break;
                    case Keys.L:
                        if (chkVFOLock.Enabled)
                            chkVFOLock.Checked = !chkVFOLock.Checked;
                        break;
                    case Keys.M:
                        if (chkMOX.Enabled)
                            chkMOX.Checked = !mox;
                        break;
                    case Keys.N:
                        chkANF.Checked = !chkANF.Checked;
                        break;
                    case Keys.P:
                        RX1PreampMode = (PreampMode)(((int)rx1_preamp_mode + 1) % (int)PreampMode.LAST);
                        break;
                    case Keys.R:
                        if (ptbRF.Value != ptbRF.Maximum)
                        {
                            ptbRF.Value++;
                            ptbRF_Scroll(this, EventArgs.Empty);
                        }
                        break;
                    case Keys.S:
                        if (chkVFOSplit.Enabled)
                            chkVFOSplit.Checked = !chkVFOSplit.Checked;
                        break;
                    case Keys.V:
                        btnMemoryQuickRestore_Click(this, EventArgs.Empty);
                        break;
                    case Keys.W:
                        if (ptbCWSpeed.Value != ptbCWSpeed.Minimum)
                        {
                            ptbCWSpeed.Value--;
                            ptbCWSpeed_Scroll(this, EventArgs.Empty);
                        }
                        break;
                }
            }
            else if (e.Alt && !e.Control)
            {
                switch (e.KeyCode)
                {
                    case Keys.B:
                        chkNB.Checked = !chkNB.Checked;
                        break;
                    case Keys.D:
                        chkEnableMultiRX.Checked = !chkEnableMultiRX.Checked;
                        break;
                    case Keys.F:
                        int low = (int)udFilterLow.Value;
                        int high = (int)udFilterHigh.Value;
                        switch (rx1_dsp_mode)
                        {
                            case DSPMode.AM:
                            case DSPMode.SAM:
                            case DSPMode.DSB:
                            case DSPMode.FM:
                            case DSPMode.CWU:
                            case DSPMode.CWL:
                                UpdateRX1Filters(low - 5, high + 5);
                                break;
                            case DSPMode.USB:
                            case DSPMode.DIGU:
                                UpdateRX1Filters(low, high + 10);
                                break;
                            case DSPMode.LSB:
                            case DSPMode.DIGL:
                                UpdateRX1Filters(low - 10, high);
                                break;
                        }
                        break;
                    case Keys.G:
                        btnVFOAtoB_Click(this, EventArgs.Empty);
                        break;
                    case Keys.H:
                        btnVFOBtoA_Click(this, EventArgs.Empty);
                        break;
                    case Keys.I:
                        btnFilterShiftReset_Click(this, EventArgs.Empty);
                        break;
                    case Keys.N:
                        chkDSPNB2.Checked = !chkDSPNB2.Checked;
                        break;
                    case Keys.Q:
                        if (ptbCWSpeed.Value != ptbCWSpeed.Maximum)
                        {
                            ptbCWSpeed.Value++;
                            ptbCWSpeed_Scroll(this, EventArgs.Empty);
                        }
                        break;
                    case Keys.R:
                        btnRITReset_Click(this, EventArgs.Empty);
                        break;
                    case Keys.T:
                        chkTUN.Checked = !chkTUN.Checked;
                        break;
                    case Keys.V:
                        btnVFOSwap_Click(this, EventArgs.Empty);
                        break;
                    case Keys.Y:
                        btnXITReset_Click(this, EventArgs.Empty);
                        break;
                    case Keys.Z:
                        if (btnZeroBeat.Enabled)
                            btnZeroBeat_Click(this, EventArgs.Empty);
                        break;
                }
            }
            else if (!e.Alt && !e.Control)
            {
                if (this.ActiveControl is TextBoxTS) return;
                if (this.ActiveControl is NumericUpDownTS) return;

                switch (e.KeyCode)
                {
                    case Keys.Space:
                        {
                            if (PowerOn)
                            {
                                if (spacebar_ptt)
                                {
                                    chkMOX.Checked = !chkMOX.Checked;
                                    e.Handled = true;
                                }
                                else if (spacebar_vox)
                                {
                                    chkVOX.Checked = !chkVOX.Checked;
                                    e.Handled = true;
                                }
                                else if (spacebar_mic_mute)
                                {
                                    chkMicMute.Checked = !chkMicMute.Checked;
                                    e.Handled = true;
                                }
                                else if (spacebar_last_btn)
                                {
                                    break;
                                }
                            }
                            else
                            {
                                if (!PowerOn)
                                {
                                    if (spacebar_last_btn)
                                    {
                                        break;
                                    }
                                    else e.Handled = true;
                                }
                            }
                        }
                        break;
                    case Keys.Multiply:
                        chkMUT.Checked = !chkMUT.Checked;
                        break;
                    case Keys.Add:
                        if (ptbAF.Value != ptbAF.Maximum)
                        {
                            ptbAF.Value++;
                            ptbAF_Scroll(this, EventArgs.Empty);
                        }
                        break;
                    case Keys.Subtract:
                        if (ptbAF.Value != ptbAF.Minimum)
                        {
                            ptbAF.Value--;
                            ptbAF_Scroll(this, EventArgs.Empty);
                        }
                        break;
                    case Keys.K:
                        int low = (int)udFilterLow.Value;
                        int high = (int)udFilterHigh.Value;
                        int increment = 0;
                        switch (rx1_dsp_mode)
                        {
                            case DSPMode.CWL:
                            case DSPMode.CWU:
                            case DSPMode.DIGL:
                            case DSPMode.DIGU:
                                increment = 10;
                                break;
                            default:
                                increment = 50;
                                break;
                        }
                        UpdateRX1Filters(low - increment, high - increment);
                        /*if(tbFilterShift.Value != tbFilterShift.Minimum)
                                tbFilterShift.Value--;
                            tbFilterShift_Scroll(this, EventArgs.Empty);*/
                        break;
                    case Keys.L:
                        low = (int)udFilterLow.Value;
                        high = (int)udFilterHigh.Value;
                        increment = 0;
                        switch (rx1_dsp_mode)
                        {
                            case DSPMode.CWL:
                            case DSPMode.CWU:
                            case DSPMode.DIGL:
                            case DSPMode.DIGU:
                                increment = 10;
                                break;
                            default:
                                increment = 50;
                                break;
                        }
                        UpdateRX1Filters(low + increment, high + increment);
                        /*if(tbFilterShift.Value != tbFilterShift.Maximum)
                                tbFilterShift.Value++;
                            tbFilterShift_Scroll(this, EventArgs.Empty);*/
                        break;
                }

                if (e.KeyCode == key_tune_up_1)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq += 1.0;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_down_1)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq -= 1.0;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_up_2)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq += 0.1;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_down_2)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq -= 0.1;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_up_3)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq += 0.01;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_down_3)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq -= 0.01;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_up_4)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq += 0.001;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_down_4)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq -= 0.001;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_up_5)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq += 0.0001;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_down_5)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq -= 0.0001;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_up_6)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq += 0.00001;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_down_6)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq -= 0.00001;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_up_7)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq += 0.000001;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_tune_down_7)
                {
                    double freq = Double.Parse(txtVFOAFreq.Text);
                    freq -= 0.000001;
                    VFOAFreq = freq;
                }
                else if (e.KeyCode == key_rit_up)
                {
                    udRIT.Value += udRIT.Increment;
                }
                else if (e.KeyCode == key_rit_down)
                {
                    udRIT.Value -= udRIT.Increment;
                }
                else if (e.KeyCode == key_xit_up)
                {
                    udXIT.Value += udXIT.Increment;
                }
                else if (e.KeyCode == key_xit_down)
                {
                    udXIT.Value -= udXIT.Increment;
                }
                else if (e.KeyCode == key_filter_up)
                {
                    if (rx1_filter == Filter.NONE)
                        return;
                    if (rx1_filter == Filter.VAR2)
                        RX1Filter = Filter.F1;
                    else
                        RX1Filter++;
                }
                else if (e.KeyCode == key_filter_down)
                {
                    if (rx1_filter == Filter.NONE)
                        return;
                    if (rx1_filter == Filter.F1)
                        RX1Filter = Filter.VAR2;
                    else
                        RX1Filter--;
                }
                else if (e.KeyCode == key_mode_up)
                {
                    switch (rx1_dsp_mode)
                    {
                        case DSPMode.LSB:
                            RX1DSPMode = DSPMode.USB;
                            break;
                        case DSPMode.USB:
                            RX1DSPMode = DSPMode.DSB;
                            break;
                        case DSPMode.DSB:
                            RX1DSPMode = DSPMode.CWL;
                            break;
                        case DSPMode.CWL:
                            RX1DSPMode = DSPMode.CWU;
                            break;
                        case DSPMode.CWU:
                            RX1DSPMode = DSPMode.FM;
                            break;
                        case DSPMode.FM:
                            RX1DSPMode = DSPMode.AM;
                            break;
                        case DSPMode.AM:
                            RX1DSPMode = DSPMode.SAM;
                            break;
                        case DSPMode.SAM:
                            RX1DSPMode = DSPMode.DIGL;
                            break;
                        case DSPMode.DIGL:
                            RX1DSPMode = DSPMode.DIGU;
                            break;
                        case DSPMode.DIGU:
                            RX1DSPMode = DSPMode.SPEC;
                            break;
                        case DSPMode.SPEC:
                            RX1DSPMode = DSPMode.DRM;
                            break;
                        case DSPMode.DRM:
                            RX1DSPMode = DSPMode.LSB;
                            break;
                    }
                }
                else if (e.KeyCode == key_mode_down)
                {
                    switch (rx1_dsp_mode)
                    {
                        case DSPMode.LSB:
                            RX1DSPMode = DSPMode.DRM;
                            break;
                        case DSPMode.USB:
                            RX1DSPMode = DSPMode.LSB;
                            break;
                        case DSPMode.DSB:
                            RX1DSPMode = DSPMode.USB;
                            break;
                        case DSPMode.CWL:
                            RX1DSPMode = DSPMode.DSB;
                            break;
                        case DSPMode.CWU:
                            RX1DSPMode = DSPMode.CWL;
                            break;
                        case DSPMode.FM:
                            RX1DSPMode = DSPMode.CWU;
                            break;
                        case DSPMode.AM:
                            RX1DSPMode = DSPMode.FM;
                            break;
                        case DSPMode.SAM:
                            RX1DSPMode = DSPMode.AM;
                            break;
                        case DSPMode.DIGL:
                            RX1DSPMode = DSPMode.SAM;
                            break;
                        case DSPMode.DIGU:
                            RX1DSPMode = DSPMode.DIGL;
                            break;
                        case DSPMode.SPEC:
                            RX1DSPMode = DSPMode.DIGU;
                            break;
                        case DSPMode.DRM:
                            RX1DSPMode = DSPMode.SPEC;
                            break;
                    }
                }
                else if (e.KeyCode == key_band_up && !vfo_lock)
                {
                    switch (rx1_band)
                    {
                        case Band.B160M:
                            if (band_160m_index == 2)
                            {
                                band_80m_index = 0;
                                radBand80_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBand160_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B80M:
                            if (band_80m_index == 2)
                            {
                                band_60m_index = 0;
                                radBand60_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBand80_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B60M:
                            if (band_60m_index == 4)
                            {
                                band_40m_index = 0;
                                radBand40_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBand60_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B40M:
                            if (band_40m_index == 2)
                            {
                                band_30m_index = 0;
                                radBand30_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBand40_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B30M:
                            if (band_30m_index == 2)
                            {
                                band_20m_index = 0;
                                radBand20_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBand30_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B20M:
                            if (band_20m_index == 2)
                            {
                                band_17m_index = 0;
                                radBand17_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBand20_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B17M:
                            if (band_17m_index == 2)
                            {
                                band_15m_index = 0;
                                radBand15_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBand17_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B15M:
                            if (band_15m_index == 2)
                            {
                                band_12m_index = 0;
                                radBand12_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBand15_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B12M:
                            if (band_12m_index == 2)
                            {
                                band_10m_index = 0;
                                radBand10_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBand12_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B10M:
                            if (band_10m_index == 2)
                            {
                                band_6m_index = 0;
                                radBand6_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBand10_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B6M:
                            if (band_6m_index == 2)
                            {
                                if (XVTRPresent)
                                {
                                    band_2m_index = 0;
                                    radBand2_Click(this, EventArgs.Empty);
                                }
                                else
                                {
                                    band_wwv_index = 0;
                                    radBandWWV_Click(this, EventArgs.Empty);
                                }
                            }
                            else
                            {
                                radBand6_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B2M:
                            if (band_2m_index == 2)
                            {
                                band_wwv_index = 0;
                                radBandWWV_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBand2_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.WWV:
                            if (band_wwv_index == 4)
                            {
                                band_gen_index = 0;
                                radBandGEN_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBandWWV_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.GEN:
                            if (band_gen_index == 4)
                            {
                                band_160m_index = 0;
                                radBand160_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                radBandGEN_Click(this, EventArgs.Empty);
                            }
                            break;
                    }
                }
                else if (e.KeyCode == key_band_down && !vfo_lock)
                {
                    switch (rx1_band)
                    {
                        case Band.B160M:
                            if (band_160m_index == 0)
                            {
                                band_gen_index = 4;
                                radBandGEN_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "160M";
                                band_160m_index = (band_160m_index + 1) % 3;
                                radBand160_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B80M:
                            if (band_80m_index == 0)
                            {
                                band_160m_index = 2;
                                radBand160_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "80M";
                                band_80m_index = (band_80m_index + 1) % 3;
                                radBand80_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B60M:
                            if (band_60m_index == 0)
                            {
                                band_80m_index = 2;
                                radBand80_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "60M";
                                band_60m_index = (band_60m_index + 3) % 5;
                                radBand60_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B40M:
                            if (band_40m_index == 0)
                            {
                                band_60m_index = 4;
                                radBand60_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "40M";
                                band_40m_index = (band_40m_index + 1) % 3;
                                radBand40_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B30M:
                            if (band_30m_index == 0)
                            {
                                band_40m_index = 2;
                                radBand40_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "30M";
                                band_30m_index = (band_30m_index + 1) % 3;
                                radBand30_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B20M:
                            if (band_20m_index == 0)
                            {
                                band_30m_index = 2;
                                radBand30_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "20M";
                                band_20m_index = (band_20m_index + 1) % 3;
                                radBand20_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B17M:
                            if (band_17m_index == 0)
                            {
                                band_20m_index = 2;
                                radBand20_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "17M";
                                band_17m_index = (band_17m_index + 1) % 3;
                                radBand17_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B15M:
                            if (band_15m_index == 0)
                            {
                                band_17m_index = 2;
                                radBand17_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "15M";
                                band_15m_index = (band_15m_index + 1) % 3;
                                radBand15_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B12M:
                            if (band_12m_index == 0)
                            {
                                band_15m_index = 2;
                                radBand15_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "12M";
                                band_12m_index = (band_12m_index + 1) % 3;
                                radBand12_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B10M:
                            if (band_10m_index == 0)
                            {
                                band_12m_index = 2;
                                radBand12_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "10M";
                                band_10m_index = (band_10m_index + 1) % 3;
                                radBand10_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B6M:
                            if (band_6m_index == 0)
                            {
                                band_10m_index = 2;
                                radBand10_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "6M";
                                band_6m_index = (band_6m_index + 1) % 3;
                                radBand6_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.B2M:
                            if (band_2m_index == 0)
                            {
                                band_6m_index = 2;
                                radBand6_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "2M";
                                band_2m_index = (band_2m_index + 1) % 3;
                                radBand6_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.WWV:
                            if (band_wwv_index == 0)
                            {
                                if (xvtr_present)
                                {
                                    band_2m_index = 2;
                                    radBand2_Click(this, EventArgs.Empty);
                                }
                                else
                                {
                                    band_6m_index = 2;
                                    radBand6_Click(this, EventArgs.Empty);
                                }
                            }
                            else
                            {
                                last_band = "WWV";
                                band_wwv_index = (band_wwv_index + 3) % 5;
                                radBandWWV_Click(this, EventArgs.Empty);
                            }
                            break;
                        case Band.GEN:
                            if (band_gen_index == 0)
                            {
                                band_wwv_index = 4;
                                radBandWWV_Click(this, EventArgs.Empty);
                            }
                            else
                            {
                                last_band = "GEN";
                                band_gen_index = (band_gen_index + 3) % 5;
                                radBandGEN_Click(this, EventArgs.Empty);
                            }
                            break;
                    }

                }
                else if (e.KeyCode == key_cw_dot)
                {

                }
                else if (e.KeyCode == key_cw_dash)
                {

                }
                else if (vfo_lock || !quick_qsy)
                {
                    return;
                }
                else if ((int)e.KeyCode >= 48 && (int)e.KeyCode <= 57)
                {
                    if (small_lsd)
                    {
                        txtVFOAMSD.Visible = false;
                        txtVFOALSD.Visible = false;
                    }
                    txtVFOAFreq.Focus();
                    txtVFOAFreq.Text = ((int)(e.KeyCode - 48)).ToString();
                    txtVFOAFreq.Select(1, 0);
                }
                else if ((int)e.KeyCode >= 96 && (int)e.KeyCode <= 105)
                {
                    if (small_lsd)
                    {
                        txtVFOAMSD.Visible = false;
                        txtVFOALSD.Visible = false;
                    }
                    txtVFOAFreq.Focus();
                    txtVFOAFreq.Text = ((int)e.KeyCode - 96).ToString();
                    txtVFOAFreq.Select(1, 0);
                }
                else if (e.KeyCode.Equals(Keys.Decimal) ||
                    (separator == "." && e.KeyCode.Equals(Keys.OemPeriod)) ||
                    (separator == "," && e.KeyCode.Equals(Keys.Oemcomma)))
                {
                    if (small_lsd)
                    {
                        txtVFOAMSD.Visible = false;
                        txtVFOALSD.Visible = false;
                    }
                    txtVFOAFreq.Focus();
                    txtVFOAFreq.Text = separator;
                    txtVFOAFreq.Select(1, 0);
                }
            }
        }

        // chkPower
        private void chkPower_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkPower.Checked)
            {
                //chkPower.Text = "Stop";
                chkPower.BackColor = button_selected_color;
                txtVFOAFreq.ForeColor = vfo_text_light_color;
                txtVFOAMSD.ForeColor = vfo_text_light_color;
                txtVFOALSD.ForeColor = small_vfo_color;
                UpdateVFOASub();

                if (rx2_enabled) chkRX2_CheckedChanged(this, EventArgs.Empty);
                if (chkEnableMultiRX.Checked) chkEnableMultiRX_CheckedChanged(this, EventArgs.Empty);
                if (chkVFOSplit.Checked) chkVFOSplit_CheckedChanged(this, EventArgs.Empty);

                Hdw.DDSTuningWord = 0;
                fwc_dds_freq = 0.0f;
                rx2_dds_freq = 0.0f;
                /*   switch (current_model)
                {
                    case Model.FLEX3000:
                        if (fwc_init) FWC.SetStandby(false);
                        fwc_dds_freq = 0.0f;
                        last_tw = 0;
                        break;
                    case Model.FLEX5000:
                        if (fwc_init) FWC.SetStandby(false);
                        fwc_dds_freq = 0.0f;
                        last_tw = 0;
                        rx2_dds_freq = 0.0f;
                        rx2_last_tw = 0;
                        RX1Ant = rx1_ant;
                        break;
                    default:
                        Hdw.PowerOn();
                        Hdw.DDSTuningWord = 0;
                        break;
                }*/

                if (fwc_init && (current_model == Model.FLEX3000 || current_model == Model.FLEX5000))
                {
                    try
                    {
                        Pal.SetBufferSize((uint)block_size1);
                    }
                    catch (Exception)
                    {
                        // ignore exceptions in case version of PAL dll doesn't support this function
                    }
                }

                txtVFOAFreq_LostFocus(this, EventArgs.Empty);

                // wjt added 
                if (PTTBitBangEnabled && serialPTT == null) // we are enabled but don't have port object 
                {
                    //Debug.WriteLine("Forcing property set on PTTBitBangEnabled"); 
                    PTTBitBangEnabled = true; // force creation of serial ptt 
                }
                // wjt added ends 
                SetupForm.AudioReceiveMux1 = SetupForm.AudioReceiveMux1;		// set receive mux

                Audio.CurrentAudioState1 = Audio.AudioState.DTTSP;
                Audio.callback_return = 0;

                if (vac_enabled)
                {
                    Audio.VACRBReset = true;
                    Audio.VACEnabled = true;
                }

                Thread.Sleep(100); // wait for hardware to settle before starting audio (possible sample rate change)

                if (!Audio.Start())
                {
                    chkPower.Checked = false;
                    return;
                }

                if (draw_display_thread == null || !draw_display_thread.IsAlive)
                {
                    draw_display_thread = new Thread(new ThreadStart(RunDisplay));
                    draw_display_thread.Name = "Draw Display Thread";
                    draw_display_thread.Priority = ThreadPriority.BelowNormal;
                    draw_display_thread.IsBackground = true;
                    draw_display_thread.Start();
                }

                if (multimeter_thread == null || !multimeter_thread.IsAlive)
                {
                    multimeter_thread = new Thread(new ThreadStart(UpdateMultimeter));
                    multimeter_thread.Name = "Multimeter Thread";
                    multimeter_thread.Priority = ThreadPriority.Lowest;
                    multimeter_thread.IsBackground = true;
                    multimeter_thread.Start();
                }

                if (fwc_init && current_model == Model.FLEX5000 && rx2_enabled)
                {
                    if (rx2_meter_thread == null || !rx2_meter_thread.IsAlive)
                    {
                        rx2_meter_thread = new Thread(new ThreadStart(UpdateRX2MeterData));
                        rx2_meter_thread.Name = "RX2 Meter Thread";
                        rx2_meter_thread.Priority = ThreadPriority.Lowest;
                        rx2_meter_thread.IsBackground = true;
                        rx2_meter_thread.Start();
                    }

                    if (rx2_sql_update_thread == null || !rx2_sql_update_thread.IsAlive)
                    {
                        rx2_sql_update_thread = new Thread(new ThreadStart(UpdateRX2SQL));
                        rx2_sql_update_thread.Name = "Update RX2 SQL";
                        rx2_sql_update_thread.Priority = ThreadPriority.Normal;
                        rx2_sql_update_thread.IsBackground = true;
                        rx2_sql_update_thread.Start();
                    }
                }

                if (sql_update_thread == null || !sql_update_thread.IsAlive)
                {
                    sql_update_thread = new Thread(new ThreadStart(UpdateSQL));
                    sql_update_thread.Name = "Update SQL";
                    sql_update_thread.Priority = ThreadPriority.Normal;
                    sql_update_thread.IsBackground = true;
                    sql_update_thread.Start();
                }

                if (noise_gate_update_thread == null || !noise_gate_update_thread.IsAlive)
                {
                    noise_gate_update_thread = new Thread(new ThreadStart(UpdateNoiseGate));
                    noise_gate_update_thread.Name = "Update NoiseGate";
                    noise_gate_update_thread.Priority = ThreadPriority.Normal;
                    noise_gate_update_thread.IsBackground = true;
                    noise_gate_update_thread.Start();
                }

                if (vox_update_thread == null || !vox_update_thread.IsAlive)
                {
                    vox_update_thread = new Thread(new ThreadStart(UpdateVOX));
                    vox_update_thread.Name = "Update VOX";
                    vox_update_thread.Priority = ThreadPriority.Normal;
                    vox_update_thread.IsBackground = true;
                    vox_update_thread.Start();
                }

                if (poll_ptt_thread == null || !poll_ptt_thread.IsAlive)
                {
                    poll_ptt_thread = new Thread(new ThreadStart(PollPTT));
                    poll_ptt_thread.Name = "Poll PTT Thread";
                    poll_ptt_thread.Priority = ThreadPriority.Normal;
                    poll_ptt_thread.IsBackground = true;
                    poll_ptt_thread.Start();
                }

                if (fwc_init && current_model == Model.FLEX3000)
                {
                    if (FWCEEPROM.PAOK)
                    {
                        if (f3k_temp_thread == null || !f3k_temp_thread.IsAlive)
                        {
                            f3k_temp_thread = new Thread(new ThreadStart(F3KReadTemp));
                            f3k_temp_thread.Name = "F3K Temp Thread";
                            f3k_temp_thread.Priority = ThreadPriority.Lowest;
                            f3k_temp_thread.IsBackground = true;
                            f3k_temp_thread.Start();
                        }
                    }

                    if (f3k_mic_function_thread == null || !f3k_mic_function_thread.IsAlive)
                    {
                        f3k_mic_function_thread = new Thread(new ThreadStart(F3KMicFunctions));
                        f3k_mic_function_thread.Name = "F3K Mic Feature Thread";
                        f3k_mic_function_thread.Priority = ThreadPriority.Normal;
                        f3k_mic_function_thread.IsBackground = true;
                        f3k_mic_function_thread.Start();
                    }
                }

                switch (current_model)
                {
                    case Model.FLEX5000:
                    case Model.FLEX3000:
                        if (poll_pa_pwr_thread == null || !poll_pa_pwr_thread.IsAlive)
                        {
                            poll_pa_pwr_thread = new Thread(new ThreadStart(PollFWCPAPWR));
                            poll_pa_pwr_thread.Name = "Poll FWC PA PWR Thread";
                            poll_pa_pwr_thread.Priority = ThreadPriority.BelowNormal;
                            poll_pa_pwr_thread.IsBackground = true;
                            poll_pa_pwr_thread.Start();
                        }
                        break;
                    default:
                        if (pa_present)
                        {
                            if (poll_pa_pwr_thread == null || !poll_pa_pwr_thread.IsAlive)
                            {
                                poll_pa_pwr_thread = new Thread(new ThreadStart(PollPAPWR));
                                poll_pa_pwr_thread.Name = "Poll PA PWR Thread";
                                poll_pa_pwr_thread.Priority = ThreadPriority.BelowNormal;
                                poll_pa_pwr_thread.IsBackground = true;
                                poll_pa_pwr_thread.Start();
                            }
                        }
                        break;
                }

                /* wbir_thread = new Thread(new ThreadStart(WBIR));
                 wbir_thread.Name = "WBIR Thread";
                 wbir_thread.Priority = ThreadPriority.Normal;
                 wbir_thread.IsBackground = true;
                 wbir_thread.Start();

                 if (current_model == Model.FLEX5000 && FWCEEPROM.RX2OK)
                 {
                     wbir_rx2_thread = new Thread(new ThreadStart(WBIR_RX2));
                     wbir_rx2_thread.Name = "WBIR RX2 Thread";
                     wbir_rx2_thread.Priority = ThreadPriority.Normal;
                     wbir_rx2_thread.IsBackground = true;
                     wbir_rx2_thread.Start();
                 }*/

                /*      update_rx1_dds_thread = new Thread(new ThreadStart(UpdateRX1DDSFreq));
                      update_rx1_dds_thread.Name = "RX1 DDS Thread";
                      update_rx1_dds_thread.Priority = ThreadPriority.Normal;
                      update_rx1_dds_thread.IsBackground = true;
                      update_rx1_dds_thread.Start();

                      update_tx_dds_thread = new Thread(new ThreadStart(UpdateTXDDSFreq));
                      update_tx_dds_thread.Name = "TX DDS Thread";
                      update_tx_dds_thread.Priority = ThreadPriority.Normal;
                      update_tx_dds_thread.IsBackground = true;
                      update_tx_dds_thread.Start();

                      if (current_model == Model.FLEX5000 && FWCEEPROM.RX2OK)
                      {
                          update_rx2_dds_thread = new Thread(new ThreadStart(UpdateRX2DDSFreq));
                          update_rx2_dds_thread.Name = "RX2 DDS Thread";
                          update_rx2_dds_thread.Priority = ThreadPriority.Normal;
                          update_rx2_dds_thread.IsBackground = true;
                          update_rx2_dds_thread.Start();
                      }
                      */
                if (!rx_only)
                {
                    chkMOX.Enabled = true;
                    chkTUN.Enabled = true;
                }
                chkVFOLock.Enabled = true;

                timer_peak_text.Enabled = true;

                if (current_model == Model.SDR1000 && atu_present)
                {
                    int counter = 0;
                    while (((Hdw.StatusPort() & (byte)StatusPin.PA_DATA)) == 0)
                    {
                        Thread.Sleep(50);
                        if (counter++ > 100)		// 5 second time out
                        {
                            MessageBox.Show("ATU Initialization Timeout.\n" +
                                "Please check power to radio",
                                "ATU Init Error",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Hand);
                            chkPower.Checked = false;
                            return;
                        }
                    }
                    Hdw.PA_ATUTune(ATUTuneMode.BYPASS);
                }

                /*    if (rx1_dsp_mode == DSPMode.CWL ||
                    rx1_dsp_mode == DSPMode.CWU)
                {
                    DttSP.StartKeyer();
                    } */

                if (si570_used && current_model == Model.SOFTROCK40) // modif F8CHK
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);

                CWKeyer.Reset();
                CWPTT.Start();


                /*if(fwc_init && current_model == Model.FLEX5000 &&
                    FWCEEPROM.RX2OK && rx2_trx_match_serial == 0)
                    FLEX5000DetectTapResistor();*/

                if (SetupForm.radLineIn.Checked)
                {
                    SetupForm.radMicIn.Checked = true;
                    Thread.Sleep(100);
                    SetupForm.radLineIn.Checked = true;
                }

                if (SetupForm.radMicIn.Checked)
                {
                    SetupForm.radLineIn.Checked = true;
                    Thread.Sleep(100);
                    SetupForm.radMicIn.Checked = true;
                }
            }
            else
            {
                //chkPower.Text = "Start";

                chkMOX.Checked = false;
                chkMOX.Enabled = false;
                chkTUN.Checked = false;
                chkTUN.Enabled = false;

                //  if (rx1_dsp_mode == DSPMode.CWL ||
                //     rx1_dsp_mode == DSPMode.CWU)
                //  {
                //     DttSP.StopKeyer();
                //  }

                // wjt added 
                if (serialPTT != null)  // let go of serial port
                {
                    serialPTT.Destroy();
                    serialPTT = null;
                }
                // wjt added ends 

                chkVFOLock.Enabled = false;

                if (!(fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)))
                {
                    //if(current_model == Model.SDR1000) //w5wc
                    Hdw.StandBy();
                }
                else
                {
                    FWC.SetStandby(true);
                }
                chkPower.BackColor = SystemColors.Control;
                txtVFOAFreq.ForeColor = vfo_text_dark_color;
                txtVFOAMSD.ForeColor = vfo_text_dark_color;
                txtVFOALSD.ForeColor = vfo_text_dark_color;
                UpdateVFOASub();

                txtVFOBFreq.ForeColor = vfo_text_dark_color;
                txtVFOBMSD.ForeColor = vfo_text_dark_color;
                txtVFOBLSD.ForeColor = vfo_text_dark_color;
                txtVFOBBand.ForeColor = band_text_dark_color;

                timer_peak_text.Enabled = false;

                Display.ResetRX1DisplayAverage();
                Display.ResetRX1DisplayPeak();
                Display.ResetRX2DisplayAverage();
                Display.ResetRX2DisplayPeak();

                CWPTT.Stop();

                Audio.callback_return = 2;
                Audio.StopAudio1();

                if (vac_enabled)
                {
                    Audio.StopAudioVAC();
                }

                if (draw_display_thread != null)
                {
                    if (!draw_display_thread.Join(500))
                        draw_display_thread.Abort();
                }
                if (multimeter_thread != null)
                {
                    if (!multimeter_thread.Join(500))
                        multimeter_thread.Abort();
                }
                if (sql_update_thread != null)
                {
                    if (!sql_update_thread.Join(500))
                        sql_update_thread.Abort();
                }
                if (noise_gate_update_thread != null)
                {
                    if (!noise_gate_update_thread.Join(500))
                        noise_gate_update_thread.Abort();
                }
                if (vox_update_thread != null)
                {
                    if (!vox_update_thread.Join(500))
                        vox_update_thread.Abort();
                }
                if (poll_ptt_thread != null)
                {
                    if (!poll_ptt_thread.Join(500))
                        poll_ptt_thread.Abort();
                }
            }

            if (fwc_init && current_model == Model.FLEX5000)
            {
                bool tx1, tx2, tx3;
                if (flex5000RelayForm != null)
                    flex5000RelayForm.UpdateRelayState(out tx1, out tx2, out tx3);
            }
            panelVFOAHover.Invalidate();
            panelVFOBHover.Invalidate();
        }

        public void comboDisplayMode_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            DisplayMode old_mode = Display.CurrentDisplayMode;

            switch (comboDisplayMode.Text)
            {
                case "Spectrum":
                    Display.CurrentDisplayMode = DisplayMode.SPECTRUM;
                    UpdateRXDisplayVars((int)udFilterLow.Value, (int)udFilterHigh.Value);
                    break;
                case "Panadapter":
                    Display.CurrentDisplayMode = DisplayMode.PANADAPTER;
                    //ptbDisplayZoom.Maximum = 250;
                    //ptbDisplayZoom.Minimum = 1;
                    CalcDisplayFreq();
                    break;
                case "Scope":
                    Display.CurrentDisplayMode = DisplayMode.SCOPE;
                    break;
                case "Scope2":
                    Display.CurrentDisplayMode = DisplayMode.SCOPE2;
                    break;
                case "Phase":
                    Display.CurrentDisplayMode = DisplayMode.PHASE;
                    break;
                case "Phase2":
                    Display.CurrentDisplayMode = DisplayMode.PHASE2;
                    break;
                case "Waterfall":
                    Display.CurrentDisplayMode = DisplayMode.WATERFALL;
                    // ptbDisplayZoom.Maximum = 240;
                    //ptbDisplayZoom.Minimum = 10;
                    CalcDisplayFreq();
                    break;
                case "Histogram":
                    Display.CurrentDisplayMode = DisplayMode.HISTOGRAM;
                    break;
                case "Panafall":
                    Display.CurrentDisplayMode = DisplayMode.PANAFALL;
                    CalcDisplayFreq();
                    break;
                case "Panascope":
                    Display.CurrentDisplayMode = DisplayMode.PANASCOPE;
                    //ptbDisplayZoom.Maximum = 240;
                    //ptbDisplayZoom.Minimum = 10;
                    CalcDisplayFreq();
                    break;
                case "Spectrascope":
                    Display.CurrentDisplayMode = DisplayMode.SPECTRASCOPE;
                    // ptbDisplayZoom.Maximum = 240;
                    // ptbDisplayZoom.Minimum = 10;
                    UpdateRXDisplayVars((int)udFilterLow.Value, (int)udFilterHigh.Value);
                    //CalcDisplayFreq();
                    break;
                case "Off":
                    Display.CurrentDisplayMode = DisplayMode.OFF;
                    break;
            }

            if (old_mode == DisplayMode.OFF && (draw_display_thread == null || !draw_display_thread.IsAlive))
            {
                draw_display_thread = new Thread(new ThreadStart(RunDisplay));
                draw_display_thread.Name = "Draw Display Thread";
                draw_display_thread.Priority = ThreadPriority.BelowNormal;
                draw_display_thread.IsBackground = true;
                draw_display_thread.Start();
            }

            switch (old_mode)
            {
                case DisplayMode.PANADAPTER:
                case DisplayMode.WATERFALL:
                case DisplayMode.PANAFALL:
                case DisplayMode.PANASCOPE:
                    switch (Display.CurrentDisplayMode)
                    {
                        case DisplayMode.PANADAPTER:
                        case DisplayMode.WATERFALL:
                        case DisplayMode.PANAFALL:
                        case DisplayMode.PANASCOPE:
                            break;
                        default:
                            RX1Filter = rx1_filter; // reset filter display limits
                            TXFilterLow = TXFilterLow;
                            break;
                    }
                    break;
            }

            switch (Display.CurrentDisplayMode)
            {
                case DisplayMode.PHASE:
                case DisplayMode.PHASE2:
                case DisplayMode.SCOPE:
                case DisplayMode.SCOPE2:
                case DisplayMode.OFF:
                    chkDisplayAVG.Enabled = false;
                    if (chkDisplayAVG.Checked)
                        chkDisplayAVG.BackColor = SystemColors.Control;
                    //chkDisplayAVG.Checked = false;
                    chkDisplayPeak.Enabled = false;
                    if (chkDisplayPeak.Checked)
                        chkDisplayPeak.BackColor = SystemColors.Control;
                    //chkDisplayPeak.Checked = false;
                    break;
                case DisplayMode.WATERFALL:
                    chkDisplayAVG.Enabled = true;
                    if (chkDisplayAVG.Checked)
                        chkDisplayAVG.BackColor = button_selected_color;
                    chkDisplayPeak.Enabled = true;
                    if (chkDisplayPeak.Checked)
                        chkDisplayPeak.BackColor = button_selected_color;
                    btnZeroBeat.Enabled = true;
                    radio.GetDSPRX(0, 0).SpectrumPreFilter = true;
                    radio.GetDSPRX(1, 0).SpectrumPreFilter = true;
                    break;
                case DisplayMode.PANADAPTER:
                    chkDisplayAVG.Enabled = true;
                    if (chkDisplayAVG.Checked)
                        chkDisplayAVG.BackColor = button_selected_color;
                    chkDisplayPeak.Enabled = true;
                    if (chkDisplayPeak.Checked)
                        chkDisplayPeak.BackColor = button_selected_color;
                    btnZeroBeat.Enabled = chkDisplayAVG.Checked;
                    radio.GetDSPRX(0, 0).SpectrumPreFilter = true;
                    radio.GetDSPRX(1, 0).SpectrumPreFilter = true;
                    break;
                case DisplayMode.HISTOGRAM:
                    chkDisplayAVG.Enabled = true;
                    if (chkDisplayAVG.Checked)
                        chkDisplayAVG.BackColor = button_selected_color;
                    chkDisplayPeak.Enabled = true;
                    if (chkDisplayPeak.Checked)
                        chkDisplayPeak.BackColor = button_selected_color;
                    btnZeroBeat.Enabled = chkDisplayAVG.Checked;
                    if (rx1_dsp_mode != DSPMode.SPEC)
                    {
                        radio.GetDSPRX(0, 0).SpectrumPreFilter = false;
                        radio.GetDSPRX(1, 0).SpectrumPreFilter = false;
                    }
                    else
                    {
                        radio.GetDSPRX(0, 0).SpectrumPreFilter = true;
                        radio.GetDSPRX(1, 0).SpectrumPreFilter = true;
                    }
                    RX1Filter = rx1_filter;
                    break;
                case DisplayMode.PANAFALL:
                    chkDisplayAVG.Enabled = true;
                    if (chkDisplayAVG.Checked)
                        chkDisplayAVG.BackColor = button_selected_color;
                    chkDisplayPeak.Enabled = true;
                    if (chkDisplayPeak.Checked)
                        chkDisplayPeak.BackColor = button_selected_color;
                    btnZeroBeat.Enabled = chkDisplayAVG.Checked;
                    radio.GetDSPRX(0, 0).SpectrumPreFilter = true;
                    radio.GetDSPRX(1, 0).SpectrumPreFilter = true;
                    break;
                case DisplayMode.PANASCOPE:
                    chkDisplayAVG.Enabled = true;
                    if (chkDisplayAVG.Checked)
                        chkDisplayAVG.BackColor = button_selected_color;
                    chkDisplayPeak.Enabled = true;
                    if (chkDisplayPeak.Checked)
                        chkDisplayPeak.BackColor = button_selected_color;
                    btnZeroBeat.Enabled = chkDisplayAVG.Checked;
                    radio.GetDSPRX(0, 0).SpectrumPreFilter = true;
                    radio.GetDSPRX(1, 0).SpectrumPreFilter = true;
                    break;
                default:
                    chkDisplayAVG.Enabled = true;
                    if (chkDisplayAVG.Checked)
                        chkDisplayAVG.BackColor = button_selected_color;
                    chkDisplayPeak.Enabled = true;
                    if (chkDisplayPeak.Checked)
                        chkDisplayPeak.BackColor = button_selected_color;
                    btnZeroBeat.Enabled = chkDisplayAVG.Checked;
                    if (rx1_dsp_mode != DSPMode.SPEC)
                    {
                        radio.GetDSPRX(0, 0).SpectrumPreFilter = false;
                        radio.GetDSPRX(1, 0).SpectrumPreFilter = false;
                    }
                    else
                    {
                        radio.GetDSPRX(0, 0).SpectrumPreFilter = true;
                        radio.GetDSPRX(1, 0).SpectrumPreFilter = true;
                    }
                    break;
            }

            if (chkDisplayAVG.Checked)
            {
                switch (Display.CurrentDisplayMode)
                {
                    case DisplayMode.PANADAPTER:
                    case DisplayMode.HISTOGRAM:
                    case DisplayMode.SPECTRUM:
                    case DisplayMode.WATERFALL:
                    case DisplayMode.PANAFALL:
                    case DisplayMode.PANASCOPE:
                    case DisplayMode.SPECTRASCOPE:
                        btnZeroBeat.Enabled = true;
                        break;
                    default:
                        btnZeroBeat.Enabled = false;
                        break;
                }
            }

            was_panadapter = false;
            was_waterfall = false;

            if (comboDisplayMode.Focused)
                btnHidden.Focus();
        }

        private void chkBIN_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkBIN.Checked) chkBIN.BackColor = button_selected_color;
            else chkBIN.BackColor = SystemColors.Control;
            radio.GetDSPRX(0, 0).BinOn = chkBIN.Checked;
            radio.GetDSPRX(0, 1).BinOn = chkBIN.Checked;
            BINToolStripMenuItem.Checked = chkBIN.Checked;
        }

        private void comboAGC_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            if (comboAGC.SelectedIndex < 0) return;
            radio.GetDSPRX(0, 0).RXAGCMode = (AGCMode)comboAGC.SelectedIndex;
            radio.GetDSPRX(0, 1).RXAGCMode = (AGCMode)comboAGC.SelectedIndex;

            // set whether custom controls are active
            switch ((AGCMode)comboAGC.SelectedIndex)
            {
                case AGCMode.LONG:
                    SetupForm.CustomRXAGCEnabled = false;
                    /*SetupForm.RXAGCAttack = 2;
                    SetupForm.RXAGCHang = 750;
                    SetupForm.RXAGCDecay = 2000;*/
                    //comboAGC.BackColor = SystemColors.Window;
                    // SetupForm.AGCHangThreshold = 0;
                    //DttSP.SetRXAGCHangLevel(0, 0, 0.0);
                    SetupForm.tbDSPAGCHangThreshold.Enabled = true;
                    SetupForm.SetAGCHangThres = SetupForm.tbDSPAGCHangThreshold.Value;
                    toolTip1.SetToolTip(comboAGC, "Automatic Gain Control Mode Setting:\n" +
                        "Long (Attack 2ms, Hang 2000ms, Decay 2000ms)");
                    break;
                case AGCMode.SLOW:
                    SetupForm.CustomRXAGCEnabled = false;
                    /*SetupForm.RXAGCAttack = 2;
                    SetupForm.RXAGCHang = 500;
                    SetupForm.RXAGCDecay = 500;*/
                    //SetupForm.AGCHangThreshold = 0;
                    //DttSP.SetRXAGCHangLevel(0, 0, 0.0);
                    SetupForm.tbDSPAGCHangThreshold.Enabled = true;
                    SetupForm.SetAGCHangThres = SetupForm.tbDSPAGCHangThreshold.Value;
                    toolTip1.SetToolTip(comboAGC, "Automatic Gain Control Mode Setting:\n" +
                        "Slow (Attack 2ms, Hang 1000ms, Decay 500ms)");
                    //comboAGC.BackColor = SystemColors.Window;
                    break;
                case AGCMode.MED:
                    SetupForm.CustomRXAGCEnabled = false;
                    /*SetupForm.RXAGCAttack = 2;
                    SetupForm.RXAGCHang = 250;
                    SetupForm.RXAGCDecay = 250;*/
                    // SetupForm.AGCHangThreshold = 100;
                    //DttSP.SetRXAGCHangLevel(0, 0, 100.0);
                    DttSP.SetRXAGCHangThreshold(0, 0, 100);
                    //SetupForm.SetAGCHangThres();
                    SetupForm.tbDSPAGCHangThreshold.Enabled = false;
                    toolTip1.SetToolTip(comboAGC, "Automatic Gain Control Mode Setting:\n" +
                        "Medium (Attack 2ms, Hang OFF, Decay 250ms)");
                    //comboAGC.BackColor = SystemColors.Window;
                    break;
                case AGCMode.FAST:
                    SetupForm.CustomRXAGCEnabled = false;
                    /*SetupForm.RXAGCAttack = 2;
                    SetupForm.RXAGCHang = 100;
                    SetupForm.RXAGCDecay = 100;*/
                    //SetupForm.AGCHangThreshold = 100;
                    // DttSP.SetRXAGCHangLevel(0, 0, 100.0);
                    DttSP.SetRXAGCHangThreshold(0, 0, 100);
                    SetupForm.tbDSPAGCHangThreshold.Enabled = false;
                    toolTip1.SetToolTip(comboAGC, "Automatic Gain Control Mode Setting:\n" +
                        "Fast (Attack 2ms, Hang OFF, Decay 50ms)");
                    //comboAGC.BackColor = SystemColors.Window;
                    break;
                case AGCMode.CUSTOM:
                    SetupForm.CustomRXAGCEnabled = true;
                    // SetupForm.AGCHangThreshold = 0;
                    // DttSP.SetRXAGCHangLevel(0, 0, 0.0);
                    SetupForm.tbDSPAGCHangThreshold.Enabled = true;
                    SetupForm.SetAGCHangThres = SetupForm.tbDSPAGCHangThreshold.Value;
                    toolTip1.SetToolTip(comboAGC, "Automatic Gain Control Mode Setting:\n" +
                        "Custom - Set specifics in Setup Form -> DSP -> AGC/ALC");
                    //comboAGC.BackColor = SystemColors.Window;
                    break;
                case AGCMode.FIXD:
                    SetupForm.CustomRXAGCEnabled = false;
                    toolTip1.SetToolTip(comboAGC, "Automatic Gain Control Mode Setting:\n" +
                        "Fixed - Set gain with AGC-T control above");
                    //comboAGC.BackColor = Color.Orange;
                    break;
            }

            // set RF control to Max or Fixed gain depending on mode
            switch ((AGCMode)comboAGC.SelectedIndex)
            {
                case AGCMode.FIXD:
                    RF = SetupForm.AGCFixedGain;
                    ptbRF_Scroll(this, EventArgs.Empty);
                    break;
                default:
                    RF = SetupForm.AGCMaxGain;
                    ptbRF_Scroll(this, EventArgs.Empty);
                    break;
            }

            if (comboAGC.Focused)
                btnHidden.Focus();
        }

        private void Console_Closing(object sender, System.ComponentModel.CancelEventArgs e)
        {
            Audio.callback_return = 2;
            CATEnabled = false;
            if (SetupForm != null) SetupForm.Hide();
            if (CWXForm != null) CWXForm.Hide();
            if (EQForm != null) EQForm.Hide();
            if (UCBForm != null) UCBForm.Hide();
            if (XVTRForm != null) XVTRForm.Hide();
            //if(ProdTestForm != null) ProdTestForm.Hide();
            if (fwcMixForm != null) fwcMixForm.Hide();
            if (flex3000MixerForm != null) flex3000MixerForm.Hide();
            if (flex5000LLHWForm != null) flex5000LLHWForm.Hide();
            if (flex5000DebugForm != null) flex5000DebugForm.Hide();
            if (fwcAntForm != null) fwcAntForm.Hide();
            if (fwcAtuForm != null) fwcAtuForm.Hide();
            if (predistForm != null) predistForm.Hide();

            chkPower.Checked = false;
            Thread.Sleep(100);
            this.Hide();
            SaveState();

            if (fwc_init)
            {
                try
                {
                    switch (current_model)
                    {
                        case Model.FLEX5000:
                            FWC.SetPABias(false);
                            break;
                        case Model.FLEX3000:
                            FWC.SetPABias(false);
                            FWC.SetFanSpeed(0.0f);
                            break;
                    }
                }
                catch (Exception)
                {

                }
            }


            if (CWXForm != null) CWXForm.Close();
            if (SetupForm != null) SetupForm.SaveOptions();
            if (EQForm != null) EQForm.Close();
            if (UCBForm != null) UCBForm.Close();
            if (XVTRForm != null) XVTRForm.Close();
            //if(ProdTestForm != null) ProdTestForm.Close();
            if (fwcMixForm != null) fwcMixForm.Close();
            if (flex3000MixerForm != null) flex3000MixerForm.Close();
            if (flex5000LLHWForm != null) flex5000LLHWForm.Close();
            if (flex5000DebugForm != null) flex5000DebugForm.Close();
            if (fwcAntForm != null) fwcAntForm.Close();
            if (fwcAtuForm != null) fwcAtuForm.Close();
            if (predistForm != null) predistForm.Close();
        }

        private void comboPreamp_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            //if (initializing) return;
            PreampMode mode = PreampMode.FIRST;
            bool exit = false;
            switch (current_model)
            {
                case Model.HPSDR:
                case Model.HERMES:
                    switch (comboPreamp.Text)
                    {
                        case "-20dB":
                            mode = PreampMode.HPSDR_OFF;
                            comboPreamp.Text = "-20dB";
                            break;

                        case "Low":
                        case "Med":
                        case "High":
                        case "0dB":
                            mode = PreampMode.HPSDR_ON;
                            comboPreamp.Text = "0dB";
                            break;

                        case "-10db":
                            mode = PreampMode.HPSDR_MINUS10;
                            break;

                        case "-20db":
                            mode = PreampMode.HPSDR_MINUS20;
                            break;

                        case "-30db":
                            mode = PreampMode.HPSDR_MINUS30;
                            break;

                        case "-40db":
                            mode = PreampMode.HPSDR_MINUS40;
                            break;

                        case "-50db":
                            mode = PreampMode.HPSDR_MINUS50;
                            break;

                        default:
                            exit = true;
                            break;
                    }
                    break;
                case Model.SDR1000:
                    switch (comboPreamp.Text)
                    {
                        case "Off":
                            mode = PreampMode.OFF;
                            break;
                        case "Low":
                            mode = PreampMode.LOW;
                            break;
                        case "Med":
                            mode = PreampMode.MED;
                            break;
                        case "High":
                        case "On":
                            mode = PreampMode.HIGH;
                            break;
                        default:
                            exit = true;
                            break;
                    }
                    break;
                case Model.FLEX3000:
                    switch (comboPreamp.Text)
                    {
                        case "Attn":
                            mode = PreampMode.OFF;
                            break;
                        case "Off":
                            mode = PreampMode.LOW;
                            break;
                        case "Pre1":
                            mode = PreampMode.MED;
                            break;
                        case "Pre2":
                            mode = PreampMode.HIGH;
                            break;
                        default:
                            exit = true;
                            break;
                    }
                    break;
                case Model.FLEX5000:
                    exit = true;
                    break;
                default:
                    exit = true;
                    break;
            }

            if (comboPreamp.Focused)
                btnHidden.Focus();

            if (exit) return;

            RX1PreampMode = mode;
            update_preamp = true;
        }

        private void chkMUT_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkMUT.Checked)
                chkMUT.BackColor = button_selected_color;
            else
                chkMUT.BackColor = SystemColors.Control;

            if (num_channels == 2)
            {
                if (current_model == Model.SDR1000)
                    Hdw.MuteRelay = chkMUT.Checked;
            }

            if (chkMUT.Checked)
                Audio.MonitorVolume = 0.0;
            else
                ptbAF_Scroll(this, EventArgs.Empty);
        }

        public bool ModelIsHPSDRorHermes()
        {
            if (current_model == Model.HPSDR)
            {
                return true;
            }
            if (current_model == Model.HERMES)
            {
                return true;
            }
            return false;
        }

        private void ptbPWR_Scroll(object sender, System.EventArgs e)
        {
            lblPWR.Text = "Drive:  " + ptbPWR.Value.ToString();

            if (SetupForm == null)
                return;

            if (ptbPWR.Value == 0)
            {
                Audio.RadioVolume = 0.0;
                return;
            }

            int[] powers = { 1, 2, 5, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100 };
            float val = (float)ptbPWR.Value;
            double new_volume = 0;

            Band b = tx_band;

            if ((!tuning || xvtr_tune_power) && tx_xvtr_index >= 0)
            {
                int power = ptbPWR.Value;
                if (rx1_dsp_mode == DSPMode.FM) power = (int)(power * 2.5);
                XVTRForm.SetPower(tx_xvtr_index, power);
                b = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), tx_xvtr_index, true, current_region);
            }

            int new_pwr = ptbPWR.Value;
            if (rx1_dsp_mode == DSPMode.FM) new_pwr = (int)(new_pwr * 2.5);
            power_by_band[(int)tx_band] = new_pwr;

            if (pa_present && VFOAFreq < 29.7f || (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000) ||
                (ModelIsHPSDRorHermes())))
            {
                if (val == 0)
                {
                    Audio.RadioVolume = 0.0;
                }
                else
                {
                    if (new_power_cal)
                    {
                        //double new_volume;
                        // interpolate between values
                        int pwr = (int)val;
                        if (!tuning && (rx1_dsp_mode == DSPMode.AM || rx1_dsp_mode == DSPMode.SAM))
                            pwr = Math.Max(1, (int)(pwr * 0.4));

                        int index1 = 12;
                        while (powers[index1] > pwr) index1--;
                        int index2 = 0;
                        while (powers[index2] < pwr) index2++;

                        if (current_model != Model.FLEX5000 && pwr < 10)
                        {
                            new_volume = Math.Sqrt(pwr / 10.0 * Math.Pow(power_table[(int)b][3], 2.0)) / audio_volts1;
                        }
                        if (index1 == index2)
                        {
                            new_volume = power_table[(int)b][index1] / audio_volts1;
                        }
                        else
                        {
                            double percent = ((double)pwr - powers[index1]) / ((double)powers[index2] - powers[index1]);
                            double val1;
                            if (index1 < 0) val1 = 0;
                            else val1 = Math.Pow(power_table[(int)b][index1], 2.0);
                            double val2 = Math.Pow(power_table[(int)b][index2], 2.0);
                            new_volume = Math.Sqrt(val1 + percent * (val2 - val1)) / audio_volts1;
                        }
                        if (!tuning && (rx1_dsp_mode == DSPMode.AM || rx1_dsp_mode == DSPMode.SAM))
                            new_volume = Math.Sqrt(Math.Pow((new_volume * audio_volts1), 2.0) * 5.0) / audio_volts1;
                        Audio.RadioVolume = new_volume;
                    }
                    else
                    {
                        /*if(current_dsp_mode == DSPMode.AM ||current_dsp_mode == DSPMode.SAM)
                            val = (float)(Math.Max(1.0f, (float)val*0.4));*/
                        double target_dbm = 10 * (double)Math.Log10((double)val * 1000);

                        double gbb; //w5wc
                        if (tx_xvtr_index >= 0)
                        {
                            Band lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), tx_xvtr_index, true, current_region);
                            gbb = GainByBand(lo_band);
                        }
                        else
                        {
                            gbb = GainByBand(TXBand);
                        }
                        target_dbm -= gbb;

                        double target_volts = Math.Sqrt(Math.Pow(10, target_dbm * 0.1) * 0.05);		// E = Sqrt(P * R) 
                        /*if(current_dsp_mode == DSPMode.AM ||current_dsp_mode == DSPMode.SAM)
                            target_volts = Math.Sqrt(Math.Pow(target_volts, 2.0)*5.0);*/
                       // Audio.RadioVolume = target_volts / audio_volts1;
                        Audio.RadioVolume = (double)Math.Min((target_volts / 0.8), 1.0);
                    }
                }
            }
            else
            {
                const double TARGET = 0.8;		// audio in volts needed to hit 1W 
                Audio.RadioVolume = (double)Math.Sqrt((double)ptbPWR.Value / 100.0) / audio_volts1 * TARGET;
            }

            if (ptbPWR.Focused) btnHidden.Focus();
        }

        private void ptbAF_Scroll(object sender, System.EventArgs e)
        {
            //udAF.Value = ptbAF.Value;
            lblAF.Text = "AF:  " + ptbAF.Value.ToString();

            if (chkMUT.Checked)
            {
                Audio.MonitorVolume = 0.0;
                goto end;
            }

            if ((num_channels > 2) && mox && !chkMON.Checked)
            {
                // monitor is muted
                Audio.MonitorVolume = 0.0;
            }
            else
            {
                Audio.MonitorVolume = ptbAF.Value / 100.0;
            }

        end:
            if (!MOX) RXAF = ptbAF.Value;
            else TXAF = ptbAF.Value;

            if (ptbAF.Focused) btnHidden.Focus();
        }

        private void ptbRF_Scroll(object sender, System.EventArgs e)
        {
            //lblRF.Text = "AGC Gain:  "+ptbRF.Value.ToString();

            switch (RX1AGCMode)
            {
                case AGCMode.FIXD:
                    lblRF.Text = "Fixed Gain:  " + ptbRF.Value.ToString();
                    if (SetupForm != null) SetupForm.AGCFixedGain = ptbRF.Value;
                    break;
                default:
                    lblRF.Text = "AGC Gain:  " + ptbRF.Value.ToString();
                    if (SetupForm != null) SetupForm.AGCMaxGain = ptbRF.Value;
                    break;
            }

            rx1_agct_by_band[(int)rx1_band] = ptbRF.Value;
            if (ptbRF.Focused) btnHidden.Focus();
        }

        private void chkMicMute_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkMicMute.Checked)
                Audio.MicPreamp = 0.0;
            else
                ptbMic_Scroll(this, EventArgs.Empty);
        }

        private void ptbMic_Scroll(object sender, System.EventArgs e)
        {
            // if (ModelIsHPSDRorHermes())
            // {
            ptbMic.Minimum = mic_gain_min;
            ptbMic.Maximum = mic_gain_max;
            lblMicVal.Text = ptbMic.Value.ToString() + " dB";
            if (radio.GetDSPTX(0).CurrentDSPMode != DSPMode.FM)
            {
                double gain_db = (double)ptbMic.Value;
                if (chkMicMute.Checked == true) chkMicMute.Checked = false;
                if (mic_boost)
                {
                    toolTip1.SetToolTip(ptbMic, (ptbMic.Value + 20).ToString());

                    //lblMicVal.Text = (ptbMic.Value + 20).ToString() + " dB";
                    //gain_db += 20.0;
                }
                else if (line_in)
                {
                    toolTip1.SetToolTip(ptbMic, (ptbMic.Value + line_in_boost).ToString());
                }
                else
                {
                    toolTip1.SetToolTip(ptbMic, "");
                    // lblMicVal.Text = ptbMic.Value.ToString() + " dB";
                }
                // lblMicVal.Text = ptbMic.Value.ToString() + " dB";
                //double gain_db = (double)ptbMic.Value;
                Audio.MicPreamp = Math.Pow(10.0, gain_db / 20.0); // convert to scalar 
            }
            if (ptbMic.Focused) btnHidden.Focus();
            // }
            /*  else
              {
                  if (chkMicMute.Checked == true) chkMicMute.Checked = false;
                  ptbMic.Minimum = 0;
                  ptbMic.Maximum = 70;
                  lblMicVal.Text = ptbMic.Value.ToString();
                  double gain_db = (double)ptbMic.Value;
                  if (mic_boost) gain_db += 20.0;
                  Audio.MicPreamp = Math.Pow(10.0, gain_db / 20.0); // convert to scalar
                  if (ptbMic.Focused) btnHidden.Focus();
              }*/
        }

        private void ptbCWSpeed_Scroll(object sender, System.EventArgs e)
        {
            lblCWSpeed.Text = "Speed:  " + ptbCWSpeed.Value.ToString() + " WPM";
            // RadioDSP.KeyerSpeed = ptbCWSpeed.Value;
            CWKeyer.WPM = ptbCWSpeed.Value;

            if (ptbCWSpeed.Focused) btnHidden.Focus();
        }

        private void chkVOX_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.VOXEnable = chkVOX.Checked;

            if (chkVOX.Checked)
            {
                chkVOX.BackColor = button_selected_color;
            }
            else
            {
                Audio.VOXActive = false;
                chkVOX.BackColor = SystemColors.Control;
            }
        }

        private void ptbSquelch_Scroll(object sender, System.EventArgs e)
        {
            chkSquelch.Text = "SQL:  " + ptbSquelch.Value.ToString();

            if (rx1_dsp_mode == DSPMode.FM) //FM Squelch
            {
                radio.GetDSPRX(0, 0).FMSquelchThreshold = (float)Math.Pow(10.0, -2 * ptbSquelch.Value / 100.0);
                radio.GetDSPRX(0, 1).FMSquelchThreshold = (float)Math.Pow(10.0, -2 * ptbSquelch.Value / 100.0);
            }
            else //non-FM Squelch
            {
                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                {
                    radio.GetDSPRX(0, 0).RXSquelchThreshold = ((float)ptbSquelch.Value -
                        rx1_meter_cal_offset -
                        rx1_preamp_offset[(int)rx1_preamp_mode] -
                        rx1_filter_size_cal_offset -
                        (-alex_preamp_offset) -
                        rx1_path_offset);
                    radio.GetDSPRX(0, 1).RXSquelchThreshold = ((float)ptbSquelch.Value -
                        rx1_meter_cal_offset -
                        rx1_preamp_offset[(int)rx1_preamp_mode] -
                        rx1_filter_size_cal_offset -
                        (-alex_preamp_offset) -
                        rx1_path_offset);
                }
                else
                {
                    radio.GetDSPRX(0, 0).RXSquelchThreshold = (float)ptbSquelch.Value -
                        rx1_preamp_offset[(int)rx1_preamp_mode] -
                        rx1_meter_cal_offset -
                        rx1_filter_size_cal_offset -
                        (-alex_preamp_offset);

                    radio.GetDSPRX(0, 1).RXSquelchThreshold = (float)ptbSquelch.Value -
                        rx1_preamp_offset[(int)rx1_preamp_mode] -
                        rx1_meter_cal_offset -
                        rx1_filter_size_cal_offset -
                        (-alex_preamp_offset);
                }
            }

            if (ptbSquelch.Focused) btnHidden.Focus();
        }

        private void picSquelch_Paint(object sender, System.Windows.Forms.PaintEventArgs e)
        {
            int signal_x = (int)((sql_data + 160.0) * (picSquelch.Width - 1) / 160.0);
            int sql_x = (int)(((float)ptbSquelch.Value + 160.0) * (picSquelch.Width - 1) / 160.0);

            if (mox) signal_x = sql_x = 0;
            e.Graphics.FillRectangle(Brushes.LimeGreen, 0, 0, signal_x, picSquelch.Height);
            if (sql_x < signal_x)
                e.Graphics.FillRectangle(Brushes.Red, sql_x + 1, 0, signal_x - sql_x - 1, picSquelch.Height);
        }

        private void chkVACEnabled_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.VACEnable = chkVACEnabled.Checked;
            vac_enabled = chkVACEnabled.Checked;

            if (chkVACEnabled.Checked) chkVACEnabled.BackColor = button_selected_color;
            else chkVACEnabled.BackColor = SystemColors.Control;
        }

        private void chkVACIQEnabled_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.VACIQEnable = chkVACIQEnabled.Checked;
            vaciq_enabled = chkVACIQEnabled.Checked;
        }

        private void chkNoiseGate_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.NoiseGateEnabled = chkNoiseGate.Checked;

            if (chkNoiseGate.Checked) chkNoiseGate.BackColor = button_selected_color;
            else chkNoiseGate.BackColor = SystemColors.Control;
        }

        private void ptbVACRXGain_Scroll(object sender, System.EventArgs e)
        {
            lblRXGain.Text = "RX Gain:  " + ptbVACRXGain.Value.ToString();
            if (SetupForm != null) SetupForm.VACRXGain = ptbVACRXGain.Value;
            if (ptbVACRXGain.Focused) btnHidden.Focus();
        }

        private void ptbVACTXGain_Scroll(object sender, System.EventArgs e)
        {
            lblTXGain.Text = "TX Gain:  " + ptbVACTXGain.Value.ToString();
            if (SetupForm != null) SetupForm.VACTXGain = ptbVACTXGain.Value;
            if (ptbVACTXGain.Focused) btnHidden.Focus();
        }

        private void ptbVOX_Scroll(object sender, System.EventArgs e)
        {
            lblVOXVal.Text = ptbVOX.Value.ToString();
            if (SetupForm != null) SetupForm.VOXSens = ptbVOX.Value;
            if (ptbVOX.Focused) btnHidden.Focus();
        }

        private void picVOX_Paint(object sender, System.Windows.Forms.PaintEventArgs e)
        {
            int peak_x = (int)(Audio.Peak * 10 * picVOX.Width);
            int vox_x = (int)(ptbVOX.Value * (picVOX.Width - 1) / 1000.0);

            if (!chkVOX.Checked || peak_x < 0) peak_x = vox_x = 0;
            e.Graphics.FillRectangle(Brushes.LimeGreen, 0, 0, peak_x, picVOX.Height);
            if (vox_x < peak_x)
                e.Graphics.FillRectangle(Brushes.Red, vox_x + 1, 0, peak_x - vox_x - 1, picVOX.Height);
        }

        private void ptbNoiseGate_Scroll(object sender, System.EventArgs e)
        {
            lblNoiseGateVal.Text = ptbNoiseGate.Value.ToString();
            if (SetupForm != null) SetupForm.NoiseGate = ptbNoiseGate.Value;
            if (ptbNoiseGate.Focused) btnHidden.Focus();
        }

        private void picNoiseGate_Paint(object sender, System.Windows.Forms.PaintEventArgs e)
        {
            int signal_x = (int)((noise_gate_data + 160.0) * (picNoiseGate.Width - 1) / 160.0);
            int noise_x = (int)(((float)ptbNoiseGate.Value + 160.0) * (picNoiseGate.Width - 1) / 160.0);

            if (!mox) signal_x = noise_x = 0;
            e.Graphics.FillRectangle(Brushes.LimeGreen, 0, 0, signal_x, picNoiseGate.Height);
            if (noise_x < signal_x)
                e.Graphics.FillRectangle(Brushes.Red, noise_x + 1, 0, signal_x - noise_x - 1, picNoiseGate.Height);
        }

        private void WheelTune_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            if (e.Button == MouseButtons.Left)
                ChangeTuneStepUp();
        }

        private void chkMON_CheckedChanged(object sender, System.EventArgs e)
        {
            Audio.MON = chkMON.Checked;

            if (chkMON.Checked)
                chkMON.BackColor = button_selected_color;
            else
                chkMON.BackColor = SystemColors.Control;

            if (num_channels == 4 || num_channels == 6)
            {
                if (!(chkMON.Checked == false && mox))
                    ptbAF_Scroll(this, EventArgs.Empty);
                else
                    Audio.MonitorVolume = 0.0;
            }
            else
            {
                if (PowerOn && mox && current_model == Model.SDR1000)
                    Hdw.MuteRelay = !chkMON.Checked;
            }
        }

        private void AudioMOXChanged(bool tx)
        {
            // Audio.MOX = tx;

            if (tx)
            {
                //  if (!tuning && cw_key_mode)
                //  Audio.CurrentAudioState1 = Audio.AudioState.CW;
                Audio.MOX = tx;
                ptbAF.Value = txaf;
            }
            else // rx
            {
                // if (!tuning && cw_key_mode)
                //  Audio.CurrentAudioState1 = Audio.AudioState.DTTSP;
                ptbAF.Value = rxaf;
            }

            //udPWR_ValueChanged(this, EventArgs.Empty);
            ptbAF_Scroll(this, EventArgs.Empty);
        }

        private void HdwMOXChanged(bool tx, double freq)
        {
            if (!fwc_init || current_model != Model.FLEX5000)
                Hdw.UpdateHardware = false;

            if (tx)
            {
                switch (rx1_dsp_mode)
                {
                    case DSPMode.AM:
                    case DSPMode.SAM:
                    case DSPMode.FM:
                        //freq -= 0.011025; //w5wc-1
                        break;
                    /*case DSPMode.DRM:
                        freq -= 0.012;
                        break;*/
                }
                spur_reduction = false;
                if_shift = false; //

                // make sure TX freq has been set
                //  if (tx_dds_freq_updated)
                {
                    UpdateTXDDSFreq();
                    tx_dds_freq_updated = false;
                }

                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                {
                    FWC.SetMOX(true);
                    fwc_pa_bias = true;
                    if (current_model == Model.FLEX3000)
                    {
                        //f3k_fan = true;
                        mic_down = false;
                        mic_down_running = false;
                        mic_up = false;
                        mic_up_running = false;
                    }

                    if (preSelForm != null)
                        preSelForm.MOX = tx;
                }
                else
                {
                    if (num_channels == 2) Hdw.MuteRelay = !chkMON.Checked;

                    if (ext_ctrl_enabled)
                    {
                        Hdw.UpdateHardware = true;
                        UpdateExtCtrl();
                        Hdw.UpdateHardware = false;
                    }

                    Band lo_band = Band.FIRST;

                    if (rx1_xvtr_index >= 0)
                    {
                    // Fix Penny O/C VHF control Vk4xv
                    lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), rx1_xvtr_index, false, current_region);
                        //lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), -1, false, current_region);

                        if (penny_ext_ctrl_enabled)
                            Penny.getPenny().UpdateExtCtrl(lo_band, mox);

                        if (alex_ant_ctrl_enabled)
                            Alex.getAlex().UpdateAlexAntSelection(lo_band, mox);
                    }
                    else
                    {
                        if (penny_ext_ctrl_enabled)
                            Penny.getPenny().UpdateExtCtrl(rx1_band, mox);

                        if (alex_ant_ctrl_enabled)
                            Alex.getAlex().UpdateAlexAntSelection(rx1_band, mox);
                    }

                    if (x2_enabled)
                    {
                        Hdw.UpdateHardware = true;
                        Hdw.X2 = (byte)(Hdw.X2 | 0x40);
                        Hdw.UpdateHardware = false;
                        Thread.Sleep(x2_delay);
                    }

                    Hdw.GainRelay = true;		// 0dB
                    Hdw.Attn = false;

                    if (xvtr_present && freq >= 144.0)
                    {
                        Hdw.XVTR_RF = true;
                        if (current_xvtr_tr_mode == XVTRTRMode.POSITIVE)
                            Hdw.XVTR_TR = true;
                        else if (current_xvtr_tr_mode == XVTRTRMode.NEGATIVE)
                            Hdw.XVTR_TR = false;
                    }
                    else
                    {
                        if (tx_xvtr_index < 0 || !XVTRForm.GetXVTRRF(tx_xvtr_index))
                        {
                            Hdw.RFE_TR = true;
                            if (pa_present && freq <= 30.0)
                            {
                                Hdw.PA_TR_Relay = true;
                                Hdw.PABias = true;
                            }
                            if (rfe_pa_tr_enable && freq <= 30.0)
                                Hdw.PA_TR_Relay = true;
                        }
                        else
                        {
                            Hdw.XVTR_RF = true;
                        }
                    }
                }
                Hdw.TransmitRelay = true;
            }
            else // rx
            {

                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                {

                    FWC.SetMOX(false);
                    //FWC.SetPABias(false);
                    fwc_pa_bias = false;

                    if (preSelForm != null)
                        preSelForm.MOX = tx;
                }
                else
                {
                    if (xvtr_present && Hdw.XVTR_RF)
                    {
                        Hdw.XVTR_RF = false;
                        if (current_xvtr_tr_mode == XVTRTRMode.POSITIVE)
                            Hdw.XVTR_TR = false;
                        else if (current_xvtr_tr_mode == XVTRTRMode.NEGATIVE)
                            Hdw.XVTR_TR = true;
                    }
                    else
                    {
                        if (tx_xvtr_index < 0 || !XVTRForm.GetXVTRRF(tx_xvtr_index))
                        {
                            Hdw.RFE_TR = false;
                            if (pa_present)
                            {
                                Hdw.PABias = false;
                                Hdw.PA_TR_Relay = false;
                            }
                            if (rfe_pa_tr_enable)
                            {
                                Hdw.PA_TR_Relay = false;
                            }
                        }
                        else
                        {
                            Hdw.XVTR_RF = false;
                        }
                    }

                    Hdw.TransmitRelay = false;

                    if (x2_enabled)
                    {
                        Hdw.UpdateHardware = true;
                        Hdw.X2 = (byte)(Hdw.X2 & 0xBF);
                        Hdw.UpdateHardware = false;
                        Thread.Sleep(x2_delay);
                    }

                    if (!chkMUT.Checked && num_channels == 2)
                        Hdw.MuteRelay = false;

                    RX1PreampMode = rx1_preamp_mode;

                    spur_reduction = SetupForm.chkGeneralSpurRed.Checked;

                    /* if (rx1_dsp_mode != DSPMode.DRM &&
                         rx1_dsp_mode != DSPMode.SPEC)
                         if_shift = true;*/

                    UpdateTXDDSFreq();

                    Band lo_band = Band.FIRST;

                    if (rx1_xvtr_index >= 0)
                    {
                    // Fix Penny O/C VHF control Vk4xv
                    lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), rx1_xvtr_index, false, current_region);
                        //lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), -1, false, current_region);

                        if (penny_ext_ctrl_enabled)
                            Penny.getPenny().UpdateExtCtrl(lo_band, mox);

                        if (alex_ant_ctrl_enabled)
                            Alex.getAlex().UpdateAlexAntSelection(lo_band, mox);
                    }
                    else
                    {
                        if (penny_ext_ctrl_enabled)
                            Penny.getPenny().UpdateExtCtrl(rx1_band, mox);

                        if (alex_ant_ctrl_enabled)
                            Alex.getAlex().UpdateAlexAntSelection(rx1_band, mox);
                    }

                }
            }
            if (!fwc_init || current_model != Model.FLEX5000)
                Hdw.UpdateHardware = true;

            /*	if(!fwc_init || current_model != Model.FLEX5000)
            {
                if (tx && !tuning)
                {
                    DDSFreq = freq;
                }
                else if (tx && chkVFOSplit.Checked)
                {
                    txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                }
                else
                {
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                }
                }*/
        }

        private void UIMOXChangedTrue()
        {
            Display.MOX = true;
            meter_peak_count = multimeter_peak_hold_samples;		// reset multimeter peak

            switch (Display.CurrentDisplayMode)
            {
                case DisplayMode.PANADAPTER:
                case DisplayMode.SPECTRUM:
                case DisplayMode.HISTOGRAM:
                case DisplayMode.WATERFALL:
                case DisplayMode.PANAFALL:
                case DisplayMode.PANASCOPE:
                case DisplayMode.SPECTRASCOPE:
                    Display.DrawBackground();
                    break;
            }

            comboMeterRXMode.ForeColor = Color.Gray;
            comboMeterTXMode.ForeColor = Color.White;
            comboMeterTXMode_SelectedIndexChanged(this, EventArgs.Empty);

            if (!disable_ui_mox_changes)
            {
                SetupForm.SpurRedEnabled = false;
                DisableAllBands();
                DisableAllModes();
                chkVFOSplit.Enabled = false;
                btnVFOAtoB.Enabled = false;
                btnVFOBtoA.Enabled = false;
                btnVFOSwap.Enabled = false;
                chkPower.BackColor = Color.Red;
            }

            if (!fwc_init || current_model != Model.FLEX5000)
                comboPreamp.Enabled = !chkMOX.Checked;
            SetupForm.MOX = chkMOX.Checked;
            ResetMultiMeterPeak();
            //chkMOX.BackColor = button_selected_color;

            picSquelch.Invalidate();

            /*Thread t = new Thread(new ThreadStart(DelayedDisplayReset));
            t.Name = "Display Reset";
            t.Priority = ThreadPriority.BelowNormal;
            t.IsBackground = true;
            t.Start();*/
        }

        private void UIMOXChangedFalse()
        {
            Display.MOX = false;
            switch (Display.CurrentDisplayMode)
            {
                case DisplayMode.PANADAPTER:
                case DisplayMode.SPECTRUM:
                case DisplayMode.HISTOGRAM:
                case DisplayMode.WATERFALL:
                case DisplayMode.PANAFALL:
                case DisplayMode.PANASCOPE:
                case DisplayMode.SPECTRASCOPE:
                    Display.DrawBackground();
                    break;
            }

            if (!disable_ui_mox_changes)
            {
                SetupForm.SpurRedEnabled = true;
                EnableAllBands();
                EnableAllModes();
                chkVFOSplit.Enabled = true;
                btnVFOAtoB.Enabled = true;
                btnVFOBtoA.Enabled = true;
                btnVFOSwap.Enabled = true;
            }
            if (chkPower.Checked) chkPower.BackColor = button_selected_color;
            comboMeterTXMode.ForeColor = Color.Gray;
            comboMeterRXMode.ForeColor = Color.White;
            comboMeterRXMode_SelectedIndexChanged(this, EventArgs.Empty);

            pa_fwd_power = 0;
            pa_rev_power = 0;

            Audio.HighSWRScale = 1.0;
            HighSWR = false;

            for (int i = 0; i < meter_text_history.Length; i++)
                meter_text_history[i] = 0.0f;

            if (!fwc_init || current_model != Model.FLEX5000)
                comboPreamp.Enabled = !chkMOX.Checked;
            SetupForm.MOX = chkMOX.Checked;
            ResetMultiMeterPeak();
            chkMOX.BackColor = SystemColors.Control;

            picNoiseGate.Invalidate();

            /*Thread t = new Thread(new ThreadStart(DelayedDisplayReset));
            t.Name = "Display Reset";
            t.Priority = ThreadPriority.BelowNormal;
            t.IsBackground = true;
            t.Start();*/
        }

        private HiPerfTimer t1 = new HiPerfTimer();
        private double timer1 = 0.0;
        private bool mox = false;
        private void chkMOX_CheckedChanged2(object sender, System.EventArgs e)
        {
            chkFWCATUBypass.Enabled = !chkMOX.Checked;
            //Debug.WriteLine("MOX: "+chkMOX.Checked);	
            t1.Start();
            if (rx_only && chkMOX.Checked)
            {
                chkMOX.Checked = false;
                return;
            }

            // only allow softrock style xmit  for cw and ssb for now
            if (rx1_dsp_mode != DSPMode.CWL && rx1_dsp_mode != DSPMode.CWU &&
                rx1_dsp_mode != DSPMode.USB && rx1_dsp_mode != DSPMode.LSB &&
                ( /* current_model == Model.SDR1000_DDSLOCKED || */ current_model == Model.SOFTROCK40)
                )
            {
                chkMOX.Checked = false;
                return;
            }

            // bool tx = mox = chkMOX.Checked;
            // double freq = 0.0;
            bool tx = chkMOX.Checked;

            if (tx) mox = tx;
            double freq = 0.0;

            if (tx)
            {
                /*t1.Stop();
                timer1 += t1.DurationMsec;
                count1++;*/

                //FM Offsets
                if (radio.GetDSPTX(0).CurrentDSPMode == DSPMode.FM && current_fm_tx_mode != FMTXMode.Simplex
                    && !chkVFOSplit.Checked)
                {
                    switch (current_fm_tx_mode)
                    {
                        case FMTXMode.Low:
                            if (!chkFMTXRev.Checked)
                                TXFreq -= fm_tx_offset_mhz; // usual case
                            else
                                TXFreq += fm_tx_offset_mhz;
                            break;
                        case FMTXMode.High:
                            if (!chkFMTXRev.Checked)
                                TXFreq += fm_tx_offset_mhz; // usual case
                            else
                                TXFreq -= fm_tx_offset_mhz;
                            break;
                    }
                }

                if (chkVFOBTX.Checked || (!chkRX2.Checked && chkVFOSplit.Checked))
                    freq = double.Parse(txtVFOBFreq.Text);
                else if (chkRX2.Checked && chkVFOSplit.Checked)
                    freq = double.Parse(txtVFOABand.Text);
                else
                    freq = double.Parse(txtVFOAFreq.Text);

                if (tx_xvtr_index >= 0)
                    freq = XVTRForm.TranslateFreq(freq);

                if (chkXIT.Checked)
                    freq += (int)udXIT.Value * 0.000001;

                /*t1.Stop();
                  timer2 += t1.DurationMsec;
                  count2++;*/

                if (!calibrating)
                {
                    if (tx_band == Band.B60M && current_region == FRSRegion.US && !extended)
                    {
                        switch (radio.GetDSPTX(0).CurrentDSPMode)
                        {
                            case DSPMode.USB:
                            case DSPMode.CWL:
                            case DSPMode.CWU:
                            case DSPMode.DIGU:
                                break;
                            default:
                                MessageBox.Show(rx1_dsp_mode.ToString() + " mode is not allowed on 60M band.",
                                    "Transmit Error: Mode/Band",
                                    MessageBoxButtons.OK,
                                    MessageBoxIcon.Error);
                                chkMOX.Checked = false;
                                return;
                            // break;
                        }
                    }

                    if (!CheckValidTXFreq(current_region, freq, radio.GetDSPTX(0).CurrentDSPMode))	// out of band
                    {
                        if (tx_band == Band.B60M && (current_region == FRSRegion.US || current_region == FRSRegion.UK) &&
                            CheckValidTXFreq_Private(current_region, freq) && !extended)
                        {
                            if (radio.GetDSPTX(0).TXFilterHigh - radio.GetDSPTX(0).TXFilterLow > 2800)
                                MessageBox.Show("The transmit filter you have selected exceeds the bandwidth\n" +
                                    "constraints (2.8kHz) for the US/UK 60m band.",
                                    "60m Bandwidth",
                                    MessageBoxButtons.OK,
                                    MessageBoxIcon.Error);
                            else
                                MessageBox.Show("The US/UK 60m region requires transmission center of energy to be around\n" +
                                    "the defined channels.  Click the 60m Band button to jump to the nearest channel.",
                                    "US/UK 60m Off Channel",
                                    MessageBoxButtons.OK,
                                    MessageBoxIcon.Error);
                        }
                        else
                        {
                            switch (radio.GetDSPTX(0).CurrentDSPMode)
                            {
                                case DSPMode.CWL:
                                case DSPMode.CWU:
                                    MessageBox.Show("The frequency " + freq.ToString("f6") + "MHz is not within the\n" +
                                        "Band specifications for your region (" + ((int)current_region).ToString() + ").",
                                        "Transmit Error: Out Of Band",
                                        MessageBoxButtons.OK,
                                        MessageBoxIcon.Error);
                                    break;
                                default:
                                    MessageBox.Show("The frequency " + freq.ToString("f6") + "MHz in combination with your TX filter\n" +
                                        "settings [" + Display.TXFilterLow.ToString() + ", " + Display.TXFilterHigh.ToString() + "] are not within the " +
                                        "Band specifications for your region (" + ((int)current_region).ToString() + ").",
                                        "Transmit Error: Out Of Band",
                                        MessageBoxButtons.OK,
                                        MessageBoxIcon.Error);
                                    break;
                            }
                        }
                        chkMOX.Checked = false;
                        return;
                    }
                }

                /*t1.Stop();
                timer3 += t1.DurationMsec;
                count3++;*/

                switch (rx1_dsp_mode)
                {
                    case DSPMode.CWL:
                        freq += (double)cw_pitch * 0.0000010;
                        break;
                    case DSPMode.CWU:
                        freq -= (double)cw_pitch * 0.0000010;
                        break;
                }
            }
            else
            {
                current_ptt_mode = PTTMode.NONE;
                /*if(pa_present)
                {
                    if(poll_pa_pwr_thread !=null && poll_pa_pwr_thread.IsAlive)
                        poll_pa_pwr_thread.Abort();
                }*/
                //Undo FM Offsets
                if (radio.GetDSPTX(0).CurrentDSPMode == DSPMode.FM && current_fm_tx_mode != FMTXMode.Simplex
                    && !chkVFOSplit.Checked)
                {
                    switch (current_fm_tx_mode)
                    {
                        case FMTXMode.Low:
                            if (!chkFMTXRev.Checked)
                                TXFreq += fm_tx_offset_mhz; // usual case
                            else
                                TXFreq -= fm_tx_offset_mhz;
                            break;
                        case FMTXMode.High:
                            if (!chkFMTXRev.Checked)
                                TXFreq -= fm_tx_offset_mhz; // usual case
                            else
                                TXFreq += fm_tx_offset_mhz;
                            break;
                    }
                }
            }

            if (!full_duplex)
            {
                if (tx)
                {
                  /*  if (attontx)
                    {
                        RX1PreampMode = PreampMode.HPSDR_OFF;			// set to -20dB
                        update_preamp = true;
                        update_preamp_mode = true;
                    } */

                    if (!hpsdr_duplex_enabled)
                    {
                        if (chkVFOATX.Checked || mute_rx1_on_vfob_tx)
                            DttSP.SetThreadProcessingMode(0, 0);
                        else DttSP.SetThreadProcessingMode(0, 2);
                    }

                    DttSP.FlushAllBufs(0, false);
                    DttSP.FlushAllBufs(1, true);
                    DttSP.SetThreadProcessingMode(1, 2);
                }
            }

            if (tx)
            {
                if (attontx)
                {
                    RX1PreampMode = PreampMode.HPSDR_OFF;			// set to -20dB
                    update_preamp = true;
                    update_preamp_mode = true;
                }
                
                AudioMOXChanged(tx);
                if (rf_delay > 0) Thread.Sleep(rf_delay);
                HdwMOXChanged(tx, freq);
                // AudioMOXChanged(tx);

            }
            else
            {
                switch (radio.GetDSPTX(0).CurrentDSPMode)
                {
                    case DSPMode.CWL:
                    case DSPMode.CWU:
                        Audio.MOX = tx; // switch manually since ramping is already done
                        break;
                    default:
                        if (limit_slew)
                        {
                            Audio.Ramp = true;
                            int audio_buffer = (int)(block_size1 / (double)sample_rate1 * 1e3); // in ms
                            int dsp_buffer = (int)(radio.GetDSPTX(0).BufferSize / (double)sample_rate1 * 1e3); // in ms
                            Thread.Sleep(2 * (audio_buffer + dsp_buffer));
                        }
                        else
                        {
                            Audio.MOX = tx; // switch manually since ramping is already done
                        }
                        break;
                }

                mox = tx;
                AudioMOXChanged(tx);
                if (mox_delay > 0) Thread.Sleep(mox_delay);
                HdwMOXChanged(tx, freq);

                DttSP.SetThreadProcessingMode(1, 0);
                DttSP.FlushAllBufs(1, true);
                if (!hpsdr_duplex_enabled)
                {
                    DttSP.FlushAllBufs(0, false);
                    DttSP.SetThreadProcessingMode(0, 2);
                }
            }

            /*if (tx)
            {
                t1.Stop();
                timer6 += t1.DurationMsec;
                count6++;

                switch (current_model)
                {
                    case Model.FLEX5000:
                    case Model.FLEX3000:
                        if (poll_pa_pwr_thread == null || !poll_pa_pwr_thread.IsAlive)
                        {
                            poll_pa_pwr_thread = new Thread(new ThreadStart(PollFWCPAPWR));
                            poll_pa_pwr_thread.Name = "Poll FWC PA PWR Thread";
                            poll_pa_pwr_thread.Priority = ThreadPriority.BelowNormal;
                            poll_pa_pwr_thread.IsBackground = true;
                            poll_pa_pwr_thread.Start();
                        }
                        break;
                    default:
                        if (pa_present)
                        {
                            if (poll_pa_pwr_thread == null || !poll_pa_pwr_thread.IsAlive)
                            {
                                poll_pa_pwr_thread = new Thread(new ThreadStart(PollPAPWR));
                                poll_pa_pwr_thread.Name = "Poll PA PWR Thread";
                                poll_pa_pwr_thread.Priority = ThreadPriority.BelowNormal;
                                poll_pa_pwr_thread.IsBackground = true;
                                poll_pa_pwr_thread.Start();
                            }
                        }
                        break;
                }
            }*/

            if (!tx)
            {
                pa_fwd_power = 0;
                pa_rev_power = 0;
                //fwd_power = 0;
                //rev_power = 0;
                HighSWR = false;
            }

            if (tx) UIMOXChangedTrue();
            else UIMOXChangedFalse();

            /*if(tx)
            {
                t1.Stop();
                timer7 += t1.DurationMsec;
                count7++;
            }*/

            /*Debug.WriteLine("1:"+(timer1/count1).ToString("f3")+
                " 2:"+(timer2/count2).ToString("f3")+
                " 3:"+(timer3/count3).ToString("f3")+
                " 4:"+(timer4/count4).ToString("f3")+
                " 5:"+(timer5/count5).ToString("f3")+
                " 6:"+(timer6/count6).ToString("f3")+
                " 7:"+(timer7/count7).ToString("f3")+
                " 8:"+(timer8/count8).ToString("f3")+
                " 9:"+(timer9/count9).ToString("f3")+
                " 10:"+(timer10/count10).ToString("f3")+
                " 11:"+(timer11/count11).ToString("f3")+
                " 12:"+(timer12/count12).ToString("f3"));*/
        }
        //private Thread mox_update_thread;

        private void chkMOX_Click(object sender, System.EventArgs e)
        {
            if (chkMOX.Checked)			// because the CheckedChanged event fires first
                manual_mox = true;
            else
            {
                manual_mox = false;
                if (chkTUN.Checked)
                    chkTUN.Checked = false;
            }
        }

        private void comboMeterRXMode_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            if (comboMeterRXMode.Items.Count == 0 ||
                comboMeterRXMode.SelectedIndex < 0)
            {
                current_meter_rx_mode = MeterRXMode.FIRST;
            }
            else
            {
                MeterRXMode mode = MeterRXMode.FIRST;
                switch (comboMeterRXMode.Text)
                {
                    case "Signal":
                        mode = MeterRXMode.SIGNAL_STRENGTH;
                        break;
                    case "Sig Avg":
                        multimeter_avg = Display.CLEAR_FLAG;
                        mode = MeterRXMode.SIGNAL_AVERAGE;
                        break;
                    case "ADC L":
                        mode = MeterRXMode.ADC_L;
                        break;
                    case "ADC R":
                        mode = MeterRXMode.ADC_R;
                        break;
                    case "ADC2 L":
                        mode = MeterRXMode.ADC2_L;
                        break;
                    case "ADC2 R":
                        mode = MeterRXMode.ADC2_R;
                        break;
                    case "Off":
                        mode = MeterRXMode.OFF;
                        break;
                }
                current_meter_rx_mode = mode;

                if (!mox)
                {
                    switch (mode)
                    {
                        case MeterRXMode.SIGNAL_STRENGTH:
                        case MeterRXMode.SIGNAL_AVERAGE:
                            lblMultiSMeter.Text = "  1   3   5   7   9  +20 +40 +60";
                            break;
                        case MeterRXMode.ADC_L:
                        case MeterRXMode.ADC_R:
                            lblMultiSMeter.Text = "-100  -80   -60   -40   -20    0";
                            break;
                        case MeterRXMode.OFF:
                            lblMultiSMeter.Text = "";
                            break;
                    }
                    ResetMultiMeterPeak();
                }
            }

            picMultiMeterDigital.Invalidate();

            if (comboMeterRXMode.Focused)
                btnHidden.Focus();
        }

        private void comboMeterTXMode_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            MeterTXMode mode = MeterTXMode.FIRST;
            if (comboMeterTXMode.Items.Count == 0 ||
                comboMeterTXMode.SelectedIndex < 0)
            {
                //current_meter_tx_mode = MeterTXMode.FIRST;
            }
            else
            {
                switch (comboMeterTXMode.Text)
                {
                    case "Fwd Pwr":
                        mode = MeterTXMode.FORWARD_POWER;
                        break;
                    case "Ref Pwr":
                        mode = MeterTXMode.REVERSE_POWER;
                        break;
                    case "Mic":
                        mode = MeterTXMode.MIC;
                        break;
                    case "EQ":
                        mode = MeterTXMode.EQ;
                        break;
                    case "Leveler":
                        mode = MeterTXMode.LEVELER;
                        break;
                    case "Lev Gain":
                        mode = MeterTXMode.LVL_G;
                        break;
                    case "CPDR":
                        mode = MeterTXMode.CPDR;
                        break;
                    case "ALC":
                        mode = MeterTXMode.ALC;
                        break;
                    case "ALC Comp":
                        mode = MeterTXMode.ALC_G;
                        break;
                    case "SWR":
                        mode = MeterTXMode.SWR;
                        break;
                    case "Off":
                        mode = MeterTXMode.OFF;
                        break;
                }

                if (chkTUN.Checked)
                {
                    tune_meter_tx_mode = mode;
                    if (SetupForm != null) SetupForm.TuneMeterTXMode = mode;
                }
                current_meter_tx_mode = mode;
            }

            if (mox)
            {
                switch (mode)
                {
                    case MeterTXMode.FIRST:
                        lblMultiSMeter.Text = "";
                        break;
                    case MeterTXMode.MIC:
                    case MeterTXMode.EQ:
                    case MeterTXMode.LEVELER:
                    case MeterTXMode.CPDR:
                    case MeterTXMode.ALC:
                        lblMultiSMeter.Text = "-20    -10     -5      0   1   2   3";
                        break;
                    case MeterTXMode.FORWARD_POWER:
                    case MeterTXMode.REVERSE_POWER:
                        if (alexpresent || pa_present || (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)))
                            lblMultiSMeter.Text = "1      5     10    50   100  120+";
                        else
                            lblMultiSMeter.Text = "0      0.1     0.2     0.5        1.0";
                        break;
                    case MeterTXMode.SWR:
                        lblMultiSMeter.Text = "1      1.5   2     3     5    10";
                        lblMultiSMeter.Text = "0             10              20";
                        break;
                    case MeterTXMode.OFF:
                        lblMultiSMeter.Text = "";
                        break;
                    case MeterTXMode.LVL_G:
                    case MeterTXMode.ALC_G:
                        lblMultiSMeter.Text = "0       5       10      15      20";
                        break;
                }
                ResetMultiMeterPeak();
            }

            picMultiMeterDigital.Invalidate();

            if (comboMeterTXMode.Focused)
                btnHidden.Focus();
        }

        private void chkDisplayAVG_CheckedChanged(object sender, System.EventArgs e)
        {
            Display.AverageOn = chkDisplayAVG.Checked;
            if (chkDisplayAVG.Checked)
            {
                chkDisplayAVG.BackColor = button_selected_color;
            }
            else
            {
                chkDisplayAVG.BackColor = SystemColors.Control;
            }

            if (chkDisplayAVG.Checked)
            {
                switch (Display.CurrentDisplayMode)
                {
                    case DisplayMode.PANADAPTER:
                    case DisplayMode.HISTOGRAM:
                    case DisplayMode.SPECTRUM:
                    case DisplayMode.WATERFALL:
                    case DisplayMode.PANAFALL:
                    case DisplayMode.PANASCOPE:
                    case DisplayMode.SPECTRASCOPE:
                        btnZeroBeat.Enabled = true; // only allow zerobeat when avg is on 
                        break;
                    default:
                        btnZeroBeat.Enabled = false;
                        break;
                }
            }
            else btnZeroBeat.Enabled = false;
        }

        private void chkDisplayPeak_CheckedChanged(object sender, System.EventArgs e)
        {
            Display.PeakOn = chkDisplayPeak.Checked;
            if (chkDisplayPeak.Checked)
            {
                chkDisplayPeak.BackColor = button_selected_color;
            }
            else
            {
                chkDisplayPeak.BackColor = SystemColors.Control;
            }
        }

        private void chkSquelch_CheckedChanged(object sender, System.EventArgs e)
        {
            if (rx1_dsp_mode == DSPMode.FM && !chkSquelch.Checked)
                chkSquelch.Checked = true;

            radio.GetDSPRX(0, 0).RXSquelchOn = chkSquelch.Checked;
            radio.GetDSPRX(0, 1).RXSquelchOn = chkSquelch.Checked;
        }

        private MeterTXMode old_tune_meter_tx_mode;
        private void chkTUN_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkTUN.Checked)
            {
                if (!PowerOn)
                {
                    MessageBox.Show("Power must be on to turn on the Tune function.",
                        "Power is off",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Hand);
                    chkTUN.Checked = false;
                    return;
                }

                if (chkNoiseGate.Checked)
                    radio.GetDSPTX(0).TXSquelchOn = false;

                tuning = true;
                chkTUN.BackColor = button_selected_color;

                if (current_meter_tx_mode != tune_meter_tx_mode)
                {
                    old_tune_meter_tx_mode = current_meter_tx_mode;
                    CurrentMeterTXMode = tune_meter_tx_mode;
                    comboMeterTXMode_SelectedIndexChanged(this, EventArgs.Empty);
                }

                switch (Audio.TXDSPMode)
                {
                    case DSPMode.USB:
                    case DSPMode.CWU:
                    case DSPMode.DIGU:
                        Audio.SineFreq1 = cw_pitch;
                        DttSP.SetTXFilter(1, cw_pitch - 100, cw_pitch + 100);
                        Audio.TXInputSignal = Audio.SignalSource.SINE;
                        Audio.SourceScale = 1.0;
                        break;
                    case DSPMode.LSB:
                    case DSPMode.CWL:
                    case DSPMode.DIGL:
                        Audio.SineFreq1 = cw_pitch;
                        DttSP.SetTXFilter(1, -cw_pitch - 100, -cw_pitch + 100);
                        Audio.TXInputSignal = Audio.SignalSource.SINE;
                        Audio.SourceScale = 1.0;
                        break;
                    case DSPMode.DSB:
                        Audio.SineFreq1 = cw_pitch;
                        DttSP.SetTXFilter(1, cw_pitch - 100, cw_pitch + 100);
                        Audio.TXInputSignal = Audio.SignalSource.SINE;
                        Audio.SourceScale = 1.0;
                        break;
                    case DSPMode.AM:
                    case DSPMode.SAM:
                    case DSPMode.FM:
                        Audio.SineFreq1 = cw_pitch;
                        DttSP.SetTXFilter(1, cw_pitch - 100, cw_pitch + 100);
                        Audio.TXInputSignal = Audio.SignalSource.SINE;
                        Audio.SourceScale = 1.0;
                        break;
                }

                DttSP.SetMode(1, 0, DSPMode.DIGU);

                PreviousPWR = ptbPWR.Value;
                if (!xvtr_tune_power || tx_xvtr_index < 0)
                    PWR = tune_power;

                if (!chkVFOSplit.Checked && !chkVFOBTX.Checked)
                {
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                }
                else
                {
                    if (chkVFOBTX.Checked)
                        txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                    else // split is on
                    {
                        if (!chkRX2.Checked)
                            txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                        else
                            txtVFOABand_LostFocus(this, EventArgs.Empty);
                    }
                }

                chkMOX.Checked = true;
                if (!mox)
                {
                    chkTUN.Checked = false;
                    return;
                }
                current_ptt_mode = PTTMode.MANUAL;

                switch (Audio.TXDSPMode)
                {
                    case DSPMode.CWL:
                    case DSPMode.CWU:
                        Audio.CurrentAudioState1 = Audio.AudioState.DTTSP;
                        Audio.TXDSPMode = DSPMode.DIGU;
                        break;
                }

                if (HPSDRisMetis)
                {
                    JanusAudio.SetUserOut0(1);
                    JanusAudio.SetUserOut2(1);
                }

                if (atu_present && tx_band != Band.B2M &&
                    (ATUTuneMode)comboTuneMode.SelectedIndex != ATUTuneMode.BYPASS)
                {
                    chkTUN.Enabled = false;
                    comboTuneMode.Enabled = false;

                    Thread t = new Thread(new ThreadStart(Tune));
                    t.IsBackground = true;
                    t.Priority = ThreadPriority.Normal;
                    t.Name = "TUN Thread";
                    t.Start();
                }
                return;
            }
            else
            {
                //Audio.SourceScale = 0.0000001;
                //Audio.TXInputSignal = Audio.SignalSource.SILENCE;
                //Thread.Sleep(200);
                Audio.TXInputSignal = Audio.SignalSource.RADIO;
                Thread.Sleep(50);
                // Hdw.TUNControl = true;
                chkMOX.Checked = false;
                chkTUN.BackColor = SystemColors.Control;
                tuning = false;

                if (!chkVFOSplit.Checked && !chkVFOBTX.Checked)
                {
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                }
                else
                {
                    if (chkVFOBTX.Checked)
                        txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                    else // split is on
                    {
                        if (!chkRX2.Checked)
                            txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                        else
                            txtVFOABand_LostFocus(this, EventArgs.Empty);
                    }
                }

                /*if(!(atu_present && tx_band != Band.B2M &&
                    (ATUTuneMode)comboTuneMode.SelectedIndex != ATUTuneMode.BYPASS))
                {
                    if(tx_xvtr_index >= 0 && xvtr_tune_power)
                    {
                        // do not do anything
                    }
                    else
                    {
                        if(rx1_dsp_mode == DSPMode.FM)
                            TunePower = (int)(ptbPWR.Value*2.5);
                        else TunePower = ptbPWR.Value;
                    }
                }*/

                if (!(atu_present && tx_band != Band.B2M &&
                     (ATUTuneMode)comboTuneMode.SelectedIndex != ATUTuneMode.BYPASS))
                {
                    if (tx_xvtr_index < 0 || xvtr_tune_power)
                        TunePower = ptbPWR.Value;
                }

                PWR = PreviousPWR;
                //DttSP.SetMode(1, 0, rx1_dsp_mode);
                //DSPMode mode = rx1_dsp_mode;
                DSPMode mode = radio.GetDSPTX(0).CurrentDSPMode;
                DttSP.SetMode(1, 0, mode);
                //if (chkVFOBTX.Checked) mode = rx2_dsp_mode;
                switch (mode)
                {
                    case DSPMode.AM:
                    case DSPMode.SAM:
                    case DSPMode.FM:
                        Audio.SineFreq1 = cw_pitch;
                        break;
                    case DSPMode.CWL:
                    case DSPMode.CWU:
                        Audio.TXDSPMode = mode;
                        break;
                }
                DttSP.SetTXFilter(1, radio.GetDSPTX(0).TXFilterLow, radio.GetDSPTX(0).TXFilterHigh);

                if (tune_meter_tx_mode != old_tune_meter_tx_mode)
                    CurrentMeterTXMode = old_tune_meter_tx_mode;

                if (chkNoiseGate.Checked)
                    radio.GetDSPTX(0).TXSquelchOn = true;

                if (HPSDRisMetis)
                {
                    JanusAudio.SetUserOut0(0);
                    JanusAudio.SetUserOut2(0);
                }
            }
        }

        private void comboTuneMode_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            if (atu_present)
            {
                if (comboTuneMode.SelectedIndex == (int)ATUTuneMode.BYPASS)
                {
                    if (current_model == Model.SDR1000)
                        Hdw.PA_ATUTune(ATUTuneMode.BYPASS);
                    tuned_band = Band.FIRST;
                    if (chkTUN.BackColor == button_selected_color)
                        chkTUN.BackColor = SystemColors.Control;
                }
            }

            if (comboTuneMode.Focused)
                btnHidden.Focus();
        }

        private void HideFocus(object sender, EventArgs e)
        {
            btnHidden.Focus();
        }

        private void chkVFOLock_CheckedChanged(object sender, System.EventArgs e)
        {
            VFOLock = chkVFOLock.Checked;
            if (chkVFOLock.Checked)
                chkVFOLock.BackColor = button_selected_color;
            else
                chkVFOLock.BackColor = SystemColors.Control;
        }

        private void btnBandVHF_Click(object sender, System.EventArgs e)
        {
            panelBandVHF.Visible = true;
            panelBandHF.Visible = false;
            whatisVHF = true;
            whatisHF = false;
 
            {
                if (this.collapsedDisplay)
                    this.CollapseDisplay();
            }
        }

        private void btnBandHF_Click(object sender, System.EventArgs e)
        {
            panelBandHF.Visible = true;
            panelBandVHF.Visible = false;
            whatisVHF = false;
            whatisHF = true;
  
            {
                if (this.collapsedDisplay)
                   this.CollapseDisplay();
            }
        }

        private void udFilterLow_LostFocus(object sender, EventArgs e)
        {
            udFilterLow_ValueChanged(sender, e);
        }

        private void udFilterHigh_LostFocus(object sender, EventArgs e)
        {
            udFilterHigh_ValueChanged(sender, e);
        }

        private void udRIT_LostFocus(object sender, EventArgs e)
        {
            udRIT_ValueChanged(sender, e);
        }

        private void udXIT_LostFocus(object sender, EventArgs e)
        {
            udXIT_ValueChanged(sender, e);
        }

        private void DateTime_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            if (current_datetime_mode + 1 == DateTimeMode.LAST)
                CurrentDateTimeMode = DateTimeMode.OFF;
            else CurrentDateTimeMode = current_datetime_mode + 1;
        }

        private void chkSR_CheckedChanged(object sender, System.EventArgs e)
        {
            //if (SetupForm != null) SetupForm.SpurReduction = chkSR.Checked;
            // if (chkEnableMultiRX.Checked) txtVFOBFreq_LostFocus(this, EventArgs.Empty);
            //  if (chkSR.Checked) chkSR.BackColor = button_selected_color;
            // else chkSR.BackColor = SystemColors.Control;
            if (SetupForm != null)
            {
                if (chkSR.Checked) SetupForm.radAlexAutoCntl.Checked = true;
                else SetupForm.radAlexManualCntl.Checked = true;
            }
        }

        private void btnChangeTuneStepSmaller_Click(object sender, System.EventArgs e)
        {
            ChangeTuneStepDown();
        }

        private void btnChangeTuneStepLarger_Click(object sender, System.EventArgs e)
        {
            ChangeTuneStepUp();
        }

        private void comboTXProfile_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            if (SetupForm == null || initializing) return;
            SetupForm.TXProfile = comboTXProfile.Text;

            if (comboDigTXProfile.Text != comboTXProfile.Text)
                comboDigTXProfile.Text = comboTXProfile.Text;

            if (comboFMTXProfile.Text != comboTXProfile.Text)
                comboFMTXProfile.Text = comboTXProfile.Text;

            UpdateDisplay();

            if (comboTXProfile.Focused) btnHidden.Focus();
        }

        private void comboDigTXProfile_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            if (SetupForm == null || initializing) return;
            SetupForm.TXProfile = comboDigTXProfile.Text;

            if (comboTXProfile.Text != comboDigTXProfile.Text)
                comboTXProfile.Text = comboDigTXProfile.Text;

            if (comboFMTXProfile.Text != comboTXProfile.Text)
                comboFMTXProfile.Text = comboTXProfile.Text;

            UpdateDisplay();

            if (comboDigTXProfile.Focused) btnHidden.Focus();
        }

        private void comboFMTXProfile_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (SetupForm == null || initializing) return;
            SetupForm.TXProfile = comboFMTXProfile.Text;

            if (comboTXProfile.Text != comboDigTXProfile.Text)
                comboTXProfile.Text = comboDigTXProfile.Text;

            if (comboDigTXProfile.Text != comboTXProfile.Text)
                comboDigTXProfile.Text = comboTXProfile.Text;

            UpdateDisplay();

            if (comboFMTXProfile.Focused) btnHidden.Focus();
        }

        private void chkShowTXFilter_CheckedChanged(object sender, System.EventArgs e)
        {
            Display.DrawTXFilter = chkShowTXFilter.Checked;
        }

        private void mnuFilterReset_Click(object sender, System.EventArgs e)
        {
            DialogResult dr = MessageBox.Show(
                "Are you sure you want to reset all RX1 custom filter settings to the default?",
                "Reset Filters?",
                MessageBoxButtons.YesNo,
                MessageBoxIcon.Question);

            if (dr == DialogResult.No) return;

            InitFilterPresets(rx1_filters);

            radFilter1.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F1);
            radFilter2.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F2);
            radFilter3.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F3);
            radFilter4.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F4);
            radFilter5.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F5);
            radFilter6.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F6);
            radFilter7.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F7);
            radFilter8.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F8);
            radFilter9.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F9);
            radFilter10.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F10);
            radFilterVar1.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.VAR1);
            radFilterVar2.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.VAR2);
            RX1Filter = rx1_filter;

            if (filterRX1Form != null && !filterRX1Form.IsDisposed)
            {
                filterRX1Form.DSPMode = rx1_dsp_mode;
            }
        }

        private void menuItemRX2FilterReset_Click(object sender, System.EventArgs e)
        {
            DialogResult dr = MessageBox.Show(
                "Are you sure you want to reset all RX2 custom filter settings to the default?",
                "Reset Filters?",
                MessageBoxButtons.YesNo,
                MessageBoxIcon.Question);

            if (dr == DialogResult.No) return;

            InitFilterPresets(rx2_filters);

            radRX2Filter1.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F1);
            radRX2Filter2.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F2);
            radRX2Filter3.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F3);
            radRX2Filter4.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F4);
            radRX2Filter5.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F5);
            radRX2Filter6.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F6);
            radRX2Filter7.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F7);
            radRX2FilterVar1.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.VAR1);
            radRX2FilterVar2.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.VAR2);
            RX2Filter = rx2_filter;

            if (filterRX2Form != null && !filterRX2Form.IsDisposed)
            {
                filterRX2Form.DSPMode = rx2_dsp_mode;
            }
        }

        private void chkVACStereo_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.VACStereo = chkVACStereo.Checked;
        }

        private void chkCWVAC_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.VACEnable = chkCWVAC.Checked;
            if (chkCWVAC.Checked) chkCWVAC.BackColor = button_selected_color;
            else chkCWVAC.BackColor = SystemColors.Control;
        }

        private void chkCWVACIQ_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.VACIQEnable = chkCWVACIQ.Checked;
        }

        private void chkCWIambic_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.CWIambic = chkCWIambic.Checked;
        }

        private void chkCWSidetone_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.CWDisableMonitor = chkCWSidetone.Checked;
        }

        private void udCWPitch_ValueChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.CWPitch = (int)udCWPitch.Value;
            if (udCWPitch.Focused) btnHidden.Focus();
        }

        private void comboVACSampleRate_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.VACSampleRate = comboVACSampleRate.Text;
            if (comboVACSampleRate.Focused) btnHidden.Focus();
        }

        private void chkX2TR_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.X2TR = chkX2TR.Checked;

            if (chkX2TR.Checked) chkX2TR.BackColor = button_selected_color;
            else chkX2TR.BackColor = SystemColors.Control;
        }

        private void chkShowTXCWFreq_CheckedChanged(object sender, System.EventArgs e)
        {
            Display.DrawTXCWFreq = chkShowTXCWFreq.Checked;
        }

        private void chkShowCWZero_CheckedChanged(object sender, System.EventArgs e)
        {
            Display.ShowCWZeroLine = chkShowCWZero.Checked;
        }

        private void chkCWBreakInEnabled_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.BreakInEnabled = chkCWBreakInEnabled.Checked;
            if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                FWC.SetBreakIn(chkCWBreakInEnabled.Checked);
        }

        private void udCWBreakInDelay_ValueChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.BreakInDelay = (int)udCWBreakInDelay.Value;
            if (udCWBreakInDelay.Focused)
                btnHidden.Focus();
        }

        private void udCWBreakInDelay_LostFocus(object sender, System.EventArgs e)
        {
            udCWBreakInDelay_ValueChanged(sender, e);
        }

        private void chkPhoneVAC_CheckedChanged(object sender, System.EventArgs e)
        {
            if (SetupForm != null) SetupForm.VACEnable = chkPhoneVAC.Checked;
            if (chkPhoneVAC.Checked) chkPhoneVAC.BackColor = button_selected_color;
            else chkPhoneVAC.BackColor = SystemColors.Control;
        }

        private void chkRXEQ_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkRXEQ.Checked) chkRXEQ.BackColor = button_selected_color;
            else chkRXEQ.BackColor = SystemColors.Control;
            if (EQForm != null) EQForm.RXEQEnabled = chkRXEQ.Checked;
        }

        private void chkTXEQ_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkTXEQ.Checked) chkTXEQ.BackColor = button_selected_color;
            else chkTXEQ.BackColor = SystemColors.Control;
            if (EQForm != null) EQForm.TXEQEnabled = chkTXEQ.Checked;
        }

        private void chkBCI_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkBCI.Checked)
                chkBCI.BackColor = button_selected_color;
            else
                chkBCI.BackColor = SystemColors.Control;
            SetHWFilters(dds_freq);
        }

        public bool CheckForTXCW()
        {
            if (!cw_semi_break_in_enabled) return false;
            DSPMode tx_mode = rx1_dsp_mode;
            if (chkVFOBTX.Checked && chkRX2.Checked) tx_mode = rx2_dsp_mode;

            bool ret_val = false;

            switch (tx_mode)
            {
                case DSPMode.CWL:
                case DSPMode.CWU:
                    ret_val = true;
                    break;
                default:
                    ret_val = false;
                    break;
            }

            return ret_val;
        }

        #endregion

        #region VFO Events

        private enum TuneLocation
        {
            VFOA = 0,
            VFOB,
            VFOASub,
            DisplayBottom,
            Other,
        }

        private TuneLocation TuneHitTest(int x, int y)
        {
            int left, right, top, bottom;
            left = grpVFOA.Left + txtVFOAFreq.Left;
            right = left + txtVFOAFreq.Width;
            top = grpVFOA.Top + txtVFOAFreq.Top;
            bottom = top + txtVFOAFreq.Height;
            if (x > left && x < right && y > top && y < bottom)
                return TuneLocation.VFOA;

            left = grpVFOB.Left + txtVFOBFreq.Left;
            right = left + txtVFOBFreq.Width;
            top = grpVFOB.Top + txtVFOBFreq.Top;
            bottom = top + txtVFOBFreq.Height;
            if (x > left && x < right && y > top && y < bottom)
                return TuneLocation.VFOB;

            left = grpVFOA.Left + txtVFOABand.Left;
            right = left + txtVFOABand.Width;
            top = grpVFOA.Top + txtVFOABand.Top;
            bottom = top + txtVFOABand.Height;
            if (x > left && x < right && y > top && y < bottom)
                return TuneLocation.VFOASub;

            left = panelDisplay.Left + picDisplay.Left;
            right = left + picDisplay.Width;
            top = panelDisplay.Top + picDisplay.Top + picDisplay.Height / 2;
            bottom = top + picDisplay.Height / 2;
            if (x > left && x < right && y > top && y < bottom)
                return TuneLocation.DisplayBottom;

            return TuneLocation.Other;
        }

        private void Console_MouseWheel(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            //			if(this.ActiveControl is TextBoxTS && this.ActiveControl != txtVFOAFreq
            //				&& this.ActiveControl != txtVFOBFreq) return;
            //			if(this.ActiveControl is NumericUpDownTS) return;
            if (this.ActiveControl is TextBoxTS ||
                this.ActiveControl is NumericUpDownTS ||
                this.ActiveControl is TrackBarTS)
            {
                Console_KeyPress(this, new KeyPressEventArgs((char)Keys.Enter));
                return;
            }

            if (e.Delta == 0) return;

            int num_steps = (e.Delta > 0 ? 1 : -1);	// 1 per click
            //int numberToMove = e.Delta / 120;	// 1 per click

            if (vfo_char_width == 0)
                GetVFOCharWidth();

            if (num_steps == 0) return;
            int step = CurrentTuneStepHz;
            if (shift_down && step >= 10) step /= 10;

            switch (TuneHitTest(e.X, e.Y))
            {
                case TuneLocation.VFOA:
                    double freq = double.Parse(txtVFOAFreq.Text);
                    double mult = 1000.0;
                    int right = grpVFOA.Left + txtVFOAFreq.Left + txtVFOAFreq.Width;
                    if (vfoa_hover_digit < 0)
                    {
                        int x = right + 2 - (vfo_pixel_offset - 5);
                        while (x < e.X && mult > 0.0000011)
                        {
                            mult /= 10.0;
                            x += vfo_char_width;
                            if (mult == 1.0)
                                x += vfo_decimal_space;
                            else x += vfo_char_space;
                        }
                    }
                    else
                    {
                        mult = Math.Pow(10, -vfoa_hover_digit) * 1000.0;
                    }

                    if (mult <= 1.0)
                    {
                        freq += mult * num_steps;
                        //Debug.WriteLine("freq: "+freq.ToString("f6"));
                        VFOAFreq = freq;
                    }
                    break;

                case TuneLocation.VFOB:
                    freq = double.Parse(txtVFOBFreq.Text);
                    mult = 1000.0;
                    right = grpVFOB.Left + txtVFOBFreq.Left + txtVFOBFreq.Width;
                    if (vfob_hover_digit < 0)
                    {
                        int x = right + 2 - (vfo_pixel_offset - 5);
                        while (x < e.X && mult > 0.0000011)
                        {
                            mult /= 10;
                            x += vfo_char_width;
                            if (mult == 1.0)
                                x += vfo_decimal_space;
                            else x += vfo_char_space;
                        }
                    }
                    else
                    {
                        mult = Math.Pow(10, -vfob_hover_digit) * 1000.0;
                    }

                    if (mult <= 1.0)
                    {
                        freq += mult * num_steps;
                        VFOBFreq = freq;
                    }
                    break;

                case TuneLocation.VFOASub:
                    if (rx2_enabled && (chkEnableMultiRX.Checked || chkVFOSplit.Checked))
                    {
                        freq = VFOASubFreq;
                        mult = 1000.0;
                        right = grpVFOA.Left + txtVFOABand.Left + txtVFOABand.Width;
                        if (vfoa_sub_hover_digit < 0)
                        {
                            int x = right + 2 - (vfo_sub_pixel_offset - 5);
                            while (x < e.X && mult > 0.0000011)
                            {
                                mult /= 10;
                                x += vfo_sub_char_width;
                                if (mult == 1.0)
                                    x += vfo_sub_decimal_space;
                                else x += vfo_sub_char_space;
                            }
                        }
                        else
                        {
                            mult = Math.Pow(10, -vfoa_sub_hover_digit) * 1000.0;
                        }

                        if (mult <= 1.0)
                        {
                            freq += mult * num_steps;
                            VFOASubFreq = freq;
                        }
                    }
                    else
                    {
                        VFOAFreq = SnapTune(VFOAFreq, step, num_steps);
                    }
                    break;

                case TuneLocation.DisplayBottom:
                    if (rx2_enabled && chkVFOSplit.Checked && current_click_tune_mode == ClickTuneMode.VFOB && wheel_tunes_vfob)
                        VFOASubFreq = SnapTune(VFOASubFreq, step, num_steps);
                    else if (rx2_enabled || (current_click_tune_mode == ClickTuneMode.VFOB && wheel_tunes_vfob))
                        VFOBFreq = SnapTune(VFOBFreq, step, num_steps);
                    else
                        VFOAFreq = SnapTune(VFOAFreq, step, num_steps);
                    break;

                case TuneLocation.Other:
                    if (current_click_tune_mode == ClickTuneMode.VFOB && wheel_tunes_vfob)
                    {
                        if (rx2_enabled && chkVFOSplit.Checked)
                            VFOASubFreq = SnapTune(VFOASubFreq, step, num_steps);
                        else
                            VFOBFreq = SnapTune(VFOBFreq, step, num_steps);
                    }
                    else VFOAFreq = SnapTune(VFOAFreq, step, num_steps);
                    break;
            }
        }

        /// <summary>
        /// Calculates a "Snapped" frequency that lies on an integer multiple of the Tune Step.
        /// </summary>
        /// <param name="freq_mhz">The starting frequency in MHz</param>
        /// <param name="step_size_hz">The selected step size in Hz</param>
        /// <param name="num_steps">Indicates both the number and direction of steps.  Negative
        /// numbers indicate steps down while positive numbers indicate steps up.</param>
        /// <returns>The adjusted frequency in MHz</returns>
        public double SnapTune(double freq_mhz, int step_size_hz, int num_steps)
        {
            long freq_hz = (long)Math.Round(freq_mhz * 1e6); // convert frequency to Hz -- use long to support >4GHz
            long temp = freq_hz / step_size_hz; // do integer division to end up on a step size boundary

            // handle when starting frequency was already on a step size boundary and tuning down
            if (num_steps < 0 && freq_hz % step_size_hz != 0)
                num_steps++; // off boundary -- add one as the divide takes care of one step

            temp += num_steps; // increment by the number of steps (positive or negative

            freq_hz = temp * step_size_hz; // multiply back up to get hz
            return Math.Round(freq_hz * 1e-6, 6); // return freq in MHz
        }

        private void txtVFOAFreq_LostFocus(object sender, System.EventArgs e)
        {
            if (txtVFOAFreq.Text == "." || txtVFOAFreq.Text == "")
            {
                VFOAFreq = saved_vfoa_freq;
                return;
            }

            double freq = double.Parse(txtVFOAFreq.Text);
            //txtVFOAFreq.Text = freq.ToString("f6");
            UpdateVFOAFreq(freq.ToString("f6"));
            Display.VFOA = (long)(freq * 1e6);
            if (chkTUN.Checked &&  !hpsdr_duplex_enabled && chkVFOATX.Checked && !chkVFOSplit.Checked)
            {
                switch (radio.GetDSPTX(0).CurrentDSPMode)
                {
                    case DSPMode.CWL:
                    case DSPMode.LSB:
                    case DSPMode.DIGL:
                        Display.VFOA += cw_pitch;
                        break;
                    case DSPMode.CWU:
                    case DSPMode.USB:
                    case DSPMode.DIGU:
                    case DSPMode.AM:
                    case DSPMode.SAM:
                    case DSPMode.FM:
                    case DSPMode.DSB:
                        if (RX1IsOn60mChannel())
                            Display.VFOA -= (long)((ModeFreqOffset(rx1_dsp_mode) * 1e6) + cw_pitch);
                        else
                            Display.VFOA -= cw_pitch;
                        break;
                }
            }

            /*if(fwc_init && current_model == Model.FLEX5000)
            {
                if(freq < 2.0)
                {
                    if(comboPreamp.Enabled) comboPreamp.Enabled = false;
                    if(comboPreamp.Text != "Off") comboPreamp.Text = "Off";
                }
                else if(freq >= 28.0 && current_xvtr_index < 0)
                {
                    if(comboPreamp.Enabled) comboPreamp.Enabled = false;
                    if(comboPreamp.Text != "On") comboPreamp.Text = "On";
                }
                else if(!comboPreamp.Enabled) comboPreamp.Enabled = true;
            }*/

            int last_rx1_xvtr_index = rx1_xvtr_index;
            int last_tx_xvtr_index = tx_xvtr_index;
            rx1_xvtr_index = XVTRForm.XVTRFreq(freq);

            if (rx1_xvtr_index < 0)
            {
                int old_xvtr_index = XVTRForm.XVTRFreq(saved_vfoa_freq);
                if (old_xvtr_index >= 0 && freq >= max_freq)
                {
                    VFOAFreq = saved_vfoa_freq;
                    return;
                }
                //if(fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000) && last_tx_xvtr_index >= 0)
                //	FWC.SetXVTRActive(false);
                RX1XVTRGainOffset = 0.0f;
                if (last_rx1_xvtr_index >= 0)
                    comboPreamp_SelectedIndexChanged(this, EventArgs.Empty);
            }

            if (!chkVFOSplit.Checked)
                tx_xvtr_index = rx1_xvtr_index;

            if (!mox || (mox && !chkVFOSplit.Checked))
            {
                if (tx_xvtr_index >= 0 && tx_xvtr_index != last_tx_xvtr_index)
                {
                    if (!chkVFOSplit.Checked && (!tuning || xvtr_tune_power))
                    {
                        int power = XVTRForm.GetPower(tx_xvtr_index);
                        if (rx1_dsp_mode == DSPMode.FM) power = (int)(power * 0.4);
                        int old_pwr = ptbPWR.Value;
                        if (power == old_pwr) ptbPWR_Scroll(this, EventArgs.Empty);
                        else PWR = power;

                        if (fwc_init && (current_model == Model.FLEX3000 || current_model == Model.FLEX5000))
                        {
                            FWC.SetXVTRActive(true);
                        }
                    }
                }

                if (rx1_xvtr_index >= 0 && rx1_xvtr_index != last_rx1_xvtr_index)
                {
                    RX1XVTRGainOffset = XVTRForm.GetRXGain(rx1_xvtr_index);
                    SetupForm.RXOnly = XVTRForm.GetRXOnly(rx1_xvtr_index);

                    if (!fwc_init || current_model != Model.FLEX5000)
                    {
                        if (PowerOn)
                            Hdw.X2 = (byte)((Hdw.X2 & 0xF0) | XVTRForm.GetXVTRAddr(rx1_xvtr_index));
                    }
                    else if (fwc_init && (current_model == Model.FLEX3000 || current_model == Model.FLEX5000))
                    {
                        FWC.SetXVTRSplit(XVTRForm.GetXVTRRF(rx1_xvtr_index));
                    }
                }
            }
            // update Band Info
            string bandInfo;
            double db_freq = freq;
            if (RX1IsIn60m()) db_freq -= ModeFreqOffset(rx1_dsp_mode);
            bool transmit_allowed = DB.BandText(db_freq, out bandInfo);
            if (!transmit_allowed)
            {
                txtVFOABand.BackColor = out_of_band_color;
                //if(!chkVFOSplit.Checked && mox && !extended)
                //	chkMOX.Checked = false;
            }
            else txtVFOABand.BackColor = band_background_color;

            if (!(rx2_enabled && (chkEnableMultiRX.Checked || chkVFOSplit.Checked)))
                txtVFOABand.Text = bandInfo;

            Band b = BandByFreq(freq, rx1_xvtr_index, false, current_region);
            if (b != rx1_band)
                SetRX1Band(b);

            Band old_tx_band = tx_band;
            if (!chkVFOSplit.Checked && !chkVFOBTX.Checked)
            {
                b = BandByFreq(freq, tx_xvtr_index, true, current_region);
                if (b != tx_band)
                    SetTXBand(b);
            }

            Band lo_band = Band.FIRST;

            if (chkPower.Checked)
            {
                if (ext_ctrl_enabled)
                    UpdateExtCtrl();

                if (rx1_xvtr_index >= 0)
                {
                    // Fix Penny O/C VHF control Vk4xv
                    lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), rx1_xvtr_index, false, current_region);
                    //lo_band = BandByFreq(XVTRForm.TranslateFreq(VFOAFreq), -1, false, current_region);

                    if (penny_ext_ctrl_enabled)
                        Penny.getPenny().UpdateExtCtrl(lo_band, mox);

                    if (alex_ant_ctrl_enabled)
                        Alex.getAlex().UpdateAlexAntSelection(lo_band, mox);
                }
                else
                {
                    if (penny_ext_ctrl_enabled)
                        Penny.getPenny().UpdateExtCtrl(RX1Band, mox);

                    if (alex_ant_ctrl_enabled)
                        Alex.getAlex().UpdateAlexAntSelection(RX1Band, mox);
                }
            }

            if (tx_band != old_tx_band)
            {
                if (tx_band == Band.B60M)
                {
                    chkXIT.Enabled = false;
                    chkXIT.Checked = false;
                }
                else
                    chkXIT.Enabled = true;
            }

            saved_vfoa_freq = freq;

            if (rx1_xvtr_index >= 0)
                freq = XVTRForm.TranslateFreq(freq);
            else
            {
                if (freq < min_freq)
                {
                    freq = min_freq;
                    UpdateVFOAFreq(freq.ToString("f6"));
                }
                else if (freq > max_freq)
                {
                    freq = max_freq;
                    UpdateVFOAFreq(freq.ToString("f6"));
                }
            }

            //  if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
            //  {
            double rx_freq = freq;
            double tx_freq = freq;

            if (chkRIT.Checked)
                rx_freq += (int)udRIT.Value * 0.000001;

            if (rx_freq < min_freq) rx_freq = min_freq;
            else if (rx_freq > max_freq) rx_freq = max_freq;

            if (chkXIT.Checked)
                tx_freq += (int)udXIT.Value * 0.000001;

            if (tx_freq < min_freq) tx_freq = min_freq;
            else if (tx_freq > max_freq) tx_freq = max_freq;

            if (mox && !chkVFOSplit.Checked && !full_duplex && !chkVFOBTX.Checked)
            {
                if (!CheckValidTXFreq(current_region, tx_freq, radio.GetDSPTX(0).CurrentDSPMode))
                {
                    switch (radio.GetDSPTX(0).CurrentDSPMode)
                    {
                        case DSPMode.CWL:
                        case DSPMode.CWU:
                            MessageBox.Show("The frequency " + tx_freq.ToString("f6") + "MHz is not within the\n" +
                                "Band specifications for your region (" + current_region.ToString() + ").",
                                "Transmit Error: Out Of Band",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);
                            break;
                        default:
                            MessageBox.Show("The frequency " + tx_freq.ToString("f6") + "MHz in combination with your TX filter\n" +
                                "settings [" + Display.TXFilterLow.ToString() + ", " + Display.TXFilterHigh.ToString() + "] are not within the " +
                                "Band specifications for your region (" + current_region.ToString() + ").",
                                "Transmit Error: Out Of Band",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);
                            break;
                    }
                    chkMOX.Checked = false;
                    return;
                }
            }

            if (rx1_dsp_mode == DSPMode.CWL)
            {
                rx_freq += (double)cw_pitch * 0.0000010;
                tx_freq += (double)cw_pitch * 0.0000010;
            }
            else if (rx1_dsp_mode == DSPMode.CWU)
            {
                rx_freq -= (double)cw_pitch * 0.0000010;
                tx_freq -= (double)cw_pitch * 0.0000010;
            }

            switch (RX1DSPMode)
            {
                case DSPMode.AM:
                case DSPMode.SAM:
                case DSPMode.FM:
                case DSPMode.USB:
                case DSPMode.DIGU:
                case DSPMode.DSB:
                    if (chkTUN.Checked)
                    {
                        if (RX1IsOn60mChannel())
                            tx_freq -= (ModeFreqOffset(rx1_dsp_mode) + cw_pitch * 1e-6);
                        else
                            tx_freq -= cw_pitch * 1e-6;
                    }
                    break;
                case DSPMode.LSB:
                case DSPMode.DIGL:
                    if (chkTUN.Checked) tx_freq += cw_pitch * 1e-6;
                    break;
            }

            if (rx_freq < min_freq) rx_freq = min_freq;
            else if (rx_freq > max_freq) rx_freq = max_freq;
            if (tx_freq < min_freq) tx_freq = min_freq;
            else if (tx_freq > max_freq) tx_freq = max_freq;

            if (chkPower.Checked)
            {
                if (Audio.wave_playback)
                {
                    double f = (wave_freq - (VFOAFreq * 1e6) % sample_rate1);
                    if (f > sample_rate1 / 2) f -= sample_rate1;
                    if (f < -sample_rate1 / 2) f += sample_rate1;
                    radio.GetDSPRX(0, 0).RXOsc = f;
                }
                else
                {
                    //  if (!mox || (mox && !full_duplex))
                    // FWCDDSFreq = rx_freq;

                    if (!chkVFOSplit.Checked && !chkFullDuplex.Checked && !rx1_spectrum_drag && !chkVFOBTX.Checked)
                    {
                        tx_dds_freq_mhz = tx_freq;
                        tx_dds_freq_updated = true;
                        UpdateTXDDSFreq();
                    }
                    FWCDDSFreq = rx_freq;

                    if (chkEnableMultiRX.Checked)
                    {
                        int diff;
                        if (rx2_enabled) diff = (int)((VFOASubFreq - VFOAFreq) * 1e6);
                        else diff = (int)((VFOBFreq - VFOAFreq) * 1e6);
                        if (chkRIT.Checked && !mox) diff -= (int)udRIT.Value;
                        int rx2_osc = (int)(radio.GetDSPRX(0, 0).RXOsc - diff);
                        if (rx2_osc > -sample_rate1 / 2 && rx2_osc < sample_rate1 / 2)
                        {
                            radio.GetDSPRX(0, 1).RXOsc = rx2_osc;
                        }
                        else if (chkEnableMultiRX.Checked)
                            chkEnableMultiRX.Checked = false;
                    }

                }
            }
            /*   }
               else
               {
                   if (chkRIT.Checked && !mox)
                       freq += (int)udRIT.Value * 0.000001;
                   else if (chkXIT.Checked && mox && !chkVFOSplit.Checked && !chkVFOBTX.Checked)
                       freq += (int)udXIT.Value * 0.000001;

                   if (freq < min_freq) freq = min_freq;
                   else if (freq > max_freq) freq = max_freq;

                   if (mox && !chkVFOSplit.Checked && !chkVFOBTX.Checked)
                   {
                       if (!CheckValidTXFreq(current_region, freq, radio.GetDSPTX(0).CurrentDSPMode))
                       {
                           switch (radio.GetDSPTX(0).CurrentDSPMode)
                           {
                               case DSPMode.CWL:
                               case DSPMode.CWU:
                                   MessageBox.Show("The frequency " + freq.ToString("f6") + "MHz is not within the\n" +
                                       "Band specifications for your region (" + current_region.ToString() + ").",
                                       "Transmit Error: Out Of Band",
                                       MessageBoxButtons.OK,
                                       MessageBoxIcon.Error);
                                   break;
                               default:
                                   MessageBox.Show("The frequency " + freq.ToString("f6") + "MHz in combination with your TX filter\n" +
                                       "settings [" + Display.TXFilterLow.ToString() + ", " + Display.TXFilterHigh.ToString() + "] are not within the " +
                                       "Band specifications for your region (" + current_region.ToString() + ").",
                                       "Transmit Error: Out Of Band",
                                       MessageBoxButtons.OK,
                                       MessageBoxIcon.Error);
                                   break;
                           }
                           chkMOX.Checked = false;
                           return;
                       }
                   }

                   if (rx1_dsp_mode == DSPMode.CWL)
                       freq += (double)cw_pitch * 0.0000010;
                   else if (rx1_dsp_mode == DSPMode.CWU)
                       freq -= (double)cw_pitch * 0.0000010;

                   switch (RX1DSPMode)
                   {
                       case DSPMode.AM:
                       case DSPMode.SAM:
                       case DSPMode.FM:
                           //if(mox) freq -= 0.011025; //w5wc-1
                           break;
                       case DSPMode.USB:
                       case DSPMode.DIGU:
                           if (chkTUN.Checked) freq -= cw_pitch * 0.0000010;
                           break;
                       case DSPMode.LSB:
                       case DSPMode.DIGL:
                           if (chkTUN.Checked) freq += cw_pitch * 0.0000010;
                           break;
                   }

                   if (freq < min_freq) freq = min_freq;
                   else if (freq > max_freq) freq = max_freq;

                   if (PowerOn)
                   {
                       switch (current_model)
                       {
                           case Model.SDR1000:
                           case Model.HPSDR:
                           case Model.HERMES:
                           case Model.DEMO:
                               if (Audio.wave_playback)
                               {
                                   double f = (wave_freq - (VFOAFreq * 1000000.0) % sample_rate1);
                                   if (f > sample_rate1 / 2) f -= sample_rate1;
                                   if (f < -sample_rate1 / 2) f += sample_rate1;
                                   radio.GetDSPRX(0, 0).RXOsc = f;
                               }
                               else
                               {
                                   if (!mox || (mox && !chkVFOSplit.Checked && !chkVFOBTX.Checked))
                                   {
                                       //if(current_click_tune_mode != ClickTuneMode.VFOA)
                                       DDSFreq = freq;

                                       if (chkEnableMultiRX.Checked)
                                       {
                                           int diff = (int)((VFOBFreq - VFOAFreq) * 1000000.0);
                                           if (chkRIT.Checked && !mox) diff -= (int)udRIT.Value;
                                           int rx2_osc = (int)(radio.GetDSPRX(0, 0).RXOsc - diff);
                                           if (rx2_osc > -sample_rate1 / 2 && rx2_osc < sample_rate1 / 2)
                                           {
                                               radio.GetDSPRX(0, 1).RXOsc = rx2_osc + if_freq;
                                           }
                                           else chkEnableMultiRX.Checked = false;
                                       }
                                   }
                               }
                               break;
                           case Model.SOFTROCK40:
                               if (si570_used)   // modif F8CHK
                                   SI570_update();

   #if true
                               //!!!!drm patch
                               double osc_freq = soft_rock_center_freq * 1000000.0 - freq * 1000000.0;
                               if (rx1_dsp_mode == DSPMode.DRM) // if we're in DRM mode we need to be offset 12khz
                               {
                                   osc_freq = osc_freq + 12000.0;
                                   // System.Console.WriteLine("setting osc_freq: " + osc_freq); 
                               }
                               tuned_freq = freq;
                               //Debug.WriteLine("osc_freq: "+osc_freq.ToString("f6"));
                               radio.GetDSPRX(0, 0).RXOsc = osc_freq;
   #else 
                           //wjtFIXME!  the #else is form kd5tfd's 1.6.3 HPSDR tree 
                           SetSoftRockOscFreqs();
   #endif
                               break;
                       }
                   }
               } */

            if (chkVFOSync.Checked && txtVFOBFreq.Text != txtVFOAFreq.Text)
            {
                txtVFOBFreq.Text = txtVFOAFreq.Text;
                txtVFOBFreq_LostFocus(this, EventArgs.Empty);
            }

            if (small_lsd)
            {
                txtVFOAMSD.Visible = true;
                txtVFOALSD.Visible = true;
            }

            if (Display.PeakOn) Display.ResetRX1DisplayPeak();
            last_rx1_xvtr_index = rx1_xvtr_index;
            last_tx_xvtr_index = tx_xvtr_index;

            UpdateRX1Notches();
        }

#if false 
		//wjtFIXME! -- this code for sr xmit from KD5TFD's 1.6.3 HPSDR tree 
		//kd5tfd fix !!! fix spacing below
                //
                // set tx, rx, and keyer freqs appropriate for a soft rock
                //
                private void SetSoftRockOscFreqs()
                {



                        double freq = double.Parse(txtVFOAFreq.Text);

                        if(rx1_dsp_mode == DSPMode.CWL)
                        {
                                freq += (double)cw_pitch * 0.0000010;
                        }
                        else if(rx1_dsp_mode == DSPMode.CWU)
                        {
                                freq -= (double)cw_pitch * 0.0000010;
                        }

                        if(freq < min_freq) freq = min_freq;
                        else if(freq > max_freq) freq = max_freq;

                        if (chkRIT.Checked )
                        {
                                freq += (int)udRIT.Value * 0.000001;
                        }





                        //!!!!drm patch
                        double osc_freq = soft_rock_center_freq*1000000 - freq*1000000;
                        double tx_freq;
                        //??!! TODO!! KD5TFD - need to add code to split and xit to update tx freq if they are changed
                        if ( chkVFOSplit.Checked )
                        {
                                tx_freq = double.Parse(txtVFOBFreq.Text);
                        }
                        else
                        {
                                tx_freq = double.Parse(txtVFOAFreq.Text);
                        }
                        if ( chkXIT.Checked )
                        {
                                tx_freq += (int)udXIT.Value * 0.000001;
                        }
                        if(rx1_dsp_mode == DSPMode.CWL)
                        {
                                tx_freq += (double)cw_pitch * 0.0000010;
                        }
                        else if(rx1_dsp_mode == DSPMode.CWU)
                        {
                                tx_freq -= (double)cw_pitch * 0.0000010;
                        }

                        double tx_osc_freq = soft_rock_center_freq*1000000 - tx_freq*1000000;
                        tx_osc_freq = -tx_osc_freq;

                        System.Console.WriteLine("freq: " + freq + " tx_freq: " + tx_freq);

                        if ( rx1_dsp_mode  == DSPMode.DRM ) // if we're in DRM mode we need to be offset 12khz
                        {
                                osc_freq = osc_freq + 12000;
                                // System.Console.WriteLine("setting osc_freq: " + osc_freq);
                        }
                        tuned_freq = freq;
                        //Debug.WriteLine("osc_freq: "+osc_freq.ToString("f6"));
                        DttSP.SetOsc(osc_freq);
                        DttSP.SetTXOsc(tx_osc_freq);

                        System.Console.WriteLine("osc_freq: " + osc_freq);
                        System.Console.WriteLine("tx_osc_freq: " + tx_osc_freq);

                        if ( rx1_dsp_mode == DSPMode.CWU || rx1_dsp_mode == DSPMode.CWL )
                        {
                                float keyer_freq = (float)(-tx_osc_freq);
                                switch(rx1_dsp_mode)
                                {
                                        case DSPMode.CWU:
                                                keyer_freq -= CWPitch;
                                                break;

                                        case DSPMode.CWL:
                                                keyer_freq += CWPitch;
                                                break;
                                }
                                DttSP.SetKeyerFreq(keyer_freq);
                                System.Console.WriteLine("keyer_freq: " + keyer_freq);
                        }
                }

#endif

        private static double tuned_freq;
        private void txtVFOAFreq_KeyPress(object sender, System.Windows.Forms.KeyPressEventArgs e)
        {
            string separator = System.Globalization.CultureInfo.CurrentCulture.NumberFormat.NumberDecimalSeparator;
            int KeyCode = (int)e.KeyChar;
            if ((KeyCode < 48 || KeyCode > 57) &&			// numeric keys
                KeyCode != 8 &&								// backspace
                !e.KeyChar.ToString().Equals(separator) &&	// decimal
                KeyCode != 27)								// escape
            {
                e.Handled = true;
            }
            else
            {
                if (e.KeyChar.ToString().Equals(separator))
                {
                    e.Handled = (((TextBoxTS)sender).Text.IndexOf(separator) >= 0);
                }
                else if (KeyCode == 27)
                {
                    VFOAFreq = saved_vfoa_freq;
                    btnHidden.Focus();
                }
            }
            if (e.KeyChar == (char)Keys.Enter)
            {
                txtVFOAFreq_LostFocus(txtVFOAFreq, new System.EventArgs());
                btnHidden.Focus();
            }
        }

        private void txtVFOAFreq_MouseMove(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            if (this.ContainsFocus)
            {
                int old_digit = vfoa_hover_digit;
                int digit_index = 0;
                if (vfo_char_width == 0)
                    GetVFOCharWidth();

                int x = txtVFOAFreq.Width - (vfo_pixel_offset - 5);
                while (x < e.X)
                {
                    digit_index++;

                    if (small_lsd && txtVFOALSD.Visible)
                    {
                        if (digit_index < 6)
                            x += (vfo_char_width + vfo_char_space);
                        else
                            x += (vfo_small_char_width + vfo_small_char_space);

                        if (digit_index == 3)
                            x += (vfo_decimal_space - vfo_char_space);
                        if (digit_index == 6)
                            x += vfo_small_char_width;
                    }
                    else
                    {
                        x += vfo_char_width;
                        if (digit_index == 3)
                            x += vfo_decimal_space;
                        else
                            x += vfo_char_space;
                    }
                }

                if (digit_index < 3) digit_index = -1;
                if (digit_index > 9) digit_index = 9;
                vfoa_hover_digit = digit_index;
                if (vfoa_hover_digit != old_digit)
                    panelVFOAHover.Invalidate();
            }
        }

        private void txtVFOAFreq_MouseLeave(object sender, System.EventArgs e)
        {
            vfoa_hover_digit = -1;
            panelVFOAHover.Invalidate();
        }

        private void txtVFOABand_LostFocus(object sender, System.EventArgs e)
        {
            if (!rx2_enabled || (!chkEnableMultiRX.Checked && !chkVFOSplit.Checked)) return;
            if (txtVFOABand.Text == "." || txtVFOABand.Text == "")
            {
                VFOASubFreq = VFOAFreq;
                return;
            }

            double freq = VFOASubFreq;
            double vfoa = VFOAFreq;

            txtVFOABand.Text = freq.ToString("f6");
            Display.VFOASub = (long)(freq * 1000000.0);
            if (chkTUN.Checked && !hpsdr_duplex_enabled && chkVFOATX.Checked && chkVFOSplit.Checked)
            {
                switch (radio.GetDSPTX(0).CurrentDSPMode)
                {
                    case DSPMode.CWL:
                    case DSPMode.LSB:
                    case DSPMode.DIGL:
                        Display.VFOASub += cw_pitch;
                        break;
                    case DSPMode.CWU:
                    case DSPMode.USB:
                    case DSPMode.DIGU:
                    case DSPMode.AM:
                    case DSPMode.SAM:
                    case DSPMode.FM:
                    case DSPMode.DSB:
                        Display.VFOASub -= cw_pitch;
                        break;
                }
            }
            saved_vfoa_sub_freq = freq;

            //Band b = BandByFreq(freq, tx_xvtr_index, true, current_region);
            //if(chkVFOSplit.Checked)
            //	SetTXBand(b);

            string bandInfo;
            bool transmit_allowed = DB.BandText(freq, out bandInfo);
            if (!CheckValidTXFreq(current_region, freq, radio.GetDSPTX(0).CurrentDSPMode))
            {
                if (chkVFOSplit.Checked && mox && !extended)
                    chkMOX.Checked = false;
            }

            if (chkEnableMultiRX.Checked)
            {
                int diff = (int)((freq - vfoa) * 1000000.0);
                double sub_osc = radio.GetDSPRX(0, 0).RXOsc - diff;

                if (sub_osc < -sample_rate1 / 2)
                {
                    VFOASubFreq = vfoa + (sample_rate1 / 2 + radio.GetDSPRX(0, 0).RXOsc - 1) * 0.0000010;
                    return;
                }
                else if (sub_osc > sample_rate1 / 2)
                {
                    VFOASubFreq = vfoa + (-sample_rate1 / 2 + radio.GetDSPRX(0, 0).RXOsc + 1) * 0.0000010;
                    return;
                }

                if (sub_osc > -sample_rate1 / 2 && sub_osc < sample_rate1 / 2)
                {
                    radio.GetDSPRX(0, 1).RXOsc = sub_osc;
                }

                // if (PowerOn)
                // {
                //   SetupForm.txtRXAnt.Text = sub_osc.ToString();
                //   SetupForm.txtRXOut.Text = VFOASubFreq.ToString();
                // }

                UpdateRX1SubNotches();
            }

            if (chkVFOSplit.Checked)
            {
                tx_xvtr_index = XVTRForm.XVTRFreq(freq);
                Band old_tx_band = tx_band;
                Band b = BandByFreq(freq, tx_xvtr_index, true, current_region);
                if (chkVFOSplit.Checked && old_tx_band != b)
                    SetTXBand(b);

                if (tx_xvtr_index >= 0)
                    freq = XVTRForm.TranslateFreq(freq);

                if (old_tx_band != tx_band)
                {
                    if (tx_band == Band.B60M)
                    {
                        chkXIT.Enabled = false;
                        chkXIT.Checked = false;
                    }
                    else
                        chkXIT.Enabled = true;
                }

                if (chkXIT.Checked)
                    freq += (int)udXIT.Value * 0.000001;

                if (freq < min_freq) freq = min_freq;
                else if (freq > max_freq) freq = max_freq;

                switch (rx1_dsp_mode)
                {
                    case DSPMode.AM:
                    case DSPMode.SAM:
                    case DSPMode.FM:
                    case DSPMode.USB:
                    case DSPMode.DIGU:
                        if (chkTUN.Checked) freq -= (double)cw_pitch * 0.0000010;
                        break;
                    case DSPMode.LSB:
                    case DSPMode.DIGL:
                        if (chkTUN.Checked) freq += (double)cw_pitch * 0.0000010;
                        break;
                    case DSPMode.CWL:
                        freq += (double)cw_pitch * 0.0000010;
                        break;
                    case DSPMode.CWU:
                        freq -= (double)cw_pitch * 0.0000010;
                        break;
                }

                //Debug.WriteLine("freq: "+freq.ToString("f6"));
                if (!rx1_sub_drag)
                {
                    tx_dds_freq_mhz = freq;
                    tx_dds_freq_updated = true;
                    UpdateTXDDSFreq();
                }
                last_tx_xvtr_index = tx_xvtr_index;
            }
        }

        private void txtVFOABand_KeyPress(object sender, System.Windows.Forms.KeyPressEventArgs e)
        {
            if (!rx2_enabled || (!chkEnableMultiRX.Checked && !chkVFOSplit.Checked))
            {
                e.Handled = true;
                return;
            }

            string separator = System.Globalization.CultureInfo.CurrentCulture.NumberFormat.NumberDecimalSeparator;
            int KeyCode = (int)e.KeyChar;
            if ((KeyCode < 48 || KeyCode > 57) &&			// numeric keys
                KeyCode != 8 &&								// backspace
                !e.KeyChar.ToString().Equals(separator) &&	// decimal
                KeyCode != 27)								// escape
            {
                e.Handled = true;
            }
            else
            {
                if (e.KeyChar.ToString().Equals(separator))
                {
                    e.Handled = (((TextBoxTS)sender).Text.IndexOf(separator) >= 0);
                }
                else if (KeyCode == 27)
                {
                    VFOASubFreq = saved_vfoa_sub_freq;
                    btnHidden.Focus();
                }
            }
            if (e.KeyChar == (char)Keys.Enter)
            {
                txtVFOABand_LostFocus(txtVFOABand, new System.EventArgs());
                btnHidden.Focus();
            }
        }

        // txtVFOBFreq
        private void txtVFOBFreq_LostFocus(object sender, System.EventArgs e)
        {
            if (txtVFOBFreq.Text == "" || txtVFOBFreq.Text == ".")
            {
                VFOBFreq = saved_vfob_freq;
                return;
            }

            double freq = double.Parse(txtVFOBFreq.Text);

            if (chkEnableMultiRX.Checked && !rx2_enabled)
            {
                int diff = (int)((VFOBFreq - VFOAFreq) * 1e6);
                double rx2_osc = radio.GetDSPRX(0, 0).RXOsc - diff;

                if (rx2_osc < -sample_rate1 / 2)
                {
                    VFOBFreq = VFOAFreq + (sample_rate1 / 2 + radio.GetDSPRX(0, 0).RXOsc - 1) * 0.0000010;
                    return;
                }
                else if (rx2_osc > sample_rate1 / 2)
                {
                    VFOBFreq = VFOAFreq + (-sample_rate1 / 2 + radio.GetDSPRX(0, 0).RXOsc + 1) * 0.0000010;
                    return;
                }

                if (rx2_osc > -sample_rate1 / 2 && rx2_osc < sample_rate1 / 2)
                {
                    radio.GetDSPRX(0, 1).RXOsc = rx2_osc;
                }

                //  if (PowerOn)
                //  {
                //     SetupForm.txtTXAnt.Text = rx2_osc.ToString();
                //     SetupForm.txtAlexBand.Text = VFOBFreq.ToString();
                //  }

                UpdateRX1SubNotches();
            }

            //txtVFOBFreq.Text = freq.ToString("f6"); 
            UpdateVFOBFreq(freq.ToString("f6"));
            if (rx2_enabled)
            {
                Display.VFOB = (long)(freq * 1e6);
                if (chkTUN.Checked && chkVFOBTX.Checked)
                {
                    switch (radio.GetDSPTX(0).CurrentDSPMode)
                    {
                        case DSPMode.CWL:
                        case DSPMode.LSB:
                        case DSPMode.DIGL:
                            Display.VFOB += cw_pitch;
                            break;
                        case DSPMode.CWU:
                        case DSPMode.USB:
                        case DSPMode.DIGU:
                        case DSPMode.AM:
                        case DSPMode.SAM:
                        case DSPMode.FM:
                        case DSPMode.DSB:
                            Display.VFOB -= cw_pitch;
                            break;
                    }
                }
            }
            else
            {
                Display.VFOASub = (long)(freq * 1e6);
                if (chkTUN.Checked && chkVFOBTX.Checked)
                {
                    switch (radio.GetDSPTX(0).CurrentDSPMode)
                    {
                        case DSPMode.CWL:
                        case DSPMode.LSB:
                        case DSPMode.DIGL:
                            Display.VFOASub += cw_pitch;
                            break;
                        case DSPMode.CWU:
                        case DSPMode.USB:
                        case DSPMode.DIGU:
                        case DSPMode.AM:
                        case DSPMode.SAM:
                        case DSPMode.FM:
                        case DSPMode.DSB:
                            Display.VFOASub -= cw_pitch;
                            break;
                    }
                }
            }

            int xvtr_index = XVTRForm.XVTRFreq(freq);
            if (xvtr_index < 0)
            {
                int old_xvtr_index = XVTRForm.XVTRFreq(saved_vfob_freq);
                if (old_xvtr_index >= 0 && freq >= max_freq)
                {
                    VFOBFreq = saved_vfob_freq;
                    return;
                }
            }

            // update Band Info
            string bandInfo;
            double db_freq = freq;
            if (RX2IsIn60m())
                db_freq -= ModeFreqOffset(rx2_dsp_mode);
            else if (RX1IsIn60m())
                db_freq -= ModeFreqOffset(rx1_dsp_mode);
            bool transmit = DB.BandText(db_freq, out bandInfo);
            if (transmit == false)
            {
                txtVFOBBand.BackColor = Color.DimGray;
                // if (chkVFOSplit.Checked && mox)
                //    chkMOX.Checked = false;
            }
            else txtVFOBBand.BackColor = band_background_color;
            txtVFOBBand.Text = bandInfo;

            saved_vfob_freq = freq;


            // if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
            if (current_model == Model.HERMES || current_model == Model.HPSDR)
            {
                if (chkVFOBTX.Checked) goto set_tx_freq;
                if (rx2_enabled) goto set_rx2_freq;
                else if (chkVFOSplit.Checked || full_duplex)
                    goto set_tx_freq;
                else goto end;
            }
            else if (mox && chkVFOSplit.Checked)
                goto set_tx_freq;
            else goto end;

        set_tx_freq:
            int last_tx_xvtr_index = tx_xvtr_index;
            tx_xvtr_index = xvtr_index;
            double tx_freq = freq;
            Band old_tx_band = tx_band;
            Band b = BandByFreq(tx_freq, tx_xvtr_index, true, current_region);
            if (old_tx_band != b)
                SetTXBand(b);

            if (tx_xvtr_index >= 0)
                tx_freq = XVTRForm.TranslateFreq(tx_freq);

            if (ext_ctrl_enabled)
                UpdateExtCtrl();

            if (tx_xvtr_index >= 0 && tx_xvtr_index != last_tx_xvtr_index)
            {
                int power = XVTRForm.GetPower(tx_xvtr_index);
                if (rx1_dsp_mode == DSPMode.FM) power = (int)(power * 0.4);
                int old_pwr = ptbPWR.Value;
                if (power == old_pwr) ptbPWR_Scroll(this, EventArgs.Empty);
                else PWR = power;

                if (fwc_init && (current_model == Model.FLEX3000 || current_model == Model.FLEX5000))
                {
                    //FWC.SetXVTRSplit(XVTRForm.GetXVTRRF(tx_xvtr_index));
                    FWC.SetXVTRActive(true);
                }
            }

            /*   if (chkPower.Checked && penny_ext_ctrl_enabled)
                   Penny.getPenny().UpdateExtCtrl(rx1_band, mox);
               if (chkPower.Checked && alex_ant_ctrl_enabled)
               {
                   Alex.getAlex().UpdateAlexAntSelection(rx1_band, mox);
               } */

            if (old_tx_band != tx_band)
            {
                if (tx_band == Band.B60M)
                {
                    chkXIT.Enabled = false;
                    chkXIT.Checked = false;
                }
                else
                    chkXIT.Enabled = true;
            }

            if (chkXIT.Checked)
                tx_freq += (int)udXIT.Value * 0.000001;

            if (tx_freq < min_freq) tx_freq = min_freq;
            else if (tx_freq > max_freq) tx_freq = max_freq;

            /*if(!IsHamBand(current_band_plan, freq))	// out of band
                {
                    MessageBox.Show("The frequency "+freq.ToString("f6")+"MHz is not within the "+
                        "IARU Band specifications.",
                        "Transmit Error: Out Of Band",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    chkMOX.Checked = false;
                    return;
                }*/

            DSPMode tx_mode = radio.GetDSPTX(0).CurrentDSPMode;
            if (chkVFOBTX.Checked && chkRX2.Checked) tx_mode = rx2_dsp_mode;

          //  if (mox || (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000)))
          //  {
                switch (tx_mode)
                {
                    case DSPMode.AM:
                    case DSPMode.SAM:
                    case DSPMode.FM:
                    case DSPMode.USB:
                    case DSPMode.DIGU:
                    case DSPMode.DSB:
                        if (chkTUN.Checked) tx_freq -= (double)cw_pitch * 1e-6;
                        break;
                    case DSPMode.LSB:
                    case DSPMode.DIGL:
                        if (chkTUN.Checked) tx_freq += (double)cw_pitch * 1e-6;
                        break;
                }
           // }

            if (tx_mode == DSPMode.CWL)
                tx_freq += (double)cw_pitch * 0.0000010;
            else if (tx_mode == DSPMode.CWU)
                tx_freq -= (double)cw_pitch * 0.0000010;

            //Debug.WriteLine("freq: "+freq.ToString("f6"));
            if (!rx1_sub_drag)
            {
                tx_dds_freq_mhz = tx_freq;
                tx_dds_freq_updated = true;
                UpdateTXDDSFreq();

                if (rx2_enabled) goto set_rx2_freq;
            }
            goto end;

        set_rx2_freq:
            SetRX2Band(BandByFreq(freq, rx2_xvtr_index, false, current_region));

            if (xvtr_index < 0)
            {
                RX2XVTRGainOffset = 0.0f;
            }
            else
            {
                freq = XVTRForm.TranslateFreq(freq);
                RX2XVTRGainOffset = XVTRForm.GetRXGain(xvtr_index);
                if (fwc_init && (current_model == Model.FLEX3000 || current_model == Model.FLEX5000))
                {
                    FWC.SetXVTRSplit(XVTRForm.GetXVTRRF(xvtr_index));
                }
            }

            /*if(CurrentBand == Band.B60M)
            {
                chkXIT.Enabled = false;
                chkXIT.Checked = false;
            }
            else
                chkXIT.Enabled = true;
                
            if(chkXIT.Checked)
                freq += (int)udXIT.Value * 0.000001;*/

            if (freq < min_freq) freq = min_freq;
            else if (freq > max_freq) freq = max_freq;

            /*if(!IsHamBand(current_band_plan, freq))	// out of band
                {
                    MessageBox.Show("The frequency "+freq.ToString("f6")+"MHz is not within the "+
                        "IARU Band specifications.",
                        "Transmit Error: Out Of Band",
                        MessageBoxButtons.OK,
                        MessageBoxIcon.Error);
                    chkMOX.Checked = false;
                    return;
                }*/

            /*if((mox || (fwc_init && current_model == Model.FLEX5000)) &&
                (RX1DSPMode == DSPMode.AM ||
                RX1DSPMode == DSPMode.SAM ||
                RX1DSPMode == DSPMode.FM))
                freq -= 0.011025;*/

            if (rx2_dsp_mode == DSPMode.CWL)
                freq += (double)cw_pitch * 0.0000010;
            else if (rx2_dsp_mode == DSPMode.CWU)
                freq -= (double)cw_pitch * 0.0000010;

            //Debug.WriteLine("freq: "+freq.ToString("f6"));
            RX2DDSFreq = freq;
            UpdateRX2Notches();
            goto end;


#if false
				// wjtFIXME! sr xmit support 
				else if ( current_model == Model.SOFTROCK40 )
				{
					SetSoftRockOscFreqs();
				}
#endif

        end:

            if (chkVFOSync.Checked && txtVFOAFreq.Text != txtVFOBFreq.Text)
            {
                txtVFOAFreq.Text = txtVFOBFreq.Text;
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }

            if (small_lsd)
            {
                txtVFOBMSD.Visible = true;
                txtVFOBLSD.Visible = true;
            }
        }

        private void txtVFOBFreq_KeyPress(object sender, System.Windows.Forms.KeyPressEventArgs e)
        {
            string separator = System.Globalization.CultureInfo.CurrentCulture.NumberFormat.NumberDecimalSeparator;
            int KeyCode = (int)e.KeyChar;
            if ((KeyCode < 48 || KeyCode > 57) &&			// numeric keys
                KeyCode != 8 &&								// backspace
                !e.KeyChar.ToString().Equals(separator) &&	// decimal
                KeyCode != 27)								// escape
            {
                e.Handled = true;
            }
            else
            {
                if (e.KeyChar.ToString().Equals(separator))
                {
                    e.Handled = (((TextBoxTS)sender).Text.IndexOf(separator) >= 0);
                }
                else if (KeyCode == 27)
                {
                    VFOBFreq = saved_vfob_freq;
                    btnHidden.Focus();
                }
            }
            if (e.KeyChar == (char)Keys.Enter)
            {
                txtVFOAFreq_LostFocus(txtVFOAFreq, new System.EventArgs());
                btnHidden.Focus();
            }
        }

        private void txtVFOBFreq_MouseMove(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            if (this.ContainsFocus)
            {
                int old_digit = vfob_hover_digit;
                int digit_index = 0;
                if (vfo_char_width == 0)
                    GetVFOCharWidth();

                int x = txtVFOBFreq.Width - (vfo_pixel_offset - 5);
                while (x < e.X)
                {
                    digit_index++;

                    if (small_lsd && txtVFOBLSD.Visible)
                    {
                        if (digit_index < 6)
                            x += (vfo_char_width + vfo_char_space);
                        else
                            x += (vfo_small_char_width + vfo_small_char_space);

                        if (digit_index == 3)
                            x += (vfo_decimal_space - vfo_char_space);
                        if (digit_index == 6)
                            x += vfo_small_char_width;
                    }
                    else
                    {
                        x += vfo_char_width;
                        if (digit_index == 3)
                            x += vfo_decimal_space;
                        else
                            x += vfo_char_space;
                    }
                }

                if (digit_index < 3) digit_index = -1;
                if (digit_index > 9) digit_index = 9;
                vfob_hover_digit = digit_index;
                if (vfob_hover_digit != old_digit)
                    panelVFOBHover.Invalidate();
            }
        }

        private void txtVFOBFreq_MouseLeave(object sender, System.EventArgs e)
        {
            vfob_hover_digit = -1;
            panelVFOBHover.Invalidate();
        }

        private void panelVFOAHover_MouseMove(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            Control c1 = (Control)sender;
            Control c2 = txtVFOAFreq;
            int client_width = (c1.Size.Width - c1.ClientSize.Width) + (c2.Size.Width - c2.ClientSize.Width);
            int client_height = (c1.Size.Height - c1.ClientSize.Height) + (c2.Size.Height - c2.ClientSize.Height);
            int x_offset = c1.Left - c2.Left - client_width / 2;
            int y_offset = c1.Top - c2.Top - client_height / 2;
            txtVFOAFreq_MouseMove(sender, new MouseEventArgs(e.Button, e.Clicks, e.X + x_offset, e.Y + y_offset, e.Delta));

            /*txtVFOAFreq_MouseMove(sender, new MouseEventArgs(MouseButtons.None, 0,
                e.X+panelVFOAHover.Left-10, e.Y+panelVFOAHover.Top, 0));*/
        }

        private void panelVFOBHover_MouseMove(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            Control c1 = (Control)sender;
            Control c2 = txtVFOBFreq;
            int client_width = (c1.Size.Width - c1.ClientSize.Width) + (c2.Size.Width - c2.ClientSize.Width);
            int client_height = (c1.Size.Height - c1.ClientSize.Height) + (c2.Size.Height - c2.ClientSize.Height);
            int x_offset = c1.Left - c2.Left - client_width / 2;
            int y_offset = c1.Top - c2.Top - client_height / 2;
            txtVFOBFreq_MouseMove(sender, new MouseEventArgs(e.Button, e.Clicks, e.X + x_offset, e.Y + y_offset, e.Delta));

            /*txtVFOBFreq_MouseMove(sender, new MouseEventArgs(MouseButtons.None, 0,
                e.X+panelVFOBHover.Left-10, e.Y+panelVFOBHover.Top, 0));*/
        }

        private void txtVFOALSD_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            txtVFOAMSD.Visible = false;
            txtVFOALSD.Visible = false;
            txtVFOAFreq.Focus();
            txtVFOAFreq.SelectAll();
        }

        private void txtVFOALSD_MouseMove(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            Control c1 = (Control)sender;
            Control c2 = txtVFOAFreq;
            int client_width = (c1.Size.Width - c1.ClientSize.Width) + (c2.Size.Width - c2.ClientSize.Width);
            int client_height = (c1.Size.Height - c1.ClientSize.Height) + (c2.Size.Height - c2.ClientSize.Height);
            int x_offset = c1.Left - c2.Left - client_width / 2;
            int y_offset = c1.Top - c2.Top - client_height / 2;
            txtVFOAFreq_MouseMove(sender, new MouseEventArgs(e.Button, e.Clicks, e.X + x_offset, e.Y + y_offset, e.Delta));

            /*txtVFOAFreq_MouseMove(txtVFOALSD,
                new MouseEventArgs(e.Button, e.Clicks, e.X+165, e.Y+25, e.Delta));*/
        }

        private void txtVFOAMSD_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            txtVFOAMSD.Visible = false;
            txtVFOALSD.Visible = false;
            txtVFOAFreq.Focus();
            txtVFOAFreq.SelectAll();
        }

        private void txtVFOAMSD_MouseMove(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            txtVFOAFreq_MouseMove(txtVFOAMSD,
                new MouseEventArgs(e.Button, e.Clicks, e.X, e.Y, e.Delta));
        }


        private void txtVFOAMSD_MouseLeave(object sender, System.EventArgs e)
        {
            txtVFOAFreq_MouseLeave(txtVFOAMSD, e);
        }

        private void txtVFOBMSD_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            txtVFOBMSD.Visible = false;
            txtVFOBLSD.Visible = false;
            txtVFOBFreq.Focus();
            txtVFOBFreq.SelectAll();
        }

        private void txtVFOBMSD_MouseLeave(object sender, System.EventArgs e)
        {
            txtVFOBFreq_MouseLeave(txtVFOBMSD, e);
        }

        private void txtVFOBMSD_MouseMove(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            txtVFOBFreq_MouseMove(txtVFOBMSD,
                new MouseEventArgs(e.Button, e.Clicks, e.X, e.Y, e.Delta));
        }

        private void txtVFOBLSD_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            txtVFOBMSD.Visible = false;
            txtVFOBLSD.Visible = false;
            txtVFOBFreq.Focus();
            txtVFOBFreq.SelectAll();
        }

        private void txtVFOBLSD_MouseMove(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            Control c1 = (Control)sender;
            Control c2 = txtVFOBFreq;
            int client_width = (c1.Size.Width - c1.ClientSize.Width) + (c2.Size.Width - c2.ClientSize.Width);
            int client_height = (c1.Size.Height - c1.ClientSize.Height) + (c2.Size.Height - c2.ClientSize.Height);
            int x_offset = c1.Left - c2.Left - client_width / 2;
            int y_offset = c1.Top - c2.Top - client_height / 2;
            txtVFOBFreq_MouseMove(sender, new MouseEventArgs(e.Button, e.Clicks, e.X + x_offset, e.Y + y_offset, e.Delta));

            /*txtVFOBFreq_MouseMove(txtVFOBLSD,
                new MouseEventArgs(e.Button, e.Clicks, e.X+165, e.Y+25, e.Delta));*/
        }

        #endregion

        #region Display Events

        private bool rx1_low_filter_drag = false;
        private bool rx1_high_filter_drag = false;
        private bool rx1_whole_filter_drag = false;
        private bool rx1_sub_drag = false;
        private bool rx1_spectrum_drag = false;

        private bool rx2_low_filter_drag = false;
        private bool rx2_high_filter_drag = false;
        private bool rx2_whole_filter_drag = false;
        //private bool rx2_sub_drag = false;
        private bool rx2_spectrum_drag = false;

        private bool tx_low_filter_drag = false;
        private bool tx_high_filter_drag = false;
        private bool tx_whole_filter_drag = false;

        private int whole_filter_start_x = 0;
        private int whole_filter_start_low = 0;
        private int whole_filter_start_high = 0;
        private int sub_drag_last_x = 0;
        private int spectrum_drag_last_x = 0;
        private double sub_drag_start_freq = 0.0;

        private bool notch_drag = false;
        private Point notch_drag_start_point = new Point(0, 0);
        private Notch notch_drag_start; // starting settings for notch
        private Notch notch_drag_active; // notch to use for modifying
        private int notch_drag_max_delta_x = 0;
        private int notch_drag_max_delta_y = 0;
        private bool notch_zoom = false;
        private bool agc_knee_drag = false;
        private Point agc_knee_drag_start_point = new Point(0, 0);
        private bool agc_hang_drag = false;

        private void picDisplay_MouseMove(object sender, MouseEventArgs e)
        {
            Cursor next_cursor = null;
            try
            {
                // get filter location information
                int filt_low_x = 0;
                int filt_high_x = 0;
                if (rx2_enabled && e.Y > picDisplay.Height / 2) // if RX2 is enabled and the cursor is in the lower half of the display
                {
                    if (mox && chkVFOBTX.Checked)
                    {
                        filt_low_x = HzToPixel(radio.GetDSPTX(0).TXFilterLow);
                        filt_high_x = HzToPixel(radio.GetDSPTX(0).TXFilterHigh);
                    }
                    else
                    {
                        filt_low_x = HzToPixel(radio.GetDSPRX(1, 0).RXFilterLow);
                        filt_high_x = HzToPixel(radio.GetDSPRX(1, 0).RXFilterHigh);
                    }
                }
                else
                {
                    if (mox && chkVFOATX.Checked)
                    {
                        filt_low_x = HzToPixel(radio.GetDSPTX(0).TXFilterLow);
                        filt_high_x = HzToPixel(radio.GetDSPTX(0).TXFilterHigh);
                    }
                    else
                    {
                        filt_low_x = HzToPixel(radio.GetDSPRX(0, 0).RXFilterLow);
                        filt_high_x = HzToPixel(radio.GetDSPRX(0, 0).RXFilterHigh);
                    }
                }

                // get VFO A Sub + Filter location information
                int vfoa_sub_x = 0;
                int vfoa_sub_low_x = 0;
                int vfoa_sub_high_x = 0;
                if (chkEnableMultiRX.Checked && !mox)
                {
                    if (!rx2_enabled)
                    {
                        vfoa_sub_x = HzToPixel((float)((VFOBFreq - VFOAFreq) * 1e6));
                        vfoa_sub_low_x = vfoa_sub_x + (HzToPixel(radio.GetDSPRX(0, 0).RXFilterLow) - HzToPixel(0.0f));
                        vfoa_sub_high_x = vfoa_sub_x + (HzToPixel(radio.GetDSPRX(0, 0).RXFilterHigh) - HzToPixel(0.0f));
                    }
                    else
                    {
                        vfoa_sub_x = HzToPixel((float)((VFOASubFreq - VFOAFreq) * 1e6));
                        vfoa_sub_low_x = vfoa_sub_x + (HzToPixel(radio.GetDSPRX(0, 1).RXFilterLow) - HzToPixel(0.0f));
                        vfoa_sub_high_x = vfoa_sub_x + (HzToPixel(radio.GetDSPRX(0, 1).RXFilterHigh) - HzToPixel(0.0f));
                    }
                }

                // get VFO B filter location information
                int vfob_x = 0;
                int vfob_low_x = 0;
                int vfob_high_x = 0;
                if (rx2_enabled && rx2_spectrum_drag)
                {
                    vfob_x = HzToPixel((float)((VFOBFreq - VFOAFreq) * 1e6));
                    vfob_low_x = vfob_x + (HzToPixel(radio.GetDSPRX(1, 0).RXFilterLow) - HzToPixel(0.0f));
                    vfob_high_x = vfob_x + (HzToPixel(radio.GetDSPRX(1, 0).RXFilterHigh) - HzToPixel(0.0f));
                }

                switch (Display.CurrentDisplayMode)
                {
                    case DisplayMode.HISTOGRAM:
                    case DisplayMode.SPECTRUM:
                        DisplayCursorX = e.X;
                        DisplayCursorY = e.Y;
                        float x = PixelToHz(e.X);
                        float y = PixelToDb(e.Y);
                        double rf_freq;
                        if (rx2_enabled && e.Y > picDisplay.Height / 2)
                            rf_freq = VFOBFreq + (double)x * 0.0000010;
                        else rf_freq = VFOAFreq + (double)x * 0.0000010;

                        if (rx1_dsp_mode == DSPMode.CWL)
                            rf_freq += (double)cw_pitch * 0.0000010;
                        else if (rx1_dsp_mode == DSPMode.CWU)
                            rf_freq -= (double)cw_pitch * 0.0000010;
                        txtDisplayCursorOffset.Text = x.ToString("f1") + "Hz";
                        txtDisplayCursorPower.Text = y.ToString("f1") + "dBm";

                        string temp_text = rf_freq.ToString("f6") + " MHz";
                        int jper = temp_text.IndexOf(separator) + 4;
                        txtDisplayCursorFreq.Text = String.Copy(temp_text.Insert(jper, " "));

                        if (!mox)
                        {
                            //Color grid_text_color = Display.GridTextColor;
                            if ((e.X > display_grid_x && e.X < display_grid_w) &&
                                (e.Y < picDisplay.Height / 2 && e.Y > 10))
                            {
                                // Display.GridTextColor = Color.Red;
                                Cursor = Cursors.PanNorth;
                                gridmaxadjust = true;
                                gridminadjust = false;
                            }
                            else if ((e.X > display_grid_x && e.X < display_grid_w) &&
                                (e.Y > picDisplay.Height / 2 && e.Y < picDisplay.Height - 10))
                            {
                                // Display.GridTextColor = Color.Green;
                                Cursor = Cursors.PanSouth;
                                gridminadjust = true;
                                gridmaxadjust = false;
                            }
                            else
                            {
                                //  Display.GridTextColor = SetupForm.clrbtnText.Color;
                                Cursor = Cursors.Cross;
                                gridmaxadjust = false;
                                gridminadjust = false;
                            }
                        }
                        break;
                    case DisplayMode.PANADAPTER:
                    case DisplayMode.WATERFALL:
                    case DisplayMode.PANAFALL:
                    case DisplayMode.PANASCOPE:
                        DisplayCursorX = e.X; // update display cursor position
                        DisplayCursorY = e.Y;
                        x = PixelToHz(e.X);
                        switch (Display.CurrentDisplayMode)
                        {
                            case DisplayMode.PANADAPTER:
                                y = PixelToDb(e.Y);
                                txtDisplayCursorPower.Text = y.ToString("f1") + "dBm";
                                float cal_offset = 0.0f;

                                switch (RX1AGCMode)
                                {
                                    case AGCMode.FIXD:
                                        cal_offset = 0.0f;
                                        break;
                                    default:
                                        cal_offset = 60.0f + (Display.RX1DisplayCalOffset +
                                        (Display.RX1PreampOffset - Display.AlexPreampOffset));
                                        break;
                                }

                                if (!mox)
                                {
                                    //Color grid_text_color = Display.GridTextColor;
                                    if ((e.X > display_grid_x && e.X < display_grid_w) &&
                                        (e.Y < picDisplay.Height / 2 && e.Y > 10))
                                    {
                                        // Display.GridTextColor = Color.Red;
                                        Cursor = Cursors.PanNorth;
                                        gridmaxadjust = true;
                                        gridminadjust = false;
                                    }
                                    else if ((e.X > display_grid_x && e.X < display_grid_w) &&
                                        (e.Y > picDisplay.Height / 2 && e.Y < picDisplay.Height - 10))
                                    {
                                        // Display.GridTextColor = Color.Green;
                                        Cursor = Cursors.PanSouth;
                                        gridminadjust = true;
                                        gridmaxadjust = false;
                                    }
                                    else
                                    {
                                        //  Display.GridTextColor = SetupForm.clrbtnText.Color;
                                        Cursor = Cursors.Cross;
                                        gridmaxadjust = false;
                                        gridminadjust = false;
                                    }

                                    if (Display.AGCKnee.Contains(e.X, e.Y) && display_agc_gain_line)
                                        Cursor = Cursors.HSplit;
                                    // else Cursor = Cursors.Cross;
                                    if (Display.AGCHang.Contains(e.X, e.Y) && display_agc_hang_line)
                                        Cursor = Cursors.HSplit;
                                }
                                else
                                {
                                    //Color grid_text_color = Display.GridTextColor;
                                    if ((e.X > display_grid_x && e.X < display_grid_w) &&
                                        (e.Y < picDisplay.Height / 2 && e.Y > 10))
                                    {
                                        // Display.GridTextColor = Color.Red;
                                        Cursor = Cursors.PanNorth;
                                        gridmaxadjust = true;
                                        gridminadjust = false;
                                    }
                                    else if ((e.X > display_grid_x && e.X < display_grid_w) &&
                                        (e.Y > picDisplay.Height / 2 && e.Y < picDisplay.Height - 10))
                                    {
                                        // Display.GridTextColor = Color.Green;
                                        Cursor = Cursors.PanSouth;
                                        gridminadjust = true;
                                        gridmaxadjust = false;
                                    }
                                    else
                                    {
                                        //  Display.GridTextColor = SetupForm.clrbtnText.Color;
                                        Cursor = Cursors.Cross;
                                        gridmaxadjust = false;
                                        gridminadjust = false;
                                    }
                                }

                                if (agc_hang_drag && display_agc_hang_line)
                                {
                                    int hang_threshold = 0;
                                    double agc_hang_point = (double)PixelToDb(e.Y + 4);

                                    agc_hang_point = agc_hang_point - (double)cal_offset;
                                    // Debug.WriteLine("agc_hang_point1: " + agc_hang_point);
                                    if (agc_hang_point > 4.0) agc_hang_point = 4.0;
                                    if (agc_hang_point < -140.0) agc_hang_point = -140.0;
                                    DttSP.SetRXAGCHangLevel(0, 0, agc_hang_point);

                                    DttSP.GetRXAGCHangThreshold(0, 0, &hang_threshold);
                                    if (hang_threshold > 100) hang_threshold = 100;
                                    if (hang_threshold < 0) hang_threshold = 0;
                                    // Debug.WriteLine("hang_threshold: " + hang_threshold);
                                    // DttSP.SetRXAGCHangLevel(0, 0, agc_hang_point);
                                    if (SetupForm != null) SetupForm.AGCHangThreshold = hang_threshold;
                                }

                                if (agc_knee_drag && display_agc_gain_line)
                                {
                                    double agc_top;
                                    double agc_thresh_point = (double)PixelToDb(e.Y + 4);

                                    agc_thresh_point = agc_thresh_point - (double)cal_offset;
                                    if (agc_thresh_point > 2.0) agc_thresh_point = 2.0;
                                    if (agc_thresh_point < -140.0) agc_thresh_point = -140.0;
                                    // Debug.WriteLine("agc_db_point2: " + agc_db_point);
                                    DttSP.SetRXAGCThresh(0, 0, agc_thresh_point);

                                    DttSP.GetRXAGCMaxGain(0, 0, &agc_top);
                                    agc_top = Math.Round(agc_top);
                                    // DttSP.SetRXAGCThresh(0, 0, agc_thresh_point);

                                    switch (RX1AGCMode)
                                    {
                                        case AGCMode.FIXD:
                                            if (agc_top > 120.0) agc_top = 120.0;
                                            if (agc_top < -20.0) agc_top = -20.0;
                                            agc_top = agc_top - (double)cal_offset;
                                            if (SetupForm != null) SetupForm.AGCFixedGain = (int)agc_top;
                                            // Debug.WriteLine("agc_db_point3: " + agc_db_point);
                                            break;
                                        default:
                                            if (agc_top > 120.0) agc_top = 120.0;
                                            if (agc_top < -20.0) agc_top = -20.0;
                                            if (SetupForm != null) SetupForm.AGCMaxGain = (int)agc_top;
                                            break;
                                    }
                                }
                                break;
                            case DisplayMode.WATERFALL:
                                y = WaterfallPixelToTime(e.Y);
                                txtDisplayCursorPower.Text = (y / 1000.0f).ToString("f1") + "sec";
                                if (!mox)
                                {
                                    //Color grid_text_color = Display.GridTextColor;
                                    if ((e.X > 5 && e.X < 25) &&
                                        (e.Y < picDisplay.Height / 2 && e.Y > 10))
                                    {
                                        // Display.GridTextColor = Color.Red;
                                        Cursor = Cursors.PanNorth;
                                        wfmaxadjust = true;
                                        wfminadjust = false;
                                    }
                                    else if ((e.X > 5 && e.X < 25) &&
                                        (e.Y > picDisplay.Height / 2 && e.Y < picDisplay.Height - 10))
                                    {
                                        // Display.GridTextColor = Color.Green;
                                        Cursor = Cursors.PanSouth;
                                        wfminadjust = true;
                                        wfmaxadjust = false;
                                    }
                                    else
                                    {
                                        //  Display.GridTextColor = SetupForm.clrbtnText.Color;
                                        Cursor = Cursors.Cross;
                                        wfmaxadjust = false;
                                        wfminadjust = false;
                                    }
                                }
                                break;
                            case DisplayMode.PANAFALL:
                                if (e.Y < picDisplay.Height / 2)
                                {
                                    y = PixelToDb(e.Y);
                                    txtDisplayCursorPower.Text = y.ToString("f1") + "dBm";
                                }
                                else
                                {
                                    y = WaterfallPixelToTime(e.Y);
                                    txtDisplayCursorPower.Text = (y / 1000.0f).ToString("f1") + "sec";
                                }
                                break;
                            case DisplayMode.PANASCOPE:
                                if (e.Y < picDisplay.Height / 2)
                                {
                                    y = PixelToDb(e.Y);
                                    txtDisplayCursorPower.Text = y.ToString("f1") + "dBm";
                                }
                                else
                                {
                                    txtDisplayCursorPower.Text = "";
                                }
                                break;
                        }

                        if (rx2_enabled && e.Y > picDisplay.Height / 2) // if RX2 is enabled and the cursor is in the lower half of the display
                        {
                            rf_freq = VFOBFreq + (double)x * 0.0000010;
                            if (rx2_dsp_mode == DSPMode.CWL)
                                rf_freq += (double)cw_pitch * 0.0000010;
                            else if (rx2_dsp_mode == DSPMode.CWU)
                                rf_freq -= (double)cw_pitch * 0.0000010;
                        }
                        else
                        {
                            rf_freq = VFOAFreq + (double)x * 0.0000010;
                            if (rx1_dsp_mode == DSPMode.CWL)
                                rf_freq += (double)cw_pitch * 0.0000010;
                            else if (rx1_dsp_mode == DSPMode.CWU)
                                rf_freq -= (double)cw_pitch * 0.0000010;
                            Display.FREQ = x; // PixelToHz(e.X); //for cross hair filter
                        }

                        txtDisplayCursorOffset.Text = x.ToString("f1") + "Hz";

                        temp_text = rf_freq.ToString("f6") + " MHz";
                        jper = temp_text.IndexOf(separator) + 4;
                        txtDisplayCursorFreq.Text = String.Copy(temp_text.Insert(jper, " "));

                        // if near a notch and not already doing something else, display appropriate cursor
                        if (Cursor != Cursors.Hand && !mox)
                        {
                            if (!rx1_low_filter_drag && !rx1_high_filter_drag && !rx1_whole_filter_drag &&
                                !rx2_low_filter_drag && !rx2_high_filter_drag && !rx2_whole_filter_drag &&
                                !tx_low_filter_drag && !tx_high_filter_drag && !tx_whole_filter_drag &&
                                !rx1_sub_drag && !notch_drag)
                            {
                                rf_freq = VFOAFreq;

                                if (rx2_enabled && e.Y > picDisplay.Height / 2)
                                {
                                    rf_freq = VFOBFreq;

                                    switch (rx2_dsp_mode)
                                    {
                                        case (DSPMode.CWL):
                                            rf_freq += cw_pitch * 1e-6;
                                            break;
                                        case (DSPMode.CWU):
                                            rf_freq -= cw_pitch * 1e-6; ;
                                            break;
                                    }
                                }
                                else
                                {
                                    switch (rx1_dsp_mode)
                                    {
                                        case (DSPMode.CWL):
                                            rf_freq += cw_pitch * 1e-6; ;
                                            break;
                                        case (DSPMode.CWU):
                                            rf_freq -= cw_pitch * 1e-6; ;
                                            break;
                                    }
                                }

                                //Debug.WriteLine("x: " + e.X);
                                int low = (int)PixelToHz(e.X - 3);
                                int high = (int)PixelToHz(e.X + 3);

                                List<Notch> list = NotchList.NotchesInBW(rf_freq, low, high);
                                if (list.Count > 0)
                                {
                                    next_cursor = Cursors.VSplit;
                                }
                                else
                                {
                                    next_cursor = Cursors.Cross;
                                }
                            }
                        }

                        if (notch_drag)
                        {
                            double hz_per_pixel = PixelToHz(1) - PixelToHz(0);
                            int delta_x = e.X - notch_drag_start_point.X;
                            int delta_y = e.Y - notch_drag_start_point.Y;

                            if (Math.Abs(delta_x) > notch_drag_max_delta_x)
                                notch_drag_max_delta_x = Math.Abs(delta_x);
                            if (Math.Abs(delta_y) > notch_drag_max_delta_y)
                                notch_drag_max_delta_y = Math.Abs(delta_y);

                            // offset the notch frequency based on the current mouse position
                            double delta_freq = delta_x * hz_per_pixel;
                            if (notch_zoom) delta_freq /= 10.0;
                            notch_drag_active.Freq = notch_drag_start.Freq + delta_freq * 1e-6;

                            // change the BW of the notch filter once outside a 20 pixel boundary
                            if (delta_y > 10)
                            {
                                notch_drag_active.BW = notch_drag_start.BW - (delta_y - 10) * 5;
                                // don't go negative or less than 10Hz
                                if (notch_drag_active.BW < 10) notch_drag_active.BW = 10;
                            }
                            else if (delta_y < -10)
                                notch_drag_active.BW = notch_drag_start.BW - (delta_y + 10) * 5;

                            UpdateRX1Notches();
                            UpdateRX1SubNotches();
                            UpdateRX2Notches();
                        }

                        if (((!rx2_enabled && rx1_dsp_mode != DSPMode.DRM) || // exclude DRM for RX1
                            (rx2_enabled && rx1_dsp_mode != DSPMode.DRM && e.Y < picDisplay.Height / 2) ||
                            (rx2_enabled && rx2_dsp_mode != DSPMode.DRM && e.Y >= picDisplay.Height / 2)))
                        {
                            if (current_click_tune_mode == ClickTuneMode.Off &&
                                picDisplay.Cursor != Cursors.Hand && next_cursor != Cursors.SizeNS && next_cursor != Cursors.VSplit)
                            {
                                if (Math.Abs(e.X - filt_low_x) < 3 || // RX low filter edge
                                    Math.Abs(e.X - filt_high_x) < 3 || // RX high filter edge
                                    rx1_high_filter_drag || rx1_low_filter_drag || // already dragging a filter edge
                                    (chkEnableMultiRX.Checked && // RX1 Sub
                                        ((rx2_enabled && e.Y < picDisplay.Height / 2) || !rx2_enabled) && (e.X > vfoa_sub_low_x - 3 && e.X < vfoa_sub_high_x + 3)) ||
                                    (rx2_enabled && e.Y > picDisplay.Height / 2 && (Math.Abs(e.X - vfob_low_x) < 3)) || // RX2 low filter edge
                                    (rx2_enabled && e.Y > picDisplay.Height / 2 && (Math.Abs(e.X - vfob_high_x) < 3)) ||
                                    rx2_high_filter_drag || rx2_low_filter_drag) // already dragging a filter edge
                                {
                                    next_cursor = Cursors.SizeWE;
                                }
                                else if (e.X > filt_low_x && e.X < filt_high_x)
                                {
                                    next_cursor = Cursors.NoMoveHoriz;
                                }
                                else
                                {
                                    next_cursor = Cursors.Cross;
                                }
                            }

                            if (notch_drag)
                            {
                                // do nothing -- already handled above
                            }
                            else if (rx1_high_filter_drag)
                            {
                                SelectRX1VarFilter();
                                int new_high = (int)Math.Max(PixelToHz(e.X), radio.GetDSPRX(0, 0).RXFilterLow + 10);
                                UpdateRX1Filters(radio.GetDSPRX(0, 0).RXFilterLow, new_high);
                            }
                            else if (rx1_low_filter_drag)
                            {
                                SelectRX1VarFilter();
                                int new_low = (int)Math.Min(PixelToHz(e.X), radio.GetDSPRX(0, 0).RXFilterHigh - 10);
                                UpdateRX1Filters(new_low, radio.GetDSPRX(0, 0).RXFilterHigh);
                            }
                            else if (rx1_whole_filter_drag)
                            {
                                SelectRX1VarFilter();
                                int diff = (int)(PixelToHz(e.X) - PixelToHz(whole_filter_start_x));
                                UpdateRX1Filters(whole_filter_start_low + diff, whole_filter_start_high + diff);
                            }
                            else if (rx1_sub_drag)
                            {
                                int diff = (int)(PixelToHz(e.X) - PixelToHz(sub_drag_last_x));
                                if (rx2_enabled)
                                    VFOASubFreq = sub_drag_start_freq + diff * 1e-6;
                                else VFOBFreq = sub_drag_start_freq + diff * 1e-6;
                            }
                            else if (rx2_high_filter_drag)
                            {
                                SelectRX2VarFilter();
                                int new_high = (int)Math.Max(PixelToHz(e.X), radio.GetDSPRX(1, 0).RXFilterLow + 10);
                                UpdateRX2Filters(radio.GetDSPRX(1, 0).RXFilterLow, new_high);
                            }
                            else if (rx2_low_filter_drag)
                            {
                                SelectRX2VarFilter();
                                int new_low = (int)Math.Min(PixelToHz(e.X), radio.GetDSPRX(1, 0).RXFilterHigh - 10);
                                UpdateRX2Filters(new_low, radio.GetDSPRX(1, 0).RXFilterHigh);
                            }
                            else if (rx2_whole_filter_drag)
                            {
                                SelectRX2VarFilter();
                                int diff = (int)(PixelToHz(e.X) - PixelToHz(whole_filter_start_x));
                                UpdateRX2Filters(whole_filter_start_low + diff, whole_filter_start_high + diff);
                            }
                            else if (tx_high_filter_drag)
                            {
                                int new_high = (int)Math.Max(Math.Abs(PixelToHz(e.X)), tx_filter_low + 10);
                                SetupForm.TXFilterHigh = new_high;
                            }
                            else if (tx_low_filter_drag)
                            {
                                int new_low = (int)(Math.Min(Math.Abs(PixelToHz(e.X)), tx_filter_high - 10));
                                SetupForm.TXFilterLow = new_low;
                            }
                            else if (tx_whole_filter_drag)
                            {
                                int diff = (int)(PixelToHz(e.X) - PixelToHz(whole_filter_start_x));
                                switch (rx1_dsp_mode)
                                {
                                    case DSPMode.LSB:
                                    case DSPMode.DIGL:
                                        SetupForm.TXFilterLow = whole_filter_start_low - diff;
                                        SetupForm.TXFilterHigh = whole_filter_start_high - diff;
                                        break;
                                    case DSPMode.USB:
                                    case DSPMode.DIGU:
                                        SetupForm.TXFilterLow = whole_filter_start_low + diff;
                                        SetupForm.TXFilterHigh = whole_filter_start_high + diff;
                                        break;
                                    case DSPMode.AM:
                                    case DSPMode.SAM:
                                    case DSPMode.FM:
                                    case DSPMode.DSB:
                                        SetupForm.TXFilterHigh = whole_filter_start_high + diff;
                                        break;
                                }
                            }
                        }
                        break;
                    default:
                        txtDisplayCursorOffset.Text = "";
                        txtDisplayCursorPower.Text = "";
                        txtDisplayCursorFreq.Text = "";
                        break;
                }

                if (rx1_spectrum_drag)
                {
                    if (!mox || (rx2_enabled && chkVFOBTX.Checked))
                    {
                        float start_freq = PixelToHz(spectrum_drag_last_x);
                        float end_freq = PixelToHz(e.X);
                        spectrum_drag_last_x = e.X;
                        float delta = end_freq - start_freq;
                        VFOAFreq -= delta * 0.0000010;
                    }
                }
                else if (rx2_spectrum_drag)
                {
                    if (rx2_enabled && (!mox || chkVFOATX.Checked))
                    {
                        float start_freq = PixelToHz(spectrum_drag_last_x);
                        float end_freq = PixelToHz(e.X);
                        spectrum_drag_last_x = e.X;
                        float delta = end_freq - start_freq;
                        VFOBFreq -= delta * 0.0000010;
                    }
                }
            }
            catch (Exception)
            {

            }

            if (next_cursor != null && picDisplay.Cursor != next_cursor)
                picDisplay.Cursor = next_cursor;
        }


        private void picDisplay_MouseLeave(object sender, System.EventArgs e)
        {
            txtDisplayCursorOffset.Text = "";
            txtDisplayCursorPower.Text = "";
            txtDisplayCursorFreq.Text = "";
            DisplayCursorX = -1;
            DisplayCursorY = -1;
            Cursor = Cursors.Default;
        }

        private void picDisplay_MouseDown(object sender, MouseEventArgs e)
        {
            switch (e.Button)
            {
                case MouseButtons.Left:
                    bool near_notch = false;
                    if (!mox && !agc_knee_drag && !agc_hang_drag)
                    {
                        switch (Display.CurrentDisplayMode)
                        {
                            case DisplayMode.PANADAPTER:
                            case DisplayMode.WATERFALL:
                            case DisplayMode.PANAFALL:
                            case DisplayMode.PANASCOPE:
                                // check first for being near a Notch
                                double rf_freq = VFOAFreq;
                                if (rx2_enabled && e.Y > picDisplay.Height / 2)
                                {
                                    rf_freq = VFOBFreq;

                                    switch (rx2_dsp_mode)
                                    {
                                        case (DSPMode.CWL):
                                            rf_freq += cw_pitch * 1e-6;
                                            break;
                                        case (DSPMode.CWU):
                                            rf_freq -= cw_pitch * 1e-6;
                                            break;
                                    }
                                }
                                else
                                {
                                    switch (rx1_dsp_mode)
                                    {
                                        case (DSPMode.CWL):
                                            rf_freq += cw_pitch * 1e-6;
                                            break;
                                        case (DSPMode.CWU):
                                            rf_freq -= cw_pitch * 1e-6;
                                            break;
                                    }
                                }

                                int low = (int)PixelToHz(e.X - 3);
                                int high = (int)PixelToHz(e.X + 3);

                                List<Notch> list = NotchList.NotchesInBW(rf_freq, low, high);
                                if (list.Count > 0)
                                {
                                    near_notch = true;

                                    int index = -1;
                                    for (int i = 0; i < list.Count; i++)
                                    {
                                        index = i;
                                        break;
                                    }

                                    if (index >= 0)
                                    {
                                        if (list[index].Permanent)
                                        {
                                            list[index].Details = true;
                                            notch_drag_active = list[index];
                                        }
                                        else
                                        {
                                            notch_drag = true;
                                            timerNotchZoom.Enabled = true;
                                            notch_drag_active = list[index];
                                            notch_drag_start = list[index].Copy();
                                            notch_drag_start_point = new Point(e.X, e.Y);
                                            list[index].Details = true;
                                            // mark which receiver the click occurred on so that we can show the callout only there
                                            list[index].RX = 1;
                                            if (rx2_enabled && e.Y > picDisplay.Height / 2)
                                                list[index].RX = 2;
                                        }
                                    }
                                }
                                break;
                        }
                    }

                    switch (Display.CurrentDisplayMode)
                    {
                        case DisplayMode.PANADAPTER:
                        case DisplayMode.HISTOGRAM:
                        case DisplayMode.SPECTRUM:

                            if (!mox)
                            {
                                if (gridmaxadjust)
                                {
                                    decimal val = SetupForm.udDisplayGridMax.Value;
                                    val += 5;

                                    if (val > SetupForm.udDisplayGridMax.Maximum)
                                        val = SetupForm.udDisplayGridMax.Maximum;

                                    SetupForm.udDisplayGridMax.Value = val;
                                }
                                if (gridminadjust)
                                {
                                    decimal val = SetupForm.udDisplayGridMin.Value;
                                    val += 5;

                                    if (val > SetupForm.udDisplayGridMin.Maximum)
                                        val = SetupForm.udDisplayGridMin.Maximum;

                                    SetupForm.udDisplayGridMin.Value = val;
                                }
                            }
                            else
                            {
                                if (gridmaxadjust)
                                {
                                    decimal val = SetupForm.udTXGridMax.Value;
                                    val += 5;

                                    if (val > SetupForm.udTXGridMax.Maximum)
                                        val = SetupForm.udTXGridMax.Maximum;

                                    SetupForm.udTXGridMax.Value = val;
                                }
                                if (gridminadjust)
                                {
                                    decimal val = SetupForm.udTXGridMin.Value;
                                    val += 5;

                                    if (val > SetupForm.udTXGridMin.Maximum)
                                        val = SetupForm.udTXGridMin.Maximum;

                                    SetupForm.udTXGridMin.Value = val;
                                }
                            }
                            break;
                        case DisplayMode.WATERFALL:
                            if (!mox)
                            {
                                if (wfmaxadjust)
                                {
                                    decimal val = SetupForm.udDisplayWaterfallHighLevel.Value;
                                    val += 5;

                                    if (val > SetupForm.udDisplayWaterfallHighLevel.Maximum)
                                        val = SetupForm.udDisplayWaterfallHighLevel.Maximum;

                                    SetupForm.udDisplayWaterfallHighLevel.Value = val;
                                }
                                if (wfminadjust)
                                {
                                    decimal val = SetupForm.udDisplayWaterfallLowLevel.Value;
                                    val += 5;

                                    if (val > SetupForm.udDisplayWaterfallLowLevel.Maximum)
                                        val = SetupForm.udDisplayWaterfallLowLevel.Maximum;

                                    SetupForm.udDisplayWaterfallLowLevel.Value = val;
                                }
                            }
                            break;
                    }

                    if (!mox)
                    {
                        switch (Display.CurrentDisplayMode)
                        {
                            case DisplayMode.PANADAPTER:
                                if (Display.AGCKnee.Contains(e.X, e.Y) && display_agc_gain_line)
                                {
                                    agc_knee_drag = true;
                                    Cursor = Cursors.HSplit;
                                    // Debug.WriteLine("AGCKnee Y:" + Display.AGCKnee.Y);
                                }
                                else
                                    if (Display.AGCHang.Contains(e.X, e.Y) && display_agc_hang_line)
                                    {
                                        agc_hang_drag = true;
                                        Cursor = Cursors.HSplit;
                                        // Debug.WriteLine("AGCKnee Y:" + Display.AGCKnee.Y);
                                    }
                                    else
                                    {
                                        agc_knee_drag = false;
                                        agc_hang_drag = false;
                                        Cursor = Cursors.Cross;
                                    }
                                break;
                        }
                    }


                    if (!near_notch && !agc_knee_drag && !agc_hang_drag && current_click_tune_mode != ClickTuneMode.Off)
                    {
                        switch (Display.CurrentDisplayMode)
                        {
                            case DisplayMode.SPECTRUM:
                            case DisplayMode.WATERFALL:
                            case DisplayMode.HISTOGRAM:
                            case DisplayMode.PANADAPTER:
                            case DisplayMode.PANAFALL:
                            case DisplayMode.PANASCOPE:
                                float x = PixelToHz(e.X);
                                double freq;
                                if (rx2_enabled && e.Y > picDisplay.Height / 2) //RX2
                                {
                                    freq = double.Parse(txtVFOBFreq.Text) + (double)x * 0.0000010;
                                    switch (rx2_dsp_mode)
                                    {
                                        case DSPMode.CWL:
                                            freq += (float)cw_pitch * 0.0000010;
                                            break;
                                        case DSPMode.CWU:
                                            freq -= (float)cw_pitch * 0.0000010;
                                            break;
                                        case DSPMode.DIGL:
                                            freq += (float)digl_click_tune_offset * 0.0000010;
                                            break;
                                        case DSPMode.DIGU:
                                            freq -= (float)digu_click_tune_offset * 0.0000010;
                                            break;
                                    }

                                    if (snap_to_click_tuning &&
                                        rx2_dsp_mode != DSPMode.CWL &&
                                        rx2_dsp_mode != DSPMode.CWU &&
                                        rx2_dsp_mode != DSPMode.DIGL &&
                                        rx2_dsp_mode != DSPMode.DIGU &&
                                        Audio.wave_playback == false)
                                    {
                                        // round freq to the nearest tuning step
                                        long f = (long)(freq * 1000000.0);
                                        int mult = CurrentTuneStepHz;
                                        if (f % mult > mult / 2) f += (mult - f % mult);
                                        else f -= f % mult;
                                        freq = (double)f * 0.0000010;
                                    }
                                }
                                else
                                {
                                    freq = double.Parse(txtVFOAFreq.Text) + (double)x * 0.0000010;
                                    switch (rx1_dsp_mode)
                                    {
                                        case DSPMode.CWL:
                                            freq += (float)cw_pitch * 0.0000010;
                                            break;
                                        case DSPMode.CWU:
                                            freq -= (float)cw_pitch * 0.0000010;
                                            break;
                                        case DSPMode.DIGL:
                                            if (!ClickTuneFilter) freq += (float)digl_click_tune_offset * 0.0000010;
                                            break;
                                        case DSPMode.DIGU:
                                            if (!ClickTuneFilter) freq -= (float)digu_click_tune_offset * 0.0000010;
                                            break;
                                    }

                                    if (snap_to_click_tuning &&
                                        rx1_dsp_mode != DSPMode.CWL &&
                                        rx1_dsp_mode != DSPMode.CWU &&
                                        rx1_dsp_mode != DSPMode.DIGL &&
                                        rx1_dsp_mode != DSPMode.DIGU &&
                                        Audio.wave_playback == false)
                                    {
                                        // round freq to the nearest tuning step
                                        long f = (long)(freq * 1000000.0);
                                        int mult = CurrentTuneStepHz; //(int)(wheel_tune_list[wheel_tune_index] * 1000000.0);
                                        if (f % mult > mult / 2) f += (mult - f % mult);
                                        else f -= f % mult;
                                        freq = (double)f * 0.0000010;
                                    }
                                }

                                if (!rx2_enabled)
                                {
                                    if (current_click_tune_mode == ClickTuneMode.VFOA)// || current_click_tune_mode == ClickTuneMode.VFOAC)
                                    {
                                        VFOAFreq = Math.Round(freq, 6);
                                    }
                                    else
                                        VFOBFreq = Math.Round(freq, 6);
                                }
                                else
                                {
                                    if (current_click_tune_mode == ClickTuneMode.VFOB && // red cross hairs
                                        (chkVFOSplit.Checked || chkEnableMultiRX.Checked))
                                    {
                                        VFOASubFreq = Math.Round(freq, 6);
                                    }
                                    else
                                    {
                                        if (e.Y <= picDisplay.Height / 2) VFOAFreq = Math.Round(freq, 6);
                                        else VFOBFreq = Math.Round(freq, 6);
                                    }
                                }

                                if (!chkMOX.Checked && (chkRIT.Checked && current_click_tune_mode == ClickTuneMode.VFOA))// || current_click_tune_mode == ClickTuneMode.VFOAC))
                                    udRIT.Value = 0;
                                else if (chkMOX.Checked && chkXIT.Checked && current_click_tune_mode == ClickTuneMode.VFOB)
                                    udXIT.Value = 0;
                                break;
                            default:
                                break;
                        }
                    }
                    else if (!near_notch && !agc_knee_drag && !agc_hang_drag)// current_click_tune_mode == ClickTuneMode.Off) 
                    {
                        switch (Display.CurrentDisplayMode)
                        {
                            case DisplayMode.PANADAPTER:
                            case DisplayMode.WATERFALL:
                            case DisplayMode.PANAFALL:
                            case DisplayMode.PANASCOPE:
                                int low_x = 0, high_x = 0;
                                int vfoa_sub_x = 0;
                                int vfoa_sub_low_x = 0;
                                int vfoa_sub_high_x = 0;
                                if (rx2_enabled && e.Y > picDisplay.Height / 2)//rx2
                                {
                                    if (mox && chkVFOBTX.Checked)
                                    {
                                        low_x = HzToPixel(radio.GetDSPTX(0).TXFilterLow);
                                        high_x = HzToPixel(radio.GetDSPTX(0).TXFilterHigh);
                                    }
                                    else if (rx2_dsp_mode != DSPMode.DRM)
                                    {
                                        low_x = HzToPixel(radio.GetDSPRX(1, 0).RXFilterLow);
                                        high_x = HzToPixel(radio.GetDSPRX(1, 0).RXFilterHigh);
                                    }
                                }
                                else
                                {
                                    if (mox && chkVFOATX.Checked)
                                    {
                                        low_x = HzToPixel(radio.GetDSPTX(0).TXFilterLow);
                                        high_x = HzToPixel(radio.GetDSPTX(0).TXFilterHigh);
                                    }
                                    else if (rx1_dsp_mode != DSPMode.DRM)
                                    {
                                        low_x = HzToPixel(radio.GetDSPRX(0, 0).RXFilterLow);
                                        high_x = HzToPixel(radio.GetDSPRX(0, 0).RXFilterHigh);
                                    }

                                    if (chkEnableMultiRX.Checked && !mox)
                                    {
                                        if (!rx2_enabled)
                                        {
                                            vfoa_sub_x = HzToPixel((float)((VFOBFreq - VFOAFreq) * 1000000.0));
                                            vfoa_sub_low_x = vfoa_sub_x + (HzToPixel((int)udFilterLow.Value) - HzToPixel(0.0f));
                                            vfoa_sub_high_x = vfoa_sub_x + (HzToPixel((int)udFilterHigh.Value) - HzToPixel(0.0f));
                                        }
                                        else
                                        {
                                            vfoa_sub_x = HzToPixel((float)((VFOASubFreq - VFOAFreq) * 1000000.0));
                                            vfoa_sub_low_x = vfoa_sub_x + (HzToPixel((int)udFilterLow.Value) - HzToPixel(0.0f));
                                            vfoa_sub_high_x = vfoa_sub_x + (HzToPixel((int)udFilterHigh.Value) - HzToPixel(0.0f));
                                        }
                                    }
                                }

                                if (Math.Abs(e.X - low_x) < 3 && e.X < high_x)
                                {
                                    if (rx2_enabled && e.Y > picDisplay.Height / 2) //rx2_low_filter_drag = true;
                                    {
                                        if (mox && chkVFOBTX.Checked)
                                        {
                                            switch (radio.GetDSPTX(0).CurrentDSPMode)
                                            {
                                                case DSPMode.LSB:
                                                case DSPMode.CWL:
                                                case DSPMode.DIGL:
                                                case DSPMode.AM:
                                                case DSPMode.SAM:
                                                case DSPMode.FM:
                                                case DSPMode.DSB:
                                                    tx_high_filter_drag = true;
                                                    break;
                                                default:
                                                    tx_low_filter_drag = true;
                                                    break;
                                            }
                                        }
                                        else rx2_low_filter_drag = true;
                                    }
                                    else
                                    {
                                        if (mox && (!chkSplitDisplay.Checked || chkVFOATX.Checked))
                                        {
                                            switch (radio.GetDSPTX(0).CurrentDSPMode)
                                            {
                                                case DSPMode.LSB:
                                                case DSPMode.CWL:
                                                case DSPMode.DIGL:
                                                case DSPMode.AM:
                                                case DSPMode.SAM:
                                                case DSPMode.FM:
                                                case DSPMode.DSB:
                                                    tx_high_filter_drag = true;
                                                    break;
                                                default:
                                                    tx_low_filter_drag = true;
                                                    break;
                                            }
                                        }
                                        else rx1_low_filter_drag = true;
                                    }
                                }
                                else if (Math.Abs(e.X - high_x) < 3)
                                {
                                    if (rx2_enabled && e.Y > picDisplay.Height / 2) //rx2_high_filter_drag = true;
                                    {
                                        if (mox && chkVFOBTX.Checked)
                                        {
                                            switch (radio.GetDSPTX(0).CurrentDSPMode)
                                            {
                                                case DSPMode.LSB:
                                                case DSPMode.CWL:
                                                case DSPMode.DIGL:
                                                    tx_low_filter_drag = true;
                                                    break;
                                                default:
                                                    tx_high_filter_drag = true;
                                                    break;
                                            }
                                        }
                                        else rx2_high_filter_drag = true;
                                        //Cursor = Cursors.SizeWE;
                                    }
                                    else if (mox && (!chkSplitDisplay.Checked || (chkSplitDisplay.Checked && chkVFOATX.Checked)))
                                    {
                                        switch (radio.GetDSPTX(0).CurrentDSPMode)
                                        {
                                            case DSPMode.LSB:
                                            case DSPMode.CWL:
                                            case DSPMode.DIGL:
                                                tx_low_filter_drag = true;
                                                break;
                                            default:
                                                tx_high_filter_drag = true;
                                                break;
                                        }
                                    }
                                    else rx1_high_filter_drag = true;
                                }
                                else if (e.X > low_x && e.X < high_x)
                                {
                                    whole_filter_start_x = e.X;
                                    if (rx2_enabled && e.Y > picDisplay.Height / 2)
                                    {
                                        if (mox && chkVFOBTX.Checked)
                                        {
                                            tx_whole_filter_drag = true;
                                            whole_filter_start_low = SetupForm.TXFilterLow;
                                            whole_filter_start_high = SetupForm.TXFilterHigh;
                                        }
                                        else
                                        {
                                            rx2_whole_filter_drag = true;
                                            whole_filter_start_low = radio.GetDSPRX(1, 0).RXFilterLow;
                                            whole_filter_start_high = radio.GetDSPRX(1, 0).RXFilterHigh;
                                        }
                                    }
                                    else
                                    {

                                        if (!mox)
                                        {
                                            rx1_whole_filter_drag = true;
                                            whole_filter_start_low = radio.GetDSPRX(0, 0).RXFilterLow;
                                            whole_filter_start_high = radio.GetDSPRX(0, 0).RXFilterHigh;
                                        }
                                        else
                                        {
                                            tx_whole_filter_drag = true;
                                            whole_filter_start_low = SetupForm.TXFilterLow;
                                            whole_filter_start_high = SetupForm.TXFilterHigh;
                                        }
                                    }
                                }
                                else if (chkEnableMultiRX.Checked && !mox &&
                                    (e.X > vfoa_sub_low_x - 3 && e.X < vfoa_sub_high_x + 3))
                                {
                                    sub_drag_last_x = e.X;
                                    if (rx2_enabled) sub_drag_start_freq = VFOASubFreq;
                                    else sub_drag_start_freq = VFOBFreq;
                                    rx1_sub_drag = true;
                                }
                                else
                                {
                                    spectrum_drag_last_x = e.X;
                                    if (rx2_enabled && e.Y > picDisplay.Height / 2) rx2_spectrum_drag = true;
                                    else rx1_spectrum_drag = true;
                                }
                                break;
                        }
                    }
                    break;
                case MouseButtons.Right:
                    double cfreq;

                    if (rx2_enabled && e.Y > picDisplay.Height / 2)
                    {
                        cfreq = VFOBFreq;
                        switch (rx2_dsp_mode)
                        {
                            case DSPMode.CWU: cfreq -= cw_pitch * 1e-6; break;
                            case DSPMode.CWL: cfreq += cw_pitch * 1e-6; break;
                        }
                    }
                    else
                    {
                        cfreq = VFOAFreq;
                        switch (rx1_dsp_mode)
                        {
                            case DSPMode.CWU: cfreq -= cw_pitch * 1e-6; break;
                            case DSPMode.CWL: cfreq += cw_pitch * 1e-6; break;
                        }
                    }

                    int clow = (int)PixelToHz(e.X - 3);
                    int chigh = (int)PixelToHz(e.X + 3);

                    List<Notch> lst = NotchList.NotchesInBW(cfreq, clow, chigh);

                    if (lst.Count > 0)
                    {
                        // make sure we have a check mark on remembered in the context menu if necessary
                        toolStripNotchRemember.Checked = lst[0].Permanent;
                        // display the pop-up
                        contextMenuStripNotch.Show(Cursor.Position);
                        Context_Notch = lst[0];
                        toolStripNotchNormal.Checked = (lst[0].Depth == 1);
                        toolStripNotchDeep.Checked = (lst[0].Depth == 2);
                        toolStripNotchVeryDeep.Checked = (lst[0].Depth == 3);
                    }
                    else
                        if (gridmaxadjust)
                        {
                            if (!mox)
                            {
                                decimal val = SetupForm.udDisplayGridMax.Value;
                                val -= 5;

                                if (val < SetupForm.udDisplayGridMax.Minimum)
                                    val = SetupForm.udDisplayGridMax.Minimum;

                                SetupForm.udDisplayGridMax.Value = val;
                            }
                            else
                            {
                                decimal val = SetupForm.udTXGridMax.Value;
                                val -= 5;

                                if (val < SetupForm.udTXGridMax.Minimum)
                                    val = SetupForm.udTXGridMax.Minimum;

                                SetupForm.udTXGridMax.Value = val;
                            }
                        }
                        else if (gridminadjust)
                        {
                            if (!mox)
                            {
                                decimal val = SetupForm.udDisplayGridMin.Value;
                                val -= 5;

                                if (val < SetupForm.udDisplayGridMin.Minimum)
                                    val = SetupForm.udDisplayGridMin.Minimum;

                                SetupForm.udDisplayGridMin.Value = val;
                            }
                            else
                            {
                                decimal val = SetupForm.udTXGridMin.Value;
                                val -= 5;

                                if (val < SetupForm.udTXGridMin.Minimum)
                                    val = SetupForm.udTXGridMin.Minimum;

                                SetupForm.udTXGridMin.Value = val;
                            }
                        }

                        else if (wfmaxadjust)
                        {
                            decimal val = SetupForm.udDisplayWaterfallHighLevel.Value;
                            val -= 5;

                            if (val < SetupForm.udDisplayWaterfallHighLevel.Minimum)
                                val = SetupForm.udDisplayWaterfallHighLevel.Minimum;

                            SetupForm.udDisplayWaterfallHighLevel.Value = val;
                        }
                        else if (wfminadjust)
                        {
                            decimal val = SetupForm.udDisplayWaterfallLowLevel.Value;
                            val -= 5;

                            if (val < SetupForm.udDisplayWaterfallLowLevel.Minimum)
                                val = SetupForm.udDisplayWaterfallLowLevel.Minimum;

                            SetupForm.udDisplayWaterfallLowLevel.Value = val;
                        }
                        else
                        {
                            switch (current_click_tune_mode)
                            {
                                case ClickTuneMode.Off:
                                    CurrentClickTuneMode = ClickTuneMode.VFOA;
                                    break;
                                case ClickTuneMode.VFOA:
                                    if (chkVFOSplit.Checked || chkEnableMultiRX.Checked)
                                        CurrentClickTuneMode = ClickTuneMode.VFOB;
                                    else
                                        CurrentClickTuneMode = ClickTuneMode.Off;
                                    break;
                                case ClickTuneMode.VFOB:
                                    CurrentClickTuneMode = ClickTuneMode.Off;
                                    break;
                            }
                        }
                    break;
                case MouseButtons.Middle:
                    if (mouse_tune_step)
                    {
                        if (shift_down) ChangeTuneStepDown();
                        else ChangeTuneStepUp();
                    }
                    break;
            }
        }

        private void picDisplay_MouseUp(object sender, MouseEventArgs e)
        {
            if (e.Button == MouseButtons.Left)
            {
                switch (Display.CurrentDisplayMode)
                {
                    case DisplayMode.PANADAPTER:
                    case DisplayMode.WATERFALL:
                    case DisplayMode.PANAFALL:
                    case DisplayMode.PANASCOPE:
                        rx1_low_filter_drag = false;
                        rx1_high_filter_drag = false;
                        rx1_whole_filter_drag = false;
                        rx2_low_filter_drag = false;
                        rx2_high_filter_drag = false;
                        rx2_whole_filter_drag = false;
                        tx_low_filter_drag = false;
                        tx_high_filter_drag = false;
                        tx_whole_filter_drag = false;
                        agc_knee_drag = false;
                        agc_hang_drag = false;
                        // agc_knee_drag_max_delta_x = 0;
                        // agc_knee_drag_max_delta_y = 0;
                        notch_drag = false;
                        notch_drag_max_delta_x = 0;
                        notch_drag_max_delta_y = 0;
                        timerNotchZoom.Enabled = false;
                        notch_zoom = false;
                        if (Display.TNFZoom)
                        {
                            Display.TNFZoom = false;
                        }
                        // stop showing details for this notch in the panadapter
                        if (notch_drag_active != null)
                        {
                            notch_drag_active.Details = false;
                            notch_drag_active = null;
                        }
                        //rx2_sub_drag = false;
                        break;
                }

                if (rx1_sub_drag)
                {
                    rx1_sub_drag = false;
                    if (rx2_enabled) txtVFOABand_LostFocus(this, EventArgs.Empty);
                    else txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                }

                if (rx1_spectrum_drag)
                {
                    rx1_spectrum_drag = false;
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                }
                rx2_spectrum_drag = false;
                //Cursor = Cursors.Default;

            }
        }

        private void picDisplay_DoubleClick(object sender, EventArgs e)
        {
            int new_val = (int)PixelToDb(display_cursor_y);
            if (!(gridmaxadjust || gridminadjust))
            {
                if (!mox) //RX1
                {
                    if (rx1_dsp_mode == DSPMode.FM)
                        return;

                    if (new_val > ptbSquelch.Maximum) new_val = ptbSquelch.Maximum;
                    if (new_val < ptbSquelch.Minimum) new_val = ptbSquelch.Minimum;
                    ptbSquelch.Value = new_val;
                    ptbSquelch_Scroll(this, EventArgs.Empty);
                }
                else // TX
                {
                    new_val += 24;
                    if (new_val > ptbNoiseGate.Maximum) new_val = ptbNoiseGate.Maximum;
                    if (new_val < ptbNoiseGate.Minimum) new_val = ptbNoiseGate.Minimum;
                    ptbNoiseGate.Value = new_val;
                    ptbNoiseGate_Scroll(this, EventArgs.Empty);
                }
            }

        }

        private void picDisplay_Resize(object sender, System.EventArgs e)
        {
            Display.Target = picDisplay;
            Display.Init();
            //Display.DrawBackground();
            UpdateDisplay();
        }

        private void ptbDisplayPan_Scroll(object sender, System.EventArgs e)
        {
            CalcDisplayFreq();
            if (ptbDisplayPan.Focused) btnHidden.Focus();
        }

        private void btnDisplayPanCenter_Click(object sender, System.EventArgs e)
        {
            //double edge_alias = 7200.0;
            //double if_freq = 11025.0;
            double spur_tune_width = 200e6 / Math.Pow(2, 16);
            if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                spur_tune_width = 500e6 / Math.Pow(2, 16);
            int width = Display.RXDisplayHigh - Display.RXDisplayLow;

            int max_pan_width = (int)(sample_rate1 - 2 * spur_tune_width - width);
            if (max_pan_width == 0)
            {
                ptbDisplayPan.Value = (ptbDisplayPan.Maximum - ptbDisplayPan.Minimum) / 2;
                ptbDisplayPan_Scroll(btnDisplayPanCenter, EventArgs.Empty);
                return;
            }
            int abs_low;
            int low = -width / 2; // target -- if width is centered at 0, low will be half the width below 0
            if (ModelIsHPSDRorHermes())
                abs_low = (int)(-(double)sample_rate1 * 0.5 + spur_tune_width);
            else
                abs_low = (int)(-(double)sample_rate1 * 0.5 - if_freq * 1000000.0 + spur_tune_width);
            int offset = low - abs_low;

            int new_val = (int)((double)offset * (double)ptbDisplayPan.Maximum / (double)max_pan_width);
            ptbDisplayPan.Value = Math.Min(Math.Max(ptbDisplayPan.Minimum, new_val), ptbDisplayPan.Maximum);
            ptbDisplayPan_Scroll(btnDisplayPanCenter, EventArgs.Empty);
        }

        private void ptbDisplayZoom_Scroll(object sender, System.EventArgs e)
        {
            double zoom_factor = 1.0 / ((ptbDisplayZoom.Maximum + ptbDisplayZoom.Minimum - ptbDisplayZoom.Value) * 0.01);
            //double zoom_factor = ptbDisplayZoom.Value / 4;
            toolTip1.SetToolTip(ptbDisplayZoom, zoom_factor.ToString("F"));
            if (zoom_factor == 0.5) radDisplayZoom05.Checked = true;
            else if (zoom_factor == 1.0) radDisplayZoom1x.Checked = true;
            else if (zoom_factor == 2.0) radDisplayZoom2x.Checked = true;
            else if (zoom_factor == 4.0) radDisplayZoom4x.Checked = true;
            else
            {
                radDisplayZoom05.Checked = false;
                radDisplayZoom1x.Checked = false;
                radDisplayZoom2x.Checked = false;
                radDisplayZoom4x.Checked = false;
            }

            CalcDisplayFreq();

            if (ptbDisplayZoom.Focused) btnHidden.Focus();
        }

        private void radDisplayZoom05_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radDisplayZoom05.Checked)
            {
                ptbDisplayZoom.Value = ptbDisplayZoom.Maximum + ptbDisplayZoom.Minimum - (int)(100.0 / 0.5);
                ptbDisplayZoom_Scroll(this, EventArgs.Empty);
                btnDisplayPanCenter_Click(this, EventArgs.Empty);
            }
        }

        private void radDisplayZoom1x_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radDisplayZoom1x.Checked)
            {
                ptbDisplayZoom.Value = ptbDisplayZoom.Maximum + ptbDisplayZoom.Minimum - (int)(100.0 / 1.0);
                ptbDisplayZoom_Scroll(this, EventArgs.Empty);
                btnDisplayPanCenter_Click(this, EventArgs.Empty);
            }
        }

        private void radDisplayZoom2x_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radDisplayZoom2x.Checked)
            {
                ptbDisplayZoom.Value = ptbDisplayZoom.Maximum + ptbDisplayZoom.Minimum - (int)(100.0 / 2.0);
                ptbDisplayZoom_Scroll(this, EventArgs.Empty);
                btnDisplayPanCenter_Click(this, EventArgs.Empty);
            }
        }

        private void radDisplayZoom4x_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radDisplayZoom4x.Checked)
            {
                ptbDisplayZoom.Value = ptbDisplayZoom.Maximum + ptbDisplayZoom.Minimum - (int)(100.0 / 4.0);
                ptbDisplayZoom_Scroll(this, EventArgs.Empty);
                btnDisplayPanCenter_Click(this, EventArgs.Empty);
            }
        }

        #endregion

        #region Band Button Events
        // ======================================================
        // Band Button Events
        // ======================================================

        private void radBand160_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("160M"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_160m_index = (band_160m_index - 1 + band_160m_register) % band_160m_register;
                else
                    band_160m_index = (band_160m_index + 1) % band_160m_register;
            }
            last_band = "160M";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_160m_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }

        private void radBand80_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("80M"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_80m_index = (band_80m_index - 1 + band_80m_register) % band_80m_register;
                else
                    band_80m_index = (band_80m_index + 1) % band_80m_register;
            }
            last_band = "80M";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_80m_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }


        private void radBand60_Click(object sender, EventArgs e)
        {
            if (RX1IsIn60m() && !RX1IsOn60mChannel())
            {
                // jump to nearest 60m band
                double jump_freq = 0;
                double min_delta = double.MaxValue;
                double offset = ModeFreqOffset(rx1_dsp_mode);
                int index = 0;
                int min_index = 0;
                foreach (Channel c in Channels60m)
                {
                    double freq = c.Freq + offset;
                    double delta = Math.Abs(freq - VFOAFreq);
                    if (delta < min_delta)
                    {
                        min_delta = delta;
                        jump_freq = freq;
                        min_index = index;
                    }
                    index++;
                }

                VFOAFreq = jump_freq;
                band_60m_index = min_index; // sets the band stack index
                last_band = "60M";
            }
            else
            {
                SaveBand();
                if (last_band.Equals("60M"))
                {
                    if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                        band_60m_index = (band_60m_index - 1 + band_60m_register) % band_60m_register;
                    else
                        band_60m_index = (band_60m_index + 1) % band_60m_register;
                }
                last_band = "60M";

                string filter, mode;
                double freq;
                if (DB.GetBandStack(last_band, band_60m_index, out mode, out filter, out freq))
                {
                    SetBand(mode, filter, freq);
                }
            }
        }

        private void radBand40_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("40M"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_40m_index = (band_40m_index - 1 + band_40m_register) % band_40m_register;
                else
                    band_40m_index = (band_40m_index + 1) % band_40m_register;
            }
            last_band = "40M";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_40m_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }

        private void radBand30_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("30M"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_30m_index = (band_30m_index - 1 + band_30m_register) % band_30m_register;
                else
                    band_30m_index = (band_30m_index + 1) % band_30m_register;
            }
            last_band = "30M";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_30m_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }

        private void radBand20_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("20M"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_20m_index = (band_20m_index - 1 + band_20m_register) % band_20m_register;
                else
                    band_20m_index = (band_20m_index + 1) % band_20m_register;
            }
            last_band = "20M";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_20m_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }

        private void radBand17_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("17M"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_17m_index = (band_17m_index - 1 + band_17m_register) % band_17m_register;
                else
                    band_17m_index = (band_17m_index + 1) % band_17m_register;
            }
            last_band = "17M";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_17m_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }

        private void radBand15_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("15M"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_15m_index = (band_15m_index - 1 + band_15m_register) % band_15m_register;
                else
                    band_15m_index = (band_15m_index + 1) % band_15m_register;
            }
            last_band = "15M";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_15m_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }

        }

        private void radBand12_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("12M"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_12m_index = (band_12m_index - 1 + band_12m_register) % band_12m_register;
                else
                    band_12m_index = (band_12m_index + 1) % band_12m_register;
            }
            last_band = "12M";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_12m_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }

        private void radBand10_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("10M"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_10m_index = (band_10m_index - 1 + band_10m_register) % band_10m_register;
                else
                    band_10m_index = (band_10m_index + 1) % band_10m_register;
            }
            last_band = "10M";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_10m_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }

        private void radBand6_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("6M"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_6m_index = (band_6m_index - 1 + band_6m_register) % band_6m_register;
                else
                    band_6m_index = (band_6m_index + 1) % band_6m_register;
            }
            last_band = "6M";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_6m_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }

        private void radBand2_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("2M"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_2m_index = (band_2m_index - 1 + band_2m_register) % band_2m_register;
                else
                    band_2m_index = (band_2m_index + 1) % band_2m_register;
            }
            last_band = "2M";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_2m_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }

        private void radBandWWV_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band.Equals("WWV"))
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_wwv_index = (band_wwv_index - 1 + band_wwv_register) % band_wwv_register;
                else
                    band_wwv_index = (band_wwv_index + 1) % band_wwv_register;
            }
            last_band = "WWV";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_wwv_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }


        private void radBandGEN_Click(object sender, EventArgs e)
        {
            SaveBand();
            if (last_band == "GEN")
            {
                if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                    band_gen_index = (band_gen_index - 1 + band_gen_register) % band_gen_register;
                else
                    band_gen_index = (band_gen_index + 1) % band_gen_register;
            }
            last_band = "GEN";

            string filter, mode;
            double freq;
            if (DB.GetBandStack(last_band, band_gen_index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }

        private void radBandVHF_Click(object sender, EventArgs e)
        {
            SaveBand();

            string new_band = ((Control)sender).Name.Substring(7);
            int index = -1, register = -1;

            switch (new_band)
            {
                case "VHF0": index = band_vhf0_index; register = band_vhf0_register; break;
                case "VHF1": index = band_vhf1_index; register = band_vhf1_register; break;
                case "VHF2": index = band_vhf2_index; register = band_vhf2_register; break;
                case "VHF3": index = band_vhf3_index; register = band_vhf3_register; break;
                case "VHF4": index = band_vhf4_index; register = band_vhf4_register; break;
                case "VHF5": index = band_vhf5_index; register = band_vhf5_register; break;
                case "VHF6": index = band_vhf6_index; register = band_vhf6_register; break;
                case "VHF7": index = band_vhf7_index; register = band_vhf7_register; break;
                case "VHF8": index = band_vhf8_index; register = band_vhf8_register; break;
                case "VHF9": index = band_vhf9_index; register = band_vhf9_register; break;
                case "VHF10": index = band_vhf10_index; register = band_vhf10_register; break;
                case "VHF11": index = band_vhf11_index; register = band_vhf11_register; break;
                case "VHF12": index = band_vhf12_index; register = band_vhf12_register; break;
                case "VHF13": index = band_vhf13_index; register = band_vhf13_register; break;
            }

            int xvtr_index = Int32.Parse(new_band.Substring(3));
            double start_freq = XVTRForm.GetBegin(xvtr_index);
            double end_freq = XVTRForm.GetEnd(xvtr_index);
            if (register < 3)
            {
                for (int i = 0; i < 3 - register; i++)
                    DB.AddBandStack(new_band, "USB", "2600", start_freq + i * 0.0010);

                UpdateBandStackRegisters();
                register = 3;
            }
            else
            {
                if (last_band == new_band)
                {
                    if ((Control.ModifierKeys & Keys.Shift) == Keys.Shift)
                        index = (index - 1 + register) % register;
                    else
                        index = (index + 1) % register;
                }

                switch (new_band)
                {
                    case "VHF0": band_vhf0_index = index; break;
                    case "VHF1": band_vhf1_index = index; break;
                    case "VHF2": band_vhf2_index = index; break;
                    case "VHF3": band_vhf3_index = index; break;
                    case "VHF4": band_vhf4_index = index; break;
                    case "VHF5": band_vhf5_index = index; break;
                    case "VHF6": band_vhf6_index = index; break;
                    case "VHF7": band_vhf7_index = index; break;
                    case "VHF8": band_vhf8_index = index; break;
                    case "VHF9": band_vhf9_index = index; break;
                    case "VHF10": band_vhf10_index = index; break;
                    case "VHF11": band_vhf11_index = index; break;
                    case "VHF12": band_vhf12_index = index; break;
                    case "VHF13": band_vhf13_index = index; break;
                }
            }
            last_band = new_band;

            string filter, mode;
            double freq;

            for (int i = 0; i < 3; i++)
            {
                DB.GetBandStack(last_band, i, out mode, out filter, out freq);
                if (freq < start_freq || freq > end_freq)
                    DB.SaveBandStack(last_band, i, mode, filter, start_freq + i * 0.001);
            }

            if (DB.GetBandStack(last_band, index, out mode, out filter, out freq))
            {
                SetBand(mode, filter, freq);
            }
        }

        #endregion

        #region Mode Button Events
        // ======================================================
        // Mode Button Events
        // ======================================================

        private void SetRX1Mode(DSPMode new_mode)
        {
            if (new_mode == DSPMode.FIRST || new_mode == DSPMode.LAST) return;

            DSPMode old_mode = rx1_dsp_mode;

            radio.GetDSPRX(0, 0).DSPMode = new_mode;				// set new DSP mode
            radio.GetDSPRX(0, 1).DSPMode = new_mode;

            if (chkVFOATX.Checked || !rx2_enabled)
            {
                Audio.TXDSPMode = new_mode;
                radio.GetDSPTX(0).CurrentDSPMode = new_mode;
                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                    FWC.SetTXDSPMode(new_mode);
            }
            Display.RX1DSPMode = new_mode;
            if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                FWC.SetRX1DSPMode(new_mode);

            double rx1_freq = VFOAFreq;
            int old_txosc = (int)radio.GetDSPTX(0).TXOsc;

            ptbFilterShift.Value = 0;
            btnFilterShiftReset.BackColor = SystemColors.Control;

            switch (old_mode)
            {
                case DSPMode.LSB:
                    radModeLSB.BackColor = SystemColors.Control;
                    break;
                case DSPMode.USB:
                    radModeUSB.BackColor = SystemColors.Control;
                    break;
                case DSPMode.DSB:
                    radModeDSB.BackColor = SystemColors.Control;
                    break;
                case DSPMode.CWL:
                    radModeCWL.BackColor = SystemColors.Control;

                    if ((chkVFOATX.Checked || !rx2_enabled) && new_mode != DSPMode.CWU && new_mode != DSPMode.CWL)
                    {
                        chkMON.Checked = mon_recall;
                    }

                    if (!RX1IsOn60mChannel())
                    {
                        switch (new_mode)
                        {
                            case DSPMode.USB:
                                rx1_freq -= (cw_pitch * 0.0000010);
                                break;
                            case DSPMode.CWU:
                                break;
                            default:
                                rx1_freq += (cw_pitch * 0.0000010);
                                break;
                        }
                        txtVFOAFreq.Text = rx1_freq.ToString("f6");
                    }
                    break;
                case DSPMode.CWU:
                    radModeCWU.BackColor = SystemColors.Control;

                    if ((chkVFOATX.Checked || !rx2_enabled) && new_mode != DSPMode.CWL && new_mode != DSPMode.CWU)
                    {
                        chkMON.Checked = mon_recall;
                        // DttSP.StopKeyer();
                        // cw_key_mode = false;
                    }

                    if (!RX1IsOn60mChannel())
                    {
                        switch (new_mode)
                        {
                            case DSPMode.LSB:
                                rx1_freq += (cw_pitch * 0.0000010);
                                break;
                            case DSPMode.CWL:
                                break;
                            default:
                                rx1_freq -= (cw_pitch * 0.0000010);
                                break;
                        }
                        txtVFOAFreq.Text = rx1_freq.ToString("f6");
                    }
                    break;
                case DSPMode.FM:
                    radModeFMN.BackColor = SystemColors.Control;
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        if (new_mode != DSPMode.AM &&
                            new_mode != DSPMode.SAM &&
                            new_mode != DSPMode.FM)
                        {
                            //chkMON.Enabled = true;
                            chkBIN.Enabled = true;
                        }

                        ptbMic_Scroll(this, EventArgs.Empty);
                    }
                    if (new_mode != DSPMode.SPEC || new_mode != DSPMode.DRM)
                        EnableAllFilters();

                    if (!initializing)
                        rx1_fm_squelch_threshold_scroll = ptbSquelch.Value;

                    ptbSquelch.Minimum = -160;
                    ptbSquelch.Maximum = 0;
                    if (!collapsedDisplay)
                        picSquelch.Visible = true;

                    ptbSquelch.Value = rx1_squelch_threshold_scroll;
                    break;
                case DSPMode.AM:
                    radModeAM.BackColor = SystemColors.Control;
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        if (new_mode != DSPMode.AM &&
                            new_mode != DSPMode.SAM &&
                            new_mode != DSPMode.FM)
                        {
                            //chkMON.Enabled = true;
                            chkBIN.Enabled = true;
                        }
                    }
                    break;
                case DSPMode.SAM:
                    radModeSAM.BackColor = SystemColors.Control;
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        if (new_mode != DSPMode.AM &&
                            new_mode != DSPMode.SAM &&
                            new_mode != DSPMode.FM)
                        {
                            //chkMON.Enabled = true;
                            chkBIN.Enabled = true;
                        }
                    }
                    break;
                case DSPMode.SPEC:
                    radModeSPEC.BackColor = SystemColors.Control;
                    comboDisplayMode.Items.Insert(1, "Panadapter");
                    comboDisplayMode.Items.Insert(5, "Waterfall");
                    ptbFilterShift.Enabled = true;
                    btnFilterShiftReset.Enabled = true;
                    if (new_mode != DSPMode.DRM || new_mode != DSPMode.FM)
                        EnableAllFilters();
                    RX1Filter = rx1_filter;
                    //if_shift = true;
                    if (was_panadapter) comboDisplayMode.Text = "Panadapter";
                    else if (was_waterfall) comboDisplayMode.Text = "Waterfall";
                    switch (Display.CurrentDisplayMode)
                    {
                        case DisplayMode.PANADAPTER:
                        case DisplayMode.WATERFALL:
                        case DisplayMode.PANAFALL:
                        case DisplayMode.PANASCOPE:
                            radio.GetDSPRX(0, 0).SpectrumPreFilter = true;
                            break;
                        default:
                            radio.GetDSPRX(0, 0).SpectrumPreFilter = false;
                            break;
                    }
                    break;
                case DSPMode.DIGL:
                    radModeDIGL.BackColor = SystemColors.Control;
                    if (vac_auto_enable &&
                        new_mode != DSPMode.DIGU &&
                        new_mode != DSPMode.DRM)
                    {
                        SetupForm.VACEnable = false;
                    }
                    break;
                case DSPMode.DIGU:
                    radModeDIGU.BackColor = SystemColors.Control;
                    if (vac_auto_enable &&
                        new_mode != DSPMode.DIGL &&
                        new_mode != DSPMode.DRM)
                    {
                        SetupForm.VACEnable = false;
                    }
                    break;
                case DSPMode.DRM:
                    radModeDRM.BackColor = SystemColors.Control;
                    //if_shift = true;
                    vfo_offset = 0.0;
                    if (vac_auto_enable &&
                        new_mode != DSPMode.DIGL &&
                        new_mode != DSPMode.DIGU)
                    {
                        SetupForm.VACEnable = false;
                    }
                    ptbFilterShift.Enabled = true;
                    btnFilterShiftReset.Enabled = true;
                    if (new_mode != DSPMode.SPEC || new_mode != DSPMode.FM)
                        EnableAllFilters();
                    if_freq = SetupForm.IFFreq;
                    CalcDisplayFreq();
                    chkTNF.Enabled = true;
                    btnTNFAdd.Enabled = true;
                    break;
            }

            switch (new_mode)
            {
                case DSPMode.LSB:
                    radModeLSB.BackColor = button_selected_color;
                    //grpMode.Text = "Mode - LSB";
                    if (!rx_only && PowerOn)
                        chkMOX.Enabled = true;
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }
                    panelModeSpecificPhone.BringToFront();
                    break;
                case DSPMode.USB:
                    radModeUSB.BackColor = button_selected_color;
                    //grpMode.Text = "Mode - USB";
                    if (!rx_only && chkPower.Checked)
                        chkMOX.Enabled = true;
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }
                    panelModeSpecificPhone.BringToFront();
                    break;
                case DSPMode.DSB:
                    radModeDSB.BackColor = button_selected_color;
                    //grpMode.Text = "Mode - DSB";
                    if (!rx_only && chkPower.Checked)
                        chkMOX.Enabled = true;
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }
                    panelModeSpecificPhone.BringToFront();
                    break;
                case DSPMode.CWL:
                    radModeCWL.BackColor = button_selected_color;
                    //grpMode.Text = "Mode - CWL";
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        CWPitch = cw_pitch;
                        radio.GetDSPTX(0).TXOsc = 0.0;
                        // RadioDSP.KeyerFreq = cw_pitch;
                        if (!rx_only && chkPower.Checked)
                        {
                            chkMOX.Enabled = true;
                            //  DttSP.StopKeyer();
                            //  DttSP.CWRingRestart();
                            // DttSP.StartKeyer();
                        }
                        //  cw_key_mode = true;
                        if (old_mode != DSPMode.CWL && old_mode != DSPMode.CWU)
                        {
                            if (!initializing)
                                mon_recall = chkMON.Checked;
                             chkMON.Checked = cw_sidetone;
                        }
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                    }

                    if (!RX1IsOn60mChannel())
                    {
                        switch (rx1_dsp_mode)
                        {
                            case DSPMode.USB:
                                rx1_freq += (cw_pitch * 1e-6);
                                break;
                            case DSPMode.CWU:
                                break;
                            default:
                                rx1_freq -= (cw_pitch * 1e-6);
                                break;
                        }
                        txtVFOAFreq.Text = rx1_freq.ToString("f6");
                    }
                    panelModeSpecificCW.BringToFront();
                    break;
                case DSPMode.CWU:
                    radModeCWU.BackColor = button_selected_color;
                    //grpMode.Text = "Mode - CWU";
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        CWPitch = cw_pitch;
                        radio.GetDSPTX(0).TXOsc = 0.0;
                        // RadioDSP.KeyerFreq = -cw_pitch;
                        if (!rx_only && chkPower.Checked)
                        {
                            chkMOX.Enabled = true;
                            //  DttSP.StopKeyer();
                            // DttSP.CWRingRestart();
                            // DttSP.StartKeyer();
                        }
                        //    cw_key_mode = true;

                        if (rx1_dsp_mode != DSPMode.CWL)
                        {
                            if (!initializing)
                                mon_recall = chkMON.Checked;
                           chkMON.Checked = cw_sidetone;
                        }

                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                    }
                    if (!RX1IsOn60mChannel())
                    {
                        switch (rx1_dsp_mode)
                        {
                            case DSPMode.LSB:
                                rx1_freq -= (cw_pitch * 1e-6);
                                break;
                            case DSPMode.CWL:
                                break;
                            default:
                                rx1_freq += (cw_pitch * 1e-6);
                                break;
                        }
                        txtVFOAFreq.Text = rx1_freq.ToString("f6");
                    }
                    panelModeSpecificCW.BringToFront();
                    break;
                case DSPMode.FM:
                    radModeFMN.BackColor = button_selected_color;
                    DisableAllFilters();

                    if (!initializing)
                        rx1_squelch_threshold_scroll = ptbSquelch.Value;

                    ptbSquelch.Minimum = 0;
                    ptbSquelch.Maximum = 100;

                    ptbSquelch.Value = rx1_fm_squelch_threshold_scroll;

                    picSquelch.Visible = false;

                    rx1_squelch_on = chkSquelch.Checked;    //save state of non-FM squelch
                    chkSquelch.Checked = true;

                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        if (!rx_only && chkPower.Checked)
                            chkMOX.Enabled = true;
                        chkMON.Checked = false;
                        chkMON.Enabled = false;
                        chkBIN.Checked = false;
                        chkBIN.Enabled = false;
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        //radio.GetDSPTX(0).TXOsc = 11025.0; //w5wc-1

                        ptbFMMic_Scroll(this, EventArgs.Empty);
                    }
                    panelModeSpecificFM.BringToFront();
                    // chkANF.Enabled = true;
                    break;
                case DSPMode.AM:
                    radModeAM.BackColor = button_selected_color;
                    //grpMode.Text = "Mode - AM";
                    if (!rx_only && chkPower.Checked)
                        chkMOX.Enabled = true;
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        chkMON.Checked = false;
                        chkMON.Enabled = false;
                        chkBIN.Checked = false;
                        chkBIN.Enabled = false;
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        //radio.GetDSPTX(0).TXOsc = 11025.0; // w5wc-1
                    }
                    panelModeSpecificPhone.BringToFront();
                    break;
                case DSPMode.SAM:
                    radModeSAM.BackColor = button_selected_color;
                    //grpMode.Text = "Mode - SAM";
                    if (!rx_only && chkPower.Checked)
                        chkMOX.Enabled = true;
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        chkMON.Checked = false;
                        chkMON.Enabled = false;
                        chkBIN.Checked = false;
                        chkBIN.Enabled = false;
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        //radio.GetDSPTX(0).TXOsc = 11025.0; // w5wc-1
                    }
                    panelModeSpecificPhone.BringToFront();
                    break;
                case DSPMode.SPEC:
                    radModeSPEC.BackColor = button_selected_color;
                    //grpMode.Text = "Mode - SPEC";
                    if_shift = false;
                    radio.GetDSPRX(0, 0).RXOsc = 0.0;
                    DisableAllFilters();
                    ptbFilterShift.Enabled = false;
                    btnFilterShiftReset.Enabled = false;
                    bool save_pan = (Display.CurrentDisplayMode == DisplayMode.PANADAPTER);
                    bool save_water = (Display.CurrentDisplayMode == DisplayMode.WATERFALL);
                    if (save_pan || save_water)
                    {
                        comboDisplayMode.Text = "Spectrum";
                    }
                    comboDisplayMode.Items.Remove("Panadapter");
                    comboDisplayMode.Items.Remove("Waterfall");
                    was_panadapter = save_pan;
                    was_waterfall = save_water;
                    radio.GetDSPRX(0, 0).SpectrumPreFilter = true;
                    Display.RXDisplayLow = -(int)sample_rate1 / 2;
                    Display.RXDisplayHigh = (int)sample_rate1 / 2;
                    break;
                case DSPMode.DIGL:
                    radModeDIGL.BackColor = button_selected_color;
                    //grpMode.Text = "Mode - DIGL";
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }
                    if (vac_auto_enable)
                        SetupForm.VACEnable = true;

                    panelModeSpecificDigital.BringToFront();
                    break;
                case DSPMode.DIGU:
                    radModeDIGU.BackColor = button_selected_color;
                    //grpMode.Text = "Mode - DIGU";
                    if (chkVFOATX.Checked)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }
                    if (vac_auto_enable)
                        SetupForm.VACEnable = true;

                    panelModeSpecificDigital.BringToFront();
                    break;
                case DSPMode.DRM:
                    if_shift = false;
                    vfo_offset = -0.012;
                    radModeDRM.BackColor = button_selected_color;
                    //grpMode.Text = "Mode - DRM";
                    if (vac_auto_enable)
                        SetupForm.VACEnable = true;
                    //chkMOX.Enabled = false;
                    if (chkVFOATX.Checked || !rx2_enabled)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }
                    DisableAllFilters();
                    ptbFilterShift.Enabled = false;
                    btnFilterShiftReset.Enabled = false;
                    //grpFilter.Text = "Filter - DRM";
                    radio.GetDSPRX(0, 0).SetRXFilter(7000, 17000);
                    /*Display.RXDisplayLow = -8000;
                        Display.RXDisplayHigh = 8000;*/
                    panelModeSpecificDigital.BringToFront();
                    btnTNFAdd.Enabled = false;
                    chkTNF.Enabled = false;
                    chkTNF.Checked = false;
                    break;
            }

            if (RX1IsOn60mChannel())
            {
                rx1_freq += (-ModeFreqOffset(rx1_dsp_mode)) + ModeFreqOffset(new_mode);
                txtVFOAFreq.Text = rx1_freq.ToString("f6");
            }

            int new_txosc = (int)radio.GetDSPTX(0).TXOsc;
            if (new_txosc != old_txosc)
            {
                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                    FWC.SetTXOffset(new_txosc);
            }

            FilterToolStripMenuItem1.Text = (radFilter1.Text = rx1_filters[(int)new_mode].GetName(Filter.F1));
            FilterToolStripMenuItem2.Text = (radFilter2.Text = rx1_filters[(int)new_mode].GetName(Filter.F2));
            FilterToolStripMenuItem3.Text = (radFilter3.Text = rx1_filters[(int)new_mode].GetName(Filter.F3));
            FilterToolStripMenuItem4.Text = (radFilter4.Text = rx1_filters[(int)new_mode].GetName(Filter.F4));
            FilterToolStripMenuItem5.Text = (radFilter5.Text = rx1_filters[(int)new_mode].GetName(Filter.F5));
            FilterToolStripMenuItem6.Text = (radFilter6.Text = rx1_filters[(int)new_mode].GetName(Filter.F6));
            FilterToolStripMenuItem7.Text = (radFilter7.Text = rx1_filters[(int)new_mode].GetName(Filter.F7));
            FilterToolStripMenuItem8.Text = (radFilter8.Text = rx1_filters[(int)new_mode].GetName(Filter.F8));
            FilterToolStripMenuItem9.Text = (radFilter9.Text = rx1_filters[(int)new_mode].GetName(Filter.F9));
            FilterToolStripMenuItem10.Text = (radFilter10.Text = rx1_filters[(int)new_mode].GetName(Filter.F10));
            radFilterVar1.Text = rx1_filters[(int)new_mode].GetName(Filter.VAR1);
            radFilterVar2.Text = rx1_filters[(int)new_mode].GetName(Filter.VAR2);

            rx1_dsp_mode = new_mode;
            //  Keyer.RX1DSPMode = new_mode;

            if (old_mode == DSPMode.FM)
                chkSquelch.Checked = rx1_squelch_on;

            if (old_mode == DSPMode.FM || new_mode == DSPMode.FM)
                ptbSquelch_Scroll(this, EventArgs.Empty);

            if (rx1_dsp_mode != DSPMode.SPEC && rx1_dsp_mode != DSPMode.FM && rx1_dsp_mode != DSPMode.DRM)
            {
                RX1Filter = rx1_filters[(int)new_mode].LastFilter;
            }
            else
            {
                if (rx1_dsp_mode == DSPMode.FM)
                {
                    if (radio.GetDSPTX(0).TXFMDeviation == 5000)
                    {
                        UpdateRX1Filters(-8000, 8000);
                    }
                    else
                    {
                        UpdateRX1Filters(-4000, 4000);
                    }
                }

                RX1Filter = Filter.NONE;
                //grpFilter.Text = "Filter - "+(sample_rate1/1000).ToString("f0")+"kHz";
            }
            BINToolStripMenuItem.Enabled = chkBIN.Enabled;

            tbFilterWidthScroll_newMode(); // wjt 

            //Display.DrawBackground();

            UpdateDSPBufRX1();
            UpdateDSPBufTX();

            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            ptbPWR_Scroll(this, EventArgs.Empty);
        }

        private void radModeButton_CheckedChanged(object sender, System.EventArgs e)
        {
            if (sender == null) return;
            if (sender.GetType() != typeof(RadioButtonTS)) return;
            RadioButtonTS radioBtnTS = (RadioButtonTS)sender;
            if (!radioBtnTS.Checked) return;
            string radiobut = ((RadioButtonTS)sender).Text;

            switch (radiobut)
            {
                case "LSB":
                    SetRX1Mode(DSPMode.LSB);
                    lblModeLabel.Text = radModeLSB.Text;
                    break;
                case "USB":
                    SetRX1Mode(DSPMode.USB);
                    lblModeLabel.Text = radModeUSB.Text;
                    break;
                case "DSB":
                    SetRX1Mode(DSPMode.DSB);
                    lblModeLabel.Text = radModeDSB.Text;
                    break;
                case "CWL":
                    SetRX1Mode(DSPMode.CWL);
                    lblModeLabel.Text = radModeCWL.Text;
                    break;
                case "CWU":
                    SetRX1Mode(DSPMode.CWU);
                    lblModeLabel.Text = radModeCWU.Text;
                    break;
                case "FM":
                    SetRX1Mode(DSPMode.FM);
                    lblModeLabel.Text = radModeFMN.Text;
                    break;
                case "AM":
                    SetRX1Mode(DSPMode.AM);
                    lblModeLabel.Text = radModeAM.Text;
                    break;
                case "SAM":
                    SetRX1Mode(DSPMode.SAM);
                    lblModeLabel.Text = radModeSAM.Text;
                    break;
                case "SPEC":
                    SetRX1Mode(DSPMode.SPEC);
                    lblModeLabel.Text = radModeSPEC.Text;
                    break;
                case "DIGL":
                    SetRX1Mode(DSPMode.DIGL);
                    lblModeLabel.Text = radModeDIGL.Text;
                    break;
                case "DIGU":
                    SetRX1Mode(DSPMode.DIGU);
                    lblModeLabel.Text = radModeDIGU.Text;
                    break;
                case "DRM":
                    SetRX1Mode(DSPMode.DRM);
                    lblModeLabel.Text = radModeDRM.Text;
                    break;
            }
            lSBToolStripMenuItem.Checked = radModeLSB.Checked;
            uSBToolStripMenuItem.Checked = radModeUSB.Checked;
            dSBToolStripMenuItem.Checked = radModeDSB.Checked;
            cWLToolStripMenuItem.Checked = radModeCWL.Checked;
            cWUToolStripMenuItem.Checked = radModeCWU.Checked;
            fMToolStripMenuItem.Checked = radModeFMN.Checked;
            aMToolStripMenuItem.Checked = radModeAM.Checked;
            sAMToolStripMenuItem.Checked = radModeSAM.Checked;
            sPECToolStripMenuItem.Checked = radModeSPEC.Checked;
            dIGLToolStripMenuItem.Checked = radModeDIGL.Checked;
            dIGUToolStripMenuItem.Checked = radModeDIGU.Checked;
            dRMToolStripMenuItem.Checked = radModeDRM.Checked;
        }

        #endregion

        #region Filter Button Events
        // ======================================================
        // Filter Button Events
        // ======================================================

        public void SetRX1Filter(Filter new_filter)
        {
            if (rx1_dsp_mode == DSPMode.FIRST || rx1_dsp_mode == DSPMode.LAST) return;

            int low = 0, high = 0;

            switch (rx1_filter)
            {
                case Filter.F1:
                    radFilter1.BackColor = SystemColors.Control;
                    break;
                case Filter.F2:
                    radFilter2.BackColor = SystemColors.Control;
                    break;
                case Filter.F3:
                    radFilter3.BackColor = SystemColors.Control;
                    break;
                case Filter.F4:
                    radFilter4.BackColor = SystemColors.Control;
                    break;
                case Filter.F5:
                    radFilter5.BackColor = SystemColors.Control;
                    break;
                case Filter.F6:
                    radFilter6.BackColor = SystemColors.Control;
                    break;
                case Filter.F7:
                    radFilter7.BackColor = SystemColors.Control;
                    break;
                case Filter.F8:
                    radFilter8.BackColor = SystemColors.Control;
                    break;
                case Filter.F9:
                    radFilter9.BackColor = SystemColors.Control;
                    break;
                case Filter.F10:
                    radFilter10.BackColor = SystemColors.Control;
                    break;
                case Filter.VAR1:
                    radFilterVar1.BackColor = SystemColors.Control;
                    //udFilterLow.BackColor = button_selected_color;
                    //udFilterHigh.BackColor = button_selected_color;
                    //udFilterLow.ReadOnly = true;
                    //udFilterHigh.ReadOnly = true;
                    udFilterLow.Enabled = false;
                    udFilterHigh.Enabled = false;
                    break;
                case Filter.VAR2:
                    radFilterVar2.BackColor = SystemColors.Control;
                    //udFilterLow.BackColor = button_selected_color;
                    //udFilterHigh.BackColor = button_selected_color;
                    //udFilterLow.ReadOnly = true;
                    //udFilterHigh.ReadOnly = true;
                    udFilterLow.Enabled = false;
                    udFilterHigh.Enabled = false;
                    break;
            }

            rx1_filter = new_filter;

            low = rx1_filters[(int)rx1_dsp_mode].GetLow(new_filter);
            high = rx1_filters[(int)rx1_dsp_mode].GetHigh(new_filter);
            rx1_filters[(int)rx1_dsp_mode].LastFilter = new_filter;

            //grpFilter.Text = "Filter - "+rx1_filters[(int)rx1_dsp_mode].GetName(new_filter);

            switch (new_filter)
            {
                case Filter.F1:
                    radFilter1.BackColor = button_selected_color;
                    break;
                case Filter.F2:
                    radFilter2.BackColor = button_selected_color;
                    break;
                case Filter.F3:
                    radFilter3.BackColor = button_selected_color;
                    break;
                case Filter.F4:
                    radFilter4.BackColor = button_selected_color;
                    break;
                case Filter.F5:
                    radFilter5.BackColor = button_selected_color;
                    break;
                case Filter.F6:
                    radFilter6.BackColor = button_selected_color;
                    break;
                case Filter.F7:
                    radFilter7.BackColor = button_selected_color;
                    break;
                case Filter.F8:
                    radFilter8.BackColor = button_selected_color;
                    break;
                case Filter.F9:
                    radFilter9.BackColor = button_selected_color;
                    break;
                case Filter.F10:
                    radFilter10.BackColor = button_selected_color;
                    break;
                case Filter.VAR1:
                    radFilterVar1.BackColor = button_selected_color;
                    udFilterLow.Enabled = true;
                    udFilterHigh.Enabled = true;
                    break;
                case Filter.VAR2:
                    radFilterVar2.BackColor = button_selected_color;
                    udFilterLow.Enabled = true;
                    udFilterHigh.Enabled = true;
                    break;
                case Filter.NONE:
                    foreach (Control c in panelFilter.Controls)
                    {
                        if (c.GetType() == typeof(RadioButtonTS))
                        {
                            ((RadioButtonTS)c).Checked = false;

                            if (c.BackColor != SystemColors.Control)
                                ((RadioButtonTS)c).BackColor = SystemColors.Control;
                        }
                    }
                    return;
            }
            UpdateRX1Filters(low, high);
        }

        private void radFilter_CheckedChanged(object sender, EventArgs e)
        {
            if (sender == null) return;
            if (sender.GetType() != typeof(RadioButtonTS)) return;
            RadioButtonTS radioBtnTS = (RadioButtonTS)sender;
            if (!radioBtnTS.Checked) return;

            string radiobut = ((RadioButtonTS)sender).Name;

            switch (radiobut)
            {
                case "radFilter1":
                    SetRX1Filter(Filter.F1);
                    lblFilterLabel.Text = radFilter1.Text;
                    FilterToolStripMenuItem1.Text = radFilter1.Text;
                    break;
                case "radFilter2":
                    SetRX1Filter(Filter.F2);
                    lblFilterLabel.Text = radFilter2.Text;
                    FilterToolStripMenuItem2.Text = radFilter2.Text;
                    break;
                case "radFilter3":
                    SetRX1Filter(Filter.F3);
                    lblFilterLabel.Text = radFilter3.Text;
                    FilterToolStripMenuItem3.Text = radFilter3.Text;
                    break;
                case "radFilter4":
                    SetRX1Filter(Filter.F4);
                    lblFilterLabel.Text = radFilter4.Text;
                    FilterToolStripMenuItem4.Text = radFilter4.Text;
                    break;
                case "radFilter5":
                    SetRX1Filter(Filter.F5);
                    lblFilterLabel.Text = radFilter5.Text;
                    FilterToolStripMenuItem5.Text = radFilter5.Text;
                    break;
                case "radFilter6":
                    SetRX1Filter(Filter.F6);
                    lblFilterLabel.Text = radFilter6.Text;
                    FilterToolStripMenuItem6.Text = radFilter6.Text;
                    break;
                case "radFilter7":
                    SetRX1Filter(Filter.F7);
                    lblFilterLabel.Text = radFilter7.Text;
                    FilterToolStripMenuItem7.Text = radFilter7.Text;
                    break;
                case "radFilter8":
                    SetRX1Filter(Filter.F8);
                    lblFilterLabel.Text = radFilter8.Text;
                    FilterToolStripMenuItem8.Text = radFilter8.Text;
                    break;
                case "radFilter9":
                    SetRX1Filter(Filter.F9);
                    lblFilterLabel.Text = radFilter9.Text;
                    FilterToolStripMenuItem9.Text = radFilter9.Text;
                    break;
                case "radFilter10":
                    SetRX1Filter(Filter.F10);
                    lblFilterLabel.Text = radFilter10.Text;
                    FilterToolStripMenuItem10.Text = radFilter10.Text;
                    break;
                case "radFilterVar1":
                    SetRX1Filter(Filter.VAR1);
                    lblFilterLabel.Text = radFilterVar1.Text;
                    break;
                case "radFilterVar2":
                    SetRX1Filter(Filter.VAR2);
                    lblFilterLabel.Text = radFilterVar2.Text;
                    break;
            }
            FilterToolStripMenuItem1.Checked = radFilter1.Checked;
            FilterToolStripMenuItem2.Checked = radFilter2.Checked;
            FilterToolStripMenuItem3.Checked = radFilter3.Checked;
            FilterToolStripMenuItem4.Checked = radFilter4.Checked;
            FilterToolStripMenuItem5.Checked = radFilter5.Checked;
            FilterToolStripMenuItem6.Checked = radFilter6.Checked;
            FilterToolStripMenuItem7.Checked = radFilter7.Checked;
            FilterToolStripMenuItem8.Checked = radFilter8.Checked;
            FilterToolStripMenuItem9.Checked = radFilter9.Checked;
            FilterToolStripMenuItem10.Checked = radFilter10.Checked;
        }

        /*       private void radFilter1_CheckedChanged(object sender, System.EventArgs e)
               {
                   FilterToolStripMenuItem1.Text = radFilter1.Text;
 
                   if (radFilter1.Checked)
                   {
                       SetRX1Filter(Filter.F1);
                       lblFilterLabel.Text = radFilter1.Text;
                       FilterToolStripMenuItem1.Checked = radFilter1.Checked;
                   }
               }

               private void radFilter2_CheckedChanged(object sender, System.EventArgs e)
               {
                   FilterToolStripMenuItem2.Text = radFilter2.Text;
                   if (radFilter2.Checked)
                   {
                       SetRX1Filter(Filter.F2);            
                       lblFilterLabel.Text = radFilter2.Text;
                       FilterToolStripMenuItem1.Checked = false;
                       FilterToolStripMenuItem2.Checked = true;
                       FilterToolStripMenuItem3.Checked = false;
                       FilterToolStripMenuItem4.Checked = false;
                       FilterToolStripMenuItem5.Checked = false;
                       FilterToolStripMenuItem6.Checked = false;
                       FilterToolStripMenuItem7.Checked = false;
                       FilterToolStripMenuItem8.Checked = false;
                       FilterToolStripMenuItem9.Checked = false;
                       FilterToolStripMenuItem10.Checked = false;
                   }
               }

               private void radFilter3_CheckedChanged(object sender, System.EventArgs e)
               {
                   FilterToolStripMenuItem3.Text = radFilter3.Text;
                   if (radFilter3.Checked)
                   {
                       SetRX1Filter(Filter.F3);
                       lblFilterLabel.Text = radFilter3.Text;
                       FilterToolStripMenuItem1.Checked = false;
                       FilterToolStripMenuItem2.Checked = false;
                       FilterToolStripMenuItem3.Checked = true;
                       FilterToolStripMenuItem4.Checked = false;
                       FilterToolStripMenuItem5.Checked = false;
                       FilterToolStripMenuItem6.Checked = false;
                       FilterToolStripMenuItem7.Checked = false;
                       FilterToolStripMenuItem8.Checked = false;
                       FilterToolStripMenuItem9.Checked = false;
                       FilterToolStripMenuItem10.Checked = false;
                   }
               }

               private void radFilter4_CheckedChanged(object sender, System.EventArgs e)
               {
                   FilterToolStripMenuItem4.Text = radFilter4.Text;
                   if (radFilter4.Checked)
                   {
                       SetRX1Filter(Filter.F4);
                       lblFilterLabel.Text = radFilter4.Text;
                       FilterToolStripMenuItem1.Checked = false;
                       FilterToolStripMenuItem2.Checked = false;
                       FilterToolStripMenuItem3.Checked = false;
                       FilterToolStripMenuItem4.Checked = true;
                       FilterToolStripMenuItem5.Checked = false;
                       FilterToolStripMenuItem6.Checked = false;
                       FilterToolStripMenuItem7.Checked = false;
                       FilterToolStripMenuItem8.Checked = false;
                       FilterToolStripMenuItem9.Checked = false;
                       FilterToolStripMenuItem10.Checked = false;
                   }
               }

               private void radFilter5_CheckedChanged(object sender, System.EventArgs e)
               {
                   FilterToolStripMenuItem5.Text = radFilter5.Text;
                   if (radFilter5.Checked)
                   {
                       SetRX1Filter(Filter.F5);
                       lblFilterLabel.Text = radFilter5.Text;
                       FilterToolStripMenuItem1.Checked = false;
                       FilterToolStripMenuItem2.Checked = false;
                       FilterToolStripMenuItem3.Checked = false;
                       FilterToolStripMenuItem4.Checked = false;
                       FilterToolStripMenuItem5.Checked = true;
                       FilterToolStripMenuItem6.Checked = false;
                       FilterToolStripMenuItem7.Checked = false;
                       FilterToolStripMenuItem8.Checked = false;
                       FilterToolStripMenuItem9.Checked = false;
                       FilterToolStripMenuItem10.Checked = false;
                   }
               }

               private void radFilter6_CheckedChanged(object sender, System.EventArgs e)
               {
                   FilterToolStripMenuItem6.Text = radFilter6.Text;
                   if (radFilter6.Checked)
                   {
                       SetRX1Filter(Filter.F6);
                       lblFilterLabel.Text = radFilter6.Text;
                       FilterToolStripMenuItem1.Checked = false;
                       FilterToolStripMenuItem2.Checked = false;
                       FilterToolStripMenuItem3.Checked = false;
                       FilterToolStripMenuItem4.Checked = false;
                       FilterToolStripMenuItem5.Checked = false;
                       FilterToolStripMenuItem6.Checked = true;
                       FilterToolStripMenuItem7.Checked = false;
                       FilterToolStripMenuItem8.Checked = false;
                       FilterToolStripMenuItem9.Checked = false;
                       FilterToolStripMenuItem10.Checked = false;
                   }
               }

               private void radFilter7_CheckedChanged(object sender, System.EventArgs e)
               {
                   FilterToolStripMenuItem7.Text = radFilter7.Text;
                   if (radFilter7.Checked)
                   {
                       SetRX1Filter(Filter.F7);
                       lblFilterLabel.Text = radFilter7.Text;
                       FilterToolStripMenuItem1.Checked = false;
                       FilterToolStripMenuItem2.Checked = false;
                       FilterToolStripMenuItem3.Checked = false;
                       FilterToolStripMenuItem4.Checked = false;
                       FilterToolStripMenuItem5.Checked = false;
                       FilterToolStripMenuItem6.Checked = false;
                       FilterToolStripMenuItem7.Checked = true;
                       FilterToolStripMenuItem8.Checked = false;
                       FilterToolStripMenuItem9.Checked = false;
                       FilterToolStripMenuItem10.Checked = false;
                   }
               }

               private void radFilter8_CheckedChanged(object sender, System.EventArgs e)
               {
                   FilterToolStripMenuItem8.Text = radFilter8.Text;
                   if (radFilter8.Checked)
                   {
                       SetRX1Filter(Filter.F8);
                       lblFilterLabel.Text = radFilter8.Text;
                       FilterToolStripMenuItem1.Checked = false;
                       FilterToolStripMenuItem2.Checked = false;
                       FilterToolStripMenuItem3.Checked = false;
                       FilterToolStripMenuItem4.Checked = false;
                       FilterToolStripMenuItem5.Checked = false;
                       FilterToolStripMenuItem6.Checked = false;
                       FilterToolStripMenuItem7.Checked = false;
                       FilterToolStripMenuItem8.Checked = true;
                       FilterToolStripMenuItem9.Checked = false;
                       FilterToolStripMenuItem10.Checked = false;
                   }
               }

               private void radFilter9_CheckedChanged(object sender, System.EventArgs e)
               {
                   FilterToolStripMenuItem9.Text = radFilter9.Text;
                   if (radFilter9.Checked)
                   {
                       SetRX1Filter(Filter.F9);
                       lblFilterLabel.Text = radFilter9.Text;
                       FilterToolStripMenuItem1.Checked = false;
                       FilterToolStripMenuItem2.Checked = false;
                       FilterToolStripMenuItem3.Checked = false;
                       FilterToolStripMenuItem4.Checked = false;
                       FilterToolStripMenuItem5.Checked = false;
                       FilterToolStripMenuItem6.Checked = false;
                       FilterToolStripMenuItem7.Checked = false;
                       FilterToolStripMenuItem8.Checked = false;
                       FilterToolStripMenuItem9.Checked = true;
                       FilterToolStripMenuItem10.Checked = false;
                   }
               }

               private void radFilter10_CheckedChanged(object sender, System.EventArgs e)
               {
                   FilterToolStripMenuItem10.Text = radFilter10.Text;
                   if (radFilter10.Checked)
                   {
                       SetRX1Filter(Filter.F10);
                       lblFilterLabel.Text = radFilter10.Text;
                       FilterToolStripMenuItem1.Checked = false;
                       FilterToolStripMenuItem2.Checked = false;
                       FilterToolStripMenuItem3.Checked = false;
                       FilterToolStripMenuItem4.Checked = false;
                       FilterToolStripMenuItem5.Checked = false;
                       FilterToolStripMenuItem6.Checked = false;
                       FilterToolStripMenuItem7.Checked = false;
                       FilterToolStripMenuItem8.Checked = false;
                       FilterToolStripMenuItem9.Checked = false;
                       FilterToolStripMenuItem10.Checked = true;
                   }
               }

               private void radFilterVar1_CheckedChanged(object sender, System.EventArgs e)
               {
                   if (radFilterVar1.Checked)
                   {
                       SetRX1Filter(Filter.VAR1);
                       lblFilterLabel.Text = radFilterVar1.Text;
                   }
               }

               private void radFilterVar2_CheckedChanged(object sender, System.EventArgs e)
               {
                   if (radFilterVar2.Checked)
                   {
                       SetRX1Filter(Filter.VAR2);
                       lblFilterLabel.Text = radFilterVar2.Text;
                   }
               } */

        private void udFilterLow_ValueChanged(object sender, System.EventArgs e)
        {
            if (udFilterLow.Focused)
            {
                if (udFilterLow.Value >= udFilterHigh.Value - 10)
                {
                    udFilterLow.Value = udFilterHigh.Value - 10;
                    return;
                }

                UpdateRX1Filters((int)udFilterLow.Value, (int)udFilterHigh.Value);

                if (!save_filter_changes)
                    rx1_filters[(int)rx1_dsp_mode].SetLow(rx1_filter, (int)udFilterLow.Value);
            }

            if (save_filter_changes)
                rx1_filters[(int)rx1_dsp_mode].SetLow(rx1_filter, (int)udFilterLow.Value);

            /*if(udFilterLow.Focused)
                btnHidden.Focus();*/
        }

        private void udFilterHigh_ValueChanged(object sender, System.EventArgs e)
        {
            if (udFilterHigh.Focused)
            {
                if (udFilterHigh.Value <= udFilterLow.Value + 10)
                {
                    udFilterHigh.Value = udFilterLow.Value + 10;
                    return;
                }

                UpdateRX1Filters((int)udFilterLow.Value, (int)udFilterHigh.Value);

                if (!save_filter_changes)
                    rx1_filters[(int)rx1_dsp_mode].SetHigh(rx1_filter, (int)udFilterHigh.Value);
            }

            if (save_filter_changes)
                rx1_filters[(int)rx1_dsp_mode].SetHigh(rx1_filter, (int)udFilterHigh.Value);

            /*if(udFilterHigh.Focused)
                btnHidden.Focus();*/
        }

        private void DoFilterShift(int shift, bool redraw)
        {
            // VK6APH: Does the Filter Shift function, alters the filter low and high frequency values 
            // as the Filter Shift slider is moved. We need to keep the last Filter Shift values
            // that the variable filters use since, unlike the other filters, there are 
            // no pre-set bandwidths that they can default to when the Filter Shift is 
            // turned off. These values are stored in the public variables last_var1_shift and
            // last_var2_shift. 
            int IFShift;
            int low;
            int high;
            int bandwidth;
            int max_shift = 9999;		// needed when using variable filters so we can't exceed +/- 10kHz DSP limits

            if (rx1_dsp_mode == DSPMode.SPEC ||
                rx1_dsp_mode == DSPMode.DRM)
                return;

            bandwidth = (int)Math.Abs(udFilterHigh.Value - udFilterLow.Value); // calculate current filter bandwidth 

            // set the maximum IF Shift depending on filter bandwidth in use 
            if (bandwidth > 800)
            {
                ptbFilterShift.Maximum = 1000;  // max IF Shift +/- 1kHz for filters > 800Hz wide
                ptbFilterShift.Minimum = -1000;
            }
            else
            {
                ptbFilterShift.Maximum = 500;	// max IF Shift +/- 500Hz for filters < 800Hz wide
                ptbFilterShift.Minimum = -500;
            }
            // calculate how far the IF Shift slider has moved
            // if we are using variable bandwidth filters need to use their last shift value
            if (rx1_filter == Filter.VAR1)
                IFShift = shift - last_var1_shift;
            else if (rx1_filter == Filter.VAR2)
                IFShift = shift - last_var2_shift;
            else
                IFShift = shift - last_filter_shift;

            high = (int)Math.Min(udFilterHigh.Value + IFShift, max_shift);	// limit high shift to maximum value
            low = (int)Math.Max(udFilterLow.Value + IFShift, -max_shift);	// limit low shift to maximum value

            radio.GetDSPRX(0, 0).SetRXFilter(low, high);			// select new filters
            udFilterLow.Value = low;						// display new low value 
            udFilterHigh.Value = high;						// display new high value
            if (redraw) Display.DrawBackground();			// draw new background for updated filter values

            // store the last IF Shift applied for use next time
            if (rx1_filter == Filter.VAR1)
                last_var1_shift = last_var1_shift + IFShift;
            else if (rx1_filter == Filter.VAR2)
                last_var2_shift = last_var2_shift + IFShift;
            else
                last_filter_shift = last_filter_shift + IFShift;
            // show the IF Shift is active by setting the zero button colour
            if (shift != 0)
                btnFilterShiftReset.BackColor = button_selected_color;
        }

        private void ptbFilterShift_Scroll(object sender, System.EventArgs e)
        {
            SelectRX1VarFilter();

            int bw = (int)udFilterHigh.Value - (int)udFilterLow.Value;
            int default_center = 0;

            switch (rx1_dsp_mode)
            {
                case DSPMode.USB:
                    default_center = default_low_cut + bw / 2;
                    break;
                case DSPMode.LSB:
                    default_center = -default_low_cut - bw / 2;
                    break;
                case DSPMode.CWU:
                    default_center = cw_pitch;
                    break;
                case DSPMode.CWL:
                    default_center = -cw_pitch;
                    break;
                case DSPMode.DIGU:
                    default_center = digu_click_tune_offset;
                    break;
                case DSPMode.DIGL:
                    default_center = -digl_click_tune_offset;
                    break;
            }

            int adjusted_max = max_filter_shift;
            if (default_center > 0)
            {
                if (ptbFilterShift.Value > 0)
                {
                    adjusted_max = Math.Min(max_filter_shift, 9999 - (Math.Abs(default_center) + bw / 2));
                }
            }
            else if (default_center < 0)
            {
                if (ptbFilterShift.Value < 0)
                {
                    adjusted_max = Math.Min(max_filter_shift, 9999 - (Math.Abs(default_center) + bw / 2));
                }
            }
            else //default_center == 0
            {
                adjusted_max = Math.Min(max_filter_shift, 9999 - bw / 2);
            }

            int range = ptbFilterShift.Maximum - ptbFilterShift.Minimum;
            int new_center = default_center + (int)((float)ptbFilterShift.Value / (range / 2) * adjusted_max);
            UpdateRX1Filters(new_center - bw / 2, new_center + bw / 2);

            btnFilterShiftReset.BackColor = button_selected_color;

            if (ptbFilterShift.Focused)
                btnHidden.Focus();
        }

        private void ptbFilterShift_Update(int low, int high)
        {
            int bw = (int)udFilterHigh.Value - (int)udFilterLow.Value;
            int default_center = 0;
            int current_center = (low + high) / 2;

            switch (rx1_dsp_mode)
            {
                case DSPMode.USB:
                    default_center = default_low_cut + bw / 2;
                    break;
                case DSPMode.LSB:
                    default_center = -default_low_cut - bw / 2;
                    break;
                case DSPMode.CWU:
                    default_center = cw_pitch;
                    break;
                case DSPMode.CWL:
                    default_center = -cw_pitch;
                    break;
                case DSPMode.DIGU:
                    default_center = digu_click_tune_offset;
                    break;
                case DSPMode.DIGL:
                    default_center = -digl_click_tune_offset;
                    break;
            }

            int adjusted_max = max_filter_shift;
            if (default_center > 0)
            {
                if (current_center > default_center)
                {
                    adjusted_max = Math.Min(max_filter_shift, 9999 - (Math.Abs(default_center) + bw / 2));
                }
            }
            else if (default_center < 0)
            {
                if (current_center < default_center)
                {
                    adjusted_max = Math.Min(max_filter_shift, 9999 - (Math.Abs(default_center) + bw / 2));
                }
            }
            else //default_center == 0
            {
                adjusted_max = Math.Min(max_filter_shift, 9999 - bw / 2);
            }

            int range = ptbFilterShift.Maximum - ptbFilterShift.Minimum;
            int delta = current_center - default_center;
            int new_val = (int)((float)delta / adjusted_max * (range / 2));
            if (new_val > ptbFilterShift.Maximum) new_val = ptbFilterShift.Maximum;
            if (new_val < ptbFilterShift.Minimum) new_val = ptbFilterShift.Minimum;
            ptbFilterShift.Value = new_val;
        }
        /*
                private void tbFilterShift_Scroll(object sender, System.EventArgs e)
                {
                    DoFilterShift(tbFilterShift.Value, true);

                    if(tbFilterShift.Focused)
                        btnHidden.Focus();
                }
        */
        private void btnFilterShiftReset_Click(object sender, System.EventArgs e)
        {
            int bw = (int)udFilterHigh.Value - (int)udFilterLow.Value;
            int low, high;
            switch (rx1_dsp_mode)
            {
                case DSPMode.AM:
                case DSPMode.SAM:
                case DSPMode.FM:
                case DSPMode.DSB:
                    ptbFilterShift.Value = 0;
                    ptbFilterShift_Scroll(this, EventArgs.Empty);
                    break;
                case DSPMode.USB:
                    low = default_low_cut;
                    high = low + bw;
                    UpdateRX1Filters(low, high);
                    break;
                case DSPMode.CWU:
                    low = cw_pitch - bw / 2;
                    high = cw_pitch + bw / 2;
                    if (low < 0)
                    {
                        int delta = -low;
                        low += delta;
                        high += delta;
                    }
                    else if (high > 9999)
                    {
                        int delta = high - 9999;
                        high -= delta;
                        low -= delta;
                    }
                    UpdateRX1Filters(low, high);
                    break;
                case DSPMode.DIGU:
                    low = digu_click_tune_offset - bw / 2;
                    high = digu_click_tune_offset + bw / 2;
                    if (low < 0)
                    {
                        int delta = -low;
                        low += delta;
                        high += delta;
                    }
                    else if (high > 9999)
                    {
                        int delta = high - 9999;
                        high -= delta;
                        low -= delta;
                    }
                    UpdateRX1Filters(low, high);
                    break;
                case DSPMode.LSB:
                    high = -default_low_cut;
                    low = high - bw;
                    UpdateRX1Filters(low, high);
                    break;
                case DSPMode.CWL:
                    high = -cw_pitch + bw / 2;
                    low = -cw_pitch - bw / 2;
                    if (high > 0)
                    {
                        int delta = -high;
                        low -= delta;
                        high -= delta;
                    }
                    else if (low < -9999)
                    {
                        int delta = low + 9999;
                        high += delta;
                        low += delta;
                    }
                    UpdateRX1Filters(low, high);
                    break;
                case DSPMode.DIGL:
                    high = -digl_click_tune_offset + bw / 2;
                    low = -digl_click_tune_offset - bw / 2;
                    if (high > 0)
                    {
                        int delta = -high;
                        low -= delta;
                        high -= delta;
                    }
                    else if (low < -9999)
                    {
                        int delta = low + 9999;
                        high += delta;
                        low += delta;
                    }
                    UpdateRX1Filters(low, high);
                    break;
            }
            btnFilterShiftReset.BackColor = SystemColors.Control;	// make button grey
        }

        private FilterWidthMode current_filter_width_mode = FilterWidthMode.Linear;
        public FilterWidthMode CurrentFilterWidthMode
        {
            get { return current_filter_width_mode; }
            set
            {
                current_filter_width_mode = value;
                UpdateRX1Filters((int)udFilterLow.Value, (int)udFilterHigh.Value);
            }
        }

        private void ptbFilterWidth_Update(int low, int high)
        {
            int bw = high - low;
            switch (rx1_dsp_mode)
            {
                case DSPMode.AM:
                case DSPMode.SAM:
                case DSPMode.FM:
                case DSPMode.DSB:
                    bw /= 2;
                    break;
            }

            int range = ptbFilterWidth.Maximum - ptbFilterWidth.Minimum;
            int new_val = 0;

            switch (current_filter_width_mode)
            {
                case FilterWidthMode.Linear:
                    new_val = ptbFilterWidth.Minimum + (int)((float)bw / max_filter_width * range);
                    break;
                case FilterWidthMode.Log:
                    double max_log = Math.Log(ptbFilterWidth.Maximum);
                    double temp = max_log - (float)bw / max_filter_width * max_log;
                    new_val = ptbFilterWidth.Maximum - (int)Math.Pow(Math.E, temp);
                    break;
                case FilterWidthMode.Log10:
                    max_log = Math.Log10(ptbFilterWidth.Maximum);
                    temp = max_log - (float)bw / max_filter_width * max_log;
                    new_val = ptbFilterWidth.Maximum - (int)Math.Pow(10, temp);
                    break;
            }

            if (new_val > ptbFilterWidth.Maximum) new_val = ptbFilterWidth.Maximum;
            if (new_val < ptbFilterWidth.Minimum) new_val = ptbFilterWidth.Minimum;
            ptbFilterWidth.Value = new_val;
        }

        private void ptbFilterWidth_Scroll(object sender, System.EventArgs e)
        {
            if (rx1_dsp_mode == DSPMode.DRM || rx1_dsp_mode == DSPMode.SPEC)
            {
                return;  // no good in this mode 
            }

            SelectRX1VarFilter();

            int range = ptbFilterWidth.Maximum - ptbFilterWidth.Minimum;
            int new_bw = 0;

            switch (current_filter_width_mode)
            {
                case FilterWidthMode.Linear:
                    new_bw = (int)((float)(ptbFilterWidth.Value - ptbFilterWidth.Minimum) / range * max_filter_width);
                    break;
                case FilterWidthMode.Log:
                    double max_log = Math.Log(ptbFilterWidth.Maximum);
                    double temp = Math.Log(Math.Max((ptbFilterWidth.Maximum - ptbFilterWidth.Value), 1.0));
                    temp = max_log - temp;
                    new_bw = (int)((float)(temp / max_log * max_filter_width));
                    break;
                case FilterWidthMode.Log10:
                    max_log = Math.Log10(ptbFilterWidth.Maximum);
                    temp = Math.Log10(Math.Max((ptbFilterWidth.Maximum - ptbFilterWidth.Value), 1.0));
                    temp = max_log - temp;
                    new_bw = (int)((float)(temp / max_log * max_filter_width));
                    break;
            }

            new_bw = Math.Max(new_bw, 10);
            int current_center = ((int)udFilterLow.Value + (int)udFilterHigh.Value) / 2;
            int low = 0, high = 0;
            switch (rx1_dsp_mode)
            {
                case DSPMode.AM:
                case DSPMode.SAM:
                case DSPMode.FM:
                case DSPMode.DSB:
                    low = current_center - new_bw;
                    high = current_center + new_bw;
                    if (low < -max_filter_width)
                    {
                        low += (-max_filter_width - low);
                        high += (-max_filter_width - low);
                    }
                    else if (high > max_filter_width)
                    {
                        high -= (high - max_filter_width);
                        low -= (high - max_filter_width);
                    }
                    break;
                case DSPMode.LSB:
                    high = -default_low_cut;
                    low = high - new_bw;
                    break;
                case DSPMode.CWL:
                case DSPMode.DIGL:
                    low = current_center - new_bw / 2;
                    high = current_center + new_bw / 2;
                    /*if(high > -default_low_cut && (int)udFilterHigh.Value <= -default_low_cut)
                    {
                        high = -default_low_cut;
                        low = high - new_bw;
                    }
                    else*/
                    if (low < -9999)
                    {
                        low = -9999;
                        high = low + new_bw;
                    }
                    break;
                case DSPMode.USB:
                    low = default_low_cut;
                    high = low + new_bw;
                    break;
                case DSPMode.CWU:
                case DSPMode.DIGU:
                    low = current_center - new_bw / 2;
                    high = current_center + new_bw / 2;
                    /*if(low < default_low_cut && (int)udFilterLow.Value >= default_low_cut)
                    {
                        low = default_low_cut;
                        high = low + new_bw;
                    }
                    else*/
                    if (high > 9999)
                    {
                        high = 9999;
                        low = high - new_bw;
                    }
                    break;
            }
            UpdateRX1Filters(low, high);

            if (ptbFilterWidth.Focused)
                btnHidden.Focus();
        }

        private void tbFilterWidthScroll_newMode()
        {
            //centerSave = 0;  // dump any save center with scroller is keeping 
            switch (rx1_dsp_mode)
            {
                case DSPMode.SPEC:
                case DSPMode.DRM:
                    ptbFilterWidth.Enabled = false;
                    break;

                default:
                    ptbFilterWidth.Enabled = true;
                    break;
            }
        }

        #endregion

        #region VFO Button Events
        // ======================================================
        // VFO Button Events
        // ======================================================

        // Added 6/20/05 BT for CAT commands
        public void CATVFOSwap(string pChangec)
        {
            string c = pChangec;
            if (c.Length > 0)
            {
                switch (c)
                {
                    case "0":
                        btnVFOAtoB_Click(btnVFOAtoB, EventArgs.Empty);
                        break;
                    case "1":
                        btnVFOBtoA_Click(btnVFOBtoA, EventArgs.Empty);
                        break;
                    case "2":
                        btnVFOSwap_Click(btnVFOSwap, EventArgs.Empty);
                        break;
                    case "3":
                        btnIFtoVFO_Click(btnIFtoVFO, EventArgs.Empty);
                        break;
                }
            }
        }

        public void CopyVFOAtoB()
        {
            btnVFOAtoB_Click(this, EventArgs.Empty);
        }

        private void btnVFOAtoB_Click(object sender, System.EventArgs e)
        {
            if (rx2_enabled)
            {
                RX2DSPMode = rx1_dsp_mode;
                txtVFOBFreq.Text = txtVFOAFreq.Text;
                txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                switch (rx1_filter)
                {
                    case Filter.F8:
                    case Filter.F9:
                    case Filter.F10:
                        RX2Filter = Filter.F1;
                        break;
                    case Filter.VAR1:
                    case Filter.VAR2:
                        RX2Filter = RX1Filter;
                        RX2FilterLow = RX1FilterLow;
                        RX2FilterHigh = RX2FilterHigh;
                        break;
                    default:
                        RX2Filter = rx1_filter;
                        break;
                }
                vfob_dsp_mode = rx1_dsp_mode;
                vfob_filter = rx1_filter;

                // chkRX2SR.Checked = chkSR.Checked;
                comboRX2AGC.Text = comboAGC.Text;
            }
            else
            {
                txtVFOBFreq.Text = txtVFOAFreq.Text;
                txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                vfob_dsp_mode = rx1_dsp_mode;
                vfob_filter = rx1_filter;
            }
        }

        public void CopyVFOBtoA()
        {
            btnVFOBtoA_Click(this, EventArgs.Empty);
        }

        private void btnVFOBtoA_Click(object sender, System.EventArgs e)
        {
            if (!rx2_enabled)
            {
                if (!chkEnableMultiRX.Checked)
                {
                    RX1DSPMode = vfob_dsp_mode;
                    RX1Filter = vfob_filter;
                }
                txtVFOAFreq.Text = txtVFOBFreq.Text;
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
            else
            {
                RX1DSPMode = rx2_dsp_mode;
                txtVFOAFreq.Text = txtVFOBFreq.Text;
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                switch (rx2_filter)
                {
                    case Filter.VAR1:
                    case Filter.VAR2:
                        RX1Filter = RX2Filter;
                        RX1FilterLow = RX2FilterLow;
                        RX1FilterHigh = RX2FilterHigh;
                        break;
                    default:
                        //RX2Filter = rx1_filter;
                        RX1Filter = RX2Filter;
                        break;
                }
                //RX1Filter = rx2_filter;

                // chkSR.Checked = chkRX2SR.Checked;
                comboAGC.Text = comboRX2AGC.Text;
            }
        }

        public void VFOSwap()
        {
            btnVFOSwap_Click(this, EventArgs.Empty);
        }

        private void btnVFOSwap_Click(object sender, System.EventArgs e)
        {
            if (!rx2_enabled)
            {
                string temp = txtVFOAFreq.Text;

                if (!chkEnableMultiRX.Checked)
                {
                    DSPMode mode = rx1_dsp_mode;
                    Filter filter = rx1_filter;

                    RX1DSPMode = vfob_dsp_mode;
                    RX1Filter = vfob_filter;
                    vfob_dsp_mode = mode;
                    vfob_filter = filter;
                }

                txtVFOAFreq.Text = txtVFOBFreq.Text;
                txtVFOBFreq.Text = temp;
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                txtVFOBFreq_LostFocus(this, EventArgs.Empty);
            }
            else
            {
                string a_freq = txtVFOAFreq.Text;
                DSPMode a_mode = rx1_dsp_mode;
                Filter a_filter = rx1_filter;
                int a_filter_low = 0, a_filter_high = 0;
                if (a_filter == Filter.VAR1 || a_filter == Filter.VAR2)
                {
                    a_filter_low = RX1FilterLow;
                    a_filter_high = RX1FilterHigh;
                }

                RX1DSPMode = rx2_dsp_mode;
                VFOAFreq = VFOBFreq;
                RX1Filter = rx2_filter;

                RX2DSPMode = a_mode;
                txtVFOBFreq.Text = a_freq;
                txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                switch (a_filter)
                {
                    case Filter.F8:
                    case Filter.F9:
                    case Filter.F10:
                        RX2Filter = Filter.F1;
                        break;
                    case Filter.VAR1:
                    case Filter.VAR2:
                        RX2Filter = a_filter;
                        RX2FilterLow = a_filter_low;
                        RX2FilterHigh = a_filter_high;
                        break;
                    default:
                        RX2Filter = a_filter;
                        break;
                }

                //  bool sr = chkSR.Checked;
                //   chkSR.Checked = chkRX2SR.Checked;
                //  chkRX2SR.Checked = sr;

                string agc = comboAGC.Text;
                comboAGC.Text = comboRX2AGC.Text;
                comboRX2AGC.Text = agc;
            }
        }

        private void UpdateVFOASub()
        {
            if (rx2_enabled)
            {
                if (chkVFOSplit.Checked)
                {
                    txtVFOABand.Font = new Font("Microsoft Sans Sarif", 14.0f, FontStyle.Regular);
                    if (saved_vfoa_sub_freq == Display.CLEAR_FLAG) saved_vfoa_sub_freq = saved_vfoa_freq;
                    txtVFOABand.Text = saved_vfoa_sub_freq.ToString("f6");
                    tx_xvtr_index = XVTRForm.XVTRFreq(VFOASubFreq);
                    TXBand = BandByFreq(VFOASubFreq, tx_xvtr_index, true, current_region);
                    if (chkPower.Checked) txtVFOABand.ForeColor = Color.Red;
                    else txtVFOABand.ForeColor = Color.DarkRed;
                    txtVFOABand.TextAlign = HorizontalAlignment.Right;
                    txtVFOABand.ReadOnly = false;
                    txtVFOABand_LostFocus(this, EventArgs.Empty);
                    panelVFOASubHover.Visible = true;
                    return;
                }
                else if (chkEnableMultiRX.Checked)
                {
                    txtVFOABand.Font = new Font("Microsoft Sans Sarif", 14.0f, FontStyle.Regular);
                    txtVFOABand.Text = saved_vfoa_sub_freq.ToString("f6");
                    if (chkPower.Checked) txtVFOABand.ForeColor = vfo_text_light_color;
                    else txtVFOABand.ForeColor = vfo_text_dark_color;
                    txtVFOABand.TextAlign = HorizontalAlignment.Right;
                    txtVFOABand.ReadOnly = false;
                    txtVFOABand_LostFocus(this, EventArgs.Empty);
                    panelVFOASubHover.Visible = true;

                    return;
                }
            }

            if (chkPower.Checked)
            {
                txtVFOABand.Font = new Font("Microsoft Sans Sarif", 12.0f, FontStyle.Regular);
                txtVFOABand.ForeColor = band_text_light_color;
                txtVFOABand.TextAlign = HorizontalAlignment.Center;
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                panelVFOASubHover.Visible = false;
            }
            else
            {
                txtVFOABand.Font = new Font("Microsoft Sans Sarif", 12.0f, FontStyle.Regular);
                txtVFOABand.ForeColor = band_text_dark_color;
                txtVFOABand.TextAlign = HorizontalAlignment.Center;
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                panelVFOASubHover.Visible = false;
            }
        }

        private void chkVFOSplit_CheckedChanged(object sender, System.EventArgs e)
        {
            Display.SplitEnabled = chkVFOSplit.Checked;
            if (chkVFOSplit.Checked)
            {
                chkVFOSplit.BackColor = button_selected_color;
                //FM front panel
                chkFMTXHigh.Enabled = false;
                chkFMTXHigh.Checked = false;
                chkFMTXLow.Enabled = false;
                chkFMTXLow.Checked = false;
                chkFMTXSimplex.Enabled = false;
                chkFMTXSimplex.Checked = false;
                chkFMTXRev.Enabled = false;
                chkFMTXRev.Checked = false;
                udFMOffset.Enabled = false;
                current_fm_tx_mode = FMTXMode.Simplex;
                //fm_tx_offset_mhz = 0;			
            }
            else
            {
                chkVFOSplit.BackColor = SystemColors.Control;
                //FM front panel
                chkFMTXHigh.Enabled = true;
                chkFMTXLow.Enabled = true;
                chkFMTXSimplex.Enabled = true;
                chkFMTXSimplex.Checked = true;
                chkFMTXRev.Enabled = true;
                udFMOffset.Enabled = true;
                //fm_tx_offset_mhz = 0;
            }

            if (rx2_enabled)
            {
                UpdateVFOASub();
                if (chkVFOSplit.Checked)
                {
                    if (chkVFOBTX.Checked)
                        chkVFOATX.Checked = true;
                }
                else
                {
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                }
            }
            else
            {
                if (chkVFOSplit.Checked)
                {
                    if (chkVFOSync.Checked) chkVFOSync.Checked = false;
                    TXBand = BandByFreq(VFOBFreq, tx_xvtr_index, true, current_region);
                    grpVFOB.Font = new Font("Microsoft Sans Serif", 8.25F, FontStyle.Bold);
                    grpVFOB.ForeColor = Color.Red;
                    //grpVFOB.ForeColor = SystemColors.ControlLightLight;
                    grpVFOA.Font = new Font("Microsoft Sans Serif", 8.25F, FontStyle.Bold);
                    grpVFOA.ForeColor = SystemColors.ControlLightLight;
                    chkVFOBTX.Checked = true;
                    //chkVFOBTX.ForeColor = Color.Black;
                    if (chkPower.Checked)
                    {
                        txtVFOBFreq.ForeColor = Color.Red;
                        //txtVFOBMSD.ForeColor = Color.Red;
                        //txtVFOBFreq.ForeColor = vfo_text_light_color;
                        txtVFOBMSD.ForeColor = vfo_text_light_color;
                        txtVFOBLSD.ForeColor = small_vfo_color;
                        txtVFOBBand.ForeColor = band_text_light_color;

                        if (current_model == Model.FLEX5000 && fwc_init)
                            txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                    }
                }
                else
                {

                    grpVFOB.Font = new Font("Microsoft Sans Serif", 8.25F, FontStyle.Bold);
                    grpVFOB.ForeColor = SystemColors.ControlLightLight;
                    grpVFOA.Font = new Font("Microsoft Sans Serif", 8.25F, FontStyle.Bold);
                    grpVFOA.ForeColor = Color.Red;
                    chkVFOATX.Checked = true;
                    if (chkPower.Checked)
                    {
                        if (chkEnableMultiRX.Checked)
                        {
                            txtVFOBFreq.ForeColor = vfo_text_light_color;
                            txtVFOBMSD.ForeColor = vfo_text_light_color;
                            txtVFOBLSD.ForeColor = small_vfo_color;
                            txtVFOBBand.ForeColor = band_text_light_color;
                        }
                        else
                        {
                            txtVFOBFreq.ForeColor = vfo_text_dark_color;
                            txtVFOBMSD.ForeColor = vfo_text_dark_color;
                            txtVFOBLSD.ForeColor = vfo_text_dark_color;
                            txtVFOBBand.ForeColor = band_text_dark_color;
                        }

                        if (fwc_init && current_model == Model.FLEX5000 && !full_duplex)
                            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                    }
                    if (current_click_tune_mode == ClickTuneMode.VFOB && !chkEnableMultiRX.Checked && !chkFullDuplex.Checked)
                        CurrentClickTuneMode = ClickTuneMode.VFOA;
                }
            }
#if false 
			// wjtFIXME! 
			// if we're doing soft rock stuff may need to update osc (tx mainly) when split is on
			if ( current_model ==  Model.SOFTROCK40 )
			
			{
				SetSoftRockOscFreqs();
			}
#endif
        }


        private void chkXIT_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkXIT.Checked)
            {
                chkXIT.BackColor = button_selected_color;
                chkXIT.ForeColor = Color.Red;
                Display.XIT = (int)udXIT.Value;
            }
            else
            {
                chkXIT.BackColor = SystemColors.Control;
                chkXIT.ForeColor = SystemColors.ControlLightLight;
                Display.XIT = 0;
            }
#if false
			// wjtFIXME!
			if ( current_model == Model.SOFTROCK40 )			
			{
				SetSoftRockOscFreqs();
			}
#endif

            if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
            {
                if (chkVFOSplit.Checked || full_duplex)
                    txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                else
                    txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
            else
            {
              //  if (mox)
                {
                    if (chkVFOSplit.Checked)
                        txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                    else
                        txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                }
            }
        }

        private void chkRIT_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkRIT.Checked)
            {
                chkRIT.BackColor = button_selected_color;
                chkRIT.ForeColor = Color.Red;
                Display.RIT = (int)udRIT.Value;
            }
            else
            {
                chkRIT.BackColor = SystemColors.Control;
                chkRIT.ForeColor = SystemColors.ControlLightLight;
                Display.RIT = 0;
            }

            if (!mox)
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
        }

        private void udRIT_ValueChanged(object sender, System.EventArgs e)
        {
            if (chkRIT.Checked && !mox)
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            if (chkRIT.Checked) Display.RIT = (int)udRIT.Value;

            /*if(udRIT.Focused)
                btnHidden.Focus();*/
        }

        private void udXIT_ValueChanged(object sender, System.EventArgs e)
        {
            if (chkXIT.Checked)
            {
                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                {
                    if (chkVFOSplit.Checked || full_duplex)
                        txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                    else
                        txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                }
                else
                {
                    if (chkVFOSplit.Checked)
                        txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                    else
                        txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                }
            }
#if false
			//wjtFIXME
			else if ( current_model == Model.SOFTROCK40 )			
			{
				SetSoftRockOscFreqs();
			}
#endif


            if (chkXIT.Checked) Display.XIT = (int)udXIT.Value;

            /*if(udXIT.Focused)
                btnHidden.Focus();*/
        }

        private void btnXITReset_Click(object sender, System.EventArgs e)
        {
            udXIT.Value = 0;
        }

        private void btnRITReset_Click(object sender, System.EventArgs e)
        {
            udRIT.Value = 0;
        }

        public void ZeroBeat()
        {
            if (btnZeroBeat.Enabled)
                btnZeroBeat_Click(this, EventArgs.Empty);
        }

        private void btnZeroBeat_Click(object sender, System.EventArgs e)
        {
            int peak_hz = FindPeakFreqInPassband();
            if (peak_hz == -1)
            {
                return; // find peak croaked - bail
            }
            // Debug.WriteLine("peak: " + peak_hz);
            int delta_hz = 0;

            // if we're in CW mode, zero beat to CWPitch, provided it is in the passband
            switch (rx1_dsp_mode)
            {
                case DSPMode.CWL:
                case DSPMode.CWU:
                case DSPMode.USB:
                case DSPMode.LSB:
                    int local_pitch = CWPitch;
                    if (rx1_dsp_mode == DSPMode.CWL || rx1_dsp_mode == DSPMode.LSB)
                    {
                        local_pitch = -local_pitch;
                    }
                    // is cwoffset in passband?
                    if (local_pitch >= udFilterLow.Value &&
                        local_pitch <= udFilterHigh.Value)
                    {
                        delta_hz = peak_hz - local_pitch;
                        // Debug.WriteLine("delta(cw): " + delta_hz);
                    }
                    else
                    {
                        // if we get here and delta_hz is still 0, the current
                        // CW pitch is not within the passband.
                        // Put strongest peak @ center of passband
                        int center_hz = ((int)udFilterHigh.Value + (int)udFilterLow.Value) / 2;
                        delta_hz = peak_hz - center_hz;
                    }
                    break;
                case DSPMode.DIGL:
                    local_pitch = -digl_click_tune_offset;
                    if (local_pitch >= udFilterLow.Value &&
                        local_pitch <= udFilterHigh.Value)
                    {
                        delta_hz = peak_hz - local_pitch;
                    }
                    else
                    {
                        // if we get here and delta_hz is still 0, the current
                        // pitch is not within the passband.
                        // Put strongest peak @ center of passband
                        int center_hz = ((int)udFilterHigh.Value + (int)udFilterLow.Value) / 2;
                        delta_hz = peak_hz - center_hz;
                    }
                    break;
                case DSPMode.DIGU:
                    local_pitch = digu_click_tune_offset;
                    if (local_pitch >= udFilterLow.Value &&
                        local_pitch <= udFilterHigh.Value)
                    {
                        delta_hz = peak_hz - local_pitch;
                    }
                    else
                    {
                        // if we get here and delta_hz is still 0, the current
                        // pitch is not within the passband.
                        // Put strongest peak @ center of passband
                        int center_hz = ((int)udFilterHigh.Value + (int)udFilterLow.Value) / 2;
                        delta_hz = peak_hz - center_hz;
                    }
                    break;
                case DSPMode.AM:
                case DSPMode.SAM:
                case DSPMode.FM:
                    delta_hz = peak_hz;
                    break;
            }

            //          Debug.WriteLine("peak: " + peak_hz);
            //          Debug.WriteLine("center: " + center_hz);
            //          Debug.WriteLine("delta: " + delta_hz + "\n");

            if (zero_beat_rit)
            {
                udRIT.Value += delta_hz;
                chkRIT.Checked = true;
            }
            else
            {
                VFOAFreq += delta_hz * 0.0000010;
            }
        }

        unsafe private int FindPeakFreqInPassband()
        {
            // convert hz to buckets in the averaging data
            int lo_cut_hz = (int)udFilterLow.Value;
            int hi_cut_hz = (int)udFilterHigh.Value;
            double hz_per_bucket = sample_rate1 / (double)Display.BUFFER_SIZE;
            int zero_hz_bucket = Display.BUFFER_SIZE / 2;
            int lo_bucket = (int)(lo_cut_hz / hz_per_bucket) + zero_hz_bucket;
            int hi_bucket = (int)(hi_cut_hz / hz_per_bucket) + zero_hz_bucket;

            //~~~~ 
            float max_val = float.MinValue;
            int max_bucket = 0;

            float[] spectrum_data;

            // reuse the existing display data if there is any
            switch (Display.CurrentDisplayMode)
            {
                case DisplayMode.PANADAPTER:
                case DisplayMode.HISTOGRAM:
                case DisplayMode.SPECTRUM:
                case DisplayMode.WATERFALL:
                case DisplayMode.PANAFALL:
                case DisplayMode.PANASCOPE:
                case DisplayMode.SPECTRASCOPE:
                    if (chkDisplayAVG.Checked)
                    {
                        spectrum_data = Display.rx1_average_buffer;
                    }
                    else
                    {
                        spectrum_data = Display.current_display_data;
                    }
                    break;

                // no specturm data - go get some 
                default:
                    spectrum_data = new float[Display.BUFFER_SIZE];
                    if (spectrum_data == null)
                    {
                        return -1; // bail out - not buffer 
                    }
                    fixed (float* ptr = &(spectrum_data[0]))
                        DttSP.GetSpectrum(0, ptr);
                    break;
            }

            for (int i = lo_bucket; i <= hi_bucket; i++)
            {
                if (spectrum_data[i] > max_val)
                {
                    max_bucket = i;
                    max_val = spectrum_data[i];
                }
            }
            int peak_hz = (int)((max_bucket - zero_hz_bucket) * hz_per_bucket);
            return peak_hz;
        }

        private void btnIFtoVFO_Click(object sender, System.EventArgs e)
        {
            int current_if_shift;

            bool is_centered_mode = false;
            bool is_cw_mode = false;
            bool is_lower_sb_mode = false;

            current_if_shift = ptbFilterShift.Value;

            //			Debug.WriteLine("current if shift: " + current_if_shift);

            if (current_if_shift == 0) return; // nothing to do

            switch (RX1DSPMode)
            {
                case DSPMode.DRM:
                case DSPMode.SPEC:
                case DSPMode.DIGL:
                case DSPMode.DIGU:
                    return; // nothing to do for these modes

                case DSPMode.AM:
                case DSPMode.FM:
                case DSPMode.DSB:
                case DSPMode.SAM:
                    is_centered_mode = true;
                    break;

                case DSPMode.CWL:
                    is_cw_mode = true;
                    is_lower_sb_mode = true;
                    break;
                case DSPMode.CWU:
                    is_cw_mode = true;
                    break;
                case DSPMode.LSB:
                    is_lower_sb_mode = true;
                    break;
                case DSPMode.USB:
                    break;
                default:
                    // no clue what the mode is -- bail out
                    return;
            }

            int current_width = (int)udFilterHigh.Value - (int)udFilterLow.Value;
            int current_center = (int)udFilterLow.Value + (current_width / 2);
            //			Debug.WriteLine("w: " + current_width + " center: " + current_center + " vfo: " +  VFOAFreq);

            double new_vfo = 0;
            int new_lo = 0;
            int new_hi = 0;

            if (is_centered_mode)
            {
                new_vfo = VFOAFreq + ((double)current_center) / (1000000);
                new_lo = -(current_width / 2);
                new_hi = current_width / 2;
            }
            else  // sideband style mode
            {
                int new_center;
                if (is_cw_mode)
                {
                    new_center = cw_pitch;
                }
                else  // sideband mode
                {
                    new_center = default_low_cut + (current_width / 2);
                }
                if (is_lower_sb_mode)
                {
                    new_center = -new_center;
                }
                new_vfo = VFOAFreq + ((double)(current_center - new_center)) / (1000000);
                // now figure out filter limits
                new_lo = new_center - (current_width / 2);
                new_hi = new_center + (current_width / 2);
            }
            //			Debug.WriteLine("new vfo: " + new_vfo + " lo: " + new_lo + " hi: " + new_hi );
            if (VFOAFreq > new_vfo)  // need to change this in the right order!
            {
                udFilterHigh.Value = new_hi;
                udFilterLow.Value = new_lo;
            }
            else
            {
                udFilterLow.Value = new_lo;
                udFilterHigh.Value = new_hi;
            }

            VFOAFreq = new_vfo;
            switch (RX1Filter)
            {
                case Filter.VAR1:
                    last_var1_shift = 0;
                    break;
                case Filter.VAR2:
                    last_var2_shift = 0;
                    break;
                default:
                    last_filter_shift = 0;
                    break;
            }
            btnFilterShiftReset_Click(this, EventArgs.Empty);
        }

        #endregion

        #region DSP Button Events

        private void chkNR_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkNR.Checked) chkNR.BackColor = button_selected_color;
            else chkNR.BackColor = SystemColors.Control;
            radio.GetDSPRX(0, 0).NoiseReduction = chkNR.Checked;
            radio.GetDSPRX(0, 1).NoiseReduction = chkNR.Checked;
            cat_nr_status = Convert.ToInt32(chkNR.Checked);
            NRToolStripMenuItem.Checked = chkNR.Checked;
        }

        private void chkANF_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkANF.Checked) chkANF.BackColor = button_selected_color;
            else chkANF.BackColor = SystemColors.Control;
            radio.GetDSPRX(0, 0).AutoNotchFilter = chkANF.Checked;
            radio.GetDSPRX(0, 1).AutoNotchFilter = chkANF.Checked;
            cat_anf_status = Convert.ToInt32(chkANF.Checked);
            ANFToolStripMenuItem.Checked = chkANF.Checked;
        }

        private void chkNB_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkNB.Checked) chkNB.BackColor = button_selected_color;
            else chkNB.BackColor = SystemColors.Control;
            radio.GetDSPRX(0, 0).NBOn = chkNB.Checked;
            radio.GetDSPRX(0, 1).NBOn = chkNB.Checked;
            cat_nb1_status = Convert.ToInt32(chkNB.Checked);
            NBToolStripMenuItem.Checked = chkNB.Checked;
        }

        private void chkDSPNB2_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkDSPNB2.Checked) chkDSPNB2.BackColor = button_selected_color;
            else chkDSPNB2.BackColor = SystemColors.Control;
            radio.GetDSPRX(0, 0).SDROM = chkDSPNB2.Checked;
            radio.GetDSPRX(0, 1).SDROM = chkDSPNB2.Checked;
            cat_nb2_status = Convert.ToInt32(chkDSPNB2.Checked);
            NB2ToolStripMenuItem.Checked = chkDSPNB2.Checked;
        }

        #endregion

        #region Mode Specific Events

        private void chkCPDR_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkCPDR.Checked)
            {
                chkCPDR.BackColor = button_selected_color;
                chkDX.Checked = false;
                ptbCPDR_Scroll(this, EventArgs.Empty);
            }
            else
            {
                chkCPDR.BackColor = SystemColors.Control;
            }
            if (chkDX.Checked || chkCPDR.Checked)
                radio.GetDSPTX(0).TXCompandOn = true;
            else radio.GetDSPTX(0).TXCompandOn = false;
            cat_cmpd_status = Convert.ToInt32(chkCPDR.Checked);
        }

        private void ptbCPDR_Scroll(object sender, System.EventArgs e)
        {
            lblCPDRVal.Text = ptbCPDR.Value.ToString() + " dB";

            if (chkCPDR.Checked)
                radio.GetDSPTX(0).TXCompandLevel = (double)ptbCPDR.Value;

            if (ptbCPDR.Focused) btnHidden.Focus();
        }

        private void chkDX_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkDX.Checked)
            {
                chkDX.BackColor = button_selected_color;
                if (chkCPDR.Checked) chkCPDR.Checked = false;
                ptbDX_Scroll(this, EventArgs.Empty);
            }
            else
            {
                chkDX.BackColor = SystemColors.Control;
            }
            if (chkDX.Checked || chkCPDR.Checked)
                radio.GetDSPTX(0).TXCompandOn = true;
            else radio.GetDSPTX(0).TXCompandOn = false;
        }

        private void ptbDX_Scroll(object sender, System.EventArgs e)
        {
            lblDXVal.Text = ptbDX.Value.ToString();

            if (chkDX.Checked)
                radio.GetDSPTX(0).TXCompandLevel = 1.0 + 0.4 * (double)ptbDX.Value;
            if (ptbDX.Focused) btnHidden.Focus();
        }

        #endregion

        #region Memory Events
        // ======================================================
        // Memory Events
        // ======================================================

        private void btnMemoryQuickSave_Click(object sender, System.EventArgs e)
        {
            txtMemoryQuick.Text = txtVFOAFreq.Text;
            quick_save_mode = RX1DSPMode;
            quick_save_filter = RX1Filter;
        }

        private void btnMemoryQuickRestore_Click(object sender, System.EventArgs e)
        {
            SaveBand();
            last_band = "";
            RX1DSPMode = quick_save_mode;
            txtVFOAFreq.Text = txtMemoryQuick.Text;
            txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            RX1Filter = quick_save_filter;
        }

        #endregion

        #region Menu Events

        private void menu_setup_Click(object sender, System.EventArgs e)
        {
            if (SetupForm.IsDisposed)
                SetupForm = new Setup(this);
            SetupForm.Show();
            SetupForm.Focus();
        }

        private void menu_wave_Click(object sender, System.EventArgs e)
        {
            if (WaveForm.IsDisposed)
                WaveForm = new WaveControl(this);
            WaveForm.Show();
            WaveForm.Focus();
        }

        private void mnuEQ_Click(object sender, System.EventArgs e)
        {
            if (EQForm == null || EQForm.IsDisposed)
                EQForm = new EQForm(this);
            EQForm.Show();
            EQForm.Focus();
        }

        private void mnuUCB_Click(object sender, System.EventArgs e)
        {
            if (UCBForm == null || UCBForm.IsDisposed)
                UCBForm = new UCBForm(this);
            UCBForm.Show();
            UCBForm.Focus();
        }

        private void mnuXVTR_Click(object sender, System.EventArgs e)
        {
            if (XVTRForm == null || XVTRForm.IsDisposed)
                XVTRForm = new XVTRForm(this);

            XVTRForm.Show();
            XVTRForm.Focus();
        }

        private void mnuCWX_Click(object sender, System.EventArgs e)
        {
            if (rx1_dsp_mode == DSPMode.LSB)
                RX1DSPMode = DSPMode.CWL;
            else if (rx1_dsp_mode == DSPMode.USB)
                RX1DSPMode = DSPMode.CWU;

            if (rx1_dsp_mode != DSPMode.CWL &&
                rx1_dsp_mode != DSPMode.CWU)
            {
                MessageBox.Show("The radio must be in CWL or CWU mode in order to open the " +
                    "CWX Control Form.",
                    "CWX Error: Wrong Mode",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                return;
            }

            //	cw_key_mode = true;
            if (CWXForm == null || CWXForm.IsDisposed)
            {
                CWXForm = new CWX(this);
            }

            CWXForm.Show();
            CWXForm.Focus();
        }

        /*	private void mnuMemRecall_Click(object sender, System.EventArgs e)
            {
                if(MemForm == null || MemForm.IsDisposed)
                    MemForm = new Memory(this);
                MemForm.Show();
                MemForm.Focus();
            } */

        private void menuItemFilterConfigure_Click(object sender, System.EventArgs e)
        {
            if (rx1_dsp_mode == DSPMode.DRM || rx1_dsp_mode == DSPMode.SPEC) return;

            if (filterRX1Form == null || filterRX1Form.IsDisposed)
                filterRX1Form = new FilterForm(this, rx1_filters, false);

            filterRX1Form.DSPMode = rx1_dsp_mode;
            filterRX1Form.CurrentFilter = rx1_filter;
            filterRX1Form.Show();
            filterRX1Form.Focus();
        }

        private void menuItemRX2FilterConfigure_Click(object sender, System.EventArgs e)
        {
            if (rx2_dsp_mode == DSPMode.DRM || rx2_dsp_mode == DSPMode.SPEC) return;

            if (filterRX2Form == null || filterRX2Form.IsDisposed)
                filterRX2Form = new FilterForm(this, rx2_filters, true);

            filterRX2Form.DSPMode = rx2_dsp_mode;
            filterRX2Form.CurrentFilter = rx2_filter;
            filterRX2Form.Show();
            filterRX2Form.Focus();
        }

        private void mnuMixer_Click(object sender, System.EventArgs e)
        {
            if (fwc_init)
            {
                switch (current_model)
                {
                    case Model.FLEX5000:
                        if (fwcMixForm == null || fwcMixForm.IsDisposed)
                            fwcMixForm = new FWCMixForm(this);
                        fwcMixForm.Show();
                        fwcMixForm.Focus();
                        break;
                    case Model.FLEX3000:
                        if (flex3000MixerForm == null || flex3000MixerForm.IsDisposed)
                            flex3000MixerForm = new FLEX3000MixerForm(this);
                        flex3000MixerForm.Show();
                        flex3000MixerForm.Focus();
                        break;
                }
            }
        }

        private void mnuAntenna_Click(object sender, System.EventArgs e)
        {
            if (fwc_init && current_model == Model.FLEX5000)
            {
                if (fwcAntForm == null || fwcAntForm.IsDisposed)
                    fwcAntForm = new FWCAntForm(this);
                fwcAntForm.Show();
                fwcAntForm.Focus();
            }
        }

        private void mnuRelays_Click(object sender, System.EventArgs e)
        {
            //if(fwc_init && current_model == Model.FLEX5000)
            {
                if (flex5000RelayForm == null || flex5000RelayForm.IsDisposed)
                    flex5000RelayForm = new FLEX5000RelayForm(this);
                flex5000RelayForm.Show();
                flex5000RelayForm.Focus();
            }
        }

        private void mnuATU_Click(object sender, System.EventArgs e)
        {
            if (fwc_init && current_model == Model.FLEX5000)
            {
                if (fwcAtuForm == null || fwcAtuForm.IsDisposed)
                    fwcAtuForm = new FWCATUForm(this);
                fwcAtuForm.Show();
                fwcAtuForm.Focus();
            }
            else if (fwc_init && current_model == Model.FLEX3000)
            {
                if (flex3000ATUForm == null || flex3000ATUForm.IsDisposed)
                    flex3000ATUForm = new FLEX3000ATUForm(this);
                flex3000ATUForm.Show();
                flex3000ATUForm.Focus();
            }
        }

        private void mnuProfiles_Click(object sender, System.EventArgs e)
        {
            if (ProfileForm == null || ProfileForm.IsDisposed)
                ProfileForm = new RemoteProfiles(this);
            ProfileForm.Show();
            ProfileForm.Focus();
        }

        #endregion

        #region Sub RX Events

        private void ptbPanMainRX_Scroll(object sender, System.EventArgs e)
        {
            //if(chkEnableMultiRX.Checked)
            {
                float val = (int)ptbPanMainRX.Value / 100.0f;
                if (chkPanSwap.Checked) val = 1.0f - val;
                radio.GetDSPRX(0, 0).Pan = val;
            }
            if (ptbPanMainRX.Focused)
                btnHidden.Focus();
        }

        private void ptbPanSubRX_Scroll(object sender, System.EventArgs e)
        {
            float val = (int)ptbPanSubRX.Value / 100.0f;
            if (chkPanSwap.Checked) val = 1.0f - val;
            radio.GetDSPRX(0, 1).Pan = val;

            if (ptbPanSubRX.Focused)
                btnHidden.Focus();
        }

        private void chkEnableMultiRX_CheckedChanged(object sender, System.EventArgs e)
        {
            radio.GetDSPRX(0, 1).Active = chkEnableMultiRX.Checked;
            if (chkEnableMultiRX.Checked)
            {
                //tbPanMainRX_Scroll(this, EventArgs.Empty);
                //tbRX0Gain_Scroll(this, EventArgs.Empty);

                chkEnableMultiRX.BackColor = button_selected_color;
                if (chkPower.Checked)
                {
                    if (rx2_enabled)
                    {
                        UpdateVFOASub();
                    }
                    else
                    {
                        txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                        if (chkVFOSplit.Checked) chkVFOSplit_CheckedChanged(this, EventArgs.Empty);
                        else
                        {
                            txtVFOBFreq.ForeColor = vfo_text_light_color;
                            txtVFOBMSD.ForeColor = vfo_text_light_color;
                            txtVFOBLSD.ForeColor = small_vfo_color;
                            txtVFOBBand.ForeColor = band_text_light_color;
                        }
                    }
                }
                radio.GetDSPRX(0, 1).SetRXFilter(
                    radio.GetDSPRX(0, 0).RXFilterLow,
                    radio.GetDSPRX(0, 0).RXFilterHigh);
            }
            else
            {
                //radio.GetDSPRX(0, 0).RXOutputGain = 1.0;
                //radio.GetDSPRX(0, 0).Pan = 0.5f;
                chkEnableMultiRX.BackColor = SystemColors.Control;
                //if(chkPower.Checked)
                {
                    if (rx2_enabled)
                    {
                        UpdateVFOASub();
                    }
                    else
                    {
                        if (chkVFOSplit.Checked && !rx2_enabled) chkVFOSplit_CheckedChanged(this, EventArgs.Empty);
                        else if (rx2_enabled) chkRX2_CheckedChanged(this, EventArgs.Empty);
                        else
                        {
                            txtVFOBFreq.ForeColor = vfo_text_dark_color;
                            txtVFOBMSD.ForeColor = vfo_text_dark_color;
                            txtVFOBLSD.ForeColor = vfo_text_dark_color;
                            txtVFOBBand.ForeColor = band_text_dark_color;
                        }
                    }
                }
                if (current_click_tune_mode == ClickTuneMode.VFOB && !chkFullDuplex.Checked && !chkVFOSplit.Checked)
                    CurrentClickTuneMode = ClickTuneMode.VFOA;
            }
            Display.SubRX1Enabled = chkEnableMultiRX.Checked;
            MultiRXToolStripMenuItem.Checked = chkEnableMultiRX.Checked;
            UpdateRX1SubNotches();
        }

        private void chkPanSwap_CheckedChanged(object sender, System.EventArgs e)
        {
            //if(chkEnableMultiRX.Checked)
            {
                ptbPanMainRX_Scroll(this, EventArgs.Empty);
                ptbPanSubRX_Scroll(this, EventArgs.Empty);
            }
        }

        private void ptbRX0Gain_Scroll(object sender, System.EventArgs e)
        {
            //if(chkEnableMultiRX.Checked)
            radio.GetDSPRX(0, 0).RXOutputGain = (double)ptbRX0Gain.Value / ptbRX0Gain.Maximum;
            if (ptbRX0Gain.Focused)
                btnHidden.Focus();
        }

        private void ptbRX1Gain_Scroll(object sender, System.EventArgs e)
        {
            radio.GetDSPRX(0, 1).RXOutputGain = (double)ptbRX1Gain.Value / ptbRX1Gain.Maximum;

            if (ptbRX1Gain.Focused)
                btnHidden.Focus();
        }

        #endregion


        public void CallCalTXSpur()
        {
            CalTXSpur(1.85f, p);
        }

        public void TestTXCarrier()
        {
            if (!chkPower.Checked)
            {
                MessageBox.Show("Power must be on.");
                return;
            }

            double vfoa = VFOAFreq;
            double vfob = VFOBFreq;

            bool duplex = full_duplex;
            FullDuplex = true;

            // bool spur_red = chkSR.Checked;					// save current spur reduction setting
            // chkSR.Checked = false;							// turn spur reduction off

            bool polyphase = SetupForm.Polyphase;			// save current polyphase setting
            SetupForm.Polyphase = false;					// disable polyphase

            int dsp_buf_size = SetupForm.DSPPhoneRXBuffer;		// save current DSP buffer size
            SetupForm.DSPPhoneRXBuffer = 4096;					// set DSP Buffer Size to 4096

            // setup display mode
            string display = comboDisplayMode.Text;
            comboDisplayMode.Text = "Spectrum";

            // setup dsp mode
            DSPMode dsp_mode = RX1DSPMode;
            RX1DSPMode = DSPMode.DSB;

            // setup filter
            Filter filter = RX1Filter;
            UpdateRX1Filters(-500, 500);

            FullDuplex = true;
            FWC.SetQSD(true);
            FWC.SetQSE(true);
            FWC.SetTR(true);
            FWC.SetSig(true);
            FWC.SetGen(false);
            FWC.SetTest(true);
            FWC.SetTXMon(false);

            Audio.TXInputSignal = Audio.SignalSource.SILENCE;
            //Audio.SourceScale = 1.0;

            double start = 14.0;
            double end = 14.350;
            double step = 0.001;
            float[] a = new float[Display.BUFFER_SIZE];
            StringBuilder s = new StringBuilder();

            for (double freq = start; freq < end; freq += step)
            {
                VFOAFreq = freq;
                VFOBFreq = freq;
                Thread.Sleep(100);

                float sum = 0.0f;
                for (int i = 0; i < 5; i++)
                {
                    calibration_mutex.WaitOne();
                    fixed (float* ptr = &a[0])
                        DttSP.GetSpectrum(0, ptr);// get the spectrum values
                    calibration_mutex.ReleaseMutex();
                    Thread.Sleep(50);

                    sum += a[2048];
                }
                float avg = (sum / 5) + Display.RX1DisplayCalOffset + Display.RX1PreampOffset;
                s.Append(freq.ToString("f6") + "," + avg.ToString("f1") + "\n");
            }

            StreamWriter writer = new StreamWriter(app_data_path + "\\tx_carrier" + start.ToString("f6") + "-" + end.ToString("f6") + ".csv");
            writer.WriteLine("freq,carrier");
            writer.Write(s.ToString());
            writer.Close();

            // return output tone
            Audio.TXInputSignal = Audio.SignalSource.RADIO;

            // return hardware to normal operation
            FWC.SetSig(false);
            FWC.SetTest(false);
            FWC.SetQSE(false);

            SetupForm.Polyphase = polyphase;
            SetupForm.DSPPhoneRXBuffer = dsp_buf_size;
            // chkSR.Checked = spur_red;
            FullDuplex = duplex;

            VFOAFreq = vfoa;
            VFOBFreq = vfob;

            comboDisplayMode.Text = display;

            RX1DSPMode = dsp_mode;
            RX1Filter = filter;
        }

        public void CallCalStepGen()
        {
            p = new Progress("Calibrate Gen");
            Thread t = new Thread(new ThreadStart(CalStepGen));
            t.Name = "Run Calibrate Gen Thread";
            t.IsBackground = true;
            t.Priority = ThreadPriority.Normal;
            t.Start();
            p.Show();
        }

        public void CalStepGen()
        {
            if (!chkPower.Checked)
            {
                MessageBox.Show("Power must be on.");
                return;
            }

            if (current_model != Model.FLEX5000) return;

            VFOAFreq = 14.100;
            VFOBFreq = 14.004;

            for (int i = 0; i < 100; i++)
            {
                VFOBFreq = 14.004 + i * 0.001920;
                Thread.Sleep(100);
            }

            p.Hide();
        }

        private bool full_duplex = false;
        public bool FullDuplex
        {
            get { return full_duplex; }
            set
            {
                full_duplex = value;
                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                {
                    FWC.SetFullDuplex(chkFullDuplex.Checked);
                }
                chkFullDuplex.Checked = value;
            }
        }

        private void chkFullDuplex_CheckedChanged(object sender, System.EventArgs e)
        {
            FullDuplex = chkFullDuplex.Checked;
            Audio.FullDuplex = chkFullDuplex.Checked;
            if (chkFullDuplex.Checked)
            {
                //MessageBox.Show("Full Duplex is On");
                chkFullDuplex.BackColor = Color.Red;
                txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                DttSP.SetThreadProcessingMode(0, 2);
                DttSP.SetThreadProcessingMode(1, 2);
            }
            else
            {
                chkFullDuplex.BackColor = SystemColors.Control;
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                if (chkMOX.Checked)
                {
                    DttSP.SetThreadProcessingMode(0, 0);
                    DttSP.SetThreadProcessingMode(1, 2);
                }
                else
                {
                    DttSP.SetThreadProcessingMode(0, 2);
                    DttSP.SetThreadProcessingMode(1, 0);
                }
                if (current_click_tune_mode == ClickTuneMode.VFOB && !chkVFOSplit.Checked && !chkEnableMultiRX.Checked)
                    CurrentClickTuneMode = ClickTuneMode.VFOA;
            }
        }

        private static Console theConsole = null;

        public static Console getConsole()
        {
            return theConsole;
        }

        protected override void WndProc(ref Message m)
        {
            const int WM_QUERYENDSESSION = 0x0011;
            // Listen for operating system messages. 

            if (m.Msg == WM_QUERYENDSESSION)
            {
                chkPower.Checked = false;
                this.Close();
            }
            else base.WndProc(ref m);
        }

        public void FWCATUBypass()
        {
            chkFWCATU.Checked = false;
            chkFWCATUBypass.Checked = true;
        }

        public void FWCATUTuned()
        {
            chkFWCATU.Checked = true;
            chkFWCATUBypass.Checked = false;
        }

        public void FWCATUFailed()
        {
            chkFWCATU.Checked = false;
            chkFWCATUBypass.Checked = true;
        }

        public void SetATUFeedback(string s)
        {
            toolTip1.SetToolTip(chkFWCATU, s);
        }

        private void chkFWCATU_Click(object sender, System.EventArgs e)
        {
            if (fwc_init && current_model == Model.FLEX5000 &&
                fwcAtuForm != null && !fwcAtuForm.IsDisposed)
            {
                if (!chkTUN.Checked)
                {
                    fwcAtuForm.DoTuneMemory();
                    FWCATUTuned();
                }
                else
                {
                    chkTUN.Checked = false;
                    chkFWCATUBypass_Click(this, EventArgs.Empty);
                }
            }
            else if (fwc_init && current_model == Model.FLEX3000 &&
                flex3000ATUForm != null && !flex3000ATUForm.IsDisposed)
            {
                if (!chkTUN.Checked)
                {
                    flex3000ATUForm.DoTune();
                    chkFWCATU.Checked = true;
                    chkFWCATUBypass.Checked = false;
                }
                else
                {
                    chkTUN.Checked = false;
                    flex3000ATUForm.AbortTune();
                }
            }
        }

        private void chkFWCATUBypass_Click(object sender, System.EventArgs e)
        {
            /* if (fwc_init && current_model == Model.FLEX5000 &&
                 fwcAtuForm != null && !fwcAtuForm.IsDisposed)
             {
                 fwcAtuForm.DoBypass();
                 FWCATUBypass();
             }
             else if (fwc_init && current_model == Model.FLEX3000 &&
                 flex3000ATUForm != null && !flex3000ATUForm.IsDisposed)
             {
                 flex3000ATUForm.DoBypass();
                 FWCATUBypass();
             } */
        }

        private void chkSplitDisplay_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkSplitDisplay.Checked)
                chkSplitDisplay.BackColor = button_selected_color;
            else
                chkSplitDisplay.BackColor = SystemColors.Control;

            Display.SplitDisplay = chkSplitDisplay.Checked;
        }

        private void comboDisplayModeTop_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            /*switch(comboDisplayModeTop.Text)
            {
                case "Spectrum":
                    Display.CurrentDisplayModeTop = DisplayMode.SPECTRUM;
                    if(chkSplitDisplay.Checked) UpdateRXDisplayVars((int)udFilterLow.Value, (int)udFilterHigh.Value);
                    break;
                case "Panadapter":
                    Display.CurrentDisplayModeTop = DisplayMode.PANADAPTER;
                    if(chkSplitDisplay.Checked) CalcDisplayFreq();
                    break;
                case "Scope":
                    Display.CurrentDisplayModeTop = DisplayMode.SCOPE;
                    break;
                case "Phase":
                    Display.CurrentDisplayModeTop = DisplayMode.PHASE;
                    break;
                case "Phase2":
                    Display.CurrentDisplayModeTop = DisplayMode.PHASE2;
                    break;
                case "Waterfall":
                    Display.CurrentDisplayModeTop = DisplayMode.WATERFALL;
                    if(chkSplitDisplay.Checked) CalcDisplayFreq();
                    break;
                case "Histogram":
                    Display.CurrentDisplayModeTop = DisplayMode.HISTOGRAM;
                    break;
                case "Off":
                    Display.CurrentDisplayModeTop = DisplayMode.OFF;
                    break;
            }*/
        }

        private void comboDisplayModeBottom_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            switch (comboDisplayModeBottom.Text)
            {
                case "Spectrum":
                    Display.CurrentDisplayModeBottom = DisplayMode.SPECTRUM;
                    if (chkSplitDisplay.Checked) UpdateRXDisplayVars((int)udFilterLow.Value, (int)udFilterHigh.Value);
                    break;
                case "Panadapter":
                    Display.CurrentDisplayModeBottom = DisplayMode.PANADAPTER;
                    if (chkSplitDisplay.Checked) CalcDisplayFreq();
                    break;
                case "Scope":
                    Display.CurrentDisplayModeBottom = DisplayMode.SCOPE;
                    break;
                case "Phase":
                    Display.CurrentDisplayModeBottom = DisplayMode.PHASE;
                    break;
                case "Phase2":
                    Display.CurrentDisplayModeBottom = DisplayMode.PHASE2;
                    break;
                case "Waterfall":
                    Display.CurrentDisplayModeBottom = DisplayMode.WATERFALL;
                    if (chkSplitDisplay.Checked) CalcDisplayFreq();
                    break;
                case "Histogram":
                    Display.CurrentDisplayModeBottom = DisplayMode.HISTOGRAM;
                    break;
                case "Off":
                    Display.CurrentDisplayModeBottom = DisplayMode.OFF;
                    break;
            }
        }

        private void ckQuickPlay_CheckedChanged(object sender, System.EventArgs e)
        {
            // if (!mox)
            //  {
            //     ckQuickPlay.Checked = false;
            //     return;
            // }

            if (ckQuickPlay.Checked)
            {
                WaveForm.QuickPlay = true;
                ckQuickPlay.BackColor = button_selected_color;
            }
            else
            {
                WaveForm.QuickPlay = false;
                ckQuickPlay.BackColor = SystemColors.Control;//k6jca 1/13/08
            }
            ckQuickRec.Enabled = !ckQuickPlay.Checked;
        }

        private void ckQuickRec_CheckedChanged(object sender, System.EventArgs e)
        {
            if (ckQuickRec.Checked)
            {
                WaveForm.QuickRec = true;
                ckQuickPlay.Enabled = true;
                ckQuickRec.BackColor = button_selected_color;
            }
            else
            {
                WaveForm.QuickRec = false;
                ckQuickRec.BackColor = SystemColors.Control;//k6jca 1/13/08
            }
            ckQuickPlay.Enabled = !ckQuickRec.Checked;
        }

        private void ResizeConsole(int h_delta, int v_delta)		//k6jca 1/15/08
        {

            // This routine captures the size and location parameters *after* windows
            // has resized the image, (if the video is set for "120 dpi" in lieu of the
            // normal 96 dpi).  These will be used as the "basis" for all new size calcs.


            if ((h_delta == 0) && (v_delta == 0) && (previous_delta == 0))
            {
                // do nothing - this only occurs for my first call to Resize with both deltas zero during init
                // and at that time windows hasn't resized the display if in 120 dpi mode.
                // Use the "previous_delta" variable to ensure that if we *reduce* size back
                // to original, we do the calcs for that, too (previous_delta won't be 0 in that case);
            }
            else
            {

                //this.Size = new Size (console_basis_size.Width + h_delta,console_basis_size.Height + v_delta);
                //this.Width = console_basis_size.Width + h_delta;
                //this.Height = console_basis_size.Height + v_delta;
                panelFilter.Location = new Point(gr_filter_basis_location.X + h_delta, gr_filter_basis_location.Y + v_delta);

                grpMultimeter.Location = new Point(gr_Multimeter_basis_location.X + h_delta, gr_Multimeter_basis_location.Y);
                panelBandHF.Location = new Point(gr_BandHF_basis_location.X + h_delta, gr_BandHF_basis_location.Y + (v_delta / 4));
                panelBandVHF.Location = new Point(gr_BandVHF_basis_location.X + h_delta, gr_BandVHF_basis_location.Y + (v_delta / 4));
                panelMode.Location = new Point(gr_Mode_basis_location.X + h_delta, gr_Mode_basis_location.Y + (v_delta / 2));
                //grpVFOB.Location = new Point(gr_VFOB_basis_location.X+h_delta-(h_delta/4),gr_VFOB_basis_location.Y);
                //grpVFOA.Location = new Point(gr_VFOA_basis_location.X+(h_delta/4),gr_VFOA_basis_location.Y);
                panelModeSpecificPhone.Location = new Point(gr_ModePhone_basis_location.X + h_delta - (h_delta / 4), gr_ModePhone_basis_location.Y + v_delta);
                panelModeSpecificCW.Location = new Point(gr_ModeCW_basis_location.X + h_delta - (h_delta / 4), gr_ModeCW_basis_location.Y + v_delta);
                panelModeSpecificDigital.Location = new Point(gr_ModeDig_basis_location.X + h_delta - (h_delta / 4), gr_ModeDig_basis_location.Y + v_delta);
                panelModeSpecificFM.Location = new Point(gr_ModeFM_basis_location.X + h_delta - (h_delta / 4), gr_ModeFM_basis_location.Y + v_delta);

                panelVFO.Location = new Point(gr_VFO_basis_location.X + (h_delta / 4), gr_VFO_basis_location.Y + v_delta);
                grpVFOBetween.Location = new Point(gr_vfobetween_basis_location.X + (h_delta / 2), gr_vfobetween_basis_location.Y);

                if (!this.collapsedDisplay)
                {
                    grpVFOB.Location = new Point(gr_VFOB_basis_location.X + h_delta - (h_delta / 4), gr_VFOB_basis_location.Y);
                    grpVFOA.Location = new Point(gr_VFOA_basis_location.X + (h_delta / 4), gr_VFOA_basis_location.Y);

                    //btnDisplayPanCenter.Location = new Point(btn_display_pan_center_basis.X+(h_delta),btn_display_pan_center_basis.Y+v_delta);
                    btnDisplayPanCenter.Location = new Point(btn_display_pan_center_basis.X, btn_display_pan_center_basis.Y + v_delta);
                    // ptbDisplayPan.Size = new Size(tb_display_pan_size_basis.Width+(h_delta),tb_display_pan_size_basis.Height);
                    radDisplayZoom4x.Location = new Point(btn_display_zoom_4x_basis.X + h_delta, btn_display_zoom_4x_basis.Y + v_delta);
                    radDisplayZoom2x.Location = new Point(btn_display_zoom_2x_basis.X + h_delta, btn_display_zoom_2x_basis.Y + v_delta);
                    radDisplayZoom1x.Location = new Point(btn_display_zoom_1x_basis.X + h_delta, btn_display_zoom_1x_basis.Y + v_delta);
                    radDisplayZoom05.Location = new Point(btn_display_zoom_05_basis.X + h_delta, btn_display_zoom_05_basis.Y + v_delta);
                    ptbDisplayZoom.Location = new Point(tb_display_zoom_basis.X + h_delta, tb_display_zoom_basis.Y + v_delta);
                    txtDisplayPeakFreq.Location = new Point(txt_display_peak_freq_basis.X + h_delta, txt_display_peak_freq_basis.Y + v_delta);
                    txtDisplayPeakPower.Location = new Point(txt_display_peak_power_basis.X + h_delta, txt_display_peak_power_basis.Y + v_delta);
                    txtDisplayPeakOffset.Location = new Point(txt_display_peak_offset_basis.X + h_delta, txt_display_peak_offset_basis.Y + v_delta);
                    lblDisplayZoom.Location = new Point(lbl_display_zoom_basis.X + h_delta, lbl_display_zoom_basis.Y + v_delta);

                    panelDisplay.Size = new Size(gr_display_size_basis.Width + h_delta, gr_display_size_basis.Height + v_delta);
                    picDisplay.Size = new Size(pic_display_size_basis.Width + h_delta, pic_display_size_basis.Height + v_delta);
                    txtOverload.Size = new Size(txtOverload_size_basis.Width + h_delta, txtOverload_size_basis.Height);
                    txtOverload.Location = new Point(txtOverload_basis.X, txtOverload_basis.Y + v_delta);
                    panelDisplay2.Location = new Point(gr_display2_basis.X + (h_delta / 2), gr_display2_basis.Y + v_delta);
                    panelDSP.Location = new Point(gr_dsp_basis.X + (h_delta / 2), gr_dsp_basis.Y + v_delta);

                    //panelMultiRX.Location = new Point(gr_multirx_basis.X + (h_delta / 2), gr_multirx_basis.Y + v_delta);
                    ptbDisplayPan.Location = new Point(tb_displaypan_basis.X, tb_displaypan_basis.Y + v_delta);
                    lblDisplayPan.Location = new Point(lbl_displaypan_basis.X, lbl_displaypan_basis.Y + v_delta);
                    txtDisplayCursorFreq.Location = new Point(txt_display_cursor_freq_basis.X, txt_display_cursor_freq_basis.Y + v_delta);
                    txtDisplayCursorPower.Location = new Point(txt_display_cursor_power_basis.X, txt_display_cursor_power_basis.Y + v_delta);
                    txtDisplayCursorOffset.Location = new Point(txt_display_cursor_offset_basis.X, txt_display_cursor_offset_basis.Y + v_delta);

                    //chkPower.Location = new Point(chk_power_basis.X, chk_power_basis.Y + (v_delta / 8));
                    panelPower.Location = new Point(gr_power_basis.X, gr_power_basis.Y + (v_delta / 8));
                    panelOptions.Location = new Point(gr_options_basis.X, gr_options_basis.Y + (v_delta / 4));
                }
                //chkPower.Location = new Point(chk_power_basis.X, chk_power_basis.Y + (v_delta / 8));
                panelMultiRX.Location = new Point(gr_multirx_basis.X + (h_delta / 2), gr_multirx_basis.Y + v_delta);
                panelSoundControls.Location = new Point(gr_sound_controls_basis.X, gr_sound_controls_basis.Y + (v_delta / 8) + (v_delta / 4));
                chkSquelch.Location = new Point(chk_squelch_basis.X, chk_squelch_basis.Y + (v_delta / 2));
                picSquelch.Location = new Point(pic_sql_basis.X, pic_sql_basis.Y + (v_delta / 2));
                ptbSquelch.Location = new Point(tb_sql_basis.X, tb_sql_basis.Y + (v_delta / 2));
                panelAntenna.Location = new Point(gr_antenna_basis.X, gr_antenna_basis.Y + (v_delta / 8) + (v_delta / 2));
                panelDateTime.Location = new Point(gr_date_time_basis.X, gr_date_time_basis.Y + (v_delta / 2) + (v_delta / 4));
                //lblCPUMeter.Location = new Point(lbl_cpu_meter_basis.X,lbl_cpu_meter_basis.Y+(v_delta/8)+(v_delta/2)+(v_delta/4));

                //panelRX2Divider.Location = new Point(pan_rx2_divider_basis.X, pan_rx2_divider_basis.Y+v_delta);
                //panelRX2Divider.Size = new Size(pan_rx2_divider_size_basis.Width+h_delta, pan_rx2_divider_size_basis.Height);

                grpDisplaySplit.Location = new Point(gr_display_split_basis.X + (h_delta / 2), gr_display_split_basis.Y + v_delta);
                grpRX2Meter.Location = new Point(gr_rx2_meter_basis.X + h_delta, gr_rx2_meter_basis.Y + v_delta);
                panelRX2Filter.Location = new Point(gr_rx2_filter_basis.X + (int)(h_delta * 0.66), gr_rx2_filter_basis.Y + v_delta);
                panelRX2Mode.Location = new Point(gr_rx2_mode_basis.X + (int)(h_delta * 0.492), gr_rx2_mode_basis.Y + v_delta);
                panelRX2Display.Location = new Point(gr_rx2_display_basis.X + (int)(h_delta * 0.383), gr_rx2_display_basis.Y + v_delta);
                panelRX2DSP.Location = new Point(gr_rx2_dsp_basis.X + (int)(h_delta * 0.258), gr_rx2_dsp_basis.Y + v_delta);

                lblRX2RF.Location = new Point(lbl_rx2_rf_basis.X + (int)(h_delta * 0.164), lbl_rx2_rf_basis.Y + v_delta);
                ptbRX2RF.Location = new Point(tb_rx2_rf_basis.X + (int)(h_delta * 0.164), tb_rx2_rf_basis.Y + v_delta);
                chkRX2Squelch.Location = new Point(chk_rx2_squelch_basis.X + (int)(h_delta * 0.164), chk_rx2_squelch_basis.Y + v_delta);
                ptbRX2Squelch.Location = new Point(tb_rx2_squelch_basis.X + (int)(h_delta * 0.164), tb_rx2_squelch_basis.Y + v_delta);
                picRX2Squelch.Location = new Point(pic_rx2_squelch_basis.X + (int)(h_delta * 0.164), pic_rx2_squelch_basis.Y + v_delta);

                panelRX2Mixer.Location = new Point(gr_rx2_mixer_basis.X + (int)(h_delta * 0.078), gr_rx2_mixer_basis.Y + v_delta);
                chkRX2.Location = new Point(chk_rx2_enable_basis.X, chk_rx2_enable_basis.Y + v_delta);
                chkRX2Preamp.Location = new Point(chk_rx2_preamp_basis.X, chk_rx2_preamp_basis.Y + v_delta);
                lblRX2Band.Location = new Point(lbl_rx2_band_basis.X, lbl_rx2_band_basis.Y + v_delta);
                comboRX2Band.Location = new Point(combo_rx2_band_basis.X, combo_rx2_band_basis.Y + v_delta);
            }
            previous_delta = h_delta + v_delta; //we'll check this next time through...


            if (this.collapsedDisplay)
                this.RepositionControlsForCollapsedlDisplay();

        }

        public int HDelta
        {
            get { return h_delta; }
            set
            {
                h_delta = value;
                ResizeConsole(h_delta, v_delta);
            }
        }

        public int VDelta
        {
            get { return v_delta; }
            set
            {
                v_delta = value;
                ResizeConsole(h_delta, v_delta);
            }
        }

        public void GrabConsoleSizeBasis()
        {
            console_basis_size = this.Size;
            gr_filter_basis_location = this.panelFilter.Location;
            //Debug.WriteLine("console basis:  "+console_basis_size+"  "+gr_filter_basis_location);

            gr_Multimeter_basis_location = this.grpMultimeter.Location;
            gr_BandHF_basis_location = this.panelBandHF.Location;
            gr_BandVHF_basis_location = this.panelBandVHF.Location;
            gr_Mode_basis_location = this.panelMode.Location;
            gr_VFOB_basis_location = this.grpVFOB.Location;
            gr_VFOA_basis_location = this.grpVFOA.Location;
            gr_ModePhone_basis_location = this.panelModeSpecificPhone.Location;
            gr_ModeCW_basis_location = this.panelModeSpecificCW.Location;
            gr_ModeDig_basis_location = this.panelModeSpecificDigital.Location;
            gr_ModeFM_basis_location = this.panelModeSpecificFM.Location;
            gr_VFO_basis_location = this.panelVFO.Location;
            gr_vfobetween_basis_location = this.grpVFOBetween.Location;
            btn_display_pan_center_basis = this.btnDisplayPanCenter.Location;
            tb_display_pan_size_basis = this.ptbDisplayPan.Size;
            btn_display_zoom_4x_basis = this.radDisplayZoom4x.Location;
            btn_display_zoom_2x_basis = this.radDisplayZoom2x.Location;
            btn_display_zoom_1x_basis = this.radDisplayZoom1x.Location;
            btn_display_zoom_05_basis = this.radDisplayZoom05.Location;
            tb_display_zoom_basis = this.ptbDisplayZoom.Location;
            txt_display_peak_freq_basis = this.txtDisplayPeakFreq.Location;
            txt_display_peak_power_basis = this.txtDisplayPeakPower.Location;
            txt_display_peak_offset_basis = this.txtDisplayPeakOffset.Location;
            lbl_display_zoom_basis = this.lblDisplayZoom.Location;

            gr_display_size_basis = this.panelDisplay.Size;
            pic_display_size_basis = this.picDisplay.Size;
            txtOverload_size_basis = this.txtOverload.Size;
            txtOverload_basis = this.txtOverload.Location;
            gr_display2_basis = this.panelDisplay2.Location;
            gr_dsp_basis = this.panelDSP.Location;
            gr_multirx_basis = this.panelMultiRX.Location;
            tb_displaypan_basis = this.ptbDisplayPan.Location;
            lbl_displaypan_basis = this.lblDisplayPan.Location;
            txt_display_cursor_freq_basis = this.txtDisplayCursorFreq.Location;
            txt_display_cursor_power_basis = this.txtDisplayCursorPower.Location;
            txt_display_cursor_offset_basis = this.txtDisplayCursorOffset.Location;
            chk_power_basis = this.chkPower.Location;
            gr_power_basis = this.panelPower.Location;
            gr_options_basis = this.panelOptions.Location;
            gr_sound_controls_basis = this.panelSoundControls.Location;
            chk_squelch_basis = this.chkSquelch.Location;
            pic_sql_basis = this.picSquelch.Location;
            tb_sql_basis = this.ptbSquelch.Location;
            gr_antenna_basis = this.panelAntenna.Location;
            gr_date_time_basis = this.panelDateTime.Location;
            //lbl_cpu_meter_basis = this.lblCPUMeter.Location;

            //pan_rx2_divider_basis = this.panelRX2Divider.Location;
            //pan_rx2_divider_size_basis = this.panelRX2Divider.Size;

            gr_display_split_basis = this.grpDisplaySplit.Location;
            gr_rx2_meter_basis = this.grpRX2Meter.Location;
            gr_rx2_filter_basis = this.panelRX2Filter.Location;
            gr_rx2_mode_basis = this.panelRX2Mode.Location;
            gr_rx2_display_basis = this.panelRX2Display.Location;
            gr_rx2_dsp_basis = this.panelRX2DSP.Location;

            lbl_rx2_rf_basis = this.lblRX2RF.Location;
            tb_rx2_rf_basis = this.ptbRX2RF.Location;
            chk_rx2_squelch_basis = this.chkRX2Squelch.Location;
            tb_rx2_squelch_basis = this.ptbRX2Squelch.Location;
            pic_rx2_squelch_basis = this.picRX2Squelch.Location;

            gr_rx2_mixer_basis = this.panelRX2Mixer.Location;
            chk_rx2_enable_basis = this.chkRX2.Location;
            chk_rx2_preamp_basis = this.chkRX2Preamp.Location;
            lbl_rx2_band_basis = this.lblRX2Band.Location;
            combo_rx2_band_basis = this.comboRX2Band.Location;

            // :W1CEG:
            gr_multi_meter_size_basis = this.grpMultimeter.Size;
            pic_multi_meter_digital_basis = this.picMultiMeterDigital.Location;
            lbl_multi_smeter_basis = this.lblMultiSMeter.Location;
            pic_multi_meter_size_basis = this.picMultiMeterDigital.Size;
            txt_multi_text_basis = this.txtMultiText.Location;
            gr_options_size_basis = this.panelOptions.Size;
            chk_mon_basis = this.chkMON.Location;
            chk_mut_basis = this.chkMUT.Location;
            chk_mox_basis = this.chkMOX.Location;
            chk_tun_basis = this.chkTUN.Location;
            chk_vox_basis = this.chkVOX.Location;
            //lbl_af_basis = this.lblAF.Location;
            tb_af_basis = this.ptbAF.Location;
            tb_rf_basis = this.ptbRF.Location;
            gr_display_basis = this.panelDisplay.Location;
            pic_display_basis = this.picDisplay.Location;
            combo_display_mode_basis = this.comboDisplayMode.Location;
            combo_agc_basis = this.comboAGC.Location;
            combo_preamp_basis = this.comboPreamp.Location;
            combo_meter_rxmode_basis = this.comboMeterRXMode.Location;
            combo_meter_txmode_basis = this.comboMeterTXMode.Location;
            tb_display_zoom_size_basis = this.ptbDisplayZoom.Size;
            gr_BandHF_basis_size = panelBandHF.Size;
            gr_BandVHF_basis_size = panelBandVHF.Size;
            gr_Mode_basis_size = panelMode.Size;
            rad_band160_basis = radBand160.Location;
            rad_band80_basis = radBand80.Location;
            rad_band60_basis = radBand60.Location;
            rad_band40_basis = radBand40.Location;
            rad_band30_basis = radBand30.Location;
            rad_band20_basis = radBand20.Location;
            rad_band17_basis = radBand17.Location;
            rad_band15_basis = radBand15.Location;
            rad_band12_basis = radBand12.Location;
            rad_band10_basis = radBand10.Location;
            rad_band6_basis = radBand6.Location;
            rad_band2_basis = radBand2.Location;
            rad_bandwwv_basis = radBandWWV.Location;
            rad_bandgen_basis = radBandGEN.Location;
            rad_mode_lsb_basis = radModeLSB.Location;
            rad_mode_usb_basis = radModeUSB.Location;
            rad_mode_dsb_basis = radModeDSB.Location;
            rad_mode_cwl_basis = radModeCWL.Location;
            rad_mode_cwu_basis = radModeCWU.Location;
            rad_mode_fmn_basis = radModeFMN.Location;
            rad_mode_am_basis = radModeAM.Location;
            rad_mode_sam_basis = radModeSAM.Location;
            rad_mode_spec_basis = radModeSPEC.Location;
            rad_mode_digl_basis = radModeDIGL.Location;
            rad_mode_digu_basis = radModeDIGU.Location;
            rad_mode_drm_basis = radModeDRM.Location;
        }

        private bool rx2_enabled = false;
        public bool RX2Enabled
        {
            get { return rx2_enabled; }
            set
            {
                rx2_enabled = value;
                chkRX2.Checked = value;
                if (rx2_enabled)
                {
                    if (chkPower.Checked)
                    {
                        if (rx2_meter_thread == null || !rx2_meter_thread.IsAlive)
                        {
                            rx2_meter_thread = new Thread(new ThreadStart(UpdateRX2MeterData));
                            rx2_meter_thread.Name = "RX2 Meter Thread";
                            rx2_meter_thread.Priority = ThreadPriority.Lowest;
                            rx2_meter_thread.IsBackground = true;
                            rx2_meter_thread.Start();
                        }

                        if (rx2_sql_update_thread == null || !rx2_sql_update_thread.IsAlive)
                        {
                            rx2_sql_update_thread = new Thread(new ThreadStart(UpdateRX2SQL));
                            rx2_sql_update_thread.Name = "Update RX2 SQL";
                            rx2_sql_update_thread.Priority = ThreadPriority.Normal;
                            rx2_sql_update_thread.IsBackground = true;
                            rx2_sql_update_thread.Start();
                        }

                        txtVFOBFreq_LostFocus(this, EventArgs.Empty);

                        txtVFOBFreq.ForeColor = vfo_text_light_color;
                        txtVFOBMSD.ForeColor = vfo_text_light_color;
                        txtVFOBLSD.ForeColor = small_vfo_color;
                        txtVFOBBand.ForeColor = band_text_light_color;

                        if (chkVFOSplit.Checked) chkVFOSplit_CheckedChanged(this, EventArgs.Empty);
                        if (chkEnableMultiRX.Checked) chkEnableMultiRX_CheckedChanged(this, EventArgs.Empty);
                    }

                    radio.GetDSPRX(1, 0).Active = true;
                    DttSP.SetThreadProcessingMode(2, 2);
                    RadioDSP.SetThreadNumber(3);

                    if (chkEnableMultiRX.Checked)
                        txtVFOABand_LostFocus(this, EventArgs.Empty);

                    if (comboDisplayMode.Items.Contains("Panafall"))
                        comboDisplayMode.Items.Remove("Panafall");
                    if (comboDisplayMode.SelectedIndex < 0)
                        comboDisplayMode.Text = "Panadapter";

                    if (comboDisplayMode.Items.Contains("Panascope"))
                        comboDisplayMode.Items.Remove("Panascope");
                    if (comboDisplayMode.SelectedIndex < 0)
                        comboDisplayMode.Text = "Panadapter";
                }
                else
                {
                    if (chkPower.Checked)
                    {
                        if (chkVFOSplit.Checked) chkVFOSplit_CheckedChanged(this, EventArgs.Empty);
                        else if (chkEnableMultiRX.Checked) chkEnableMultiRX_CheckedChanged(this, EventArgs.Empty);
                        else
                        {
                            txtVFOBFreq.ForeColor = vfo_text_dark_color;
                            txtVFOBMSD.ForeColor = vfo_text_dark_color;
                            txtVFOBLSD.ForeColor = vfo_text_dark_color;
                            txtVFOBBand.ForeColor = band_text_dark_color;
                            panelVFOASubHover.Visible = false;
                        }
                        if (chkVFOBTX.Checked && FWCEEPROM.RX2OK && !chkVFOSplit.Checked)
                            chkVFOATX.Checked = true;
                        UpdateVFOASub();
                    }

                    radio.GetDSPRX(1, 0).Active = false;
                    DttSP.SetThreadProcessingMode(2, 0);
                    RadioDSP.SetThreadNumber(2);

                    /*if(comboMeterRXMode.Items.Contains("ADC2_L"))
                        comboMeterRXMode.Items.Remove("ADC2_L");
                    if(comboMeterRXMode.Items.Contains("ADC2_R"))
                        comboMeterRXMode.Items.Remove("ADC2_R");*/

                    if (chkEnableMultiRX.Checked)
                        txtVFOBFreq_LostFocus(this, EventArgs.Empty);

                    if (!comboDisplayMode.Items.Contains("Panafall"))
                        comboDisplayMode.Items.Insert(comboDisplayMode.Items.Count - 1, "Panafall");
                    if (!comboDisplayMode.Items.Contains("Panascope"))
                        comboDisplayMode.Items.Insert(comboDisplayMode.Items.Count - 1, "Panascope");
                }

                Audio.RX2Enabled = rx2_enabled;
                chkSplitDisplay.Checked = rx2_enabled;
            }
        }

        private void chkRX2_CheckedChanged(object sender, System.EventArgs e)
        {
            RX2Enabled = chkRX2.Checked;
            if (chkRX2.Checked)
                chkRX2.BackColor = button_selected_color;
            else
                chkRX2.BackColor = SystemColors.Control;
        }

        private void chkRX2SR_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkRX2SR.Checked) chkRX2SR.BackColor = button_selected_color;
            else chkRX2SR.BackColor = SystemColors.Control;
            RX2SpurReduction = chkRX2SR.Checked;
        }

        private void panelVFOASubHover_Paint(object sender, System.Windows.Forms.PaintEventArgs e)
        {
            if (!rx2_enabled || (!chkEnableMultiRX.Checked && !chkVFOSplit.Checked)) return;
            if (vfoa_sub_hover_digit < 0) return;

            int x = 0;
            int width = 0;

            /*if(small_lsd && txtVFOALSD.Visible)
            {
                x += (vfo_char_width+vfo_char_space)*vfoa_hover_digit;
                if(vfoa_hover_digit > 3)
                    x += (vfo_decimal_space-vfo_char_space);
				
                if(vfoa_hover_digit > 6)
                {
                    x += vfo_small_char_width;
                    x += (vfo_small_char_width+vfo_small_char_space-vfo_char_width-vfo_char_space)*(vfoa_hover_digit-6);
                    width = x+vfo_small_char_width;
                }
                else width = x+vfo_char_width;
            }
            else*/
            {
                x += (vfo_sub_char_width + vfo_sub_char_space) * vfoa_sub_hover_digit;
                if (vfoa_sub_hover_digit > 3)
                    x += (vfo_sub_decimal_space - vfo_sub_char_space);
                width = x + vfo_sub_char_width;
            }
            using (Pen p = new Pen(txtVFOABand.ForeColor, 2.0f))
                e.Graphics.DrawLine(p, x, 1, width, 1);
        }

        private void panelVFOASubHover_MouseMove(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            if (!rx2_enabled || (!chkEnableMultiRX.Checked && !chkVFOSplit.Checked)) return;
            Control c1 = (Control)sender;
            Control c2 = txtVFOABand;
            int client_width = (c1.Size.Width - c1.ClientSize.Width) + (c2.Size.Width - c2.ClientSize.Width);
            int client_height = (c1.Size.Height - c1.ClientSize.Height) + (c2.Size.Height - c2.ClientSize.Height);
            int x_offset = c1.Left - c2.Left - client_width / 2;
            int y_offset = c1.Top - c2.Top - client_height / 2;
            txtVFOABand_MouseMove(sender, new MouseEventArgs(e.Button, e.Clicks, e.X + x_offset, e.Y + y_offset, e.Delta));
        }

        private void txtVFOABand_MouseMove(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            if (!rx2_enabled || (!chkEnableMultiRX.Checked && !chkVFOSplit.Checked) || !chkPower.Checked) return;
            panelVFOASubHover.Visible = true;
            if (this.ContainsFocus)
            {
                int old_digit = vfoa_sub_hover_digit;
                int digit_index = 0;
                if (vfo_sub_char_width == 0)
                    GetVFOSubCharWidth();

                int x = txtVFOABand.Width - (vfo_sub_pixel_offset - 5);
                while (x < e.X)
                {
                    digit_index++;

                    /*if(small_lsd && txtVFOALSD.Visible)
                    {
                        if(digit_index < 6)
                            x += (vfo_char_width+vfo_char_space);
                        else 
                            x += (vfo_small_char_width+vfo_small_char_space);

                        if(digit_index == 3)
                            x += (vfo_decimal_space-vfo_char_space);
                        if(digit_index == 6)
                            x += vfo_small_char_width;
                    }
                    else
                    {*/
                    x += vfo_sub_char_width;
                    if (digit_index == 3)
                        x += vfo_sub_decimal_space;
                    else
                        x += vfo_sub_char_space;
                    //}
                }

                if (digit_index < 3) digit_index = -1;
                if (digit_index > 9) digit_index = 9;
                vfoa_sub_hover_digit = digit_index;
                if (vfoa_sub_hover_digit != old_digit)
                    panelVFOASubHover.Invalidate();
                //Debug.WriteLine("vfoa_sub_hover_digit:"+vfoa_sub_hover_digit);
            }
        }

        private void txtVFOABand_MouseLeave(object sender, System.EventArgs e)
        {
            vfoa_sub_hover_digit = -1;
            panelVFOASubHover.Invalidate();
        }

        private void SetRX2Mode(DSPMode new_mode)
        {
            if (!fwc_init || current_model != Model.FLEX5000 || !FWCEEPROM.RX2OK) return;
            if (new_mode == DSPMode.FIRST || new_mode == DSPMode.LAST) return;
            DSPMode old_mode = rx2_dsp_mode;

            if (rx2_enabled)
            {
                radio.GetDSPRX(1, 0).DSPMode = new_mode;				// set new DSP mode
                radio.GetDSPRX(1, 1).DSPMode = new_mode;

                if (chkVFOBTX.Checked)
                {
                    Audio.TXDSPMode = new_mode;
                    radio.GetDSPTX(0).CurrentDSPMode = new_mode;
                    if (fwc_init && (current_model == Model.FLEX5000))
                        FWC.SetTXDSPMode(new_mode);
                }
            }
            Display.RX2DSPMode = new_mode;
            //if(fwc_init && current_model == Model.FLEX5000)
            //FWC.SetRX2DSPMode(new_mode);

            double rx2_freq = VFOBFreq;
            int old_txosc = (int)radio.GetDSPTX(0).TXOsc;

            switch (old_mode)
            {
                case DSPMode.LSB:
                    radRX2ModeLSB.BackColor = SystemColors.Control;
                    break;
                case DSPMode.USB:
                    radRX2ModeUSB.BackColor = SystemColors.Control;
                    break;
                case DSPMode.DSB:
                    radRX2ModeDSB.BackColor = SystemColors.Control;
                    break;
                case DSPMode.CWL:
                    radRX2ModeCWL.BackColor = SystemColors.Control;
                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        // DttSP.StopKeyer();
                        cw_key_mode = false;
                    }
                    switch (new_mode)
                    {
                        case DSPMode.USB:
                            rx2_freq -= (cw_pitch * 0.0000010);
                            break;
                        case DSPMode.CWU:
                            break;
                        default:
                            rx2_freq += (cw_pitch * 0.0000010);
                            break;
                    }
                    txtVFOBFreq.Text = rx2_freq.ToString("f6");
                    break;
                case DSPMode.CWU:
                    radRX2ModeCWU.BackColor = SystemColors.Control;
                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        // DttSP.StopKeyer();
                        cw_key_mode = false;
                    }
                    switch (new_mode)
                    {
                        case DSPMode.LSB:
                            rx2_freq += (cw_pitch * 0.0000010);
                            break;
                        case DSPMode.CWL:
                            break;
                        default:
                            rx2_freq -= (cw_pitch * 0.0000010);
                            break;
                    }
                    txtVFOBFreq.Text = rx2_freq.ToString("f6");
                    break;
                case DSPMode.FM:
                    radRX2ModeFMN.BackColor = SystemColors.Control;
                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        if (new_mode != DSPMode.AM &&
                            new_mode != DSPMode.SAM &&
                            new_mode != DSPMode.FM)
                        {
                            chkMON.Enabled = true;
                            chkBIN.Enabled = true;
                        }

                        ptbMic_Scroll(this, EventArgs.Empty);

                        //int pwr = ptbPWR.Value;
                        //ptbPWR.Maximum = 100;
                        //tbPWR.TickFrequency = 10;
                        //if(tx_xvtr_index < 0) 
                        //	PWR = (int)(pwr*2.5);
                    }
                    // if (new_mode != DSPMode.DRM)
                    //    EnableAllRX2Filters();

                    // if(!initializing)
                    //     rx2_fm_squelch_threshold_scroll = ptbRX2Squelch.Value;

                    ptbRX2Squelch.Minimum = -160;
                    ptbRX2Squelch.Maximum = 0;

                    picRX2Squelch.Visible = true;

                    ptbRX2Squelch.Value = rx2_squelch_threshold_scroll;
                    break;
                case DSPMode.AM:
                    radRX2ModeAM.BackColor = SystemColors.Control;
                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        if (new_mode != DSPMode.AM &&
                            new_mode != DSPMode.SAM &&
                            new_mode != DSPMode.FM)
                        {
                            chkMON.Enabled = true;
                            chkBIN.Enabled = true;
                        }
                    }
                    if (new_mode != DSPMode.SPEC || new_mode != DSPMode.DRM)
                        EnableAllFilters();
                    break;
                case DSPMode.SAM:
                    radRX2ModeSAM.BackColor = SystemColors.Control;
                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        if (new_mode != DSPMode.AM &&
                            new_mode != DSPMode.SAM &&
                            new_mode != DSPMode.FM)
                        {
                            chkMON.Enabled = true;
                            chkBIN.Enabled = true;
                        }
                    }
                    break;
                case DSPMode.DIGL:
                    radRX2ModeDIGL.BackColor = SystemColors.Control;
                    if (rx2_enabled && vac_auto_enable &&
                        new_mode != DSPMode.DIGU &&
                        new_mode != DSPMode.DRM)
                    {
                        SetupForm.VACEnable = false;
                    }
                    break;
                case DSPMode.DIGU:
                    radRX2ModeDIGU.BackColor = SystemColors.Control;
                    if (rx2_enabled && vac_auto_enable &&
                        new_mode != DSPMode.DIGL &&
                        new_mode != DSPMode.DRM)
                    {
                        SetupForm.VACEnable = false;
                    }
                    break;
                case DSPMode.DRM:
                    radRX2ModeDRM.BackColor = SystemColors.Control;
                    rx2_if_shift = true;
                    rx2_vfo_offset = 0.0;
                    if (rx2_enabled && vac_auto_enable &&
                        new_mode != DSPMode.DIGL &&
                        new_mode != DSPMode.DIGU)
                        SetupForm.VACEnable = false;
                    if (new_mode != DSPMode.FM)
                        EnableAllFilters();
                    rx2_if_freq = SetupForm.IFFreq;
                    CalcDisplayFreq();
                    break;
            }

            switch (new_mode)
            {
                case DSPMode.LSB:
                    radRX2ModeLSB.BackColor = button_selected_color;
                    //panelRX2Mode.Text = "RX2 Mode - LSB";
                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }
                    break;
                case DSPMode.USB:
                    radRX2ModeUSB.BackColor = button_selected_color;
                    //panelRX2Mode.Text = "RX2 Mode - USB";
                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }
                    break;
                case DSPMode.DSB:
                    radRX2ModeDSB.BackColor = button_selected_color;
                    //grpRX2Mode.Text = "RX2 Mode - DSB";
                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }
                    break;
                case DSPMode.CWL:
                    radRX2ModeCWL.BackColor = button_selected_color;
                    //grpRX2Mode.Text = "RX2 Mode - CWL";

                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        radio.GetDSPTX(0).TXOsc = 0.0;
                        RadioDSP.KeyerFreq = cw_pitch;
                        if (!rx_only && chkPower.Checked)
                        {
                            //  DttSP.StopKeyer();
                            // DttSP.CWRingRestart();
                            // DttSP.StartKeyer();
                        }
                        cw_key_mode = true;

                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                    }

                    switch (rx2_dsp_mode)
                    {
                        case DSPMode.USB:
                            rx2_freq += (cw_pitch * 0.0000010);
                            break;
                        case DSPMode.CWU:
                            break;
                        default:
                            rx2_freq -= (cw_pitch * 0.0000010);
                            break;
                    }
                    txtVFOBFreq.Text = rx2_freq.ToString("f6");
                    break;
                case DSPMode.CWU:
                    radRX2ModeCWU.BackColor = button_selected_color;
                    //grpRX2Mode.Text = "RX2 Mode - CWU";

                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        radio.GetDSPTX(0).TXOsc = 0.0;
                        RadioDSP.KeyerFreq = -cw_pitch;
                        if (!rx_only && chkPower.Checked)
                        {
                            //  DttSP.StopKeyer();
                            //  DttSP.CWRingRestart();
                            //  DttSP.StartKeyer();
                        }
                        cw_key_mode = true;
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                    }

                    switch (rx1_dsp_mode)
                    {
                        case DSPMode.LSB:
                            rx2_freq -= (cw_pitch * 0.0000010);
                            break;
                        case DSPMode.CWL:
                            break;
                        default:
                            rx2_freq += (cw_pitch * 0.0000010);
                            break;
                    }
                    txtVFOBFreq.Text = rx2_freq.ToString("f6");
                    break;
                case DSPMode.FM:
                    radRX2ModeFMN.BackColor = button_selected_color;
                    // DisableAllRX2Filters();    //this needs to be for RX2 only

                    if (!initializing)
                        rx2_squelch_threshold_scroll = ptbRX2Squelch.Value;

                    ptbRX2Squelch.Minimum = 0;
                    ptbRX2Squelch.Maximum = 100;

                    ptbRX2Squelch.Value = rx2_fm_squelch_threshold_scroll;

                    picRX2Squelch.Visible = false;

                    //chkRX2Squelch.Enabled = false;
                    rx2_squelch_on = chkRX2Squelch.Checked;    //save state of non-FM squelch
                    chkRX2Squelch.Checked = true;

                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        //int pwr = ptbPWR.Value;
                        //if(rx1_xvtr_index < 0) 
                        //	PWR = (int)(pwr*0.4);
                        //else
                        //	PreviousPWR = pwr;
                        //ptbPWR.Maximum = 40;
                        //if(tx_xvtr_index >= 0)
                        //	XVTRForm.SetPower(tx_xvtr_index, PreviousPWR);
                        //tbPWR.TickFrequency = 8;
                        if (!rx_only && chkPower.Checked)
                            chkMOX.Enabled = true;
                        chkMON.Checked = false;
                        chkMON.Enabled = false;
                        chkBIN.Checked = false;
                        chkBIN.Enabled = false;
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        //radio.GetDSPTX(0).TXOsc = 11025.0; // w5wc-1
                        ptbFMMic_Scroll(this, EventArgs.Empty);
                    }
                    break;
                case DSPMode.AM:
                    radRX2ModeAM.BackColor = button_selected_color;
                    //grpRX2Mode.Text = "RX2 Mode - AM";
                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        chkMON.Checked = false;
                        chkMON.Enabled = false;
                        chkBIN.Checked = false;
                        chkBIN.Enabled = false;
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        // radio.GetDSPTX(0).TXOsc = 11025.0; // w5wc-1
                    }
                    break;
                case DSPMode.SAM:
                    radRX2ModeSAM.BackColor = button_selected_color;
                    //grpRX2Mode.Text = "RX2 Mode - SAM";

                    if (chkVFOBTX.Checked)
                    {
                        chkMON.Checked = false;
                        chkMON.Enabled = false;
                        chkBIN.Checked = false;
                        chkBIN.Enabled = false;
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        // radio.GetDSPTX(0).TXOsc = 11025.0; w5wc-1
                    }
                    break;
                case DSPMode.DIGL:
                    radRX2ModeDIGL.BackColor = button_selected_color;
                    //grpRX2Mode.Text = "RX2 Mode - DIGL";

                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }

                    if (rx2_enabled && vac_auto_enable)
                        SetupForm.VACEnable = true;
                    break;
                case DSPMode.DIGU:
                    radRX2ModeDIGU.BackColor = button_selected_color;
                    //grpRX2Mode.Text = "RX2 Mode - DIGU";

                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }
                    if (rx2_enabled && vac_auto_enable)
                        SetupForm.VACEnable = true;
                    break;
                case DSPMode.DRM:
                    rx2_if_shift = false;
                    rx2_vfo_offset = -0.012;
                    radRX2ModeDRM.BackColor = button_selected_color;
                    //grpRX2Mode.Text = "RX2 Mode - DRM";
                    if (rx2_enabled && vac_auto_enable)
                        SetupForm.VACEnable = true;

                    if (chkVFOBTX.Checked && rx2_enabled)
                    {
                        SetTXFilters(new_mode, tx_filter_low, tx_filter_high);
                        radio.GetDSPTX(0).TXOsc = 0.0;
                    }
                    //DisableAllRX2Filters(); // !FIXME

                    //grpFilter.Text = "Filter - DRM";
                    radio.GetDSPRX(1, 0).SetRXFilter(7000, 17000);
                    /*Display.RXDisplayLow = -8000;
                        Display.RXDisplayHigh = 8000;*/
                    break;
            }

            int new_txosc = (int)radio.GetDSPTX(0).TXOsc;
            if (new_txosc != old_txosc)
            {
                if (fwc_init && (current_model == Model.FLEX5000))
                    FWC.SetTXOffset(new_txosc);
            }

            radRX2Filter1.Text = rx2_filters[(int)new_mode].GetName(Filter.F1);
            radRX2Filter2.Text = rx2_filters[(int)new_mode].GetName(Filter.F2);
            radRX2Filter3.Text = rx2_filters[(int)new_mode].GetName(Filter.F3);
            radRX2Filter4.Text = rx2_filters[(int)new_mode].GetName(Filter.F4);
            radRX2Filter5.Text = rx2_filters[(int)new_mode].GetName(Filter.F5);
            radRX2Filter6.Text = rx2_filters[(int)new_mode].GetName(Filter.F6);
            radRX2Filter7.Text = rx2_filters[(int)new_mode].GetName(Filter.F7);
            radRX2FilterVar1.Text = rx2_filters[(int)new_mode].GetName(Filter.VAR1);
            radRX2FilterVar2.Text = rx2_filters[(int)new_mode].GetName(Filter.VAR2);

            rx2_dsp_mode = new_mode;

            RX2Filter = rx2_filters[(int)new_mode].LastFilter;

            tbFilterWidthScroll_newMode(); // wjt */

            Display.DrawBackground();

            UpdateDSPBufRX2();
            UpdateDSPBufTX();

            txtVFOBFreq_LostFocus(this, EventArgs.Empty);
            ptbPWR_Scroll(this, EventArgs.Empty);

            if (fwc_init && current_model == Model.FLEX5000)
            {
                bool tx1, tx2, tx3;
                if (flex5000RelayForm != null)
                    flex5000RelayForm.UpdateRelayState(out tx1, out tx2, out tx3);
            }
        }

        private void radRX2ModeLSB_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2ModeLSB.Checked)
            {
                SetRX2Mode(DSPMode.LSB);
            }
        }

        private void radRX2ModeUSB_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2ModeUSB.Checked)
            {
                SetRX2Mode(DSPMode.USB);
            }
        }

        private void radRX2ModeDSB_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2ModeDSB.Checked)
            {
                SetRX2Mode(DSPMode.DSB);
            }
        }

        private void radRX2ModeCWL_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2ModeCWL.Checked)
            {
                SetRX2Mode(DSPMode.CWL);
            }
        }

        private void radRX2ModeCWU_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2ModeCWU.Checked)
            {
                SetRX2Mode(DSPMode.CWU);
            }
        }

        private void radRX2ModeFMN_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2ModeFMN.Checked)
            {
                SetRX2Mode(DSPMode.FM);
            }
        }

        private void radRX2ModeAM_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2ModeAM.Checked)
            {
                SetRX2Mode(DSPMode.AM);
            }
        }

        private void radRX2ModeSAM_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2ModeSAM.Checked)
            {
                SetRX2Mode(DSPMode.SAM);
            }
        }

        private void radRX2ModeDIGL_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2ModeDIGL.Checked)
            {
                SetRX2Mode(DSPMode.DIGL);
            }
        }

        private void radRX2ModeDIGU_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2ModeDIGU.Checked)
            {
                SetRX2Mode(DSPMode.DIGU);
            }
        }

        private void radRX2ModeDRM_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2ModeDRM.Checked)
            {
                SetRX2Mode(DSPMode.DRM);
            }
        }

        public void SetRX2Filter(Filter new_filter)
        {
            if (!fwc_init || current_model != Model.FLEX5000 || !FWCEEPROM.RX2OK) return;
            if (rx2_dsp_mode == DSPMode.FIRST || rx2_dsp_mode == DSPMode.LAST) return;

            int low = 0, high = 0;

            switch (rx2_filter)
            {
                case Filter.F1:
                    radRX2Filter1.BackColor = SystemColors.Control;
                    break;
                case Filter.F2:
                    radRX2Filter2.BackColor = SystemColors.Control;
                    break;
                case Filter.F3:
                    radRX2Filter3.BackColor = SystemColors.Control;
                    break;
                case Filter.F4:
                    radRX2Filter4.BackColor = SystemColors.Control;
                    break;
                case Filter.F5:
                    radRX2Filter5.BackColor = SystemColors.Control;
                    break;
                case Filter.F6:
                    radRX2Filter6.BackColor = SystemColors.Control;
                    break;
                case Filter.F7:
                    radRX2Filter7.BackColor = SystemColors.Control;
                    break;
                case Filter.VAR1:
                    //radRX2FilterVar1.BackColor = SystemColors.Control;
                    //udRX2FilterLow.BackColor = SystemColors.Window;
                    //udRX2FilterHigh.BackColor = SystemColors.Window;
                    udRX2FilterLow.Enabled = false;
                    udRX2FilterHigh.Enabled = false;
                    break;
                case Filter.VAR2:
                    //radRX2FilterVar2.BackColor = SystemColors.Control;
                    //udRX2FilterLow.BackColor = SystemColors.Window;
                    //udRX2FilterHigh.BackColor = SystemColors.Window;
                    udRX2FilterLow.Enabled = false;
                    udRX2FilterHigh.Enabled = false;
                    break;
            }

            rx2_filter = new_filter;

            low = rx2_filters[(int)rx2_dsp_mode].GetLow(new_filter);
            high = rx2_filters[(int)rx2_dsp_mode].GetHigh(new_filter);
            rx2_filters[(int)rx2_dsp_mode].LastFilter = new_filter;

            panelRX2Filter.Text = "RX2 Filter - " + rx2_filters[(int)rx2_dsp_mode].GetName(new_filter);

            switch (new_filter)
            {
                case Filter.F1:
                    radRX2Filter1.BackColor = button_selected_color;
                    break;
                case Filter.F2:
                    radRX2Filter2.BackColor = button_selected_color;
                    break;
                case Filter.F3:
                    radRX2Filter3.BackColor = button_selected_color;
                    break;
                case Filter.F4:
                    radRX2Filter4.BackColor = button_selected_color;
                    break;
                case Filter.F5:
                    radRX2Filter5.BackColor = button_selected_color;
                    break;
                case Filter.F6:
                    radRX2Filter6.BackColor = button_selected_color;
                    break;
                case Filter.F7:
                    radRX2Filter7.BackColor = button_selected_color;
                    break;
                case Filter.VAR1:
                    //radRX2FilterVar1.BackColor = button_selected_color;
                    //udRX2FilterLow.BackColor = button_selected_color;
                    //udRX2FilterHigh.BackColor = button_selected_color;
                    udRX2FilterLow.Enabled = true;
                    udRX2FilterHigh.Enabled = true;
                    break;
                case Filter.VAR2:
                    //radRX2FilterVar2.BackColor = button_selected_color;
                    //udRX2FilterLow.BackColor = button_selected_color;
                    //udRX2FilterHigh.BackColor = button_selected_color;
                    udRX2FilterLow.Enabled = true;
                    udRX2FilterHigh.Enabled = true;
                    break;
                case Filter.NONE:
                    foreach (Control c in panelRX2Filter.Controls)
                    {
                        if (c.GetType() == typeof(RadioButtonTS))
                        {
                            ((RadioButtonTS)c).Checked = false;

                            if (c.BackColor != SystemColors.Control)
                                ((RadioButtonTS)c).BackColor = SystemColors.Control;
                        }
                    }
                    return;
            }

            UpdateRX2Filters(low, high);
        }

        private void radRX2Filter1_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2Filter1.Checked)
                SetRX2Filter(Filter.F1);
        }

        private void radRX2Filter2_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2Filter2.Checked)
                SetRX2Filter(Filter.F2);
        }

        private void radRX2Filter3_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2Filter3.Checked)
                SetRX2Filter(Filter.F3);
        }

        private void radRX2Filter4_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2Filter4.Checked)
                SetRX2Filter(Filter.F4);
        }

        private void radRX2Filter5_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2Filter5.Checked)
                SetRX2Filter(Filter.F5);
        }

        private void radRX2Filter6_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2Filter6.Checked)
                SetRX2Filter(Filter.F6);
        }

        private void radRX2Filter7_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2Filter7.Checked)
                SetRX2Filter(Filter.F7);
        }

        private void radRX2FilterVar1_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2FilterVar1.Checked)
                SetRX2Filter(Filter.VAR1);
        }

        private void radRX2FilterVar2_CheckedChanged(object sender, System.EventArgs e)
        {
            if (radRX2FilterVar2.Checked)
                SetRX2Filter(Filter.VAR2);
        }

        private void udRX2FilterLow_ValueChanged(object sender, System.EventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            if (udRX2FilterLow.Focused)
            {
                if (udRX2FilterLow.Value >= udRX2FilterHigh.Value - 10)
                {
                    udRX2FilterLow.Value = udRX2FilterHigh.Value - 10;
                    return;
                }

                UpdateRX2Filters((int)udRX2FilterLow.Value, (int)udRX2FilterHigh.Value);

                if (!save_filter_changes)
                    rx2_filters[(int)rx2_dsp_mode].SetLow(rx2_filter, (int)udRX2FilterLow.Value);
            }

            if (save_filter_changes)
                rx2_filters[(int)rx2_dsp_mode].SetLow(rx2_filter, (int)udRX2FilterLow.Value);

            /*if(udFilterLow.Focused)
                btnHidden.Focus();*/
        }

        private void udRX2FilterHigh_ValueChanged(object sender, System.EventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            if (udRX2FilterHigh.Focused)
            {
                if (udRX2FilterHigh.Value <= udRX2FilterLow.Value + 10)
                {
                    udRX2FilterHigh.Value = udRX2FilterLow.Value + 10;
                    return;
                }

                UpdateRX2Filters((int)udRX2FilterLow.Value, (int)udRX2FilterHigh.Value);

                if (!save_filter_changes)
                    rx2_filters[(int)rx2_dsp_mode].SetHigh(rx2_filter, (int)udRX2FilterHigh.Value);
            }

            if (save_filter_changes)
                rx2_filters[(int)rx2_dsp_mode].SetHigh(rx2_filter, (int)udRX2FilterHigh.Value);

            /*if(udFilterHigh.Focused)
                btnHidden.Focus();*/
        }

        private void chkRX2NR_CheckedChanged(object sender, System.EventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            if (chkRX2NR.Checked) chkRX2NR.BackColor = button_selected_color;
            else chkRX2NR.BackColor = SystemColors.Control;
            radio.GetDSPRX(1, 0).NoiseReduction = chkRX2NR.Checked;
            radio.GetDSPRX(1, 1).NoiseReduction = chkRX2NR.Checked;
            //cat_nr_status = Convert.ToInt32(chkRX2NR.Checked);
        }

        private void chkRX2ANF_CheckedChanged(object sender, System.EventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            if (chkRX2ANF.Checked) chkRX2ANF.BackColor = button_selected_color;
            else chkRX2ANF.BackColor = SystemColors.Control;
            radio.GetDSPRX(1, 0).AutoNotchFilter = chkRX2ANF.Checked;
            radio.GetDSPRX(1, 1).AutoNotchFilter = chkRX2ANF.Checked;
            //cat_anf_status = Convert.ToInt32(chkRX2ANF.Checked);
        }

        private void chkRX2NB_CheckedChanged(object sender, System.EventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            if (chkRX2NB.Checked) chkRX2NB.BackColor = button_selected_color;
            else chkRX2NB.BackColor = SystemColors.Control;
            radio.GetDSPRX(1, 0).NBOn = chkRX2NB.Checked;
            radio.GetDSPRX(1, 1).NBOn = chkRX2NB.Checked;
            //cat_nb1_status = Convert.ToInt32(chkRX2NB.Checked);
        }

        private void chkRX2NB2_CheckedChanged(object sender, System.EventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            if (chkRX2NB2.Checked) chkRX2NB2.BackColor = button_selected_color;
            else chkRX2NB2.BackColor = SystemColors.Control;
            radio.GetDSPRX(1, 0).SDROM = chkRX2NB2.Checked;
            radio.GetDSPRX(1, 1).SDROM = chkRX2NB2.Checked;
            //cat_nb2_status = Convert.ToInt32(chkRX2NB2.Checked);
        }

        private void chkRX2BIN_CheckedChanged(object sender, System.EventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            if (chkRX2BIN.Checked) chkRX2BIN.BackColor = button_selected_color;
            else chkRX2BIN.BackColor = SystemColors.Control;
            radio.GetDSPRX(1, 0).BinOn = chkRX2BIN.Checked;
            radio.GetDSPRX(1, 1).BinOn = chkRX2BIN.Checked;
        }

        private void comboRX2MeterMode_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            if (comboRX2MeterMode.Items.Count == 0 ||
                comboRX2MeterMode.SelectedIndex < 0)
            {
                rx2_meter_mode = MeterRXMode.FIRST;
            }
            else
            {
                MeterRXMode mode = MeterRXMode.FIRST;
                switch (comboRX2MeterMode.Text)
                {
                    case "Signal":
                        mode = MeterRXMode.SIGNAL_STRENGTH;
                        break;
                    case "Sig Avg":
                        rx2_meter_avg = Display.CLEAR_FLAG;
                        mode = MeterRXMode.SIGNAL_AVERAGE;
                        break;
                    case "ADC L":
                        mode = MeterRXMode.ADC_L;
                        break;
                    case "ADC R":
                        mode = MeterRXMode.ADC_R;
                        break;
                    case "ADC2 L":
                        mode = MeterRXMode.ADC2_L;
                        break;
                    case "ADC2 R":
                        mode = MeterRXMode.ADC2_R;
                        break;
                    case "Off":
                        mode = MeterRXMode.OFF;
                        break;
                }
                rx2_meter_mode = mode;

                switch (mode)
                {
                    case MeterRXMode.SIGNAL_STRENGTH:
                    case MeterRXMode.SIGNAL_AVERAGE:
                        lblRX2Meter.Text = "  1   3   5   7   9  +20 +40 +60";
                        break;
                    case MeterRXMode.ADC_L:
                    case MeterRXMode.ADC_R:
                        lblRX2Meter.Text = "-100  -80   -60   -40   -20    0";
                        break;
                    case MeterRXMode.OFF:
                        lblRX2Meter.Text = "";
                        break;
                }
                ResetRX2MeterPeak();
            }

            picRX2Meter.Invalidate();

            if (comboRX2MeterMode.Focused)
                btnHidden.Focus();
        }

        private void chkRX2Preamp_CheckedChanged(object sender, System.EventArgs e)
        {
            if (!fwc_init || current_model != Model.FLEX5000 || !FWCEEPROM.RX2OK) return;
            if (chkRX2Preamp.Checked)
            {
                chkRX2Preamp.BackColor = button_selected_color;
                RX2PreampMode = PreampMode.HIGH;
            }
            else
            {
                chkRX2Preamp.BackColor = SystemColors.Control;
                RX2PreampMode = PreampMode.OFF;
            }
        }

        private void ptbRX2RF_Scroll(object sender, System.EventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            lblRX2RF.Text = "AGC-T:  " + ptbRX2RF.Value.ToString();
            switch (RX2AGCMode)
            {
                case AGCMode.FIXD:
                    radio.GetDSPRX(1, 0).RXFixedAGC = (double)ptbRX2RF.Value;
                    radio.GetDSPRX(1, 1).RXFixedAGC = (double)ptbRX2RF.Value;
                    rx2_fixed_gain = ptbRX2RF.Value;
                    break;
                default:
                    radio.GetDSPRX(1, 0).RXAGCMaxGain = (double)ptbRX2RF.Value;
                    radio.GetDSPRX(1, 1).RXAGCMaxGain = (double)ptbRX2RF.Value;
                    rx2_max_gain = ptbRX2RF.Value;
                    break;
            }

            rx2_agct_by_band[(int)rx2_band] = ptbRX2RF.Value;
            if (ptbRX2RF.Focused) btnHidden.Focus();
        }

        private void chkRX2Squelch_CheckedChanged(object sender, System.EventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            if (chkRX2Squelch.Checked) chkRX2Squelch.BackColor = button_selected_color;
            else chkRX2Squelch.BackColor = SystemColors.Control;
            radio.GetDSPRX(1, 0).RXSquelchOn = chkRX2Squelch.Checked;
            radio.GetDSPRX(1, 1).RXSquelchOn = chkRX2Squelch.Checked;
        }

        private void ptbRX2Squelch_Scroll(object sender, System.EventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            chkRX2Squelch.Text = "SQL:  " + ptbRX2Squelch.Value.ToString();
            radio.GetDSPRX(1, 0).RXSquelchThreshold = ((float)ptbRX2Squelch.Value -
                rx2_meter_cal_offset -
                rx2_preamp_offset[(int)rx2_preamp_mode] -
                rx2_filter_size_cal_offset -
                rx2_path_offset);
            radio.GetDSPRX(1, 1).RXSquelchThreshold = ((float)ptbRX2Squelch.Value -
                rx2_meter_cal_offset -
                rx2_preamp_offset[(int)rx2_preamp_mode] -
                rx2_filter_size_cal_offset -
                rx2_path_offset);

            if (ptbRX2Squelch.Focused) btnHidden.Focus();
        }

        private void picRX2Squelch_Paint(object sender, System.Windows.Forms.PaintEventArgs e)
        {
            if (!FWCEEPROM.RX2OK) return;
            int signal_x = (int)((rx2_sql_data + 160.0) * (picRX2Squelch.Width - 1) / 160.0);
            int sql_x = (int)(((float)ptbRX2Squelch.Value + 160.0) * (picRX2Squelch.Width - 1) / 160.0);

            e.Graphics.FillRectangle(Brushes.LimeGreen, 0, 0, signal_x, picRX2Squelch.Height);
            if (sql_x < signal_x)
                e.Graphics.FillRectangle(Brushes.Red, sql_x + 1, 0, signal_x - sql_x - 1, picRX2Squelch.Height);
        }

        private void chkRX1Preamp_CheckedChanged(object sender, System.EventArgs e)
        {
            if (!fwc_init || current_model != Model.FLEX5000) return;
            if (chkRX1Preamp.Checked)
            {
                chkRX1Preamp.BackColor = button_selected_color;
                chkRX1Preamp.Text = "On";
                RX1PreampMode = PreampMode.HIGH;
            }
            else
            {
                chkRX1Preamp.BackColor = SystemColors.Control;
                chkRX1Preamp.Text = "Off";
                RX1PreampMode = PreampMode.OFF;
            }
        }

        private void ptbRX2Pan_Scroll(object sender, System.EventArgs e)
        {
            float val = (int)ptbRX2Pan.Value / 100.0f;
            radio.GetDSPRX(1, 0).Pan = val;

            if (ptbRX2Pan.Focused)
                btnHidden.Focus();
        }

        private void ptbRX2Gain_Scroll(object sender, System.EventArgs e)
        {
            if (chkRX2Mute.Checked) return;
            radio.GetDSPRX(1, 0).RXOutputGain = (double)ptbRX2Gain.Value / ptbRX2Gain.Maximum;
            if (ptbRX2Gain.Focused)
                btnHidden.Focus();
        }

        private void chkRX2Mute_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkRX2Mute.Checked)
                radio.GetDSPRX(1, 0).RXOutputGain = 0.0;
            else ptbRX2Gain_Scroll(this, EventArgs.Empty);
            if (chkRX2Mute.Focused)
                btnHidden.Focus();
        }

        private void comboRX2DisplayMode_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            switch (comboRX2DisplayMode.Text)
            {
                case "Spectrum":
                    Display.CurrentDisplayModeBottom = DisplayMode.SPECTRUM;
                    if (chkSplitDisplay.Checked) UpdateRXDisplayVars((int)udFilterLow.Value, (int)udFilterHigh.Value);
                    break;
                case "Panadapter":
                    Display.CurrentDisplayModeBottom = DisplayMode.PANADAPTER;
                    if (chkSplitDisplay.Checked) CalcDisplayFreq();
                    break;
                case "Scope":
                    Display.CurrentDisplayModeBottom = DisplayMode.SCOPE;
                    break;
                case "Phase":
                    Display.CurrentDisplayModeBottom = DisplayMode.PHASE;
                    break;
                case "Phase2":
                    Display.CurrentDisplayModeBottom = DisplayMode.PHASE2;
                    break;
                case "Waterfall":
                    Display.CurrentDisplayModeBottom = DisplayMode.WATERFALL;
                    if (chkSplitDisplay.Checked) CalcDisplayFreq();
                    break;
                case "Histogram":
                    Display.CurrentDisplayModeBottom = DisplayMode.HISTOGRAM;
                    break;
                case "Off":
                    Display.CurrentDisplayModeBottom = DisplayMode.OFF;
                    break;
            }

            if (comboRX2DisplayMode.Focused)
                btnHidden.Focus();
        }

        private void chkRX2DisplayAVG_CheckedChanged(object sender, System.EventArgs e)
        {
            Display.RX2AverageOn = chkRX2DisplayAVG.Checked;
            if (chkRX2DisplayAVG.Checked)
            {
                chkRX2DisplayAVG.BackColor = button_selected_color;
            }
            else
            {
                chkRX2DisplayAVG.BackColor = SystemColors.Control;
            }

            /*if(chkRX2DisplayAVG.Checked)
            {
                switch(Display.CurrentDisplayMode)
                {
                    case DisplayMode.PANADAPTER:
                    case DisplayMode.HISTOGRAM:
                    case DisplayMode.SPECTRUM:
                    case DisplayMode.WATERFALL:
                        btnZeroBeat.Enabled = true; // only allow zerobeat when avg is on 
                        break;
                    default:
                        btnZeroBeat.Enabled = false;
                        break;
                }
            }
            else btnZeroBeat.Enabled = false;*/
        }

        private void chkRX2DisplayPeak_CheckedChanged(object sender, System.EventArgs e)
        {
            Display.RX2PeakOn = chkRX2DisplayPeak.Checked;
            if (chkRX2DisplayPeak.Checked)
            {
                chkRX2DisplayPeak.BackColor = button_selected_color;
            }
            else
            {
                chkRX2DisplayPeak.BackColor = SystemColors.Control;
            }
        }

        private void UpdateDSPBufRX1()
        {
            int size = 2048;
            switch (rx1_dsp_mode)
            {
                case DSPMode.LSB:
                case DSPMode.USB:
                case DSPMode.DSB:
                case DSPMode.AM:
                case DSPMode.SAM:
                case DSPMode.FM:
                    size = dsp_buf_phone_rx;
                    break;
                case DSPMode.CWL:
                case DSPMode.CWU:
                    size = dsp_buf_cw_rx;
                    break;
                case DSPMode.DIGL:
                case DSPMode.DIGU:
                case DSPMode.DRM:
                    size = dsp_buf_dig_rx;
                    break;
            }

            int offset = 0;
            switch (size)
            {
                case 4096: offset = 0; break;
                case 2048: offset = 3; break;
                case 1024: offset = 6; break;
                case 512: offset = 9; break;
                case 256: offset = 12; break;
            }

            if (radio.GetDSPRX(0, 0).BufferSize != size ||
                radio.GetDSPRX(0, 1).BufferSize != size)
            {
                bool poweron = PowerOn;
                if (poweron)
                {
                    PowerOn = false;
                    Thread.Sleep(100);
                }

                RX1FilterSizeCalOffset = (float)offset;
                radio.GetDSPRX(0, 0).BufferSize = size;
                radio.GetDSPRX(0, 1).BufferSize = size;

                if (!initializing)
                {
                    RadioDSP.SyncStatic();

                    for (int i = 0; i < 1; i++)
                    {
                        for (int j = 0; j < 2; j++)
                        {
                            RadioDSPRX dsp_rx = radio.GetDSPRX(i, j);
                            dsp_rx.Update = false;
                            dsp_rx.Force = true;
                            dsp_rx.Update = true;
                            dsp_rx.Force = false;
                        }
                    }

                    for (int i = 0; i < 1; i++)
                    {
                        RadioDSPTX dsp_tx = radio.GetDSPTX(i);
                        dsp_tx.Update = false;
                        dsp_tx.Force = true;
                        dsp_tx.Update = true;
                        dsp_tx.Force = false;
                    }
                }

                if (poweron) PowerOn = true;
            }
        }

        private void UpdateDSPBufRX2()
        {
            int size = 2048;
            switch (rx2_dsp_mode)
            {
                case DSPMode.LSB:
                case DSPMode.USB:
                case DSPMode.DSB:
                case DSPMode.AM:
                case DSPMode.SAM:
                case DSPMode.FM:
                    size = dsp_buf_phone_rx;
                    break;
                case DSPMode.CWL:
                case DSPMode.CWU:
                    size = dsp_buf_cw_rx;
                    break;
                case DSPMode.DIGL:
                case DSPMode.DIGU:
                case DSPMode.DRM:
                    size = dsp_buf_dig_rx;
                    break;
            }

            int offset = 0;
            switch (size)
            {
                case 4096: offset = 0; break;
                case 2048: offset = 3; break;
                case 1024: offset = 6; break;
                case 512: offset = 9; break;
                case 256: offset = 12; break;
            }

            if (radio.GetDSPRX(1, 0).BufferSize != size ||
                radio.GetDSPRX(1, 1).BufferSize != size)
            {
                bool poweron = PowerOn;
                if (poweron)
                {
                    PowerOn = false;
                    Thread.Sleep(100);
                }

                RX2FilterSizeCalOffset = (float)offset;
                radio.GetDSPRX(1, 0).BufferSize = size;
                radio.GetDSPRX(1, 1).BufferSize = size;

                if (!initializing)
                {
                    RadioDSP.SyncStatic();

                    for (int i = 0; i < 1; i++)
                    {
                        for (int j = 0; j < 2; j++)
                        {
                            RadioDSPRX dsp_rx = radio.GetDSPRX(i, j);
                            dsp_rx.Update = false;
                            dsp_rx.Force = true;
                            dsp_rx.Update = true;
                            dsp_rx.Force = false;
                        }
                    }

                    for (int i = 0; i < 1; i++)
                    {
                        RadioDSPTX dsp_tx = radio.GetDSPTX(i);
                        dsp_tx.Update = false;
                        dsp_tx.Force = true;
                        dsp_tx.Update = true;
                        dsp_tx.Force = false;
                    }
                }

                if (poweron) PowerOn = true;
            }
        }

        private void UpdateDSPBufTX()
        {
            int size = 2048;
            DSPMode mode = rx1_dsp_mode;
            if (chkVFOBTX.Checked) mode = rx2_dsp_mode;
            switch (mode)
            {
                case DSPMode.LSB:
                case DSPMode.USB:
                case DSPMode.DSB:
                case DSPMode.AM:
                case DSPMode.SAM:
                case DSPMode.FM:
                    size = dsp_buf_phone_tx;
                    break;
                case DSPMode.CWL:
                case DSPMode.CWU:
                    size = dsp_buf_cw_tx;
                    break;
                case DSPMode.DIGL:
                case DSPMode.DIGU:
                case DSPMode.DRM:
                    size = dsp_buf_dig_tx;
                    break;
            }

            if (radio.GetDSPTX(0).BufferSize != size)
            {
                bool poweron = PowerOn;
                if (poweron)
                {
                    PowerOn = false;
                    Thread.Sleep(100);
                }

                radio.GetDSPTX(0).BufferSize = size;

                if (!initializing)
                {
                    RadioDSP.SyncStatic();

                    for (int i = 0; i < 2; i++)
                    {
                        for (int j = 0; j < 2; j++)
                        {
                            RadioDSPRX dsp_rx = radio.GetDSPRX(i, j);
                            dsp_rx.Update = false;
                            dsp_rx.Force = true;
                            dsp_rx.Update = true;
                            dsp_rx.Force = false;
                        }
                    }

                    for (int i = 0; i < 1; i++)
                    {
                        RadioDSPTX dsp_tx = radio.GetDSPTX(i);
                        dsp_tx.Update = false;
                        dsp_tx.Force = true;
                        dsp_tx.Update = true;
                        dsp_tx.Force = false;
                    }
                }

                if (poweron) PowerOn = true;
            }
        }

        private int dsp_buf_phone_rx = 4096;
        public int DSPBufPhoneRX
        {
            get { return dsp_buf_phone_rx; }
            set
            {
                dsp_buf_phone_rx = value;
                UpdateDSPBufRX1();
                // UpdateDSPBufRX2();
            }
        }

        private int dsp_buf_phone_tx = 2048;
        public int DSPBufPhoneTX
        {
            get { return dsp_buf_phone_tx; }
            set
            {
                dsp_buf_phone_tx = value;
                UpdateDSPBufTX();
            }
        }

        private int dsp_buf_cw_rx = 4096;
        public int DSPBufCWRX
        {
            get { return dsp_buf_cw_rx; }
            set
            {
                dsp_buf_cw_rx = value;
                UpdateDSPBufRX1();
                // UpdateDSPBufRX2();
            }
        }

        private int dsp_buf_cw_tx = 2048;
        public int DSPBufCWTX
        {
            get { return dsp_buf_cw_tx; }
            set
            {
                dsp_buf_cw_tx = value;
                UpdateDSPBufTX();
            }
        }

        private int dsp_buf_dig_rx = 4096;
        public int DSPBufDigRX
        {
            get { return dsp_buf_dig_rx; }
            set
            {
                dsp_buf_dig_rx = value;
                UpdateDSPBufRX1();
                // UpdateDSPBufRX2();
            }
        }

        private int dsp_buf_dig_tx = 2048;

        private void comboRX2Band_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            if (comboRX2Band.Focused)
            {
                string filter = "", mode = "";
                double freq = 0.0;
                bool b = false;
                switch (comboRX2Band.Text)
                {
                    case "160m":
                        b = DB.GetBandStack("160M", 0, out mode, out filter, out freq);
                        break;
                    case "80m":
                        b = DB.GetBandStack("80M", 0, out mode, out filter, out freq);
                        break;
                    case "60m":
                        b = DB.GetBandStack("60M", 0, out mode, out filter, out freq);
                        break;
                    case "40m":
                        b = DB.GetBandStack("40M", 0, out mode, out filter, out freq);
                        break;
                    case "30m":
                        b = DB.GetBandStack("30M", 0, out mode, out filter, out freq);
                        break;
                    case "20m":
                        b = DB.GetBandStack("20M", 0, out mode, out filter, out freq);
                        break;
                    case "17m":
                        b = DB.GetBandStack("17M", 0, out mode, out filter, out freq);
                        break;
                    case "15m":
                        b = DB.GetBandStack("15M", 0, out mode, out filter, out freq);
                        break;
                    case "12m":
                        b = DB.GetBandStack("12M", 0, out mode, out filter, out freq);
                        break;
                    case "10m":
                        b = DB.GetBandStack("10M", 0, out mode, out filter, out freq);
                        break;
                    case "6m":
                        b = DB.GetBandStack("6M", 0, out mode, out filter, out freq);
                        break;
                    case "GEN":
                        b = DB.GetBandStack("GEN", 0, out mode, out filter, out freq);
                        break;
                    case "WWV":
                        b = DB.GetBandStack("WWV", 0, out mode, out filter, out freq);
                        break;
                }

                if (b)
                {
                    VFOBFreq = freq;
                    RX2DSPMode = (DSPMode)Enum.Parse(typeof(DSPMode), mode);
                    VFOBFreq = freq;
                    RX2Filter = (Filter)Enum.Parse(typeof(Filter), filter);
                }

                btnHidden.Focus();
            }
        }

        bool done_console_basis = false;
        int dpi = 0;
        SizeF base_size = new SizeF(0, 0);
        bool dpi_resize_done = false;
        bool set_min_size = false;
        private void Console_Resize(object sender, System.EventArgs e)
        {
            if (this.WindowState == FormWindowState.Minimized)
                return;

            if (dpi == 0)
                dpi = (int)picDisplay.CreateGraphics().DpiX;
            if (dpi > 96 && !dpi_resize_done)
            {
                if (base_size.Width == 0)
                    base_size = this.AutoScaleDimensions;

                if (this.AutoScaleDimensions != base_size)
                    dpi_resize_done = true;
                else return;
            }

            if (!done_console_basis)
            {
                GrabConsoleSizeBasis();
                done_console_basis = true;
                /*if(dpi > 96)
                {
                    ArrayList a = DB.GetVars("State");
                    foreach(string s in a)
                    {
                        string[] vals = s.Split('/');
                        string name = vals[0];
                        string val = vals[1];
						
                        switch(name)
                        {
                            case "console_width":
                                this.Width = int.Parse(val);
                                break;
                            case "console_height":
                                this.Height = int.Parse(val);
                                break;
                        }
                    }						
                }*/
            }

            if (!set_min_size)
            {
                int W = console_basis_size.Width;
                int H;

                if (fwc_init && current_model == Model.FLEX5000 && FWCEEPROM.RX2OK)
                    H = console_basis_size.Height - (panelRX2Filter.Height + 8);
                else H = console_basis_size.Height;

                this.MinimumSize = new Size(W, H);
                set_min_size = true;
            }

            if (this.Width < console_basis_size.Width && !this.collapsedDisplay)
            {
                this.Width = console_basis_size.Width;
                return;
            }

            if (fwc_init && current_model == Model.FLEX5000 && FWCEEPROM.RX2OK)
            {
                if (this.Height < console_basis_size.Height - (panelRX2Filter.Height + 8))
                    this.Height = console_basis_size.Height - (panelRX2Filter.Height + 8);
            }
            else if (this.Height < console_basis_size.Height && !this.collapsedDisplay)
            {
                this.Height = console_basis_size.Height;
                return;
            }

            int h_delta = this.Width - console_basis_size.Width;
            int v_delta = Math.Max(this.Height - console_basis_size.Height, 0);

            if (this.SetupForm != null)
            {
                if (this.collapsedDisplay)
                {
                    this.SetupForm.CollapsedWidth = this.Width;
                    this.SetupForm.CollapsedHeight = this.Height;
                }
                else
                {
                    if (this.SetupForm.CollapsedWidth == 0)
                        this.SetupForm.CollapsedWidth = console_basis_size.Width;
                    if (this.SetupForm.CollapsedHeight == 0)
                        this.SetupForm.CollapsedHeight =
                            (fwc_init && current_model == Model.FLEX5000 && FWCEEPROM.RX2OK) ?
                                console_basis_size.Height - (panelRX2Filter.Height + 8) :
                                console_basis_size.Height;
                }
            }

            ResizeConsole(h_delta, v_delta);
        }

        private int rx2_fixed_gain = 20;
        private int rx2_max_gain = 90;
        private void comboRX2AGC_SelectedIndexChanged(object sender, System.EventArgs e)
        {
            if (!fwc_init || current_model != Model.FLEX5000 || comboRX2AGC.SelectedIndex < 0) return;
            radio.GetDSPRX(1, 0).RXAGCMode = (AGCMode)comboRX2AGC.SelectedIndex;

            switch ((AGCMode)comboRX2AGC.SelectedIndex)
            {
                case AGCMode.LONG:
                    toolTip1.SetToolTip(comboRX2AGC, "Automatic Gain Control Mode Setting:\n" +
                        "Long (Attack 2ms, Hang 750ms, Decay 200ms)");
                    //comboRX2AGC.BackColor = SystemColors.Window;
                    break;
                case AGCMode.SLOW:
                    toolTip1.SetToolTip(comboRX2AGC, "Automatic Gain Control Mode Setting:\n" +
                        "Slow (Attack 2ms, Hang 500ms, Decay 500ms)");
                    //comboRX2AGC.BackColor = SystemColors.Window;
                    break;
                case AGCMode.MED:
                    toolTip1.SetToolTip(comboRX2AGC, "Automatic Gain Control Mode Setting:\n" +
                        "Medium (Attack 2ms, Hang 250ms, Decay 250ms)");
                    //comboRX2AGC.BackColor = SystemColors.Window;
                    break;
                case AGCMode.FAST:
                    toolTip1.SetToolTip(comboRX2AGC, "Automatic Gain Control Mode Setting:\n" +
                        "Fast (Attack 2ms, Hang 100ms, Decay 100ms)");
                    //comboRX2AGC.BackColor = SystemColors.Window;
                    break;
                /*case AGCMode.CUSTOM:
                    toolTip1.SetToolTip(comboAGC, "Automatic Gain Control Mode Setting:\n"+
                        "Custom - Set specifics in Setup Form -> DSP -> AGC/ALC");
                    comboRX2AGC.BackColor = SystemColors.Window;
                    break;*/
                case AGCMode.FIXD:
                    SetupForm.CustomRXAGCEnabled = false;
                    toolTip1.SetToolTip(comboAGC, "Automatic Gain Control Mode Setting:\n" +
                        "Fixed - Set gain with AGC-T control above");
                    //comboRX2AGC.BackColor = Color.Orange;
                    break;
            }

            // set RF control to Max or Fixed gain depending on mode
            switch ((AGCMode)comboRX2AGC.SelectedIndex)
            {
                case AGCMode.FIXD:
                    ptbRX2RF.Value = rx2_fixed_gain;
                    ptbRX2RF_Scroll(this, EventArgs.Empty);
                    break;
                default:
                    ptbRX2RF.Value = rx2_max_gain;
                    ptbRX2RF_Scroll(this, EventArgs.Empty);
                    break;
            }
        }

        private void chkVFOSync_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkVFOSync.Checked)
            {
                chkVFOSync.BackColor = button_selected_color;
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
            }
            else
            {
                chkVFOSync.BackColor = SystemColors.Control;
            }
        }

        private bool mute_rx1_on_vfob_tx = true;
        public bool MuteRX1OnVFOBTX
        {
            get { return mute_rx1_on_vfob_tx; }
            set { mute_rx1_on_vfob_tx = value; }
        }

        public int DSPBufDigTX
        {
            get { return dsp_buf_dig_tx; }
            set
            {
                dsp_buf_dig_tx = value;
                UpdateDSPBufTX();
            }
        }

        private void chkVFOATX_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkVFOATX.Focused && !chkVFOATX.Checked) chkVFOATX.Checked = true;
            if (chkVFOATX.Checked)
            {
                if (chkVFOBTX.Checked) chkVFOBTX.Checked = false;
                swap_vfo_ab_tx = false;
                if (KWAutoInformation)
                    BroadcastVFOChange("0");
                chkVFOATX.BackColor = button_selected_color;
                txtVFOAFreq_LostFocus(this, EventArgs.Empty);
                txtVFOBFreq_LostFocus(this, EventArgs.Empty);
            }
            else
            {
                chkVFOATX.BackColor = SystemColors.Control;
            }
            btnHidden.Focus();
        }

        private void BroadcastVFOChange(string ndx)
        {
            string cmd = "ZZSW" + ndx + ";";
            try
            {
                siolisten.SIO.put(cmd);
            }
            catch { }
        }

        private void chkVFOBTX_CheckedChanged(object sender, System.EventArgs e)
        {
            if (chkVFOBTX.Focused && !chkVFOBTX.Checked) chkVFOBTX.Checked = true;
            if (chkVFOBTX.Checked)
            {
                if (chkVFOATX.Checked) chkVFOATX.Checked = false;
                chkVFOBTX.BackColor = button_selected_color;
                swap_vfo_ab_tx = true;
                if (KWAutoInformation)
                    BroadcastVFOChange("1");
                txtVFOBFreq_LostFocus(this, EventArgs.Empty);
                if (fwc_init && current_model == Model.FLEX5000 && FWCEEPROM.RX2OK && chkRX2.Checked)
                {
                    if (mute_rx1_on_vfob_tx)
                    {
                        radio.GetDSPRX(0, 0).RXOutputGain = 0.0;
                        radio.GetDSPRX(0, 1).RXOutputGain = 0.0;
                    }
                    Audio.TXDSPMode = rx2_dsp_mode;
                    radio.GetDSPTX(0).CurrentDSPMode = rx2_dsp_mode;
                    if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                        FWC.SetTXDSPMode(rx2_dsp_mode);
                    SetRX2Mode(rx2_dsp_mode);
                    Display.TXOnVFOB = true;
                    if (chkVFOSplit.Checked)
                        chkVFOSplit.Checked = false;
                }

                if (chkRX2.Checked == false)
                    chkVFOSplit.Checked = true;
            }
            else
            {
                chkVFOBTX.BackColor = SystemColors.Control;
                if (fwc_init && current_model == Model.FLEX5000 && FWCEEPROM.RX2OK && chkRX2.Checked)
                {
                    if (mute_rx1_on_vfob_tx)
                    {
                        ptbRX0Gain_Scroll(this, EventArgs.Empty);
                        ptbRX1Gain_Scroll(this, EventArgs.Empty);
                    }
                    Display.TXOnVFOB = false;
                }

                if (chkRX2.Checked == false)
                    chkVFOSplit.Checked = false;
                Audio.TXDSPMode = rx1_dsp_mode;
                radio.GetDSPTX(0).CurrentDSPMode = rx1_dsp_mode;
                if (fwc_init && (current_model == Model.FLEX5000 || current_model == Model.FLEX3000))
                    FWC.SetTXDSPMode(rx2_dsp_mode);
                SetRX1Mode(rx1_dsp_mode);
            }
            btnHidden.Focus();
        }

        private void toolStripMenuItemRX1FilterConfigure_Click(object sender, EventArgs e)
        {
            if (rx1_dsp_mode == DSPMode.DRM || rx1_dsp_mode == DSPMode.SPEC) return;

            if (filterRX1Form == null || filterRX1Form.IsDisposed)
                filterRX1Form = new FilterForm(this, rx1_filters, false);

            filterRX1Form.DSPMode = rx1_dsp_mode;
            filterRX1Form.CurrentFilter = rx1_filter;
            filterRX1Form.Show();
            filterRX1Form.Focus();
        }

        private void toolStripMenuItemRX1FilterReset_Click(object sender, EventArgs e)
        {
            DialogResult dr = MessageBox.Show(
                "Are you sure you want to reset all RX1 custom filter settings to the default?",
                "Reset Filters?",
                MessageBoxButtons.YesNo,
                MessageBoxIcon.Question);

            if (dr == DialogResult.No) return;

            InitFilterPresets(rx1_filters);

            radFilter1.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F1);
            radFilter2.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F2);
            radFilter3.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F3);
            radFilter4.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F4);
            radFilter5.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F5);
            radFilter6.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F6);
            radFilter7.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F7);
            radFilter8.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F8);
            radFilter9.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F9);
            radFilter10.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.F10);
            radFilterVar1.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.VAR1);
            radFilterVar2.Text = rx1_filters[(int)rx1_dsp_mode].GetName(Filter.VAR2);
            RX1Filter = rx1_filter;

            if (filterRX1Form != null && !filterRX1Form.IsDisposed)
            {
                filterRX1Form.DSPMode = rx1_dsp_mode;
            }
        }

        private void toolStripMenuItemRX2FilterConfigure_Click(object sender, EventArgs e)
        {
            if (rx2_dsp_mode == DSPMode.DRM || rx2_dsp_mode == DSPMode.SPEC) return;

            if (filterRX2Form == null || filterRX2Form.IsDisposed)
                filterRX2Form = new FilterForm(this, rx2_filters, true);

            filterRX2Form.DSPMode = rx2_dsp_mode;
            filterRX2Form.CurrentFilter = rx2_filter;
            filterRX2Form.Show();
            filterRX2Form.Focus();
        }

        private Notch Context_Notch;
        private void toolStripNotchDelete_Click(Object sender, EventArgs e)
        {
            NotchList.RemoveNotch(Context_Notch);
            contextMenuStripNotch.Close();
            UpdateRX1Notches();
            UpdateRX1SubNotches();
            UpdateRX2Notches();
        }

        private void toolStripNotchRemember_Click(object sender, EventArgs e)
        {
            Context_Notch.Permanent = !toolStripNotchRemember.Checked;
            toolStripNotchRemember.Checked = !toolStripNotchRemember.Checked;
            contextMenuStripNotch.Close();
        }

        private void toolStripNotchNormal_Click(object sender, EventArgs e)
        {
            Context_Notch.Depth = 1;
            toolStripNotchNormal.Checked = true;
            toolStripNotchDeep.Checked = false;
            toolStripNotchVeryDeep.Checked = false;
            contextMenuStripNotch.Close();
            UpdateRX1Notches();
            UpdateRX1SubNotches();
            UpdateRX2Notches();
        }

        private void toolStripNotchDeep_Click(object sender, EventArgs e)
        {
            Context_Notch.Depth = 2;
            toolStripNotchNormal.Checked = false;
            toolStripNotchDeep.Checked = true;
            toolStripNotchVeryDeep.Checked = false;
            contextMenuStripNotch.Close();
            UpdateRX1Notches();
            UpdateRX1SubNotches();
            UpdateRX2Notches();
        }

        private void toolStripNotchVeryDeep_Click(object sender, EventArgs e)
        {
            Context_Notch.Depth = 3;
            toolStripNotchNormal.Checked = false;
            toolStripNotchDeep.Checked = false;
            toolStripNotchVeryDeep.Checked = true;
            contextMenuStripNotch.Close();
            UpdateRX1Notches();
            UpdateRX1SubNotches();
            UpdateRX2Notches();
        }

        private void toolStripMenuItemRX2FilterReset_Click(object sender, EventArgs e)
        {
            DialogResult dr = MessageBox.Show(
                "Are you sure you want to reset all RX2 custom filter settings to the default?",
                "Reset Filters?",
                MessageBoxButtons.YesNo,
                MessageBoxIcon.Question);

            if (dr == DialogResult.No) return;

            InitFilterPresets(rx2_filters);

            radRX2Filter1.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F1);
            radRX2Filter2.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F2);
            radRX2Filter3.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F3);
            radRX2Filter4.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F4);
            radRX2Filter5.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F5);
            radRX2Filter6.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F6);
            radRX2Filter7.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.F7);
            radRX2FilterVar1.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.VAR1);
            radRX2FilterVar2.Text = rx2_filters[(int)rx2_dsp_mode].GetName(Filter.VAR2);
            RX2Filter = rx2_filter;

            if (filterRX2Form != null && !filterRX2Form.IsDisposed)
            {
                filterRX2Form.DSPMode = rx2_dsp_mode;
            }
        }

        private static bool TDxButtonState = false;
        private static bool TDxCurrentVFO = false; //VFOA

        private void timer_navigate_Tick(object sender, System.EventArgs e)
        {
            /*  if (TDxSensor == null)
                  return;
              TDxInput.Vector3D t = TDxSensor.Translation;
              TDxInput.AngleAxis r = TDxSensor.Rotation;
              TDxDevice.Keyboard.IsKeyDown(1);
              double del;
              int val;

              if (TDxDevice.Keyboard.IsKeyDown(1)) //Button 1 assignment
              {
                  TDxButtonState = true;
              }
              else if (TDxButtonState)
              {
                  TDxButtonState = false;
                  //click
                  TDxCurrentVFO = !TDxCurrentVFO;
              } 

              if (spacenav_controlvfos)
              {
                  del = Math.Exp(r.Angle / 10.0) - 1.0;
                  if (del >= 0.1)
                  {
                      del *= -Math.Sign(r.Y) / 1000000.0;
  #if false
                      if(current_click_tune_mode == ClickTuneMode.VFOB && scroll_vfob_on_split)
                          VFOBFreq += del;
                      else 
  #endif
                      if (TDxCurrentVFO)
                          VFOBFreq += del;
                      else
                          VFOAFreq += del;
                  }
              }
              if (spacenav_flypanadapter)
              {
                  if (Math.Abs(t.Z) > 1.0)
                  {
                      val = ptbDisplayZoom.Value;
                      val += Convert.ToInt32(t.Z);
                      val = Math.Min(ptbDisplayZoom.Maximum, val);
                      val = Math.Max(ptbDisplayZoom.Minimum, val);
                      ptbDisplayZoom.Value = val;
                      ptbDisplayZoom_Scroll(this, EventArgs.Empty);
                      //btnDisplayPanCenter_Click(this, EventArgs.Empty);
                  }
                  if (Math.Abs(t.X) > 1.0)
                  {
                      val = ptbDisplayPan.Value;
                      val += Convert.ToInt32(t.X);
                      val = Math.Min(ptbDisplayPan.Maximum, val);
                      val = Math.Max(ptbDisplayPan.Minimum, val);
                      ptbDisplayPan.Value = val;
                      CalcDisplayFreq();
                      //if(ptbDisplayPan.Focused) btnHidden.Focus();
                  }
                  if (Math.Abs(t.Y) > 1.0)
                  {
                      val = ptbFilterWidth.Value;
                      val += Convert.ToInt32(t.Y);
                      val = Math.Min(ptbFilterWidth.Maximum, val);
                      val = Math.Max(ptbFilterWidth.Minimum, val);
                      ptbFilterWidth.Value = val;
                      ptbFilterWidth_Scroll(this.ptbFilterWidth, EventArgs.Empty);
                  }
              }*/
        }

        public void PressKeyboardButton(Keys keyCode)
        {
            const int KEYEVENTF_EXTENDEDKEY = 0x1;
            const int KEYEVENTF_KEYUP = 0x2;

            Win32.keybd_event((byte)keyCode, 0x45, KEYEVENTF_EXTENDEDKEY, 0);
            Win32.keybd_event((byte)keyCode, 0x45, KEYEVENTF_EXTENDEDKEY | KEYEVENTF_KEYUP, 0);
        }

        private HiPerfTimer t9 = new HiPerfTimer();

        /*private void buttonTS1_Click(object sender, EventArgs e)
        {
            ptbRF.Value = 0;
            ptbRF_Scroll(this, EventArgs.Empty);
            Application.DoEvents();
            Thread.Sleep(1000);

            ptbRF.Value = 120;
            ptbRF_Scroll(this, EventArgs.Empty);
        }*/

        public string getVersion()
        {
            Assembly assembly = Assembly.GetExecutingAssembly();
            FileVersionInfo fvi = FileVersionInfo.GetVersionInfo(assembly.Location);
            string version = fvi.FileVersion; //.Substring(0, fvi.FileVersion.LastIndexOf("."));
            return version;
        }

        /*    public abstract class Keyboard
            {
                [Flags]
                private enum KeyStates
                {
                    None = 0,
                    Down = 1,
                    Toggled = 2
                }

                [DllImport("user32.dll", CharSet = CharSet.Auto, ExactSpelling = true)]
                private static extern short GetKeyState(int keyCode);

                private static KeyStates GetKeyState(Keys key)
                {
                    KeyStates state = KeyStates.None;

                    short retVal = GetKeyState((int)key);

                    //If the high-order bit is 1, the key is down
                    //otherwise, it is up.
                    if ((retVal & 0x8000) == 0x8000)
                        state |= KeyStates.Down;

                    //If the low-order bit is 1, the key is toggled.
                    if ((retVal & 1) == 1)
                        state |= KeyStates.Toggled;

                    return state;
                }

                public static bool IsKeyDown(Keys key)
                {
                    return KeyStates.Down == (GetKeyState(key) & KeyStates.Down);
                }

                public static bool IsKeyToggled(Keys key)
                {
                    return KeyStates.Toggled == (GetKeyState(key) & KeyStates.Toggled);
                }
            } */

        private void chkTNF_CheckedChanged(object sender, EventArgs e)
        {
            UpdateRX1Notches();
            UpdateRX1SubNotches();
            UpdateRX2Notches();
            Display.TNFActive = chkTNF.Checked;
        }

        private int default_notch_width = 100;
        private void btnTNFAdd_Click(object sender, EventArgs e)
        {
            // calculate the mid-point for the filter
            int low = radio.GetDSPRX(0, 0).RXFilterLow;
            int high = radio.GetDSPRX(0, 0).RXFilterHigh;
            int midpoint = (low + high) / 2;

            if (midpoint < -9999 || midpoint > 9999)
                throw new Exception("TNF: The filter limits [" + low + "," + high + "] do not make sense");

            double vfo = VFOAFreq;
            if (chkRIT.Checked) vfo += (double)udRIT.Value * 1e-6; // check for RIT

            double rf_freq = vfo + midpoint * 1e-6;

            // if there's already another notch within 100Hz, then quit now
            if (NotchList.NotchNearFreq(rf_freq, 100))
                return;

            // if there's already 3+ filters within the RF window, quit now
            if (NotchList.NotchesInBW(VFOAFreq, low, high).Count >= 3)
                return;

            NotchList.List.Add(new Notch(rf_freq, default_notch_width));

            UpdateRX1Notches();
        }

        private void addNotch(int thread, int subrx, uint count, double freq, double bw)
        {
            if (count < 9)
            {
                radio.GetDSPRX(thread, subrx).SetNotchFreq(count, freq);
                radio.GetDSPRX(thread, subrx).SetNotchBW(count, bw);
                radio.GetDSPRX(thread, subrx).SetNotchOn(count, true);
            }
        }

        private void UpdateRX1Notches()
        {
            if (!chkTNF.Checked)
            {
                for (uint i = 0; i < 9; i++)
                    radio.GetDSPRX(0, 0).SetNotchOn(i, false);
                return;
            }

            double vfo = VFOAFreq;
            if (chkRIT.Checked) vfo += (double)udRIT.Value * 1e-6;

            switch (rx1_dsp_mode)
            {
                case (DSPMode.CWL):
                    vfo += cw_pitch * 1e-6;
                    break;
                case (DSPMode.CWU):
                    vfo -= cw_pitch * 1e-6;
                    break;
            }

            int low = radio.GetDSPRX(0, 0).RXFilterLow - 200;
            int high = radio.GetDSPRX(0, 0).RXFilterHigh + 200;

            List<Notch> l = NotchList.NotchesInBW(vfo, low, high);
            if (l.Count == 0)
            {
                for (uint i = 0; i < 9; i++)
                    radio.GetDSPRX(0, 0).SetNotchOn(i, false);
                return;
            }

            l.Sort();
            uint count = 0;

            // enable up to 9 notches
            foreach (Notch n in l)
            {
                // translate RF to audio frequency
                double audio_freq = Math.Abs((n.Freq - vfo)) * 1e6; // now in Hz

                for (int x = 0; x < n.Depth; x++)
                {
                    if (audio_freq > 0)
                        addNotch(0, 0, count++, audio_freq, n.BW);
                }

                if (count >= 9) // don't enable more than 9 notches!
                    break;
            }

            // turn off unused notches
            if (count < 9)
            {
                for (uint i = count; i < 9; i++)
                    radio.GetDSPRX(0, 0).SetNotchOn(i, false);
            }

            if (!chkPower.Checked)
                Display.DrawBackground();
        }

        private void UpdateRX1SubNotches()
        {
            if (!chkTNF.Checked || !chkEnableMultiRX.Checked)
            {
                for (uint i = 0; i < 9; i++)
                    radio.GetDSPRX(0, 1).SetNotchOn(i, false);
                return;
            }

            double vfo = VFOBFreq;
            if (rx2_enabled) vfo = VFOASubFreq;
            if (chkRIT.Checked) vfo += (double)udRIT.Value * 1e-6;

            switch (rx1_dsp_mode)
            {
                case (DSPMode.CWL):
                    vfo += cw_pitch * 1e-6;
                    break;
                case (DSPMode.CWU):
                    vfo -= cw_pitch * 1e-6;
                    break;
            }

            int low = radio.GetDSPRX(0, 1).RXFilterLow;
            int high = radio.GetDSPRX(0, 1).RXFilterHigh;

            List<Notch> l = NotchList.NotchesInBW(vfo, low, high);
            if (l.Count == 0)
            {
                for (uint i = 0; i < 9; i++)
                    radio.GetDSPRX(0, 1).SetNotchOn(i, false);
                return;
            }

            l.Sort();
            uint count = 0;

            // enable up to 3 notches
            foreach (Notch n in l)
            {
                // translate RF to audio frequency
                double audio_freq = (n.Freq - vfo) * 1e6; // now in Hz

                for (int x = 0; x < n.Depth; x++)
                {
                    if (audio_freq > 0)
                        addNotch(0, 1, count++, audio_freq, n.BW);
                }
                if (count >= 9) // don't enable more than 9 notches!
                    break;
            }

            // turn off unused notches
            if (count < 9)
            {
                for (uint i = count; i < 9; i++)
                    radio.GetDSPRX(0, 1).SetNotchOn(i, false);
            }

            if (!chkPower.Checked)
                Display.DrawBackground();
        }

        private void UpdateRX2Notches()
        {
            if (!chkTNF.Checked || !rx2_enabled)
            {
                for (uint i = 0; i < 9; i++)
                    radio.GetDSPRX(1, 0).SetNotchOn(i, false);
                return;
            }

            double vfo = VFOBFreq;
            if (chkRIT.Checked) vfo += (double)udRIT.Value * 1e-6;

            int low = radio.GetDSPRX(1, 0).RXFilterLow;
            int high = radio.GetDSPRX(1, 0).RXFilterHigh;

            List<Notch> l = NotchList.NotchesInBW(vfo, low, high);
            if (l.Count == 0)
            {
                for (uint i = 0; i < 9; i++)
                    radio.GetDSPRX(1, 0).SetNotchOn(i, false);
                return;
            }

            l.Sort();
            uint count = 0;

            // enable up to 9 notches
            foreach (Notch n in l)
            {
                // translate RF to audio frequency
                double audio_freq = (n.Freq - vfo) * 1e6; // now in Hz

                for (int x = 0; x < n.Depth; x++)
                    addNotch(1, 0, count++, audio_freq, n.BW);
                if (count >= 9) // don't enable more than 9 notches!
                    break;

            }

            // turn off unused notches
            if (count < 9)
            {
                for (uint i = count; i < 9; i++)
                    radio.GetDSPRX(1, 0).SetNotchOn(i, false);
            }

            if (!chkPower.Checked)
                Display.DrawBackground();
        }

        private void ptbFMMic_Scroll(object sender, EventArgs e)
        {
            ptbFMMic.Minimum = mic_gain_min;
            ptbFMMic.Maximum = mic_gain_max;
            lblMicValFM.Text = ptbFMMic.Value.ToString();
            if (radio.GetDSPTX(0).CurrentDSPMode == DSPMode.FM)
            {
                double gain_db = (double)ptbFMMic.Value;

                if (mic_boost)
                {
                    toolTip1.SetToolTip(ptbFMMic, (ptbFMMic.Value + 20).ToString());
                }
                else if (line_in)
                {
                    toolTip1.SetToolTip(ptbFMMic, (ptbFMMic.Value + line_in_boost).ToString());
                }
                else
                {
                    toolTip1.SetToolTip(ptbFMMic, "");
                }
                Audio.MicPreamp = Math.Pow(10.0, gain_db / 20.0); // convert to scalar
            }
            if (ptbFMMic.Focused) btnHidden.Focus();
        }

        private void chkFMVAC_CheckedChanged(object sender, EventArgs e)
        {
            if (SetupForm != null) SetupForm.VACEnable = chkFMVAC.Checked;

            if (chkFMVAC.Checked) chkFMVAC.BackColor = button_selected_color;
            else chkFMVAC.BackColor = SystemColors.Control;
        }

        private void chkFMCTCSS_CheckedChanged(object sender, EventArgs e)
        {
            CTCSSOn = chkFMCTCSS.Checked;
        }

        private void comboFMCTCSS_SelectedIndexChanged(object sender, EventArgs e)
        {
            CTCSSFreq = double.Parse(comboFMCTCSS.Text);
        }

        private void InitCTCSS()
        {
            comboFMCTCSS.Items.Clear();
            foreach (double d in CTCSS_array)
                comboFMCTCSS.Items.Add(d.ToString("f1"));
        }

        private void InitMemoryFrontPanel()
        {
            comboFMMemory.DataSource = MemoryList.List;
            comboFMMemory.DisplayMember = "Name";
            comboFMMemory.ValueMember = "Name";
        }

        private void panelModeSpecificFM_Paint(object sender, PaintEventArgs e)
        {

        }

        private void radFMDeviation2kHz_CheckedChanged(object sender, EventArgs e)
        {
            if (radFMDeviation2kHz.Checked)
            {
                radio.GetDSPTX(0).TXFMDeviation = 2500;
                radio.GetDSPRX(0, 0).RXFMDeviation = 2500;
                if (RX1DSPMode == DSPMode.FM)
                {
                    UpdateRX1Filters(-4000, 4000);
                    UpdateDisplay();
                }
                if (RX2DSPMode == DSPMode.FM)
                {
                    UpdateRX2Filters(-4000, 4000);
                    UpdateDisplay();
                }
                if (radio.GetDSPTX(0).CurrentDSPMode == DSPMode.FM)
                {
                    SetTXFilters(DSPMode.FM, -4000, 4000);
                }
            }
        }

        private void radFMDeviation5kHz_CheckedChanged(object sender, EventArgs e)
        {
            if (radFMDeviation5kHz.Checked)
            {
                radio.GetDSPTX(0).TXFMDeviation = 5000;
                radio.GetDSPRX(0, 0).RXFMDeviation = 5000;
                if (RX1DSPMode == DSPMode.FM)
                {
                    UpdateRX1Filters(-8000, 8000);
                    UpdateDisplay();
                }
                if (RX2DSPMode == DSPMode.FM)
                {
                    UpdateRX2Filters(-8000, 8000);
                    UpdateDisplay();
                }
                if (radio.GetDSPTX(0).CurrentDSPMode == DSPMode.FM)
                {
                    SetTXFilters(DSPMode.FM, -8000, 8000);
                }
            }
        }

        private void udFMOffset_ValueChanged(object sender, EventArgs e)
        {
            fm_tx_offset_mhz = (double)udFMOffset.Value;
        }

        private void chkFMTXHigh_CheckedChanged(object sender, EventArgs e)
        {
            if (chkFMTXHigh.Checked)
            {
                chkFMTXSimplex.Checked = false;
                chkFMTXLow.Checked = false;

                chkFMTXRev.Enabled = true;
                chkFMTXRev.Checked = false;

                CurrentFMTXMode = FMTXMode.High;
            }
        }

        private void chkFMTXSimplex_CheckedChanged(object sender, EventArgs e)
        {
            if (chkFMTXSimplex.Checked)
            {
                chkFMTXHigh.Checked = false;
                chkFMTXLow.Checked = false;

                chkFMTXRev.Enabled = false;
                chkFMTXRev.Checked = false;

                CurrentFMTXMode = FMTXMode.Simplex;
            }
        }

        private void chkFMTXLow_CheckedChanged(object sender, EventArgs e)
        {
            if (chkFMTXLow.Checked)
            {
                chkFMTXSimplex.Checked = false;
                chkFMTXHigh.Checked = false;

                chkFMTXRev.Enabled = true;
                chkFMTXRev.Checked = false;

                CurrentFMTXMode = FMTXMode.Low;
            }
        }

        private void chkFMTXRev_CheckedChanged(object sender, EventArgs e)
        {
            if (chkFMTXRev.Checked)
            {
                switch (current_fm_tx_mode)
                {
                    case FMTXMode.Low:
                        VFOAFreq -= (fm_tx_offset_mhz);
                        break;
                    case FMTXMode.High:
                        VFOAFreq += (fm_tx_offset_mhz);
                        break;
                }
            }
            else
            {
                switch (current_fm_tx_mode)
                {
                    case FMTXMode.Low:
                        VFOAFreq += (fm_tx_offset_mhz);
                        break;
                    case FMTXMode.High:
                        VFOAFreq -= (fm_tx_offset_mhz);
                        break;
                }
            }
        }

        private void chkFMMode_Click(object sender, EventArgs e)
        {
            switch (current_fm_tx_mode)
            {
                case FMTXMode.High:
                    chkFMTXHigh.Checked = true;
                    break;

                case FMTXMode.Simplex:
                    chkFMTXSimplex.Checked = true;
                    break;

                case FMTXMode.Low:
                    chkFMTXLow.Checked = true;
                    break;
            }
        }

        private bool ctcss_on = false;
        public bool CTCSSOn
        {
            get { return ctcss_on; }
            set
            {
                ctcss_on = value;
                if (chkFMCTCSS.Checked != value)
                    chkFMCTCSS.Checked = value;

                radio.GetDSPTX(0).CTCSSFlag = chkFMCTCSS.Checked;
            }
        }

        private double ctcss_freq = 100.0;
        public double CTCSSFreq
        {
            get { return ctcss_freq; }
            set
            {
                ctcss_freq = value;
                if (comboFMCTCSS.Text != ctcss_freq.ToString("f1"))
                {
                    comboFMCTCSS.Text = ctcss_freq.ToString("f1");
                    comboFMCTCSS_SelectedIndexChanged(this, EventArgs.Empty);
                }

                radio.GetDSPTX(0).CTCSSFreqHz = value;
            }
        }

        private void mnuMemory_Click(object sender, EventArgs e)
        {
            if (memoryForm == null || memoryForm.IsDisposed)
                memoryForm = new MemoryForm(this);
            memoryForm.Show();
            memoryForm.Focus();
        }

        public void RecallMemory(MemoryRecord record)
        {
            VFOAFreq = record.RXFreq;
            RX1DSPMode = record.DSPMode;
            VFOAFreq = record.RXFreq;
            TuneStepIndex = TuneStepLookup(record.TuneStep);

            if (record.DSPMode == DSPMode.FM)
            {
                CurrentFMTXMode = record.RPTR;
                FMTXOffsetMHz = record.RPTROffset;
                CTCSSOn = record.CTCSSOn;
                CTCSSFreq = record.CTCSSFreq;
                FMDeviation_Hz = record.Deviation;
            }
            else
            {
                TXFreq = record.TXFreq;
                RX1Filter = record.RXFilter;
                if (record.RXFilter == Filter.VAR1 || record.RXFilter == Filter.VAR2)
                    UpdateRX1Filters(record.RXFilterLow, record.RXFilterHigh);
            }

            PWR = record.Power;
            VFOSplit = record.Split;
            RX1AGCMode = record.AGCMode;
            RF = record.AGCT;
        }

        private void comboFMMemory_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (comboFMMemory.Items.Count == 0 || comboFMMemory.SelectedItem == null) return;
            MemoryRecord recordToRestore = new MemoryRecord((MemoryRecord)comboFMMemory.SelectedItem);
            if (!initializing)
                RecallMemory(recordToRestore);
        }

        private void btnFMMemoryUp_Click(object sender, EventArgs e)
        {
            if (comboFMMemory.Items.Count == 0 || comboFMMemory.SelectedItem == null) return;
            comboFMMemory.SelectedIndex = (comboFMMemory.SelectedIndex + 1) % comboFMMemory.Items.Count;
        }

        private void btnFMMemoryDown_Click(object sender, EventArgs e)
        {
            if (comboFMMemory.Items.Count == 0 || comboFMMemory.SelectedItem == null) return;
            comboFMMemory.SelectedIndex = (comboFMMemory.SelectedIndex - 1 + comboFMMemory.Items.Count) % comboFMMemory.Items.Count;
        }

        public void changeComboFMMemory(int index)
        {
            if (comboFMMemory.Items.Count == 0) return;
            if (index < 0 || index > comboFMMemory.Items.Count - 1) return;

            if (comboFMMemory.SelectedIndex != index)
            {
                comboFMMemory.SelectedIndex = index;
            }
            else // memory is already set in combobox, recall it
            {
                MemoryRecord recordToRestore = new MemoryRecord((MemoryRecord)comboFMMemory.SelectedItem);
                RecallMemory(recordToRestore);
            }
        }

        private void btnFMMemory_Click(object sender, EventArgs e)
        {
            if (memoryForm == null || memoryForm.IsDisposed)
                memoryForm = new MemoryForm(this);
            memoryForm.Show();
            memoryForm.Focus();
        }

        private void timerNotchZoom_Tick(object sender, EventArgs e)
        {
            const int TOL = 10;

            timerNotchZoom.Enabled = false;
            if (notch_drag_max_delta_x < TOL &&
                notch_drag_max_delta_y < TOL)
            {
                Display.TNFZoom = true;
                notch_zoom = true;
                Display.NotchZoomStartFreq = notch_drag_start.Freq;
            }
        }

        private void setupToolStripMenuItem_Click(object sender, EventArgs e)
        {
            if (SetupForm == null || SetupForm.IsDisposed)
                SetupForm = new Setup(this);
            SetupForm.Show();
            SetupForm.Focus();
        }

        private void memoryToolStripMenuItem_Click(object sender, EventArgs e)
        {
            if (memoryForm == null || memoryForm.IsDisposed)
                memoryForm = new MemoryForm(this);
            memoryForm.Show();
            memoryForm.Focus();
        }

        private void waveToolStripMenuItem_Click(object sender, EventArgs e)
        {
            if (WaveForm.IsDisposed)
                WaveForm = new WaveControl(this);
            WaveForm.Show();
            WaveForm.Focus();
        }

        private void CollapseToolStripMenuItem_Click(object sender, EventArgs e)
        {
            if (this.collapsedDisplay)
            {
                this.ExpandDisplay();
                isexpanded = true;
                iscollapsed = false;
            }
            else
            {
                this.CollapseDisplay();
                iscollapsed = true;
                isexpanded = false;
            }
        }

        private void equalizerToolStripMenuItem_Click(object sender, EventArgs e)
        {
            if (EQForm == null || EQForm.IsDisposed)
                EQForm = new EQForm(this);
            EQForm.Show();
            EQForm.Focus();
        }

        private void xVTRsToolStripMenuItem_Click(object sender, EventArgs e)
        {
            if (XVTRForm == null || XVTRForm.IsDisposed)
                XVTRForm = new XVTRForm(this);

            XVTRForm.Show();
            XVTRForm.Focus();
        }

        private void cWXToolStripMenuItem_Click(object sender, EventArgs e)
        {
            if (rx1_dsp_mode == DSPMode.LSB)
                RX1DSPMode = DSPMode.CWL;
            else if (rx1_dsp_mode == DSPMode.USB)
                RX1DSPMode = DSPMode.CWU;

            if (rx1_dsp_mode != DSPMode.CWL &&
                rx1_dsp_mode != DSPMode.CWU)
            {
                MessageBox.Show("The radio must be in CWL or CWU mode in order to open the " +
                    "CWX Control Form.",
                    "CWX Error: Wrong Mode",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                return;
            }

            //	cw_key_mode = true;
            if (CWXForm == null || CWXForm.IsDisposed)
            {
                CWXForm = new CWX(this);
            }

            CWXForm.Show();
            CWXForm.Focus();
        }

        public void DisableSR()
        {
            chkSR.Visible = false;
            chkSR.Checked = false;
            chkSR.Enabled = false;
        }

        public void EnableSR()
        {
            chkSR.Visible = true;
            chkSR.Enabled = true;
            chkSR.Checked = true;
        }

        private String[] on_off_preamp_settings = { "0dB", "-20dB" };
        //private String[] alex_preamp_settings = { "0db", "-20db", "-10dB", "-20dB", "-30dB", "-40dB", "-50dB" };
        private String[] alex_preamp_settings = { "-10db", "-20db", "-30db", "-40db", "-50db" };

        public void SetComboPreampForHPSDR()
        {
            if (comboPreamp == null)
            {
                System.Console.WriteLine("preamp is null!!");
                return;
            }
            comboPreamp.Items.Clear();
            //if (!alexpresent)
            // {
            comboPreamp.Items.AddRange(on_off_preamp_settings);
            // }
            if (alexpresent)
            {
                comboPreamp.Items.AddRange(alex_preamp_settings);
            }
        }

        public void si570_resolve(double fo, ref double rfreq, ref ulong hs_div, ref ulong n1) // modif F8CHK
        {
            double fdco = 0.0;

            hs_div = 12;
            n1 = 0;

            do
            {
                hs_div--;
                if ((hs_div == 10) || (hs_div == 8)) hs_div--;

                n1 = 1;
                fdco = (double)n1 * (double)hs_div * fo;
                if ((fdco >= 4850e6 && fdco <= 5670e6)) break;

                n1 = 0;
                do
                {
                    n1 += 2;
                    fdco = (double)n1 * (double)hs_div * fo;
                } while (!(fdco >= 4850e6 && fdco <= 5670e6) && (n1 < 128));

            } while (!(fdco >= 4850e6 && fdco <= 5670e6));

            rfreq = fdco / SI570FXtal;
        }


        public void si570_large_change(double rfreq, ulong hs_div, ulong n1) // modif F8CHK 
        {
            ulong rfreq_int = (ulong)rfreq;
            ulong rfreq_frac = (ulong)((rfreq - (double)rfreq_int) * (double)268435456);
            ulong rfreq_word = (rfreq_int << 28) | rfreq_frac;

            hs_div = hs_div - 4;
            n1 = n1 - 1;

            byte[] freeze_dco = { 137, 0x10 };
            // JanusAudio.Write_I2C(hdev, 0x55, freeze_dco, freeze_dco.Length);  //0x55 is the I2C address of SI570

            byte[] config = {
							 7,												
							 (byte) ((byte)((hs_div<<5) & 0xe0) | (byte)((n1>>2) & 0x1f)),
							 (byte) ((byte)((rfreq_word>>(4*8)) & 0x3f) | (byte)((n1<<6) & 0xc0)),
							 (byte) ((rfreq_word>>(3*8)) & 0xff),
							 (byte) ((rfreq_word>>(2*8)) & 0xff),
							 (byte) ((rfreq_word>>(1*8)) & 0xff),
							 (byte) ((rfreq_word>>(0*8)) & 0xff)
							 };
            //JanusAudio.Write_I2C(hdev, 0x55, config);

            byte[] unfreeze_dco = { 137, 0x00 };
            // JanusAudio.Write_I2C(hdev, 0x55, unfreeze_dco);

            byte[] newfreq = { 135, 0x40 };
            // JanusAudio.Write_I2C(hdev, 0x55, newfreq);
        }

        public void si570_small_change(double fo, ulong hs_div, ulong n1)  // modif F8CHK
        {
            double fdco = 0.0;
            double rfreq;

            fdco = fo * (double)hs_div * (double)n1;
            rfreq = fdco / SI570FXtal;

            ulong rfreq_int = (ulong)rfreq;
            ulong rfreq_frac = (ulong)((rfreq - (double)rfreq_int) * (double)268435456);
            ulong rfreq_word = (rfreq_int << 28) | rfreq_frac;

            hs_div = hs_div - 4;
            n1 = n1 - 1;

            byte[] config = {
								7,												
								(byte) ((byte)((hs_div<<5) & 0xe0) | (byte)((n1>>2) & 0x1f)),												
								(byte) ((byte)((rfreq_word>>(4*8)) & 0x3f) | (byte)((n1<<6) & 0xc0)),
								(byte) ((rfreq_word>>(3*8)) & 0xff),
								(byte) ((rfreq_word>>(2*8)) & 0xff),
								(byte) ((rfreq_word>>(1*8)) & 0xff),
								(byte) ((rfreq_word>>(0 * 8)) & 0xff)
							};

            //JanusAudio.Write_I2C(hdev, 0x55, config);
        }

        //        private IntPtr hdev; 
        private static IntPtr hdev;

        static bool OzyOk = false;
        static double fo_init = 0.0;
        static ulong hs_div;
        static ulong n1;

        public void SI570_update() // modif F8CHK
        {
            //IntPtr ozy_hdev;
            double fo = saved_vfoa_freq * 1000000.0 * 4.0;
            double rfreq = 0;

            SoftRockCenterFreq = (double)saved_vfoa_freq;

            if ((!OzyOk) && JanusAudio.isFirmwareLoaded)
            {
                //hdev = HPSDR_USB_LIB_V1.USB.InitFindAndOpenDevice(0xfffe, 0x0007);
                IntPtr ozy_hdev = JanusAudio.OzyOpen();
                hdev = JanusAudio.OzyHandleToRealHandle(ozy_hdev);
                //JanusAudio.Set_I2C_Speed(hdev, 1);
                OzyOk = true;
            }

            if (OzyOk)
            {
                if (Math.Abs(fo - fo_init) > 200000.0)
                {
                    fo_init = fo;
                    si570_resolve(fo_init, ref rfreq, ref hs_div, ref n1);
                    si570_large_change(rfreq, hs_div, n1);
                }
                else
                    si570_small_change(fo, hs_div, n1);
            }
        }

        private string[] lineinboost = new string[32];
        private bool lineinarrayfill = false;
        private void MakeLineInList()
        {
            int k = 0;
            for (double i = -34.5; i <= 12; i += 1.5)
            {
                string s = i.ToString();
                lineinboost[k] = s;
                ++k;
            }
            lineinarrayfill = true;
        }

        private readonly byte[] Penny_TLV320 = new byte[2];
        private byte[] Penny_TLV320_data = new byte[18];
        public bool SetMicGain()
        {
            if ((chkPower.Checked) && (PennyPresent || pennylanepresent))
            {
                if (HPSDRisMetis)
                {
                    var v = mic_boost ? 1 : 0;
                    JanusAudio.SetMicBoost(v);

                    v = line_in ? 1 : 0;
                    JanusAudio.SetLineIn(v);

                    if (!lineinarrayfill) MakeLineInList();

                    var lineboost = Array.IndexOf(lineinboost, line_in_boost.ToString());

                    JanusAudio.SetLineBoost(lineboost);
                }
                else
                {
                    var oz_hdev = JanusAudio.OzyOpen();
                    var usb_hdev = JanusAudio.OzyHandleToRealHandle(oz_hdev);

                    // need to select the config data depending on the Mic Gain (20dB) or line in selected
                    if (line_in)
                    {
                        if (!lineinarrayfill) MakeLineInList();

                        var lineboost = Array.IndexOf(lineinboost, line_in_boost.ToString());

                        Penny_TLV320_data = new byte[] { 0x1e, 0x00,                    
                                                         0x12, 0x01, 
                                                         0x08, 0x12, // DAC on, line input, mic muted
                                                         0x0c, 0x00, 
                                                         0x0e, 0x02, 
                                                         0x10, 0x00, 
                                                         0x0a, 0x00, 
                                                         0x00, (byte)lineboost,//0x17, // left input, 0dB gain
                                                         0x02, 0x80}; // right input muted
                    }
                    else if (mic_boost)
                    {
                        Penny_TLV320_data = new byte[] { 0x1e, 0x00, 
                                                         0x12, 0x01, 
                                                         0x08, 0x15, // DAC on, mic input, 20dB gain
                                                         0x0c, 0x00, 
                                                         0x0e, 0x02, 
                                                         0x10, 0x00, 
                                                         0x0a, 0x00, 
                                                         0x00, 0x80,
                                                         0x02, 0x80};
                    }
                    else
                    {
                        Penny_TLV320_data = new byte[] { 0x1e, 0x00, // reset DAC registers
                                                         0x12, 0x01, // digital interface active
                                                         0x08, 0x14, // DAC on, mic input, 0dB gain
                                                         0x0c, 0x00, // all devices powered on
                                                         0x0e, 0x02, // i2s format
                                                         0x10, 0x00, // 48kHz sampling rate
                                                         0x0a, 0x00, // ADC high pass filter
                                                         0x00, 0x80, // mute left line in
                                                         0x02, 0x80}; // mute right line in
                    }

                    // set the I2C interface speed to 400kHZ
                    if (!(JanusAudio.Set_I2C_Speed(usb_hdev, 1)))
                    // if (!(OZY.Set_I2C_Speed(usb_hdev, 1)))
                    {
                        MessageBox.Show(@"Unable to set I2C speed to 400kHz", @"System Error!", MessageBoxButtons.OK, MessageBoxIcon.Error);
                        return false;
                    }

                    // send the configuration data to the TLV320 on Penelope or PennyLane 
                    for (var x = 0; x < 16; x += 2)
                    {
                        Penny_TLV320[0] = Penny_TLV320_data[x]; Penny_TLV320[1] = Penny_TLV320_data[x + 1];
                        // if ((OZY.Write_I2C(usb_hdev, 0x1b, Penny_TLV320))) continue;
                        if ((JanusAudio.WriteI2C(usb_hdev, 0x1b, Penny_TLV320, Penny_TLV320.Length))) continue;
                        MessageBox.Show(@"Unable to configure TLV320 on Penelope via I2C", @"System Eror!", MessageBoxButtons.OK, MessageBoxIcon.Error);
                        // break out of the configuration loop 
                        break;
                    }
                    JanusAudio.OzyClose(oz_hdev);
                }
            }
            return true;
        }

        #region Collapsible Display

        // W1CEG:  Start
        ///////////////////////////////////////////////////////////////////////////////
        // Collapsible Display                                                        //
        ///////////////////////////////////////////////////////////////////////////////

        private Size expandedSize = new Size(0, 0);

        private bool collapsedDisplay = false;
        public bool CollapsedDisplay
        {
            get { return this.collapsedDisplay; }
        }

        private bool showTopControls = false;
        public bool ShowTopControls
        {
            set { this.showTopControls = value; }
        }

        private bool showBandControls = false;
        public bool ShowBandControls
        {
            set { this.showBandControls = value; }
        }

        private bool showModeControls = false;
        public bool ShowModeControls
        {
            set { this.showModeControls = value; }
        }

        private void mnuCollapse_Click(object sender, EventArgs e)
        {
            if (this.collapsedDisplay)
                this.ExpandDisplay();
            else
                this.CollapseDisplay();
        }

        private void ExpandDisplay()
        {
            this.collapseToolStripMenuItem.Text = "Collapse";
            this.collapsedDisplay = false;
            this.filterToolStripMenuItem.Visible = false;
            this.dSPToolStripMenuItem.Visible = false;
            this.displayControlsToolStripMenuItem.Visible = false;
            this.bandToolStripMenuItem.Visible = false;
            this.modeToolStripMenuItem.Visible = false;
            int minWidth = console_basis_size.Width;
            int minHeight = (fwc_init && current_model == Model.FLEX5000 && FWCEEPROM.RX2OK) ?
                console_basis_size.Height - (panelRX2Filter.Height + 8) :
                console_basis_size.Height;

            this.Size = this.expandedSize;
            this.MinimumSize = new Size(minWidth, minHeight);

            panelPower.Show();
            grpVFOB.Show();
            grpVFOBetween.Show();
            grpMultimeter.Show();
            panelOptions.Show();
            panelSoundControls.Show();
            chkSquelch.Show();
            ptbSquelch.Show();
            picSquelch.Show();
            panelDateTime.Show();
            panelVFO.Show();
            panelDSP.Show();
            panelDisplay2.Show();
            panelMultiRX.Show();
            panelModeSpecificCW.Show();
            panelModeSpecificPhone.Show();
            panelModeSpecificDigital.Show();
            panelModeSpecificFM.Show();
            panelFilter.Show();
            panelMode.Show();
            panelBandHF.Show();
            panelBandVHF.Show();
            chkBCI.Show();
            lblAF2.Hide();
            lblRF2.Hide();
            lblModeLabel.Hide();
            lblFilterLabel.Hide();
            picMultiMeterDigital.Show();

            int h_delta = this.Width - console_basis_size.Width;
            int v_delta = Math.Max(this.Height - console_basis_size.Height, 0);

            grpVFOA.Location = new Point(gr_VFOA_basis_location.X + (h_delta / 4), gr_VFOA_basis_location.Y);
            grpVFOB.Location = new Point(gr_VFOB_basis_location.X + h_delta - (h_delta / 4), gr_VFOB_basis_location.Y);
            grpMultimeter.Size = gr_multi_meter_size_basis;
            picMultiMeterDigital.Parent = grpMultimeter;
            picMultiMeterDigital.Size = pic_multi_meter_size_basis;
            picMultiMeterDigital.Location = pic_multi_meter_digital_basis;
            lblMultiSMeter.Parent = grpMultimeter;
            lblMultiSMeter.Location = lbl_multi_smeter_basis;
            txtMultiText.Parent = grpMultimeter;
            txtMultiText.Location = txt_multi_text_basis;
            comboMeterRXMode.Parent = grpMultimeter;
            comboMeterRXMode.Location = combo_meter_rxmode_basis;
            comboMeterTXMode.Parent = grpMultimeter;
            comboMeterTXMode.Location = combo_meter_txmode_basis;
            //txtMultiText.Show();
            chkPower.Parent = panelPower;
            chkPower.Location = chk_power_basis;
            chkMON.Parent = panelOptions;
            chkMON.Location = chk_mon_basis;
            chkMUT.Parent = panelDSP;
            chkMUT.Location = chk_mut_basis;

            chkMOX.Parent = panelOptions;
            chkMOX.Location = chk_mox_basis;
            chkTUN.Parent = panelOptions;
            chkTUN.Location = chk_tun_basis;

            chkVOX.Parent = panelModeSpecificPhone;
            chkVOX.Location = chk_vox_basis;

            //lblAF.Parent = panelSoundControls;
            //lblAF.Location = lbl_af_basis;
            ptbAF.Parent = panelSoundControls;
            ptbAF.Location = tb_af_basis;
            ptbRF.Parent = panelSoundControls;
            ptbRF.Location = tb_rf_basis;
            comboAGC.Parent = panelSoundControls;
            comboAGC.Location = combo_agc_basis;
            comboPreamp.Parent = panelSoundControls;
            comboPreamp.Location = combo_preamp_basis;

            comboDisplayMode.Parent = panelDisplay2;
            comboDisplayMode.Location = combo_display_mode_basis;

            //btnDisplayPanCenter.Location = new Point(btn_display_pan_center_basis.X + (h_delta), btn_display_pan_center_basis.Y + v_delta);
            //ptbDisplayPan.Size = new Size(tb_display_pan_size_basis.Width + (h_delta), tb_display_pan_size_basis.Height);
            //ptbDisplayPan.Size = tb_display_pan_size_basis;
            //btnDisplayPanCenter.Location = new Point(ptbDisplayPan.Location.X + ptbDisplayPan.Width + 4, ptbDisplayPan.Location.Y);
            radDisplayZoom4x.Location = new Point(btn_display_zoom_4x_basis.X + h_delta, btn_display_zoom_4x_basis.Y + v_delta);
            radDisplayZoom2x.Location = new Point(btn_display_zoom_2x_basis.X + h_delta, btn_display_zoom_2x_basis.Y + v_delta);
            radDisplayZoom1x.Location = new Point(btn_display_zoom_1x_basis.X + h_delta, btn_display_zoom_1x_basis.Y + v_delta);
            radDisplayZoom05.Location = new Point(btn_display_zoom_05_basis.X + h_delta, btn_display_zoom_05_basis.Y + v_delta);
            ptbDisplayZoom.Location = new Point(tb_display_zoom_basis.X + h_delta, tb_display_zoom_basis.Y + v_delta);
            txtDisplayPeakFreq.Location = new Point(txt_display_peak_freq_basis.X + h_delta, txt_display_peak_freq_basis.Y + v_delta);
            txtDisplayPeakPower.Location = new Point(txt_display_peak_power_basis.X + h_delta, txt_display_peak_power_basis.Y + v_delta);
            txtDisplayPeakOffset.Location = new Point(txt_display_peak_offset_basis.X + h_delta, txt_display_peak_offset_basis.Y + v_delta);
            lblDisplayZoom.Location = new Point(lbl_display_zoom_basis.X + h_delta, lbl_display_zoom_basis.Y + v_delta);

            panelDisplay.Location = gr_display_basis;
            panelDisplay.Size = new Size(gr_display_size_basis.Width + h_delta, gr_display_size_basis.Height + v_delta);
            picDisplay.Location = pic_display_basis;
            picDisplay.Size = new Size(pic_display_size_basis.Width + h_delta, pic_display_size_basis.Height + v_delta);
            txtOverload.Size = new Size(txtOverload_size_basis.Width + h_delta, txtOverload_size_basis.Height);
            txtOverload.Location = new Point(txtOverload_basis.X, txtOverload_basis.Y + v_delta);
            panelDisplay2.Location = new Point(gr_display2_basis.X + (h_delta / 2), gr_display2_basis.Y + v_delta);
            panelDSP.Location = new Point(gr_dsp_basis.X + (h_delta / 2), gr_dsp_basis.Y + v_delta);

            ptbDisplayPan.Size = tb_display_pan_size_basis;
            ptbDisplayPan.Location = new Point(tb_displaypan_basis.X, tb_displaypan_basis.Y + v_delta);
            ptbDisplayZoom.Size = tb_display_zoom_size_basis;
            lblDisplayPan.Location = new Point(lbl_displaypan_basis.X, lbl_displaypan_basis.Y + v_delta);
            // ptbDisplayPan.Size = tb_display_pan_size_basis;
            btnDisplayPanCenter.Location = new Point(ptbDisplayPan.Location.X + ptbDisplayPan.Width + 4, ptbDisplayPan.Location.Y);
            txtDisplayCursorFreq.Location = new Point(txt_display_cursor_freq_basis.X, txt_display_cursor_freq_basis.Y + v_delta);
            txtDisplayCursorPower.Location = new Point(txt_display_cursor_power_basis.X, txt_display_cursor_power_basis.Y + v_delta);
            txtDisplayCursorOffset.Location = new Point(txt_display_cursor_offset_basis.X, txt_display_cursor_offset_basis.Y + v_delta);

            // :NOTE: Force update on pan control
            ptbDisplayPan.Value = ptbDisplayPan.Value;
            ptbDisplayPan_Scroll(this, EventArgs.Empty);

            // :NOTE: Force update on zoom control
            ptbDisplayZoom.Value = ptbDisplayZoom.Value;
            ptbDisplayZoom_Scroll(this, EventArgs.Empty);

            panelBandHF.Location = new Point(gr_BandHF_basis_location.X + h_delta, gr_BandHF_basis_location.Y + (v_delta / 4));
            panelBandHF.Size = gr_BandHF_basis_size;
            radBand160.Location = rad_band160_basis;
            radBand80.Location = rad_band80_basis;
            radBand60.Location = rad_band60_basis;
            radBand40.Location = rad_band40_basis;
            radBand30.Location = rad_band30_basis;
            radBand20.Location = rad_band20_basis;
            radBand17.Location = rad_band17_basis;
            radBand15.Location = rad_band15_basis;
            radBand12.Location = rad_band12_basis;
            radBand10.Location = rad_band10_basis;
            radBand6.Location = rad_band6_basis;
            radBand2.Location = rad_band2_basis;
            radBandWWV.Location = rad_bandwwv_basis;
            radBandGEN.Location = rad_bandgen_basis;

            panelMode.Location = new Point(gr_Mode_basis_location.X + h_delta, gr_Mode_basis_location.Y + (v_delta / 2));
            panelMode.Size = gr_Mode_basis_size;
            radModeLSB.Location = rad_mode_lsb_basis;
            radModeUSB.Location = rad_mode_usb_basis;
            radModeDSB.Location = rad_mode_dsb_basis;
            radModeCWL.Location = rad_mode_cwl_basis;
            radModeCWU.Location = rad_mode_cwu_basis;
            radModeFMN.Location = rad_mode_fmn_basis;
            radModeAM.Location = rad_mode_am_basis;
            radModeSAM.Location = rad_mode_sam_basis;
            radModeSPEC.Location = rad_mode_spec_basis;
            radModeDIGL.Location = rad_mode_digl_basis;
            radModeDIGU.Location = rad_mode_digu_basis;
            radModeDRM.Location = rad_mode_drm_basis;
        }

        public void CollapseDisplay()
        {
            // Save expanded display size
            if (!this.collapsedDisplay)
                this.expandedSize = this.Size;

            this.collapseToolStripMenuItem.Text = "Expand";
            this.collapsedDisplay = true;
            this.dSPToolStripMenuItem.Visible = true;
            this.filterToolStripMenuItem.Visible = true;
            this.displayControlsToolStripMenuItem.Visible = true;
            this.bandToolStripMenuItem.Visible = !SetupForm.chkShowBandControls.Checked;
            this.modeToolStripMenuItem.Visible = !SetupForm.chkShowModeControls.Checked;
            int minWidth = 600;
            int minHeight = 210;

            if (this.showTopControls)
            {
                minWidth = Math.Max(minWidth, console_basis_size.Width);
                minHeight += grpVFOA.Height + 5;
            }

            if (this.showBandControls)
            {
                minWidth = Math.Max(minWidth, radBand160.Width * 14 + this.Width - this.ClientSize.Width);
                minHeight += 5 + radBand160.Height;
            }

            if (this.showModeControls)
            {
                minWidth = Math.Max(minWidth, radModeLSB.Width * 12 + this.Width - this.ClientSize.Width);
                minHeight += 5 + radModeLSB.Height;
            }

            this.MinimumSize = new Size(minWidth, minHeight);

            panelPower.Hide();
            panelOptions.Hide();
            panelSoundControls.Hide();
            chkSquelch.Hide();
            ptbSquelch.Hide();
            picSquelch.Hide();
            panelDateTime.Hide();
            panelVFO.Hide();
            panelDSP.Hide();
            panelDisplay2.Hide();
            panelMultiRX.Hide();
            panelModeSpecificCW.Hide();
            panelModeSpecificPhone.Hide();
            panelModeSpecificDigital.Hide();
            panelModeSpecificFM.Hide();
            panelFilter.Hide();
            panelBandVHF.Hide();
            chkBCI.Hide();
            grpVFOBetween.Hide();
            grpVFOB.Hide();
            grpMultimeter.Hide();

            if (this.showTopControls)
            {
                chkPower.Parent = this;
                chkPower.Show();
                // grpVFOBetween.Show();
                //grpMultimeter.Show();
                picMultiMeterDigital.Parent = this;
                picMultiMeterDigital.Show();
                txtMultiText.Parent = this;
                txtMultiText.Show();

                chkMON.Parent = this;
                chkMON.Show();
                chkMUT.Parent = this;
                chkMUT.Show();
                chkMOX.Parent = this;
                chkMOX.Show();
                chkTUN.Parent = this;
                chkTUN.Show();

                chkVOX.Parent = this;
                chkVOX.Show();

                //lblAF2.Parent = this;
                lblAF2.Show();
                lblRF2.Show();
                ptbAF.Parent = this;
                ptbAF.Show();
                ptbRF.Parent = this;
                ptbRF.Show();
                comboAGC.Parent = this;
                comboAGC.Show();
                comboPreamp.Parent = this;
                comboPreamp.Show();

                lblMultiSMeter.Parent = this;
                lblMultiSMeter.Show();
                comboMeterRXMode.Parent = this;
                comboMeterRXMode.Show();
                comboMeterTXMode.Parent = this;
                comboMeterTXMode.Show();

                lblModeLabel.Show();
                lblFilterLabel.Show();

                if (current_meter_display_mode == MultiMeterDisplayMode.Original)
                {
                    current_meter_display_mode = MultiMeterDisplayMode.Edge;
                    SetupForm.comboMeterType.Text = "Edge";
                }
                /*      picMultiMeterDigital.Hide();
                      lblMultiSMeter.Show();
                  }
                  else
                  {
                      picMultiMeterDigital.Parent = this;
                      picMultiMeterDigital.Show();
                      lblMultiSMeter.Hide();
                  }*/

            }
            else
            {
                comboDisplayMode.Show();
                //chkPower.Hide();
                grpVFOBetween.Hide();
                grpMultimeter.Hide();
                lblAF2.Hide();
                lblRF2.Hide();
            }

            if (this.showBandControls)
                panelBandHF.Show();
            else
                panelBandHF.Hide();


            if (this.showModeControls)
                panelMode.Show();
            else
                panelMode.Hide();

            this.RepositionControlsForCollapsedlDisplay();

            this.Size = new Size(this.SetupForm.CollapsedWidth,
                this.SetupForm.CollapsedHeight);
        }

        private void RepositionControlsForCollapsedlDisplay()
        {
            int top = 0;
            int h_delta = this.Width - console_basis_size.Width;
            int v_delta = Math.Max(this.Height - console_basis_size.Height, 0);

            if (this.showTopControls)
            {
                top = grpVFOA.Height + 5;
                //top = grpMultimeter.Location.Y + grpMultimeter.Height + 5;
                //grpVFOA.Location = new Point(gr_VFOA_basis_location.X + (h_delta / 4), gr_VFOA_basis_location.Y);
                grpVFOA.Location = new Point((this.ClientSize.Width - grpVFOA.Width) / 2, gr_VFOA_basis_location.Y);
                //grpVFOB.Location = new Point(gr_VFOB_basis_location.X + h_delta - (h_delta / 4), gr_VFOB_basis_location.Y);
                txtMultiText.Location = new Point(((this.ClientSize.Width - (grpVFOA.Location.X + grpVFOA.Width)) -
                    (txtMultiText.Width / 12)) * 2, grpVFOA.Location.Y + 5);
                // picMultiMeterDigital.Location = txtMultiText.Location;
                // picMultiMeterDigital.Location = new Point(txtMultiText.Location.X, txtMultiText.Location.Y + txtMultiText.Height + 8);
                picMultiMeterDigital.Size = new Size(pic_multi_meter_size_basis.Width * 2, pic_multi_meter_size_basis.Height);
                picMultiMeterDigital.Location = new Point(((this.ClientSize.Width - (grpVFOA.Location.X + grpVFOA.Width)) -
                    (picMultiMeterDigital.Width / 6)) * 2, txtMultiText.Location.Y + txtMultiText.Height + 9);
                // picMultiMeterDigital.Size = new Size(pic_multi_meter_size_basis.Width * 2, pic_multi_meter_size_basis.Height);
                //grpMultimeter.Size = new Size(grpMultimeter.Width, grpVFOB.Height);
                /* if (current_meter_display_mode == MultiMeterDisplayMode.Original)               
                 {
                     picMultiMeterDigital.Size = new Size(pic_multi_meter_size_basis.Width, pic_multi_meter_size_basis.Height);
                     lblMultiSMeter.Location = new Point(picMultiMeterDigital.Location.X, picMultiMeterDigital.Location.Y +
                                                         picMultiMeterDigital.Height);
                     lblMultiSMeter.Show();
                 }
                 else lblMultiSMeter.Hide(); */

                comboMeterRXMode.Location = new Point(txtMultiText.Location.X - comboMeterRXMode.Width - 5,
                    txtMultiText.Location.Y + 2);
                // comboMeterTXMode.Location = new Point(comboMeterRXMode.Location.X, 
                //     comboMeterRXMode.Location.Y + comboMeterRXMode.Height + 1);
                comboMeterTXMode.Location = new Point(txtMultiText.Location.X + txtMultiText.Width + 5,
                    txtMultiText.Location.Y + 2);
                chkPower.Location = new Point(60, grpVFOA.Location.Y + 2);
                //chkMON.Location = new Point(10, chkPower.Location.Y + chkPower.Height + 5);
                chkMON.Location = new Point(grpVFOA.Location.X - chkMON.Width - 10, grpVFOA.Location.Y + 8);
                //chkMUT.Location = new Point(chkMON.Location.X + chkMON.Width, chkPower.Location.Y + chkPower.Height + 5);
                chkTUN.Location = new Point(chkMON.Location.X, chkMON.Location.Y + chkMON.Height + 4);
                chkMOX.Location = new Point(chkTUN.Location.X, chkTUN.Location.Y + chkTUN.Height + 4);
                chkVOX.Location = new Point(chkMON.Location.X - chkVOX.Width - 10, chkMON.Location.Y);
                lblAF2.Location = new Point(5, chkPower.Location.Y + chkPower.Height + 5);
                ptbAF.Location = new Point(lblAF2.Location.X + lblAF2.Width, lblAF2.Location.Y);
                //ptbAF.Location = new Point(10, chkPower.Location.Y + chkPower.Height + 2);
                lblRF2.Location = new Point(5, lblAF2.Location.Y + lblAF2.Height + 2);
                ptbRF.Location = new Point(lblRF2.Location.X + lblRF2.Width, ptbAF.Location.Y + ptbAF.Height + 2);
                comboAGC.Location = new Point(ptbRF.Location.X + ptbRF.Width + 2, ptbRF.Location.Y + 3);
                chkMUT.Location = new Point(ptbAF.Location.X + ptbAF.Width + 2, ptbAF.Location.Y);
                comboPreamp.Location = new Point(comboAGC.Location.X + comboPreamp.Width + 2, comboAGC.Location.Y);
            }

            panelDisplay.Location = new Point(0, top + 20);

            int height = this.ClientSize.Height - (top + 25);

            if (this.showBandControls)
                height -= radBand160.Height;

            if (this.showModeControls)
                height -= radModeLSB.Height;

            panelDisplay.Size = new Size(this.ClientSize.Width, height);

            picDisplay.Location = new Point(0, 0);
            picDisplay.Size = new Size(panelDisplay.Size.Width, panelDisplay.Size.Height - (txtOverload_size_basis.Height + 5 + tb_display_pan_size_basis.Height + 5));

            top = picDisplay.Location.Y + picDisplay.Height;
            txtDisplayCursorOffset.Location = new Point(picDisplay.Location.X, top);
            txtDisplayCursorPower.Location = new Point(txtDisplayCursorOffset.Location.X + txtDisplayCursorOffset.Width, top);
            txtDisplayCursorFreq.Location = new Point(txtDisplayCursorPower.Location.X + txtDisplayCursorPower.Width, top);
            txtOverload.Location = new Point(txtDisplayCursorFreq.Location.X + txtDisplayCursorFreq.Width, top);
            txtOverload.Size = new Size(picDisplay.Width - (txtDisplayPeakOffset.Width + txtDisplayPeakPower.Width + txtDisplayPeakFreq.Width + txtDisplayCursorOffset.Width + txtDisplayCursorPower.Width + txtDisplayCursorFreq.Width), txtOverload_size_basis.Height);
            txtDisplayPeakOffset.Location = new Point(txtOverload.Location.X + txtOverload.Width, top);
            txtDisplayPeakPower.Location = new Point(txtDisplayPeakOffset.Location.X + txtDisplayPeakOffset.Width, top);
            txtDisplayPeakFreq.Location = new Point(txtDisplayPeakPower.Location.X + txtDisplayPeakPower.Width, top);

            top = txtDisplayPeakOffset.Location.Y + txtDisplayPeakOffset.Height + 5;
            int dynamicWidth = picDisplay.Width - (lblDisplayPan.Width + btnDisplayPanCenter.Width + 5 +
                comboDisplayMode.Width + 5 + lblDisplayZoom.Width + radDisplayZoom05.Width * 4);

            lblDisplayPan.Location = new Point(picDisplay.Location.X, top);
            ptbDisplayPan.Location = new Point(lblDisplayPan.Location.X + lblDisplayPan.Width, top);
            ptbDisplayPan.Size = new Size(dynamicWidth / 2, tb_display_pan_size_basis.Height);
            btnDisplayPanCenter.Location = new Point(ptbDisplayPan.Location.X + ptbDisplayPan.Width, top);
            //			btnDisplayPanCenter_Click(this, EventArgs.Empty);

            // :NOTE: Force update on pan control
            ptbDisplayPan.Value = ptbDisplayPan.Value;
            ptbDisplayPan_Scroll(this, EventArgs.Empty);

            comboDisplayMode.Parent = panelDisplay;
            comboDisplayMode.Location = new Point(btnDisplayPanCenter.Location.X + btnDisplayPanCenter.Width + 5, top);

            lblDisplayZoom.Location = new Point(comboDisplayMode.Location.X + comboDisplayMode.Width + 5, top);
            ptbDisplayZoom.Location = new Point(lblDisplayZoom.Location.X + lblDisplayZoom.Width, top);
            ptbDisplayZoom.Size = new Size(dynamicWidth / 2, tb_display_zoom_size_basis.Height);

            // :NOTE: Force update on zoom control
            ptbDisplayZoom.Value = ptbDisplayZoom.Value;
            ptbDisplayZoom_Scroll(this, EventArgs.Empty);

            radDisplayZoom05.Location = new Point(ptbDisplayZoom.Location.X + ptbDisplayZoom.Width, top);
            radDisplayZoom1x.Location = new Point(radDisplayZoom05.Location.X + radDisplayZoom05.Width, top);
            radDisplayZoom2x.Location = new Point(radDisplayZoom1x.Location.X + radDisplayZoom1x.Width, top);
            radDisplayZoom4x.Location = new Point(radDisplayZoom2x.Location.X + radDisplayZoom2x.Width, top);


            top = panelDisplay.Location.Y + panelDisplay.Height;

            if (this.showBandControls)
            {
                panelBandHF.Location = new Point(this.ClientSize.Width / 2 - radBand160.Width * 7, top);
                panelBandHF.Size = new Size(radBand160.Width * 14, radBand160.Height);

                radBand160.Location = new Point(0, 0);
                radBand80.Location = new Point(radBand160.Location.X + radBand160.Width, 0);
                radBand60.Location = new Point(radBand80.Location.X + radBand80.Width, 0);
                radBand40.Location = new Point(radBand60.Location.X + radBand60.Width, 0);
                radBand30.Location = new Point(radBand40.Location.X + radBand40.Width, 0);
                radBand20.Location = new Point(radBand30.Location.X + radBand30.Width, 0);
                radBand17.Location = new Point(radBand20.Location.X + radBand20.Width, 0);
                radBand15.Location = new Point(radBand17.Location.X + radBand17.Width, 0);
                radBand12.Location = new Point(radBand15.Location.X + radBand15.Width, 0);
                radBand10.Location = new Point(radBand12.Location.X + radBand12.Width, 0);
                radBand6.Location = new Point(radBand10.Location.X + radBand10.Width, 0);
                radBand2.Location = new Point(radBand6.Location.X + radBand6.Width, 0);
                radBandWWV.Location = new Point(radBand2.Location.X + radBand2.Width, 0);
                radBandGEN.Location = new Point(radBandWWV.Location.X + radBandWWV.Width, 0);

                top = panelBandHF.Location.Y + panelBandHF.Height;
            }

            if (this.showModeControls)
            {
                panelMode.Location = new Point(this.ClientSize.Width / 2 - radModeLSB.Width * 6, top);
                panelMode.Size = new Size(radModeLSB.Width * 12, radModeLSB.Height);

                radModeLSB.Location = new Point(0, 0);
                radModeUSB.Location = new Point(radModeLSB.Location.X + radModeLSB.Width, 0);
                radModeDSB.Location = new Point(radModeUSB.Location.X + radModeUSB.Width, 0);
                radModeCWL.Location = new Point(radModeDSB.Location.X + radModeDSB.Width, 0);
                radModeCWU.Location = new Point(radModeCWL.Location.X + radModeCWL.Width, 0);
                radModeFMN.Location = new Point(radModeCWU.Location.X + radModeCWU.Width, 0);
                radModeAM.Location = new Point(radModeFMN.Location.X + radModeFMN.Width, 0);
                radModeSAM.Location = new Point(radModeAM.Location.X + radModeAM.Width, 0);
                radModeSPEC.Location = new Point(radModeSAM.Location.X + radModeSAM.Width, 0);
                radModeDIGL.Location = new Point(radModeSPEC.Location.X + radModeSPEC.Width, 0);
                radModeDIGU.Location = new Point(radModeDIGL.Location.X + radModeDIGL.Width, 0);
                radModeDRM.Location = new Point(radModeDIGU.Location.X + radModeDIGU.Width, 0);

                top = panelMode.Location.Y + panelMode.Height;
            }

            if (!this.showTopControls)
            {
                grpVFOA.Location = new Point(grpVFOA.Location.X, -200);
                //grpVFOB.Location = new Point(grpVFOB.Location.X, -200);
            }
        }
        // W1CEG:  End
        #endregion Collapsible Display

        private void mnuFilter_Click(object sender, EventArgs e)
        {
            if (sender == null) return;
            if (sender.GetType() != typeof(ToolStripMenuItem)) return;
            string menu_item = ((ToolStripMenuItem)sender).Name;

            switch (menu_item)
            {
                case "FilterToolStripMenuItem1":
                    radFilter1.Checked = true;
                    break;
                case "FilterToolStripMenuItem2":
                    radFilter2.Checked = true;
                    break;
                case "FilterToolStripMenuItem3":
                    radFilter3.Checked = true;
                    break;
                case "FilterToolStripMenuItem4":
                    radFilter4.Checked = true;
                    break;
                case "FilterToolStripMenuItem5":
                    radFilter5.Checked = true;
                    break;
                case "FilterToolStripMenuItem6":
                    radFilter6.Checked = true;
                    break;
                case "FilterToolStripMenuItem7":
                    radFilter7.Checked = true;
                    break;
                case "FilterToolStripMenuItem8":
                    radFilter8.Checked = true;
                    break;
                case "FilterToolStripMenuItem9":
                    radFilter9.Checked = true;
                    break;
                case "FilterToolStripMenuItem10":
                    radFilter10.Checked = true;
                    break;
            }
        }

        private void mnuDSP_Click(object sender, EventArgs e)
        {
            if (sender == null) return;
            if (sender.GetType() != typeof(ToolStripMenuItem)) return;
            string menu_item = ((ToolStripMenuItem)sender).Text;

            switch (menu_item)
            {
                case "NR":
                    chkNR.Checked = !chkNR.Checked;
                    break;
                case "ANF":
                    chkANF.Checked = !chkANF.Checked;
                    break;
                case "NB":
                    chkNB.Checked = !chkNB.Checked;
                    break;
                case "NB2":
                    chkDSPNB2.Checked = !chkDSPNB2.Checked;
                    break;
                case "BIN":
                    chkBIN.Checked = !chkBIN.Checked;
                    break;
                case "Multi-RX":
                    chkEnableMultiRX.Checked = !chkEnableMultiRX.Checked;
                    break;
            }
        }

        private void mnuBand_Click(object sender, EventArgs e)
        {
            if (sender == null) return;
            if (sender.GetType() != typeof(ToolStripMenuItem)) return;
            string menu_item = ((ToolStripMenuItem)sender).Text;

            switch (menu_item)
            {
                case "160":
                    radBand160_Click(this, EventArgs.Empty);
                    break;
                case "80":
                    radBand80_Click(this, EventArgs.Empty);
                    break;
                case "60":
                    radBand60_Click(this, EventArgs.Empty);
                    break;
                case "40":
                    radBand40_Click(this, EventArgs.Empty);
                    break;
                case "30":
                    radBand30_Click(this, EventArgs.Empty);
                    break;
                case "20":
                    radBand20_Click(this, EventArgs.Empty);
                    break;
                case "17":
                    radBand17_Click(this, EventArgs.Empty);
                    break;
                case "15":
                    radBand15_Click(this, EventArgs.Empty);
                    break;
                case "12":
                    radBand12_Click(this, EventArgs.Empty);
                    break;
                case "10":
                    radBand10_Click(this, EventArgs.Empty);
                    break;
                case "6":
                    radBand6_Click(this, EventArgs.Empty);
                    break;
                case "WWV":
                    radBandWWV_Click(this, EventArgs.Empty);
                    break;
                case "GEN":
                    radBandGEN_Click(this, EventArgs.Empty);
                    break;
            }
        }

        private void mnuMode_Click(object sender, EventArgs e)
        {
            if (sender == null) return;
            if (sender.GetType() != typeof(ToolStripMenuItem)) return;
            string menu_item = ((ToolStripMenuItem)sender).Text;

            switch (menu_item)
            {
                case "LSB":
                    radModeLSB.Checked = true;
                    break;
                case "USB":
                    radModeUSB.Checked = true;
                    break;
                case "DSB":
                    radModeDSB.Checked = true;
                    break;
                case "CWL":
                    radModeCWL.Checked = true;
                    break;
                case "CWU":
                    radModeCWU.Checked = true;
                    break;
                case "FM":
                    radModeFMN.Checked = true;
                    break;
                case "AM":
                    radModeAM.Checked = true;
                    break;
                case "SAM":
                    radModeSAM.Checked = true;
                    break;
                case "SPEC":
                    radModeSPEC.Checked = true;
                    break;
                case "DIGL":
                    radModeDIGL.Checked = true;
                    break;
                case "DIGU":
                    radModeDIGU.Checked = true;
                    break;
                case "DRM":
                    radModeDRM.Checked = true;
                    break;
            }
        }

        private void mnuShowTopControls_Click(object sender, EventArgs e)
        {
            SetupForm.chkShowTopControls.Checked = !SetupForm.chkShowTopControls.Checked;
        }

        private void mnuShowBandControls_Click(object sender, EventArgs e)
        {
            SetupForm.chkShowBandControls.Checked = !SetupForm.chkShowBandControls.Checked;
        }

        private void mnuShowModeControls_Click(object sender, EventArgs e)
        {
            SetupForm.chkShowModeControls.Checked = !SetupForm.chkShowModeControls.Checked;
        }

        private void chkCWDisableTXDisplay_CheckedChanged(object sender, EventArgs e)
        {
            Display.CWDisableTXDisplay = chkCWDisableTXDisplay.Checked;
        }

        private void radBand_CheckedChanged(object sender, EventArgs e)
        {
            if (sender == null) return;
            if (sender.GetType() != typeof(RadioButtonTS)) return;
            RadioButtonTS radioBtnTS = (RadioButtonTS)sender;
            if (!radioBtnTS.Checked) return;

            bandtoolStripMenuItem1.Checked = radBand160.Checked;
            bandtoolStripMenuItem2.Checked = radBand80.Checked;
            bandtoolStripMenuItem3.Checked = radBand60.Checked;
            bandtoolStripMenuItem4.Checked = radBand40.Checked;
            bandtoolStripMenuItem5.Checked = radBand30.Checked;
            bandtoolStripMenuItem14.Checked = radBand20.Checked;
            bandtoolStripMenuItem7.Checked = radBand17.Checked;
            bandtoolStripMenuItem8.Checked = radBand15.Checked;
            bandtoolStripMenuItem9.Checked = radBand12.Checked;
            bandtoolStripMenuItem10.Checked = radBand10.Checked;
            bandtoolStripMenuItem11.Checked = radBand6.Checked;
            bandtoolStripMenuItem12.Checked = radBandWWV.Checked;
            bandtoolStripMenuItem13.Checked = radBandGEN.Checked;
        }

        private void chkFWCATUBypass_CheckedChanged(object sender, EventArgs e)
        {
            Audio.HPSDRDuplexEnabled = chkFWCATUBypass.Checked;
            Display.HPSDRDuplexEnabled = chkFWCATUBypass.Checked;
            HPSDRDuplexEnabled = chkFWCATUBypass.Checked;
        }

    }
}